function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4}!function(){function C(){return function(){}}function la(){return"x"+ ++ca+ +new Date}function G(){return+new Date}function qa(a,d){var b=a.join(ia),c=[];return d?(N(d,function(a,b){var d="object"==typeof b?JSON.stringify(b):b;"undefined"!=typeof b&&b!=z&&0<encodeURIComponent(d).length&&c.push(a+"="+encodeURIComponent(d))}),b+="?"+c.join(ja)):b}function ra(a,d){function b(){f+d>G()?(clearTimeout(c),c=setTimeout(b,d)):(f=G(),a())}var c,f=0;return b}function sa(a,d){var b=[];return N(a||[],function(a){d(a)&&b.push(a)}),b}function ta(a,d){return a.replace(ka,function(a,c){return d[c]||a})}function pa(a){var d="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"==a?c:3&c|8).toString(16)});return a&&a(d),d}function N(a,d){if(a&&d)if(a&&(Array.isArray&&Array.isArray(a)||"number"==typeof a.length))for(var b=0,c=a.length;c>b;)d.call(a[b],a[b],b++);else for(b in a)a.hasOwnProperty&&a.hasOwnProperty(b)&&d.call(a[b],b,a[b])}function ua(a,d){var b=[];return N(a||[],function(a,f){b.push(d(a,f))}),b}function va(a,d){var b=[];return N(a,function(a,f){d?0>a.search("-pnpres")&&f.f&&b.push(a):f.f&&b.push(a)}),b.sort()}function wa(){setTimeout(function(){fa||(fa=1,N(ga,function(a){a()}))},D)}function ya(a,d){var c,f,b="";if(d){if(c=a[15],c>16)throw"Decryption error: Maybe bad key";if(16==c)return"";for(f=0;16-c>f;f++)b+=String.fromCharCode(a[f])}else for(f=0;16>f;f++)b+=String.fromCharCode(a[f]);return b}function za(a,d){var c,b=[];if(!d)try{a=unescape(encodeURIComponent(a))}catch(f){throw"Error on UTF-8 encode"}for(c=0;c<a.length;c++)b[c]=a.charCodeAt(c);return b}function Aa(a,d){var q,b=T>=12?3:2,c=[],f=[],c=[],f=[],p=a.concat(d);for(c[0]=GibberishAES.l.m(p),f=c[0],q=1;b>q;q++)c[q]=GibberishAES.l.m(c[q-1].concat(p)),f=f.concat(c[q]);return c=f.slice(0,4*U),f=f.slice(4*U,4*U+16),{key:c,i:f}}function Ba(a,d,b){var p,d=Ca(d),c=Math.ceil(a.length/16),f=[],q=[];for(p=0;c>p;p++){var m=f,u=p,x=a.slice(16*p,16*p+16),t=[],r=v,r=v;for(16>x.length&&(r=16-x.length,t=[r,r,r,r,r,r,r,r,r,r,r,r,r,r,r,r]),r=0;r<x.length;r++)t[r]=x[r];m[u]=t}for(0===a.length%16&&f.push([16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16]),p=0;p<f.length;p++)f[p]=0===p?Da(f[p],b):Da(f[p],q[p-1]),q[p]=Ea(f[p],d);return q}function Fa(a,d,b,c){var q,d=Ca(d),f=a.length/16,p=[],m=[],u="";for(q=0;f>q;q++)p.push(a.slice(16*q,16*(q+1)));for(q=p.length-1;q>=0;q--)m[q]=Ga(p[q],d),m[q]=0===q?Da(m[q],b):Da(m[q],p[q-1]);for(q=0;f-1>q;q++)u+=ya(m[q]);var x,u=u+ya(m[q],y);if(c)x=u;else try{x=decodeURIComponent(escape(u))}catch(t){throw"Bad Key"}return x}function Ea(a,d){xa=A;var c,b=La(a,d,0);for(c=1;T+1>c;c++)b=Ma(b),b=Na(b),T>c&&(b=Oa(b)),b=La(b,d,c);return b}function Ga(a,d){xa=y;var c,b=La(a,d,T);for(c=T-1;c>-1;c--)b=Na(b),b=Ma(b),b=La(b,d,c),c>0&&(b=Oa(b));return b}function Ma(a){var c,d=xa?Pa:Qa,b=[];for(c=0;16>c;c++)b[c]=d[a[c]];return b}function Na(a){var c,d=[],b=xa?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11];for(c=0;16>c;c++)d[c]=a[b[c]];return d}function Oa(a){var b,d=[];if(xa)for(b=0;4>b;b++)d[4*b]=Ta[a[4*b]]^Ua[a[1+4*b]]^Za[a[2+4*b]]^$a[a[3+4*b]],d[1+4*b]=$a[a[4*b]]^Ta[a[1+4*b]]^Ua[a[2+4*b]]^Za[a[3+4*b]],d[2+4*b]=Za[a[4*b]]^$a[a[1+4*b]]^Ta[a[2+4*b]]^Ua[a[3+4*b]],d[3+4*b]=Ua[a[4*b]]^Za[a[1+4*b]]^$a[a[2+4*b]]^Ta[a[3+4*b]];else for(b=0;4>b;b++)d[4*b]=ab[a[4*b]]^bb[a[1+4*b]]^a[2+4*b]^a[3+4*b],d[1+4*b]=a[4*b]^ab[a[1+4*b]]^bb[a[2+4*b]]^a[3+4*b],d[2+4*b]=a[4*b]^a[1+4*b]^ab[a[2+4*b]]^bb[a[3+4*b]],d[3+4*b]=bb[a[4*b]]^a[1+4*b]^a[2+4*b]^ab[a[3+4*b]];return d}function La(a,d,b){var f,c=[];for(f=0;16>f;f++)c[f]=a[f]^d[b][f];return c}function Da(a,d){var c,b=[];for(c=0;16>c;c++)b[c]=a[c]^d[c];return b}function Ca(a){var c,f,d=[],b=[],p=[];for(c=0;U>c;c++)f=[a[4*c],a[4*c+1],a[4*c+2],a[4*c+3]],d[c]=f;for(c=U;4*(T+1)>c;c++){for(d[c]=[],a=0;4>a;a++)b[a]=d[c-1][a];if(0===c%U){for(a=b[0],f=v,f=0;4>f;f++)b[f]=b[f+1];b[3]=a,b=cb(b),b[0]^=db[c/U-1]}else U>6&&4==c%U&&(b=cb(b));for(a=0;4>a;a++)d[c][a]=d[c-U][a]^b[a]}for(c=0;T+1>c;c++)for(p[c]=[],b=0;4>b;b++)p[c].push(d[4*c+b][0],d[4*c+b][1],d[4*c+b][2],d[4*c+b][3]);return p}function cb(a){for(var d=0;4>d;d++)a[d]=Qa[a[d]];return a}function eb(a,d){var b=[];for(i=0;i<a.length;i+=d)b[i/d]=parseInt(a.substr(i,d),16);return b}function fb(a){for(var d=[],b=0;256>b;b++){for(var c=a,f=b,p=v,q=v,p=q=0;8>p;p++)q=1==(1&f)?q^c:q,c=c>127?283^c<<1:c<<1,f>>>=1;d[b]=q}return d}var CryptoJS=CryptoJS||function(h,s){var f={},g=f.lib={},q=function(){},m=g.Base={extend:function(a){q.prototype=this;var c=new q;return a&&c.mixIn(a),c.hasOwnProperty("init")||(c.init=function(){c.$super.init.apply(this,arguments)}),c.init.prototype=c,c.$super=this,c},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var c in a)a.hasOwnProperty(c)&&(this[c]=a[c]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}},r=g.WordArray=m.extend({init:function(a,c){a=this.words=a||[],this.sigBytes=c!=s?c:4*a.length},toString:function(a){return(a||k).stringify(this)},concat:function(a){var c=this.words,d=a.words,b=this.sigBytes;if(a=a.sigBytes,this.clamp(),b%4)for(var e=0;a>e;e++)c[b+e>>>2]|=(d[e>>>2]>>>24-8*(e%4)&255)<<24-8*((b+e)%4);else if(65535<d.length)for(e=0;a>e;e+=4)c[b+e>>>2]=d[e>>>2];else c.push.apply(c,d);return this.sigBytes+=a,this},clamp:function(){var a=this.words,c=this.sigBytes;a[c>>>2]&=4294967295<<32-8*(c%4),a.length=h.ceil(c/4)},clone:function(){var a=m.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var c=[],d=0;a>d;d+=4)c.push(4294967296*h.random()|0);return new r.init(c,a)}}),l=f.enc={},k=l.Hex={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;a>b;b++){var e=c[b>>>2]>>>24-8*(b%4)&255;d.push((e>>>4).toString(16)),d.push((15&e).toString(16))}return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;c>b;b+=2)d[b>>>3]|=parseInt(a.substr(b,2),16)<<24-4*(b%8);return new r.init(d,c/2)}},n=l.Latin1={stringify:function(a){var c=a.words;a=a.sigBytes;for(var d=[],b=0;a>b;b++)d.push(String.fromCharCode(c[b>>>2]>>>24-8*(b%4)&255));return d.join("")},parse:function(a){for(var c=a.length,d=[],b=0;c>b;b++)d[b>>>2]|=(255&a.charCodeAt(b))<<24-8*(b%4);return new r.init(d,c)}},j=l.Utf8={stringify:function(a){try{return decodeURIComponent(escape(n.stringify(a)))}catch(c){throw Error("Malformed UTF-8 data")}},parse:function(a){return n.parse(unescape(encodeURIComponent(a)))}},u=g.BufferedBlockAlgorithm=m.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(a){"string"==typeof a&&(a=j.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var c=this._data,d=c.words,b=c.sigBytes,e=this.blockSize,f=b/(4*e),f=a?h.ceil(f):h.max((0|f)-this._minBufferSize,0);if(a=f*e,b=h.min(4*a,b),a){for(var g=0;a>g;g+=e)this._doProcessBlock(d,g);g=d.splice(0,a),c.sigBytes-=b}return new r.init(g,b)},clone:function(){var a=m.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});g.Hasher=u.extend({cfg:m.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){u.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){return a&&this._append(a),this._doFinalize()},blockSize:16,_createHelper:function(a){return function(c,d){return new a.init(d).finalize(c)}},_createHmacHelper:function(a){return function(c,d){return new t.HMAC.init(a,d).finalize(c)}}});var t=f.algo={};return f}(Math);!function(h){for(var s=CryptoJS,f=s.lib,g=f.WordArray,q=f.Hasher,f=s.algo,m=[],r=[],l=function(a){return 4294967296*(a-(0|a))|0},k=2,n=0;64>n;){var j;a:{j=k;for(var u=h.sqrt(j),t=2;u>=t;t++)if(!(j%t)){j=!1;break a}j=!0}j&&(8>n&&(m[n]=l(h.pow(k,.5))),r[n]=l(h.pow(k,1/3)),n++),k++}var a=[],f=f.SHA256=q.extend({_doReset:function(){this._hash=new g.init(m.slice(0))},_doProcessBlock:function(c,d){for(var b=this._hash.words,e=b[0],f=b[1],g=b[2],j=b[3],h=b[4],m=b[5],n=b[6],q=b[7],p=0;64>p;p++){if(16>p)a[p]=0|c[d+p];else{var k=a[p-15],l=a[p-2];a[p]=((k<<25|k>>>7)^(k<<14|k>>>18)^k>>>3)+a[p-7]+((l<<15|l>>>17)^(l<<13|l>>>19)^l>>>10)+a[p-16]}k=q+((h<<26|h>>>6)^(h<<21|h>>>11)^(h<<7|h>>>25))+(h&m^~h&n)+r[p]+a[p],l=((e<<30|e>>>2)^(e<<19|e>>>13)^(e<<10|e>>>22))+(e&f^e&g^f&g),q=n,n=m,m=h,h=j+k|0,j=g,g=f,f=e,e=k+l|0}b[0]=b[0]+e|0,b[1]=b[1]+f|0,b[2]=b[2]+g|0,b[3]=b[3]+j|0,b[4]=b[4]+h|0,b[5]=b[5]+m|0,b[6]=b[6]+n|0,b[7]=b[7]+q|0},_doFinalize:function(){var a=this._data,d=a.words,b=8*this._nDataBytes,e=8*a.sigBytes;return d[e>>>5]|=128<<24-e%32,d[(e+64>>>9<<4)+14]=h.floor(b/4294967296),d[(e+64>>>9<<4)+15]=b,a.sigBytes=4*d.length,this._process(),this._hash},clone:function(){var a=q.clone.call(this);return a._hash=this._hash.clone(),a}});s.SHA256=q._createHelper(f),s.HmacSHA256=q._createHmacHelper(f)}(Math),function(){var h=CryptoJS,s=h.enc.Utf8;h.algo.HMAC=h.lib.Base.extend({init:function(f,g){f=this._hasher=new f.init,"string"==typeof g&&(g=s.parse(g));var h=f.blockSize,m=4*h;g.sigBytes>m&&(g=f.finalize(g)),g.clamp();for(var r=this._oKey=g.clone(),l=this._iKey=g.clone(),k=r.words,n=l.words,j=0;h>j;j++)k[j]^=1549556828,n[j]^=909522486;r.sigBytes=l.sigBytes=m,this.reset()},reset:function(){var f=this._hasher;f.reset(),f.update(this._iKey)},update:function(f){return this._hasher.update(f),this},finalize:function(f){var g=this._hasher;return f=g.finalize(f),g.reset(),g.finalize(this._oKey.clone().concat(f))}})}(),function(){var h=CryptoJS,j=h.lib.WordArray;h.enc.Base64={stringify:function(b){var e=b.words,f=b.sigBytes,c=this._map;b.clamp(),b=[];for(var a=0;f>a;a+=3)for(var d=(e[a>>>2]>>>24-8*(a%4)&255)<<16|(e[a+1>>>2]>>>24-8*((a+1)%4)&255)<<8|e[a+2>>>2]>>>24-8*((a+2)%4)&255,g=0;4>g&&f>a+.75*g;g++)b.push(c.charAt(d>>>6*(3-g)&63));if(e=c.charAt(64))for(;b.length%4;)b.push(e);return b.join("")},parse:function(b){var e=b.length,f=this._map,c=f.charAt(64);c&&(c=b.indexOf(c),-1!=c&&(e=c));for(var c=[],a=0,d=0;e>d;d++)if(d%4){var g=f.indexOf(b.charAt(d-1))<<2*(d%4),h=f.indexOf(b.charAt(d))>>>6-2*(d%4);c[a>>>2]|=(g|h)<<24-8*(a%4),a++}return j.create(c,a)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}();var v=void 0,y=!0,z=null,A=!1;window.JSON&&window.JSON.stringify||function(){function a(){try{return this.valueOf()}catch(a){return z}}function d(a){return c.lastIndex=0,c.test(a)?'"'+a.replace(c,function(a){var b=q[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function b(c,q){var t,r,g,j,h,l=f,e=q[c];switch(e&&"object"==typeof e&&(e=a.call(e)),"function"==typeof m&&(e=m.call(q,c,e)),typeof e){case"string":return d(e);case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(f+=p,h=[],"[object Array]"===Object.prototype.toString.apply(e)){for(j=e.length,t=0;j>t;t+=1)h[t]=b(t,e)||"null";return g=0===h.length?"[]":f?"[\n"+f+h.join(",\n"+f)+"\n"+l+"]":"["+h.join(",")+"]",f=l,g}if(m&&"object"==typeof m)for(j=m.length,t=0;j>t;t+=1)r=m[t],"string"==typeof r&&(g=b(r,e))&&h.push(d(r)+(f?": ":":")+g);else for(r in e)Object.hasOwnProperty.call(e,r)&&(g=b(r,e))&&h.push(d(r)+(f?": ":":")+g);return g=0===h.length?"{}":f?"{\n"+f+h.join(",\n"+f)+"\n"+l+"}":"{"+h.join(",")+"}",f=l,g}}window.JSON||(window.JSON={});var c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,p,q={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},m;"function"!=typeof JSON.stringify&&(JSON.stringify=function(a,c,d){var q;if(p=f="","number"==typeof d)for(q=0;d>q;q+=1)p+=" ";else"string"==typeof d&&(p=d);if((m=c)&&"function"!=typeof c&&("object"!=typeof c||"number"!=typeof c.length))throw Error("JSON.stringify");return b("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(a){return eval("("+a+")")})}();var ca=1,fa=A,ga=[],ha="-pnpres",D=1e3,ia="/",ja="&",ka=/{([\w\-]+)}/g,ma,na=Math.floor(20*Math.random());ma=function(a,d){return 0<a.indexOf("pubsub.")&&a.replace("pubsub","ps"+(d?pa().split("-")[0]:20>++na?na:na=1))||a};var O,T=14,U=8,xa=A,Qa=eb("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16",2),Pa,gb=Qa,hb=[];for(i=0;i<gb.length;i++)hb[gb[i]]=i;Pa=hb;var db=eb("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591",2),ab=fb(2),bb=fb(3),$a=fb(9),Ua=fb(11),Za=fb(13),Ta=fb(14),ib,jb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",kb=jb.split("");if("function"==typeof Array.indexOf&&(jb=kb),ib={encode:function(a){var c,d=[],b="";for(c=0;c<16*a.length;c++)d.push(a[Math.floor(c/16)][c%16]);for(c=0;c<d.length;c+=3)b+=kb[d[c]>>2],b+=kb[(3&d[c])<<4|d[c+1]>>4],b=d[c+1]!==v?b+kb[(15&d[c+1])<<2|d[c+2]>>6]:b+"=",b=d[c+2]!==v?b+kb[63&d[c+2]]:b+"=";for(a=b.slice(0,64),c=1;c<Math.ceil(b.length/64);c++)a+=b.slice(64*c,64*c+64)+(Math.ceil(b.length/64)==c+1?"":"\n");return a},decode:function(a){var f,a=a.replace(/\n/g,""),d=[],b=[],c=[];for(f=0;f<a.length;f+=4)b[0]=jb.indexOf(a.charAt(f)),b[1]=jb.indexOf(a.charAt(f+1)),b[2]=jb.indexOf(a.charAt(f+2)),b[3]=jb.indexOf(a.charAt(f+3)),c[0]=b[0]<<2|b[1]>>4,c[1]=(15&b[1])<<4|b[2]>>2,c[2]=(3&b[2])<<6|b[3],d.push(c[0],c[1],c[2]);return d=d.slice(0,d.length-d.length%16)}},O={size:function(a){switch(a){case 128:T=10,U=4;break;case 192:T=12,U=6;break;case 256:T=14,U=8;break;default:throw"Invalid Key Size Specified:"+a}},h2a:function(a){var d=[];return a.replace(/(..)/g,function(a){d.push(parseInt(a,16))}),d},expandKey:Ca,encryptBlock:Ea,decryptBlock:Ga,Decrypt:xa,s2a:za,rawEncrypt:Ba,rawDecrypt:Fa,dec:function(a,d,b){var a=ib.q(a),c=a.slice(8,16),c=Aa(za(d,b),c),d=c.key,c=c.i,a=a.slice(16,a.length);return a=Fa(a,d,c,b)},openSSLKey:Aa,a2h:function(a){var b,d="";for(b=0;b<a.length;b++)d+=(16>a[b]?"0":"")+a[b].toString(16);return d},enc:function(a,d,b){var c;c=[];var f;for(f=0;8>f;f++)c=c.concat(Math.floor(256*Math.random()));return f=Aa(za(d,b),c),d=f.key,f=f.i,c=[[83,97,108,116,101,100,95,95].concat(c)],a=za(a,b),a=Ba(a,d,f),a=c.concat(a),ib.s(a)},Hash:{MD5:function(a){function d(a,b){var c,d,f,e,g;return f=2147483648&a,e=2147483648&b,c=1073741824&a,d=1073741824&b,g=(1073741823&a)+(1073741823&b),c&d?2147483648^g^f^e:c|d?1073741824&g?3221225472^g^f^e:1073741824^g^f^e:g^f^e}function b(a,b,c,f,e,g,l){return a=d(a,d(d(b&c|~b&f,e),l)),d(a<<g|a>>>32-g,b)}function c(a,b,c,f,e,g,l){return a=d(a,d(d(b&f|c&~f,e),l)),d(a<<g|a>>>32-g,b)}function f(a,b,c,f,e,g,l){return a=d(a,d(d(b^c^f,e),l)),d(a<<g|a>>>32-g,b)}function p(a,b,c,f,g,e,l){return a=d(a,d(d(c^(b|~f),g),l)),d(a<<e|a>>>32-e,b)}function q(a){var b,c,d=[];for(c=0;3>=c;c++)b=a>>>8*c&255,d=d.concat(b);return d}var u,x,t,r,g,j,h,l,m=[],e=eb("67452301efcdab8998badcfe10325476d76aa478e8c7b756242070dbc1bdceeef57c0faf4787c62aa8304613fd469501698098d88b44f7afffff5bb1895cd7be6b901122fd987193a679438e49b40821f61e2562c040b340265e5a51e9b6c7aad62f105d02441453d8a1e681e7d3fbc821e1cde6c33707d6f4d50d87455a14eda9e3e905fcefa3f8676f02d98d2a4c8afffa39428771f6816d9d6122fde5380ca4beea444bdecfa9f6bb4b60bebfbc70289b7ec6eaa127fad4ef308504881d05d9d4d039e6db99e51fa27cf8c4ac5665f4292244432aff97ab9423a7fc93a039655b59c38f0ccc92ffeff47d85845dd16fa87e4ffe2ce6e0a30143144e0811a1f7537e82bd3af2352ad7d2bbeb86d391",8),m=a.length;for(u=m+8,x=16*((u-u%64)/64+1),t=[],g=r=0;m>g;)u=(g-g%4)/4,r=8*(g%4),t[u]|=a[g]<<r,g++;for(u=(g-g%4)/4,t[u]|=128<<8*(g%4),t[x-2]=m<<3,t[x-1]=m>>>29,m=t,g=e[0],j=e[1],h=e[2],l=e[3],a=0;a<m.length;a+=16)u=g,x=j,t=h,r=l,g=b(g,j,h,l,m[a+0],7,e[4]),l=b(l,g,j,h,m[a+1],12,e[5]),h=b(h,l,g,j,m[a+2],17,e[6]),j=b(j,h,l,g,m[a+3],22,e[7]),g=b(g,j,h,l,m[a+4],7,e[8]),l=b(l,g,j,h,m[a+5],12,e[9]),h=b(h,l,g,j,m[a+6],17,e[10]),j=b(j,h,l,g,m[a+7],22,e[11]),g=b(g,j,h,l,m[a+8],7,e[12]),l=b(l,g,j,h,m[a+9],12,e[13]),h=b(h,l,g,j,m[a+10],17,e[14]),j=b(j,h,l,g,m[a+11],22,e[15]),g=b(g,j,h,l,m[a+12],7,e[16]),l=b(l,g,j,h,m[a+13],12,e[17]),h=b(h,l,g,j,m[a+14],17,e[18]),j=b(j,h,l,g,m[a+15],22,e[19]),g=c(g,j,h,l,m[a+1],5,e[20]),l=c(l,g,j,h,m[a+6],9,e[21]),h=c(h,l,g,j,m[a+11],14,e[22]),j=c(j,h,l,g,m[a+0],20,e[23]),g=c(g,j,h,l,m[a+5],5,e[24]),l=c(l,g,j,h,m[a+10],9,e[25]),h=c(h,l,g,j,m[a+15],14,e[26]),j=c(j,h,l,g,m[a+4],20,e[27]),g=c(g,j,h,l,m[a+9],5,e[28]),l=c(l,g,j,h,m[a+14],9,e[29]),h=c(h,l,g,j,m[a+3],14,e[30]),j=c(j,h,l,g,m[a+8],20,e[31]),g=c(g,j,h,l,m[a+13],5,e[32]),l=c(l,g,j,h,m[a+2],9,e[33]),h=c(h,l,g,j,m[a+7],14,e[34]),j=c(j,h,l,g,m[a+12],20,e[35]),g=f(g,j,h,l,m[a+5],4,e[36]),l=f(l,g,j,h,m[a+8],11,e[37]),h=f(h,l,g,j,m[a+11],16,e[38]),j=f(j,h,l,g,m[a+14],23,e[39]),g=f(g,j,h,l,m[a+1],4,e[40]),l=f(l,g,j,h,m[a+4],11,e[41]),h=f(h,l,g,j,m[a+7],16,e[42]),j=f(j,h,l,g,m[a+10],23,e[43]),g=f(g,j,h,l,m[a+13],4,e[44]),l=f(l,g,j,h,m[a+0],11,e[45]),h=f(h,l,g,j,m[a+3],16,e[46]),j=f(j,h,l,g,m[a+6],23,e[47]),g=f(g,j,h,l,m[a+9],4,e[48]),l=f(l,g,j,h,m[a+12],11,e[49]),h=f(h,l,g,j,m[a+15],16,e[50]),j=f(j,h,l,g,m[a+2],23,e[51]),g=p(g,j,h,l,m[a+0],6,e[52]),l=p(l,g,j,h,m[a+7],10,e[53]),h=p(h,l,g,j,m[a+14],15,e[54]),j=p(j,h,l,g,m[a+5],21,e[55]),g=p(g,j,h,l,m[a+12],6,e[56]),l=p(l,g,j,h,m[a+3],10,e[57]),h=p(h,l,g,j,m[a+10],15,e[58]),j=p(j,h,l,g,m[a+1],21,e[59]),g=p(g,j,h,l,m[a+8],6,e[60]),l=p(l,g,j,h,m[a+15],10,e[61]),h=p(h,l,g,j,m[a+6],15,e[62]),j=p(j,h,l,g,m[a+13],21,e[63]),g=p(g,j,h,l,m[a+4],6,e[64]),l=p(l,g,j,h,m[a+11],10,e[65]),h=p(h,l,g,j,m[a+2],15,e[66]),j=p(j,h,l,g,m[a+9],21,e[67]),g=d(g,u),j=d(j,x),h=d(h,t),l=d(l,r);return q(g).concat(q(j),q(h),q(l))}},Base64:ib},!window.PUBNUB){var lb=function(a,d){return CryptoJS.HmacSHA256(a,d).toString(CryptoJS.enc.Base64)},mb=function(a){return document.getElementById(a)},nb=function(a){console.error(a)},pb=function(a,d){var b=[];return N(a.split(/\s+/),function(a){N((d||document).getElementsByTagName(a),function(a){b.push(a)})}),b},qb=function(a,d,b){N(a.split(","),function(a){function f(a){a||(a=window.event),b(a)||(a.cancelBubble=y,a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation())}d.addEventListener?d.addEventListener(a,f,A):d.attachEvent?d.attachEvent("on"+a,f):d["on"+a]=f})},rb=function(){return pb("head")[0]},V=function(a,d,b){return b?void a.setAttribute(d,b):a&&a.getAttribute&&a.getAttribute(d)},sb=function(a,d){for(var b in d)if(d.hasOwnProperty(b))try{a.style[b]=d[b]+(0<"|width|height|top|left|".indexOf(b)&&"number"==typeof d[b]?"px":"")}catch(c){}},tb=function(a){return document.createElement(a)},zb=function(){return ub||$()?0:la()},Ab=function(a){function d(a,b){H||(H=1,e.onerror=z,clearTimeout(Ra),a||!b||Sa(b),setTimeout(function(){a&&S();var b=mb(aa),c=b&&b.parentNode;c&&c.removeChild(b)},D))}if(ub||$()){a:{var b,c,f=function(){if(!q){q=1,clearTimeout(u);try{c=JSON.parse(b.responseText)}catch(a){return j(1)}p=1,r(c)}},p=0,q=0,m=a.timeout||1e4,u=setTimeout(function(){j(1,{message:"timeout"})},m),x=a.b||C(),t=a.data||{},r=a.c||C(),g=!a.h,j=function(a,c){p||(p=1,clearTimeout(u),b&&(b.onerror=b.onload=z,b.abort&&b.abort(),b=z),a&&x(c))};try{b=$()||window.XDomainRequest&&new XDomainRequest||new XMLHttpRequest,b.onerror=b.onabort=function(){j(1,b.responseText||{error:"Network Connection Error"})},b.onload=b.onloadend=f,b.onreadystatechange=function(){if(b&&4==b.readyState)switch(b.status){case 401:case 402:case 403:try{c=JSON.parse(b.responseText),j(1,c)}catch(a){return j(1,b.responseText)}}};var h=qa(a.url,t);b.open("GET",h,g),g&&(b.timeout=m),b.send()}catch(l){j(0),ub=0,a=Ab(a);break a}a=j}return a}var e=tb("script"),f=a.a,aa=la(),H=0,Ra=setTimeout(function(){d(1,{message:"timeout"})},a.timeout||1e4),S=a.b||C(),m=a.data||{},Sa=a.c||C();return window[f]=function(a){d(0,a)},a.h||(e[Bb]=Bb),e.onerror=function(){d(1)},e.src=qa(a.url,m),V(e,"id",aa),rb().appendChild(e),d},Cb=function(){return"onLine"in navigator?navigator.onLine:1},$=function(){if(!Db||!Db.get)return 0;var a={id:$.id++,send:C(),abort:function(){a.id={}},open:function(d,b){$[a.id]=a,Db.get(a.id,b)}};return a},Bb="async",ub=-1==navigator.userAgent.indexOf("MSIE 6");window.console||(window.console=window.console||{}),console.log||(console.log=console.error=(window.opera||{}).postError||C());var Eb,Fb=window.localStorage;Eb={get:function(a){try{return Fb?Fb.getItem(a):-1==document.cookie.indexOf(a)?z:((document.cookie||"").match(RegExp(a+"=([^;]+)"))||[])[1]||z}catch(d){}},set:function(a,d){try{if(Fb)return Fb.setItem(a,d)&&0;document.cookie=a+"="+d+"; expires=Thu, 1 Aug 2030 20:00:00 UTC; path=/"}catch(b){}}};var Gb={list:{},unbind:function(a){Gb.list[a]=[]},bind:function(a,d){(Gb.list[a]=Gb.list[a]||[]).push(d)},fire:function(a,d){N(Gb.list[a]||[],function(a){a(d)})}},Ib=mb("pubnub")||0,Jb=function(a){function d(){}function b(a,b){function c(b){b&&(Va=G()-(b/1e4+(G()-d)/2),a&&a(Va))}var d=G();b&&c(b)||I.time(c)}function c(a,b){Ha&&Ha(a,b),Ha=z}function f(){I.time(function(a){b(C(),a),a||c(1,{error:"Heartbeat failed to connect to Pubnub Servers.Please check your network settings."}),setTimeout(f,ob)})}function p(){Nb()||c(1,{error:"Offline. Please check your network settings. "}),setTimeout(p,D)}function q(a,b){b("object"==typeof a&&a.error&&a.message&&a.payload?{message:a.message,payload:a.payload}:a)}function m(a,b,c){if("object"==typeof a){if(a.error&&a.message&&a.payload)return void c({message:a.message,payload:a.payload});if(a.payload)return void b(a.payload)}b(a)}function u(a){var b=0;return N(va(B),function(c){(c=B[c])&&(b++,(a||C())(c))}),b}function x(a){if(Ob){if(!Q.length)return}else{if(a&&(Q.j=0),Q.j||!Q.length)return;Q.j=1}E(Q.shift())}function t(){!Wa&&r()}function r(){clearTimeout(W),!J||J>=500||1>J||!va(B,y).length?Wa=A:(Wa=y,I.presence_heartbeat({callback:function(){W=setTimeout(r,J*D)},error:function(a){s&&s("Presence Heartbeat unable to reach Pubnub servers."+JSON.stringify(a)),W=setTimeout(r,J*D)}}))}function g(a,b){return ba.decrypt(a,b||X)||ba.decrypt(a,X)||a}function j(a,b,c){var d=A;if("number"==typeof a)d=a>5||0==a?A:y;else{if("boolean"==typeof a)return a?30:0;d=y}return d?(c&&c("Presence Heartbeat value invalid. Valid range ( x > 5 or x = 0). Current Value : "+(b||5)),b||5):a}function h(a){var b="",c=[];N(a,function(a){c.push(a)});var f,d=c.sort();for(f in d){var e=d[f],b=b+(e+"="+encodeURIComponent(a[e]));f!=d.length-1&&(b+="&")}return b}function l(a){return a||(a={}),N(Y,function(b,c){b in a||(a[b]=c)}),a}function e(a){return Jb(a)}function aa(a){function b(a,c){var d=(65535&a)+(65535&c);return(a>>16)+(c>>16)+(d>>16)<<16|65535&d}function c(a,b){return a>>>b|a<<32-b}var d;d=a.replace(/\r\n/g,"\n");for(var a="",f=0;f<d.length;f++){var e=d.charCodeAt(f);128>e?a+=String.fromCharCode(e):(e>127&&2048>e?a+=String.fromCharCode(e>>6|192):(a+=String.fromCharCode(e>>12|224),a+=String.fromCharCode(e>>6&63|128)),a+=String.fromCharCode(63&e|128))}for(f=a,d=[],e=0;e<8*f.length;e+=8)d[e>>5]|=(255&f.charCodeAt(e/8))<<24-e%32;var l,m,j,h,q,p,r,t,s,w,u,g=8*a.length,f=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],a=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],e=Array(64);for(d[g>>5]|=128<<24-g%32,d[(g+64>>9<<4)+15]=g,t=0;t<d.length;t+=16){for(g=a[0],l=a[1],m=a[2],j=a[3],h=a[4],q=a[5],p=a[6],r=a[7],s=0;64>s;s++)e[s]=16>s?d[s+t]:b(b(b(c(e[s-2],17)^c(e[s-2],19)^e[s-2]>>>10,e[s-7]),c(e[s-15],7)^c(e[s-15],18)^e[s-15]>>>3),e[s-16]),w=b(b(b(b(r,c(h,6)^c(h,11)^c(h,25)),h&q^~h&p),f[s]),e[s]),u=b(c(g,2)^c(g,13)^c(g,22),g&l^g&m^l&m),r=p,p=q,q=h,h=b(j,w),j=m,m=l,l=g,g=b(w,u);a[0]=b(g,a[0]),a[1]=b(l,a[1]),a[2]=b(m,a[2]),a[3]=b(j,a[3]),a[4]=b(h,a[4]),a[5]=b(q,a[5]),a[6]=b(p,a[6]),a[7]=b(r,a[7])}for(d="",f=0;f<4*a.length;f++)d+="0123456789abcdef".charAt(a[f>>2]>>8*(3-f%4)+4&15)+"0123456789abcdef".charAt(a[f>>2]>>8*(3-f%4)&15);return d}a.jsonp&&(ub=0);var H=a.subscribe_key||"";a.uuid||Eb.get(H+"uuid");var Ra=a.leave_on_unload||0;a.xdr=Ab,a.db=Eb,a.error=a.error||nb,a._is_online=Cb,a.jsonp_cb=zb,a.hmac_SHA256=lb,O.size(256);var S=O.s2a("0123456789012345");a.crypto_obj={encrypt:function(a,b){if(!b)return a;var c=O.s2a(aa(b).slice(0,32)),d=O.s2a(JSON.stringify(a)),c=O.rawEncrypt(d,c,S);return O.Base64.encode(c)||a},decrypt:function(a,b){if(!b)return a;var c=O.s2a(aa(b).slice(0,32));try{var d=O.Base64.decode(a),e=O.rawDecrypt(d,c,S,A);return JSON.parse(e)}catch(f){}}},a.params={pnsdk:"PubNub-JS-Web/3.6.7"};var Sa=+a.windowing||10,Hb=(+a.timeout||310)*D,ob=(+a.keepalive||60)*D,Lb=a.noleave||0,P=a.publish_key||"demo",w=a.subscribe_key||"demo",M=a.auth_key||"",Ia=a.secret_key||"",vb=a.hmac_SHA256,Xa=a.ssl?"s":"",oa="http"+Xa+"://"+(a.origin||"pubsub.pubnub.com"),K=ma(oa),wb=ma(oa),Q=[],Va=0,xb=0,yb=0,Ha=0,Ja=a.restore||0,da=0,Ya=A,B={},Z={},W=z,R=j(a.heartbeat||a.pnexpires||0,a.error),J=a.heartbeat_interval||R-3,Wa=A,Ob=a.no_wait_for_pending,Pb=a["compatible_3.5"]||A,E=a.xdr,Y=a.params||{},s=a.error||C(),Nb=a._is_online||function(){return 1},L=a.jsonp_cb||function(){return 0},ea=a.db||{get:C(),set:C()},X=a.cipher_key,F=a.uuid||ea&&ea.get(w+"uuid")||"",ba=a.crypto_obj||{encrypt:function(a){return a},decrypt:function(a){return a}},I={LEAVE:function(a,b,c,d){var e={uuid:F,auth:M},f=ma(oa),c=c||C(),g=d||C(),d=L();return 0<a.indexOf(ha)?y:Pb&&(!Xa||"0"==d)||Lb?A:("0"!=d&&(e.callback=d),E({h:b||Xa,timeout:2e3,a:d,data:l(e),c:function(a){m(a,c,g)},b:function(a){q(a,g)},url:[f,"v2","presence","sub_key",w,"channel",encodeURIComponent(a),"leave"]}),y)},set_resumed:function(a){Ya=a},get_cipher_key:function(){return X},set_cipher_key:function(a){X=a},raw_encrypt:function(a,b){return ba.encrypt(a,b||X)||a},raw_decrypt:function(a,b){return g(a,b)},get_heartbeat:function(){return R},set_heartbeat:function(a){R=j(a,J,s),J=R-3>=1?R-3:1,d(),r()},get_heartbeat_interval:function(){return J},set_heartbeat_interval:function(a){J=a,r()},get_version:function(){return"3.6.7"},getGcmMessageObject:function(a){return{data:a}},getApnsMessageObject:function(a){var b={aps:{badge:1,alert:""}};for(k in a)k[b]=a[k];return b},newPnMessage:function(){var a={};gcm&&(a.pn_gcm=gcm),apns&&(a.pn_apns=apns);for(k in n)a[k]=n[k];return a},_add_param:function(a,b){Y[a]=b},history:function(a,b){var b=a.callback||b,c=a.count||a.limit||100,d=a.reverse||"false",e=a.error||C(),f=a.auth_key||M,h=a.cipher_key,m=a.channel,j=a.start,p=a.end,r=a.include_token,t={},u=L();return m?b?w?(t.stringtoken="true",t.count=c,t.reverse=d,t.auth=f,u&&(t.callback=u),j&&(t.start=j),p&&(t.end=p),r&&(t.include_token="true"),void E({a:u,data:l(t),c:function(a){if("object"==typeof a&&a.error)e({message:a.message,payload:a.payload});else{for(var c=a[0],d=[],f=0;f<c.length;f++){var l=g(c[f],h);try{d.push(JSON.parse(l))}catch(m){d.push(l)}}b([d,a[1],a[2]])}},b:function(a){q(a,e)},url:[K,"v2","history","sub-key",w,"channel",encodeURIComponent(m)]})):s("Missing Subscribe Key"):s("Missing Callback"):s("Missing Channel")},replay:function(a,b){var b=b||a.callback||C(),c=a.auth_key||M,d=a.source,e=a.destination,f=a.stop,g=a.start,h=a.end,j=a.reverse,q=a.limit,p=L(),r={};return d?e?P?w?("0"!=p&&(r.callback=p),f&&(r.stop="all"),j&&(r.reverse="true"),g&&(r.start=g),h&&(r.end=h),q&&(r.count=q),r.auth=c,void E({a:p,c:function(a){m(a,b,err)},b:function(){b([0,"Disconnected"])},url:[K,"v1","replay",P,w,d,e],data:l(r)})):s("Missing Subscribe Key"):s("Missing Publish Key"):s("Missing Destination Channel"):s("Missing Source Channel")},auth:function(a){M=a,d()},time:function(a){var b=L();E({a:b,data:l({uuid:F,auth:M}),timeout:5*D,url:[K,"time",b],c:function(b){a(b[0])},b:function(){a(0)}})},publish:function(a,b){var c=a.message;if(!c)return s("Missing Message");var b=b||a.callback||c.callback||C(),d=a.channel||c.channel,e=a.auth_key||M,f=a.cipher_key,g=a.error||c.error||C(),h=a.post||A,j="store_in_history"in a?a.store_in_history:y,p=L(),r="push";return a.prepend&&(r="unshift"),d?P?w?(c.getPubnubMessage&&(c=c.getPubnubMessage()),c=JSON.stringify(ba.encrypt(c,f||X)||c),c=[K,"publish",P,w,0,encodeURIComponent(d),p,encodeURIComponent(c)],Y={uuid:F,auth:e},j||(Y.store="0"),Q[r]({a:p,timeout:5*D,url:c,data:l(Y),b:function(a){q(a,g),x(1)},c:function(a){m(a,b,g),x(1)},mode:h?"POST":"GET"}),void x()):s("Missing Subscribe Key"):s("Missing Publish Key"):s("Missing Channel")},unsubscribe:function(a,b){var c=a.channel,b=b||a.callback||C(),e=a.error||C();da=0,c=ua((c.join?c.join(","):""+c).split(","),function(a){return B[a]?a+","+a+ha:void 0}).join(","),N(c.split(","),function(a){var c=y;a&&(fa&&(c=I.LEAVE(a,0,b,e)),c||b({action:"leave"}),B[a]=0,a in Z&&delete Z[a])}),d()},subscribe:function(a,b){function e(a){a?setTimeout(d,D):(K=ma(oa,1),wb=ma(oa,1),setTimeout(function(){I.time(e)},D)),u(function(b){return a&&b.d?(b.d=0,b.p(b.name)):void(!a&&!b.d&&(b.d=1,b.o(b.name)))})}function f(){var a=L(),b=va(B).join(",");if(b){c();var h=l({uuid:F,auth:m});2<JSON.stringify(Z).length&&(h.state=JSON.stringify(Z)),R&&(h.heartbeat=R),t(),Ha=E({timeout:aa,a:a,b:function(a){q(a,x),I.time(e)},data:l(h),url:[wb,"subscribe",w,encodeURIComponent(b),a,da],c:function(a){if(!a||"object"==typeof a&&"error"in a&&a.error)return x(a.error),setTimeout(d,D);if(J(a[1]),da=!da&&Ja&&ea.get(w)||a[1],u(function(a){a.g||(a.g=1,a.n(a.name))}),Ya&&!Ja)da=0,Ya=A,ea.set(w,0);else{Q&&(da=1e4,Q=0),ea.set(w,a[1]);var b,c=(2<a.length?a[2]:ua(va(B),function(b){return ua(Array(a[0].length).join(",").split(","),function(){return b})}).join(",")).split(",");b=function(){var a=c.shift()||yb;return[(B[a]||{}).a||xb,a.split(ha)[0]]};var e=G()-Va-+a[1]/1e4;N(a[0],function(c){var d=b(),c=g(c,B[d[1]]?B[d[1]].cipher_key:z);d[0](c,a,d[1],e)})}setTimeout(f,Y)}})}}var h=a.channel,b=(b=b||a.callback)||a.message,m=a.auth_key||M,j=a.connect||C(),p=a.reconnect||C(),r=a.disconnect||C(),x=a.error||C(),J=a.idle||C(),H=a.presence||0,P=a.noheresync||0,Q=a.backfill||0,X=a.timetoken||0,aa=a.timeout||Hb,Y=a.windowing||Sa,S=a.state,W=a.heartbeat||a.pnexpires,ba=a.restore||Ja;return Ja=ba,da=X,h?b?w?((W||0===W)&&I.set_heartbeat(W),N((h.join?h.join(","):""+h).split(","),function(c){var d=B[c]||{};B[yb=c]={name:c,g:d.g,d:d.d,f:1,a:xb=b,cipher_key:a.cipher_key,n:j,o:r,p:p},S&&(Z[c]=c in S?S[c]:S),H&&(I.subscribe({channel:c+ha,callback:H,restore:ba}),!d.f&&!P&&I.here_now({channel:c,callback:function(a){N("uuids"in a?a.uuids:[],function(b){H({action:"join",uuid:b,timestamp:Math.floor(G()/1e3),occupancy:a.occupancy||1},a,c)})}}))}),d=function(){c(),setTimeout(f,Y)},fa?void d():ga.push(d)):s("Missing Subscribe Key"):s("Missing Callback"):s("Missing Channel")},here_now:function(a,b){var b=a.callback||b,c=a.error||C(),d=a.auth_key||M,e=a.channel,f=L(),g=a.state,d={uuid:F,auth:d};return("uuids"in a?a.uuids:1)||(d.disable_uuids=1),g&&(d.state=1),b?w?(g=[K,"v2","presence","sub_key",w],e&&g.push("channel")&&g.push(encodeURIComponent(e)),"0"!=f&&(d.callback=f),void E({a:f,data:l(d),c:function(a){m(a,b,c)},b:function(a){q(a,c)},url:g})):s("Missing Subscribe Key"):s("Missing Callback")},where_now:function(a,b){var b=a.callback||b,c=a.error||C(),d=a.auth_key||M,e=L(),f=a.uuid||F,d={auth:d};return b?w?("0"!=e&&(d.callback=e),void E({a:e,data:l(d),
c:function(a){m(a,b,c)},b:function(a){q(a,c)},url:[K,"v2","presence","sub_key",w,"uuid",encodeURIComponent(f)]})):s("Missing Subscribe Key"):s("Missing Callback")},state:function(a,b){var b=a.callback||b||C(),c=a.error||C(),d=a.auth_key||M,e=L(),f=a.state,g=a.uuid||F,h=a.channel,d=l({auth:d});return w?g?h?("0"!=e&&(d.callback=e),B[h]&&B[h].f&&f&&(Z[h]=f),d.state=JSON.stringify(f),f=f?[K,"v2","presence","sub-key",w,"channel",encodeURIComponent(h),"uuid",g,"data"]:[K,"v2","presence","sub-key",w,"channel",encodeURIComponent(h),"uuid",encodeURIComponent(g)],void E({a:e,data:l(d),c:function(a){m(a,b,c)},b:function(a){q(a,c)},url:f})):s("Missing Channel"):s("Missing UUID"):s("Missing Subscribe Key")},grant:function(a,b){var b=a.callback||b,c=a.error||C(),d=a.channel,e=L(),f=a.ttl,g=a.read?"1":"0",j=a.write?"1":"0",p=a.auth_key;if(!b)return s("Missing Callback");if(!w)return s("Missing Subscribe Key");if(!P)return s("Missing Publish Key");if(!Ia)return s("Missing Secret Key");var r=w+"\n"+P+"\ngrant\n",g={w:j,r:g,timestamp:Math.floor((new Date).getTime()/1e3)};"undefined"!=d&&d!=z&&0<d.length&&(g.channel=d),"0"!=e&&(g.callback=e),(f||0===f)&&(g.ttl=f),p&&(g.auth=p),g=l(g),p||delete g.auth,r+=h(g),d=vb(r,Ia),d=d.replace(/\+/g,"-"),d=d.replace(/\//g,"_"),g.signature=d,E({a:e,data:g,c:function(a){m(a,b,c)},b:function(a){q(a,c)},url:[K,"v1","auth","grant","sub-key",w]})},audit:function(a,b){var b=a.callback||b,c=a.error||C(),d=a.channel,e=a.auth_key,f=L();if(!b)return s("Missing Callback");if(!w)return s("Missing Subscribe Key");if(!P)return s("Missing Publish Key");if(!Ia)return s("Missing Secret Key");var g=w+"\n"+P+"\naudit\n",j={timestamp:Math.floor((new Date).getTime()/1e3)};"0"!=f&&(j.callback=f),"undefined"!=d&&d!=z&&0<d.length&&(j.channel=d),e&&(j.auth=e),j=l(j),e||delete j.auth,g+=h(j),d=vb(g,Ia),d=d.replace(/\+/g,"-"),d=d.replace(/\//g,"_"),j.signature=d,E({a:f,data:j,c:function(a){m(a,b,c)},b:function(a){q(a,c)},url:[K,"v1","auth","audit","sub-key",w]})},revoke:function(a,b){a.read=A,a.write=A,I.grant(a,b)},set_uuid:function(a){F=a,d()},get_uuid:function(){return F},presence_heartbeat:function(a){var b=a.callback||C(),c=a.error||C(),a=L(),d={uuid:F,auth:M};2<JSON.stringify(Z).length&&(d.state=JSON.stringify(Z)),R>0&&320>R&&(d.heartbeat=R),"0"!=a&&(d.callback=a);var e=E,d=l(d),f=5*D,g=K,h=w,j=va(B,y).join(",");e({a:a,data:d,timeout:f,url:[g,"v2","presence","sub-key",h,"channel",encodeURIComponent(j),"heartbeat"],c:function(a){m(a,b,c)},b:function(a){q(a,c)}})},xdr:E,ready:wa,db:ea,uuid:pa,map:ua,each:N,"each-channel":u,grep:sa,offline:function(){c(1,{message:"Offline. Please check your network settings."})},supplant:ta,now:G,unique:la,updater:ra};F||(F=I.uuid()),ea.set(w+"uuid",F),setTimeout(p,D),setTimeout(f,ob),W=setTimeout(t,(J-3)*D),b();var Ka,H=I;for(Ka in H)H.hasOwnProperty(Ka)&&(e[Ka]=H[Ka]);return e.css=sb,e.$=mb,e.create=tb,e.bind=qb,e.head=rb,e.search=pb,e.attr=V,e.events=Gb,e.init=e,e.secure=e,qb("beforeunload",window,function(){return Ra&&e["each-channel"](function(a){e.LEAVE(a.name,0)}),y}),a.notest?e:(qb("offline",window,e.offline),qb("offline",document,e.offline),e)};Jb.init=Jb,Jb.secure=Jb,"complete"===document.readyState?setTimeout(wa,0):qb("load",window,function(){setTimeout(wa,0)});var Kb=Ib||{};PUBNUB=Jb({notest:1,publish_key:V(Kb,"pub-key"),subscribe_key:V(Kb,"sub-key"),ssl:!document.location.href.indexOf("https")||"on"==V(Kb,"ssl"),origin:V(Kb,"origin"),uuid:V(Kb,"uuid")}),window.jQuery&&(window.jQuery.PUBNUB=Jb),"undefined"!=typeof module&&(module.exports=PUBNUB)&&wa();var Db=mb("pubnubs")||0;Ib&&(sb(Ib,{position:"absolute",top:-D}),("opera"in window||V(Ib,"flash"))&&(Ib.innerHTML="<object id=pubnubs data=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=movie value=https://pubnub.a.ssl.fastly.net/pubnub.swf><param name=allowscriptaccess value=always></object>"),PUBNUB.rdx=function(a,d){return d?($[a].responseText=unescape(d),void $[a].onload()):$[a].onerror()},$.id=D)}var Mb=PUBNUB.ws=function(a,d){if(!(this instanceof Mb))return new Mb(a,d);var b=this,a=b.url=a||"";b.protocol=d||"Sec-WebSocket-Protocol";var c=a.split("/"),c={ssl:"wss:"===c[0],origin:c[2],publish_key:c[3],subscribe_key:c[4],channel:c[5]};return b.CONNECTING=0,b.OPEN=1,b.CLOSING=2,b.CLOSED=3,b.CLOSE_NORMAL=1e3,b.CLOSE_GOING_AWAY=1001,b.CLOSE_PROTOCOL_ERROR=1002,b.CLOSE_UNSUPPORTED=1003,b.CLOSE_TOO_LARGE=1004,b.CLOSE_NO_STATUS=1005,b.CLOSE_ABNORMAL=1006,b.onclose=b.onerror=b.onmessage=b.onopen=b.onsend=C(),b.binaryType="",b.extensions="",b.bufferedAmount=0,b.trasnmitting=A,b.buffer=[],b.readyState=b.CONNECTING,a?(b.e=PUBNUB.init(c),b.e.k=c,b.k=c,void b.e.subscribe({restore:A,channel:c.channel,disconnect:b.onerror,reconnect:b.onopen,error:function(){b.onclose({code:b.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:A})},callback:function(a){b.onmessage({data:a})},connect:function(){b.readyState=b.OPEN,b.onopen()}})):(b.readyState=b.CLOSED,b.onclose({code:b.CLOSE_ABNORMAL,reason:"Missing URL",wasClean:y}),b)};Mb.prototype.send=function(a){var d=this;d.e.publish({channel:d.e.k.channel,message:a,callback:function(a){d.onsend({data:a})}})}}(),function(window,document,$,undefined){"use strict";var H=$("html"),W=$(window),D=$(document),F=$.fancybox=function(){F.open.apply(this,arguments)},IE=navigator.userAgent.match(/msie/i),didUpdate=null,isTouch=document.createTouch!==undefined,isQuery=function(obj){return obj&&obj.hasOwnProperty&&obj instanceof $},isString=function(str){return str&&"string"===$.type(str)},isPercentage=function(str){return isString(str)&&str.indexOf("%")>0},isScrollable=function(el){return el&&!(el.style.overflow&&"hidden"===el.style.overflow)&&(el.clientWidth&&el.scrollWidth>el.clientWidth||el.clientHeight&&el.scrollHeight>el.clientHeight)},getScalar=function(orig,dim){var value=parseInt(orig,10)||0;return dim&&isPercentage(orig)&&(value=F.getViewport()[dim]/100*value),Math.ceil(value)},getValue=function(value,dim){return getScalar(value,dim)+"px"};$.extend(F,{version:"2.1.5",defaults:{padding:15,margin:20,width:800,height:600,minWidth:100,minHeight:100,maxWidth:9999,maxHeight:9999,pixelRatio:1,autoSize:!0,autoHeight:!1,autoWidth:!1,autoResize:!0,autoCenter:!isTouch,fitToView:!0,aspectRatio:!1,topRatio:.5,leftRatio:.5,scrolling:"auto",wrapCSS:"",arrows:!0,closeBtn:!0,closeClick:!1,nextClick:!1,mouseWheel:!0,autoPlay:!1,playSpeed:3e3,preload:3,modal:!1,loop:!0,ajax:{dataType:"html",headers:{"X-fancyBox":!0}},iframe:{scrolling:"auto",preload:!0},swf:{wmode:"transparent",allowfullscreen:"true",allowscriptaccess:"always"},keys:{next:{13:"left",34:"up",39:"left",40:"up"},prev:{8:"right",33:"down",37:"right",38:"down"},close:[27],play:[32],toggle:[70]},direction:{next:"left",prev:"right"},scrollOutside:!0,index:0,type:null,href:null,content:null,title:null,tpl:{wrap:'<div class="fancybox-wrap" tabIndex="-1"><div class="fancybox-skin"><div class="fancybox-outer"><div class="fancybox-inner"></div></div></div></div>',image:'<img class="fancybox-image" src="{href}" alt="" />',iframe:'<iframe id="fancybox-frame{rnd}" name="fancybox-frame{rnd}" class="fancybox-iframe" frameborder="0" vspace="0" hspace="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen'+(IE?' allowtransparency="true"':"")+"></iframe>",error:'<p class="fancybox-error">The requested content cannot be loaded.<br/>Please try again later.</p>',closeBtn:'<a title="Close" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="Next" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="Previous" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'},openEffect:"fade",openSpeed:250,openEasing:"swing",openOpacity:!0,openMethod:"zoomIn",closeEffect:"fade",closeSpeed:250,closeEasing:"swing",closeOpacity:!0,closeMethod:"zoomOut",nextEffect:"elastic",nextSpeed:250,nextEasing:"swing",nextMethod:"changeIn",prevEffect:"elastic",prevSpeed:250,prevEasing:"swing",prevMethod:"changeOut",helpers:{overlay:!0,title:!0},onCancel:$.noop,beforeLoad:$.noop,afterLoad:$.noop,beforeShow:$.noop,afterShow:$.noop,beforeChange:$.noop,beforeClose:$.noop,afterClose:$.noop},group:{},opts:{},previous:null,coming:null,current:null,isActive:!1,isOpen:!1,isOpened:!1,wrap:null,skin:null,outer:null,inner:null,player:{timer:null,isActive:!1},ajaxLoad:null,imgPreload:null,transitions:{},helpers:{},open:function(group,opts){return group&&($.isPlainObject(opts)||(opts={}),!1!==F.close(!0))?($.isArray(group)||(group=isQuery(group)?$(group).get():[group]),$.each(group,function(i,element){var href,title,content,type,rez,hrefParts,selector,obj={};"object"===$.type(element)&&(element.nodeType&&(element=$(element)),isQuery(element)?(obj={href:element.data("fancybox-href")||element.attr("href"),title:element.data("fancybox-title")||element.attr("title"),isDom:!0,element:element},$.metadata&&$.extend(!0,obj,element.metadata())):obj=element),href=opts.href||obj.href||(isString(element)?element:null),title=opts.title!==undefined?opts.title:obj.title||"",content=opts.content||obj.content,type=content?"html":opts.type||obj.type,!type&&obj.isDom&&(type=element.data("fancybox-type"),type||(rez=element.prop("class").match(/fancybox\.(\w+)/),type=rez?rez[1]:null)),isString(href)&&(type||(F.isImage(href)?type="image":F.isSWF(href)?type="swf":"#"===href.charAt(0)?type="inline":isString(element)&&(type="html",content=element)),"ajax"===type&&(hrefParts=href.split(/\s+/,2),href=hrefParts.shift(),selector=hrefParts.shift())),content||("inline"===type?href?content=$(isString(href)?href.replace(/.*(?=#[^\s]+$)/,""):href):obj.isDom&&(content=element):"html"===type?content=href:type||href||!obj.isDom||(type="inline",content=element)),$.extend(obj,{href:href,type:type,content:content,title:title,selector:selector}),group[i]=obj}),F.opts=$.extend(!0,{},F.defaults,opts),opts.keys!==undefined&&(F.opts.keys=opts.keys?$.extend({},F.defaults.keys,opts.keys):!1),F.group=group,F._start(F.opts.index)):void 0},cancel:function(){var coming=F.coming;coming&&!1!==F.trigger("onCancel")&&(F.hideLoading(),F.ajaxLoad&&F.ajaxLoad.abort(),F.ajaxLoad=null,F.imgPreload&&(F.imgPreload.onload=F.imgPreload.onerror=null),coming.wrap&&coming.wrap.stop(!0,!0).trigger("onReset").remove(),F.coming=null,F.current||F._afterZoomOut(coming))},close:function(event){F.cancel(),!1!==F.trigger("beforeClose")&&(F.unbindEvents(),F.isActive&&(F.isOpen&&event!==!0?(F.isOpen=F.isOpened=!1,F.isClosing=!0,$(".fancybox-item, .fancybox-nav").remove(),F.wrap.stop(!0,!0).removeClass("fancybox-opened"),F.transitions[F.current.closeMethod]()):($(".fancybox-wrap").stop(!0).trigger("onReset").remove(),F._afterZoomOut())))},play:function(action){var clear=function(){clearTimeout(F.player.timer)},set=function(){clear(),F.current&&F.player.isActive&&(F.player.timer=setTimeout(F.next,F.current.playSpeed))},stop=function(){clear(),D.unbind(".player"),F.player.isActive=!1,F.trigger("onPlayEnd")},start=function(){F.current&&(F.current.loop||F.current.index<F.group.length-1)&&(F.player.isActive=!0,D.bind({"onCancel.player beforeClose.player":stop,"onUpdate.player":set,"beforeLoad.player":clear}),set(),F.trigger("onPlayStart"))};action===!0||!F.player.isActive&&action!==!1?start():stop()},next:function(direction){var current=F.current;current&&(isString(direction)||(direction=current.direction.next),F.jumpto(current.index+1,direction,"next"))},prev:function(direction){var current=F.current;current&&(isString(direction)||(direction=current.direction.prev),F.jumpto(current.index-1,direction,"prev"))},jumpto:function(index,direction,router){var current=F.current;current&&(index=getScalar(index),F.direction=direction||current.direction[index>=current.index?"next":"prev"],F.router=router||"jumpto",current.loop&&(0>index&&(index=current.group.length+index%current.group.length),index%=current.group.length),current.group[index]!==undefined&&(F.cancel(),F._start(index)))},reposition:function(e,onlyAbsolute){var pos,current=F.current,wrap=current?current.wrap:null;wrap&&(pos=F._getPosition(onlyAbsolute),e&&"scroll"===e.type?(delete pos.position,wrap.stop(!0,!0).animate(pos,200)):(wrap.css(pos),current.pos=$.extend({},current.dim,pos)))},update:function(e){var type=e&&e.type,anyway=!type||"orientationchange"===type;anyway&&(clearTimeout(didUpdate),didUpdate=null),F.isOpen&&!didUpdate&&(didUpdate=setTimeout(function(){var current=F.current;current&&!F.isClosing&&(F.wrap.removeClass("fancybox-tmp"),(anyway||"load"===type||"resize"===type&&current.autoResize)&&F._setDimension(),"scroll"===type&&current.canShrink||F.reposition(e),F.trigger("onUpdate"),didUpdate=null)},anyway&&!isTouch?0:300))},toggle:function(action){F.isOpen&&(F.current.fitToView="boolean"===$.type(action)?action:!F.current.fitToView,isTouch&&(F.wrap.removeAttr("style").addClass("fancybox-tmp"),F.trigger("onUpdate")),F.update())},hideLoading:function(){D.unbind(".loading"),$("#fancybox-loading").remove()},showLoading:function(){var el,viewport;F.hideLoading(),el=$('<div id="fancybox-loading"><div></div></div>').click(F.cancel).appendTo("body"),D.bind("keydown.loading",function(e){27===(e.which||e.keyCode)&&(e.preventDefault(),F.cancel())}),F.defaults.fixed||(viewport=F.getViewport(),el.css({position:"absolute",top:.5*viewport.h+viewport.y,left:.5*viewport.w+viewport.x}))},getViewport:function(){var locked=F.current&&F.current.locked||!1,rez={x:W.scrollLeft(),y:W.scrollTop()};return locked?(rez.w=locked[0].clientWidth,rez.h=locked[0].clientHeight):(rez.w=isTouch&&window.innerWidth?window.innerWidth:W.width(),rez.h=isTouch&&window.innerHeight?window.innerHeight:W.height()),rez},unbindEvents:function(){F.wrap&&isQuery(F.wrap)&&F.wrap.unbind(".fb"),D.unbind(".fb"),W.unbind(".fb")},bindEvents:function(){var keys,current=F.current;current&&(W.bind("orientationchange.fb"+(isTouch?"":" resize.fb")+(current.autoCenter&&!current.locked?" scroll.fb":""),F.update),keys=current.keys,keys&&D.bind("keydown.fb",function(e){var code=e.which||e.keyCode,target=e.target||e.srcElement;return 27===code&&F.coming?!1:void(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||target&&(target.type||$(target).is("[contenteditable]"))||$.each(keys,function(i,val){return current.group.length>1&&val[code]!==undefined?(F[i](val[code]),e.preventDefault(),!1):$.inArray(code,val)>-1?(F[i](),e.preventDefault(),!1):void 0}))}),$.fn.mousewheel&&current.mouseWheel&&F.wrap.bind("mousewheel.fb",function(e,delta,deltaX,deltaY){for(var target=e.target||null,parent=$(target),canScroll=!1;parent.length&&!(canScroll||parent.is(".fancybox-skin")||parent.is(".fancybox-wrap"));)canScroll=isScrollable(parent[0]),parent=$(parent).parent();0===delta||canScroll||F.group.length>1&&!current.canShrink&&(deltaY>0||deltaX>0?F.prev(deltaY>0?"down":"left"):(0>deltaY||0>deltaX)&&F.next(0>deltaY?"up":"right"),e.preventDefault())}))},trigger:function(event,o){var ret,obj=o||F.coming||F.current;if(obj){if($.isFunction(obj[event])&&(ret=obj[event].apply(obj,Array.prototype.slice.call(arguments,1))),ret===!1)return!1;obj.helpers&&$.each(obj.helpers,function(helper,opts){opts&&F.helpers[helper]&&$.isFunction(F.helpers[helper][event])&&F.helpers[helper][event]($.extend(!0,{},F.helpers[helper].defaults,opts),obj)}),D.trigger(event)}},isImage:function(str){return isString(str)&&str.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSWF:function(str){return isString(str)&&str.match(/\.(swf)((\?|#).*)?$/i)},_start:function(index){var obj,href,type,margin,padding,coming={};if(index=getScalar(index),obj=F.group[index]||null,!obj)return!1;if(coming=$.extend(!0,{},F.opts,obj),margin=coming.margin,padding=coming.padding,"number"===$.type(margin)&&(coming.margin=[margin,margin,margin,margin]),"number"===$.type(padding)&&(coming.padding=[padding,padding,padding,padding]),coming.modal&&$.extend(!0,coming,{closeBtn:!1,closeClick:!1,nextClick:!1,arrows:!1,mouseWheel:!1,keys:null,helpers:{overlay:{closeClick:!1}}}),coming.autoSize&&(coming.autoWidth=coming.autoHeight=!0),"auto"===coming.width&&(coming.autoWidth=!0),"auto"===coming.height&&(coming.autoHeight=!0),coming.group=F.group,coming.index=index,F.coming=coming,!1===F.trigger("beforeLoad"))return void(F.coming=null);if(type=coming.type,href=coming.href,!type)return F.coming=null,F.current&&F.router&&"jumpto"!==F.router?(F.current.index=index,F[F.router](F.direction)):!1;if(F.isActive=!0,("image"===type||"swf"===type)&&(coming.autoHeight=coming.autoWidth=!1,coming.scrolling="visible"),"image"===type&&(coming.aspectRatio=!0),"iframe"===type&&isTouch&&(coming.scrolling="scroll"),coming.wrap=$(coming.tpl.wrap).addClass("fancybox-"+(isTouch?"mobile":"desktop")+" fancybox-type-"+type+" fancybox-tmp "+coming.wrapCSS).appendTo(coming.parent||"body"),$.extend(coming,{skin:$(".fancybox-skin",coming.wrap),outer:$(".fancybox-outer",coming.wrap),inner:$(".fancybox-inner",coming.wrap)}),$.each(["Top","Right","Bottom","Left"],function(i,v){coming.skin.css("padding"+v,getValue(coming.padding[i]))}),F.trigger("onReady"),"inline"===type||"html"===type){if(!coming.content||!coming.content.length)return F._error("content")}else if(!href)return F._error("href");"image"===type?F._loadImage():"ajax"===type?F._loadAjax():"iframe"===type?F._loadIframe():F._afterLoad()},_error:function(type){$.extend(F.coming,{type:"html",autoWidth:!0,autoHeight:!0,minWidth:0,minHeight:0,scrolling:"no",hasError:type,content:F.coming.tpl.error}),F._afterLoad()},_loadImage:function(){var img=F.imgPreload=new Image;img.onload=function(){this.onload=this.onerror=null,F.coming.width=this.width/F.opts.pixelRatio,F.coming.height=this.height/F.opts.pixelRatio,F._afterLoad()},img.onerror=function(){this.onload=this.onerror=null,F._error("image")},img.src=F.coming.href,img.complete!==!0&&F.showLoading()},_loadAjax:function(){var coming=F.coming;F.showLoading(),F.ajaxLoad=$.ajax($.extend({},coming.ajax,{url:coming.href,error:function(jqXHR,textStatus){F.coming&&"abort"!==textStatus?F._error("ajax",jqXHR):F.hideLoading()},success:function(data,textStatus){"success"===textStatus&&(coming.content=data,F._afterLoad())}}))},_loadIframe:function(){var coming=F.coming,iframe=$(coming.tpl.iframe.replace(/\{rnd\}/g,(new Date).getTime())).attr("scrolling",isTouch?"auto":coming.iframe.scrolling).attr("src",coming.href);$(coming.wrap).bind("onReset",function(){try{$(this).find("iframe").hide().attr("src","//about:blank").end().empty()}catch(e){}}),coming.iframe.preload&&(F.showLoading(),iframe.one("load",function(){$(this).data("ready",1),isTouch||$(this).bind("load.fb",F.update),$(this).parents(".fancybox-wrap").width("100%").removeClass("fancybox-tmp").show(),F._afterLoad()})),coming.content=iframe.appendTo(coming.inner),coming.iframe.preload||F._afterLoad()},_preloadImages:function(){var item,i,group=F.group,current=F.current,len=group.length,cnt=current.preload?Math.min(current.preload,len-1):0;for(i=1;cnt>=i;i+=1)item=group[(current.index+i)%len],"image"===item.type&&item.href&&((new Image).src=item.href)},_afterLoad:function(){var current,content,type,scrolling,href,embed,coming=F.coming,previous=F.current,placeholder="fancybox-placeholder";if(F.hideLoading(),coming&&F.isActive!==!1){if(!1===F.trigger("afterLoad",coming,previous))return coming.wrap.stop(!0).trigger("onReset").remove(),void(F.coming=null);switch(previous&&(F.trigger("beforeChange",previous),previous.wrap.stop(!0).removeClass("fancybox-opened").find(".fancybox-item, .fancybox-nav").remove()),F.unbindEvents(),current=coming,content=coming.content,type=coming.type,scrolling=coming.scrolling,$.extend(F,{wrap:current.wrap,skin:current.skin,outer:current.outer,inner:current.inner,current:current,previous:previous}),href=current.href,type){case"inline":case"ajax":case"html":current.selector?content=$("<div>").html(content).find(current.selector):isQuery(content)&&(content.data(placeholder)||content.data(placeholder,$('<div class="'+placeholder+'"></div>').insertAfter(content).hide()),content=content.show().detach(),current.wrap.bind("onReset",function(){$(this).find(content).length&&content.hide().replaceAll(content.data(placeholder)).data(placeholder,!1)}));break;case"image":content=current.tpl.image.replace("{href}",href);break;case"swf":content='<object id="fancybox-swf" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="100%" height="100%"><param name="movie" value="'+href+'"></param>',embed="",$.each(current.swf,function(name,val){content+='<param name="'+name+'" value="'+val+'"></param>',embed+=" "+name+'="'+val+'"'}),content+='<embed src="'+href+'" type="application/x-shockwave-flash" width="100%" height="100%"'+embed+"></embed></object>"}isQuery(content)&&content.parent().is(current.inner)||current.inner.append(content),F.trigger("beforeShow"),current.inner.css("overflow","yes"===scrolling?"scroll":"no"===scrolling?"hidden":scrolling),F._setDimension(),F.reposition(),F.isOpen=!1,F.coming=null,F.bindEvents(),F.isOpened?previous.prevMethod&&F.transitions[previous.prevMethod]():$(".fancybox-wrap").not(current.wrap).stop(!0).trigger("onReset").remove(),F.transitions[F.isOpened?current.nextMethod:current.openMethod](),F._preloadImages()}},_setDimension:function(){var wPadding,hPadding,wSpace,hSpace,origWidth,origHeight,origMaxWidth,origMaxHeight,ratio,width_,height_,maxWidth_,maxHeight_,iframe,body,viewport=F.getViewport(),steps=0,canShrink=!1,canExpand=!1,wrap=F.wrap,skin=F.skin,inner=F.inner,current=F.current,width=current.width,height=current.height,minWidth=current.minWidth,minHeight=current.minHeight,maxWidth=current.maxWidth,maxHeight=current.maxHeight,scrolling=current.scrolling,scrollOut=current.scrollOutside?current.scrollbarWidth:0,margin=current.margin,wMargin=getScalar(margin[1]+margin[3]),hMargin=getScalar(margin[0]+margin[2]);if(wrap.add(skin).add(inner).width("auto").height("auto").removeClass("fancybox-tmp"),wPadding=getScalar(skin.outerWidth(!0)-skin.width()),hPadding=getScalar(skin.outerHeight(!0)-skin.height()),wSpace=wMargin+wPadding,hSpace=hMargin+hPadding,origWidth=isPercentage(width)?(viewport.w-wSpace)*getScalar(width)/100:width,origHeight=isPercentage(height)?(viewport.h-hSpace)*getScalar(height)/100:height,"iframe"===current.type){if(iframe=current.content,current.autoHeight&&1===iframe.data("ready"))try{iframe[0].contentWindow.document.location&&(inner.width(origWidth).height(9999),body=iframe.contents().find("body"),scrollOut&&body.css("overflow-x","hidden"),origHeight=body.outerHeight(!0))}catch(e){}}else(current.autoWidth||current.autoHeight)&&(inner.addClass("fancybox-tmp"),current.autoWidth||inner.width(origWidth),current.autoHeight||inner.height(origHeight),current.autoWidth&&(origWidth=inner.width()),current.autoHeight&&(origHeight=inner.height()),inner.removeClass("fancybox-tmp"));if(width=getScalar(origWidth),height=getScalar(origHeight),ratio=origWidth/origHeight,minWidth=getScalar(isPercentage(minWidth)?getScalar(minWidth,"w")-wSpace:minWidth),maxWidth=getScalar(isPercentage(maxWidth)?getScalar(maxWidth,"w")-wSpace:maxWidth),minHeight=getScalar(isPercentage(minHeight)?getScalar(minHeight,"h")-hSpace:minHeight),maxHeight=getScalar(isPercentage(maxHeight)?getScalar(maxHeight,"h")-hSpace:maxHeight),origMaxWidth=maxWidth,origMaxHeight=maxHeight,current.fitToView&&(maxWidth=Math.min(viewport.w-wSpace,maxWidth),maxHeight=Math.min(viewport.h-hSpace,maxHeight)),maxWidth_=viewport.w-wMargin,maxHeight_=viewport.h-hMargin,current.aspectRatio?(width>maxWidth&&(width=maxWidth,height=getScalar(width/ratio)),height>maxHeight&&(height=maxHeight,width=getScalar(height*ratio)),minWidth>width&&(width=minWidth,height=getScalar(width/ratio)),minHeight>height&&(height=minHeight,width=getScalar(height*ratio))):(width=Math.max(minWidth,Math.min(width,maxWidth)),current.autoHeight&&"iframe"!==current.type&&(inner.width(width),height=inner.height()),height=Math.max(minHeight,Math.min(height,maxHeight))),current.fitToView)if(inner.width(width).height(height),wrap.width(width+wPadding),width_=wrap.width(),height_=wrap.height(),current.aspectRatio)for(;(width_>maxWidth_||height_>maxHeight_)&&width>minWidth&&height>minHeight&&!(steps++>19);)height=Math.max(minHeight,Math.min(maxHeight,height-10)),width=getScalar(height*ratio),minWidth>width&&(width=minWidth,height=getScalar(width/ratio)),width>maxWidth&&(width=maxWidth,height=getScalar(width/ratio)),inner.width(width).height(height),wrap.width(width+wPadding),width_=wrap.width(),height_=wrap.height();else width=Math.max(minWidth,Math.min(width,width-(width_-maxWidth_))),height=Math.max(minHeight,Math.min(height,height-(height_-maxHeight_)));scrollOut&&"auto"===scrolling&&origHeight>height&&maxWidth_>width+wPadding+scrollOut&&(width+=scrollOut),inner.width(width).height(height),wrap.width(width+wPadding),width_=wrap.width(),height_=wrap.height(),canShrink=(width_>maxWidth_||height_>maxHeight_)&&width>minWidth&&height>minHeight,canExpand=current.aspectRatio?origMaxWidth>width&&origMaxHeight>height&&origWidth>width&&origHeight>height:(origMaxWidth>width||origMaxHeight>height)&&(origWidth>width||origHeight>height),$.extend(current,{dim:{width:getValue(width_),height:getValue(height_)},origWidth:origWidth,origHeight:origHeight,canShrink:canShrink,canExpand:canExpand,wPadding:wPadding,hPadding:hPadding,wrapSpace:height_-skin.outerHeight(!0),skinSpace:skin.height()-height}),!iframe&&current.autoHeight&&height>minHeight&&maxHeight>height&&!canExpand&&inner.height("auto")},_getPosition:function(onlyAbsolute){var current=F.current,viewport=F.getViewport(),margin=current.margin,width=F.wrap.width()+margin[1]+margin[3],height=F.wrap.height()+margin[0]+margin[2],rez={position:"absolute",top:margin[0],left:margin[3]};return current.autoCenter&&current.fixed&&!onlyAbsolute&&height<=viewport.h&&width<=viewport.w?rez.position="fixed":current.locked||(rez.top+=viewport.y,rez.left+=viewport.x),rez.top=getValue(Math.max(rez.top,rez.top+(viewport.h-height)*current.topRatio)),rez.left=getValue(Math.max(rez.left,rez.left+(viewport.w-width)*current.leftRatio)),rez},_afterZoomIn:function(){var current=F.current;current&&(F.isOpen=F.isOpened=!0,F.wrap.css("overflow","visible").addClass("fancybox-opened"),F.update(),(current.closeClick||current.nextClick&&F.group.length>1)&&F.inner.css("cursor","pointer").bind("click.fb",function(e){$(e.target).is("a")||$(e.target).parent().is("a")||(e.preventDefault(),F[current.closeClick?"close":"next"]())}),current.closeBtn&&$(current.tpl.closeBtn).appendTo(F.skin).bind("click.fb",function(e){e.preventDefault(),F.close()}),current.arrows&&F.group.length>1&&((current.loop||current.index>0)&&$(current.tpl.prev).appendTo(F.outer).bind("click.fb",F.prev),(current.loop||current.index<F.group.length-1)&&$(current.tpl.next).appendTo(F.outer).bind("click.fb",F.next)),F.trigger("afterShow"),current.loop||current.index!==current.group.length-1?F.opts.autoPlay&&!F.player.isActive&&(F.opts.autoPlay=!1,F.play()):F.play(!1))},_afterZoomOut:function(obj){obj=obj||F.current,$(".fancybox-wrap").trigger("onReset").remove(),$.extend(F,{group:{},opts:{},router:!1,current:null,isActive:!1,isOpened:!1,isOpen:!1,isClosing:!1,wrap:null,skin:null,outer:null,inner:null}),F.trigger("afterClose",obj)}}),F.transitions={getOrigPosition:function(){var current=F.current,element=current.element,orig=current.orig,pos={},width=50,height=50,hPadding=current.hPadding,wPadding=current.wPadding,viewport=F.getViewport();return!orig&&current.isDom&&element.is(":visible")&&(orig=element.find("img:first"),orig.length||(orig=element)),isQuery(orig)?(pos=orig.offset(),orig.is("img")&&(width=orig.outerWidth(),height=orig.outerHeight())):(pos.top=viewport.y+(viewport.h-height)*current.topRatio,pos.left=viewport.x+(viewport.w-width)*current.leftRatio),("fixed"===F.wrap.css("position")||current.locked)&&(pos.top-=viewport.y,pos.left-=viewport.x),pos={top:getValue(pos.top-hPadding*current.topRatio),left:getValue(pos.left-wPadding*current.leftRatio),width:getValue(width+wPadding),height:getValue(height+hPadding)}},step:function(now,fx){var ratio,padding,value,prop=fx.prop,current=F.current,wrapSpace=current.wrapSpace,skinSpace=current.skinSpace;("width"===prop||"height"===prop)&&(ratio=fx.end===fx.start?1:(now-fx.start)/(fx.end-fx.start),F.isClosing&&(ratio=1-ratio),padding="width"===prop?current.wPadding:current.hPadding,value=now-padding,F.skin[prop](getScalar("width"===prop?value:value-wrapSpace*ratio)),F.inner[prop](getScalar("width"===prop?value:value-wrapSpace*ratio-skinSpace*ratio)))},zoomIn:function(){var current=F.current,startPos=current.pos,effect=current.openEffect,elastic="elastic"===effect,endPos=$.extend({opacity:1},startPos);delete endPos.position,elastic?(startPos=this.getOrigPosition(),current.openOpacity&&(startPos.opacity=.1)):"fade"===effect&&(startPos.opacity=.1),F.wrap.css(startPos).animate(endPos,{duration:"none"===effect?0:current.openSpeed,easing:current.openEasing,step:elastic?this.step:null,complete:F._afterZoomIn})},zoomOut:function(){var current=F.current,effect=current.closeEffect,elastic="elastic"===effect,endPos={opacity:.1};elastic&&(endPos=this.getOrigPosition(),current.closeOpacity&&(endPos.opacity=.1)),F.wrap.animate(endPos,{duration:"none"===effect?0:current.closeSpeed,easing:current.closeEasing,step:elastic?this.step:null,complete:F._afterZoomOut})},changeIn:function(){var field,current=F.current,effect=current.nextEffect,startPos=current.pos,endPos={opacity:1},direction=F.direction,distance=200;startPos.opacity=.1,"elastic"===effect&&(field="down"===direction||"up"===direction?"top":"left","down"===direction||"right"===direction?(startPos[field]=getValue(getScalar(startPos[field])-distance),endPos[field]="+="+distance+"px"):(startPos[field]=getValue(getScalar(startPos[field])+distance),endPos[field]="-="+distance+"px")),"none"===effect?F._afterZoomIn():F.wrap.css(startPos).animate(endPos,{duration:current.nextSpeed,easing:current.nextEasing,complete:F._afterZoomIn})},changeOut:function(){var previous=F.previous,effect=previous.prevEffect,endPos={opacity:.1},direction=F.direction,distance=200;"elastic"===effect&&(endPos["down"===direction||"up"===direction?"top":"left"]=("up"===direction||"left"===direction?"-":"+")+"="+distance+"px"),previous.wrap.animate(endPos,{duration:"none"===effect?0:previous.prevSpeed,easing:previous.prevEasing,complete:function(){$(this).trigger("onReset").remove()}})}},F.helpers.overlay={defaults:{closeClick:!0,speedOut:200,showEarly:!0,css:{},locked:!isTouch,fixed:!0},overlay:null,fixed:!1,el:$("html"),create:function(opts){opts=$.extend({},this.defaults,opts),this.overlay&&this.close(),this.overlay=$('<div class="fancybox-overlay"></div>').appendTo(F.coming?F.coming.parent:opts.parent),this.fixed=!1,opts.fixed&&F.defaults.fixed&&(this.overlay.addClass("fancybox-overlay-fixed"),this.fixed=!0)},open:function(opts){var that=this;opts=$.extend({},this.defaults,opts),this.overlay?this.overlay.unbind(".overlay").width("auto").height("auto"):this.create(opts),this.fixed||(W.bind("resize.overlay",$.proxy(this.update,this)),this.update()),opts.closeClick&&this.overlay.bind("click.overlay",function(e){return $(e.target).hasClass("fancybox-overlay")?(F.isActive?F.close():that.close(),!1):void 0}),this.overlay.css(opts.css).show()},close:function(){var scrollV,scrollH;W.unbind("resize.overlay"),this.el.hasClass("fancybox-lock")&&($(".fancybox-margin").removeClass("fancybox-margin"),scrollV=W.scrollTop(),scrollH=W.scrollLeft(),this.el.removeClass("fancybox-lock"),W.scrollTop(scrollV).scrollLeft(scrollH)),$(".fancybox-overlay").remove().hide(),$.extend(this,{overlay:null,fixed:!1})},update:function(){var offsetWidth,width="100%";this.overlay.width(width).height("100%"),IE?(offsetWidth=Math.max(document.documentElement.offsetWidth,document.body.offsetWidth),D.width()>offsetWidth&&(width=D.width())):D.width()>W.width()&&(width=D.width()),this.overlay.width(width).height(D.height())},onReady:function(opts,obj){var overlay=this.overlay;$(".fancybox-overlay").stop(!0,!0),overlay||this.create(opts),opts.locked&&this.fixed&&obj.fixed&&(overlay||(this.margin=D.height()>W.height()?$("html").css("margin-right").replace("px",""):!1),
obj.locked=this.overlay.append(obj.wrap),obj.fixed=!1),opts.showEarly===!0&&this.beforeShow.apply(this,arguments)},beforeShow:function(opts,obj){var scrollV,scrollH;obj.locked&&(this.margin!==!1&&($("*").filter(function(){return"fixed"===$(this).css("position")&&!$(this).hasClass("fancybox-overlay")&&!$(this).hasClass("fancybox-wrap")}).addClass("fancybox-margin"),this.el.addClass("fancybox-margin")),scrollV=W.scrollTop(),scrollH=W.scrollLeft(),this.el.addClass("fancybox-lock"),W.scrollTop(scrollV).scrollLeft(scrollH)),this.open(opts)},onUpdate:function(){this.fixed||this.update()},afterClose:function(opts){this.overlay&&!F.coming&&this.overlay.fadeOut(opts.speedOut,$.proxy(this.close,this))}},F.helpers.title={defaults:{type:"float",position:"bottom"},beforeShow:function(opts){var title,target,current=F.current,text=current.title,type=opts.type;if($.isFunction(text)&&(text=text.call(current.element,current)),isString(text)&&""!==$.trim(text)){switch(title=$('<div class="fancybox-title fancybox-title-'+type+'-wrap">'+text+"</div>"),type){case"inside":target=F.skin;break;case"outside":target=F.wrap;break;case"over":target=F.inner;break;default:target=F.skin,title.appendTo("body"),IE&&title.width(title.width()),title.wrapInner('<span class="child"></span>'),F.current.margin[2]+=Math.abs(getScalar(title.css("margin-bottom")))}title["top"===opts.position?"prependTo":"appendTo"](target)}}},$.fn.fancybox=function(options){var index,that=$(this),selector=this.selector||"",run=function(e){var relType,relVal,what=$(this).blur(),idx=index;e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||what.is(".fancybox-wrap")||(relType=options.groupAttr||"data-fancybox-group",relVal=what.attr(relType),relVal||(relType="rel",relVal=what.get(0)[relType]),relVal&&""!==relVal&&"nofollow"!==relVal&&(what=selector.length?$(selector):that,what=what.filter("["+relType+'="'+relVal+'"]'),idx=what.index(this)),options.index=idx,F.open(what,options)!==!1&&e.preventDefault())};return options=options||{},index=options.index||0,selector&&options.live!==!1?D.undelegate(selector,"click.fb-start").delegate(selector+":not('.fancybox-item, .fancybox-nav')","click.fb-start",run):that.unbind("click.fb-start").bind("click.fb-start",run),this.filter("[data-fancybox-start=1]").trigger("click"),this},D.ready(function(){var w1,w2;$.scrollbarWidth===undefined&&($.scrollbarWidth=function(){var parent=$('<div style="width:50px;height:50px;overflow:auto"><div/></div>').appendTo("body"),child=parent.children(),width=child.innerWidth()-child.height(99).innerWidth();return parent.remove(),width}),$.support.fixedPosition===undefined&&($.support.fixedPosition=function(){var elem=$('<div style="position:fixed;top:20px;"></div>').appendTo("body"),fixed=20===elem[0].offsetTop||15===elem[0].offsetTop;return elem.remove(),fixed}()),$.extend(F.defaults,{scrollbarWidth:$.scrollbarWidth(),fixed:$.support.fixedPosition,parent:$("body")}),w1=$(window).width(),H.addClass("fancybox-lock-test"),w2=$(window).width(),H.removeClass("fancybox-lock-test"),$("<style type='text/css'>.fancybox-margin{margin-right:"+(w2-w1)+"px;}</style>").appendTo("head")})}(window,document,jQuery),!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.buckets=b()}(this,function(){"use strict";var a={};return a.defaultCompare=function(a,b){return b>a?-1:a===b?0:1},a.defaultEquals=function(a,b){return a===b},a.defaultToString=function(b){return null===b?"BUCKETS_NULL":a.isUndefined(b)?"BUCKETS_UNDEFINED":a.isString(b)?b:b.toString()},a.isFunction=function(a){return"function"==typeof a},a.isUndefined=function(a){return void 0===a},a.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)},a.reverseCompareFunction=function(b){return a.isFunction(b)?function(a,c){return-1*b(a,c)}:function(a,b){return b>a?1:a===b?0:-1}},a.compareToEquals=function(a){return function(b,c){return 0===a(b,c)}},a.arrays={},a.arrays.indexOf=function(b,c,d){var e,f=d||a.defaultEquals,g=b.length;for(e=0;g>e;e+=1)if(f(b[e],c))return e;return-1},a.arrays.lastIndexOf=function(b,c,d){var e,f=d||a.defaultEquals,g=b.length;for(e=g-1;e>=0;e-=1)if(f(b[e],c))return e;return-1},a.arrays.contains=function(b,c,d){return a.arrays.indexOf(b,c,d)>=0},a.arrays.remove=function(b,c,d){var e=a.arrays.indexOf(b,c,d);return 0>e?!1:(b.splice(e,1),!0)},a.arrays.frequency=function(b,c,d){var e,f=d||a.defaultEquals,g=b.length,h=0;for(e=0;g>e;e+=1)f(b[e],c)&&(h+=1);return h},a.arrays.equals=function(b,c,d){var e,f=d||a.defaultEquals,g=b.length;if(b.length!==c.length)return!1;for(e=0;g>e;e+=1)if(!f(b[e],c[e]))return!1;return!0},a.arrays.copy=function(a){return a.concat()},a.arrays.swap=function(a,b,c){var d;return 0>b||b>=a.length||0>c||c>=a.length?!1:(d=a[b],a[b]=a[c],a[c]=d,!0)},a.arrays.forEach=function(a,b){var c,d=a.length;for(c=0;d>c;c+=1)if(b(a[c])===!1)return},a.Bag=function(b){var c={},d=b||a.defaultToString,e=new a.Dictionary(d),f=0;return c.add=function(b,d){var g;return(isNaN(d)||a.isUndefined(d))&&(d=1),a.isUndefined(b)||0>=d?!1:(c.contains(b)?e.get(b).copies+=d:(g={value:b,copies:d},e.set(b,g)),f+=d,!0)},c.count=function(a){return c.contains(a)?e.get(a).copies:0},c.contains=function(a){return e.containsKey(a)},c.remove=function(b,d){var g;return(isNaN(d)||a.isUndefined(d))&&(d=1),a.isUndefined(b)||0>=d?!1:c.contains(b)?(g=e.get(b),f-=d>g.copies?g.copies:d,g.copies-=d,g.copies<=0&&e.remove(b),!0):!1},c.toArray=function(){var a,b,c,d,f,g=[],h=e.values(),i=h.length;for(d=0;i>d;d+=1)for(a=h[d],b=a.value,c=a.copies,f=0;c>f;f+=1)g.push(b);return g},c.toSet=function(){var b,c=new a.Set(d),f=e.values(),g=f.length;for(b=0;g>b;b+=1)c.add(f[b].value);return c},c.forEach=function(a){e.forEach(function(b,c){var d,e=c.value,f=c.copies;for(d=0;f>d;d+=1)if(a(e)===!1)return!1;return!0})},c.size=function(){return f},c.isEmpty=function(){return 0===f},c.clear=function(){f=0,e.clear()},c.equals=function(b){var d;return a.isUndefined(b)||"function"!=typeof b.toSet?!1:c.size()!==b.size()?!1:(d=!0,b.forEach(function(a){return d=c.count(a)===b.count(a)}),d)},c},a.BSTree=function(b){function c(a,b){for(var c,d=a;void 0!==d&&0!==c;)c=g(b,d.element),0>c?d=d.leftCh:c>0&&(d=d.rightCh);return d}function d(a){for(var b=a;void 0!==b.leftCh;)b=b.leftCh;return b}var e,f={},g=b||a.defaultCompare,h=0;return f.add=function(b){function c(a){for(var b,c,d=e;void 0!==d;){if(c=g(a.element,d.element),0===c)return void 0;0>c?(b=d,d=d.leftCh):(b=d,d=d.rightCh)}return a.parent=b,void 0===b?e=a:g(a.element,b.element)<0?b.leftCh=a:b.rightCh=a,a}if(a.isUndefined(b))return!1;var d={element:b,leftCh:void 0,rightCh:void 0,parent:void 0};return void 0!==c(d)?(h+=1,!0):!1},f.clear=function(){e=void 0,h=0},f.isEmpty=function(){return 0===h},f.size=function(){return h},f.contains=function(b){return a.isUndefined(b)?!1:void 0!==c(e,b)},f.remove=function(a){function b(a,b){void 0===a.parent?e=b:a===a.parent.leftCh?a.parent.leftCh=b:a.parent.rightCh=b,void 0!==b&&(b.parent=a.parent)}function f(a){if(void 0===a.leftCh)b(a,a.rightCh);else if(void 0===a.rightCh)b(a,a.leftCh);else{var c=d(a.rightCh);c.parent!==a&&(b(c,c.rightCh),c.rightCh=a.rightCh,c.rightCh.parent=c),b(a,c),c.leftCh=a.leftCh,c.leftCh.parent=c}}var g;return g=c(e,a),void 0===g?!1:(f(g),h-=1,!0)},f.inorderTraversal=function(a){function b(a,c,d){void 0===a||d.stop||(b(a.leftCh,c,d),d.stop||(d.stop=c(a.element)===!1,d.stop||b(a.rightCh,c,d)))}b(e,a,{stop:!1})},f.preorderTraversal=function(a){function b(a,c,d){void 0===a||d.stop||(d.stop=c(a.element)===!1,d.stop||(b(a.leftCh,c,d),d.stop||b(a.rightCh,c,d)))}b(e,a,{stop:!1})},f.postorderTraversal=function(a){function b(a,c,d){void 0===a||d.stop||(b(a.leftCh,c,d),d.stop||(b(a.rightCh,c,d),d.stop||(d.stop=c(a.element)===!1)))}b(e,a,{stop:!1})},f.levelTraversal=function(b){function c(b,c){var d=a.Queue();for(void 0!==b&&d.enqueue(b);!d.isEmpty();){if(b=d.dequeue(),c(b.element)===!1)return;void 0!==b.leftCh&&d.enqueue(b.leftCh),void 0!==b.rightCh&&d.enqueue(b.rightCh)}}c(e,b)},f.minimum=function(){return f.isEmpty()?void 0:d(e).element},f.maximum=function(){function a(a){for(;void 0!==a.rightCh;)a=a.rightCh;return a}return f.isEmpty()?void 0:a(e).element},f.forEach=function(a){f.inorderTraversal(a)},f.toArray=function(){var a=[];return f.inorderTraversal(function(b){a.push(b)}),a},f.height=function(){function a(b){return void 0===b?-1:Math.max(a(b.leftCh),a(b.rightCh))+1}function b(b){return void 0===b?-1:Math.max(a(b.leftCh),a(b.rightCh))+1}return b(e)},f.equals=function(b){var c;return a.isUndefined(b)||"function"!=typeof b.levelTraversal?!1:f.size()!==b.size()?!1:(c=!0,b.forEach(function(a){return c=f.contains(a)}),c)},f},a.Dictionary=function(b){var c={},d={},e=0,f=b||a.defaultToString,g="/$ ";return c.get=function(b){var c=d[g+f(b)];return a.isUndefined(c)?void 0:c.value},c.set=function(b,c){var h,i,j;return a.isUndefined(b)||a.isUndefined(c)?void 0:(i=g+f(b),j=d[i],a.isUndefined(j)?(e+=1,h=void 0):h=j.value,d[i]={key:b,value:c},h)},c.remove=function(b){var c=g+f(b),h=d[c];return a.isUndefined(h)?void 0:(delete d[c],e-=1,h.value)},c.keys=function(){var a,b=[];for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&b.push(d[a].key);return b},c.values=function(){var a,b=[];for(a in d)Object.prototype.hasOwnProperty.call(d,a)&&b.push(d[a].value);return b},c.forEach=function(a){var b,c,e;for(b in d)if(Object.prototype.hasOwnProperty.call(d,b)&&(c=d[b],e=a(c.key,c.value),e===!1))return},c.containsKey=function(b){return!a.isUndefined(c.get(b))},c.clear=function(){d={},e=0},c.size=function(){return e},c.isEmpty=function(){return 0>=e},c.equals=function(b,d){var e,f;return a.isUndefined(b)||"function"!=typeof b.keys?!1:c.size()!==b.size()?!1:(e=d||a.defaultEquals,f=!0,b.forEach(function(a,b){return f=e(c.get(a),b)}),f)},c},a.Heap=function(b){function c(b){function c(a){return Math.floor((a-1)/2)}var d;for(d=c(b);b>0&&g(f[d],f[b])>0;)a.arrays.swap(f,d,b),b=d,d=c(b)}function d(b){function c(a){return 2*a+1}function d(a){return 2*a+2}function e(a,b){return b>=f.length?a>=f.length?-1:a:g(f[a],f[b])<=0?a:b}var h;for(h=e(c(b),d(b));h>=0&&g(f[b],f[h])>0;)a.arrays.swap(f,h,b),b=h,h=e(c(b),d(b))}var e={},f=[],g=b||a.defaultCompare;return e.peek=function(){return f.length>0?f[0]:void 0},e.add=function(b){return a.isUndefined(b)?void 0:(f.push(b),c(f.length-1),!0)},e.removeRoot=function(){var a;return f.length>0?(a=f[0],f[0]=f[f.length-1],f.splice(f.length-1,1),f.length>0&&d(0),a):void 0},e.contains=function(b){var c=a.compareToEquals(g);return a.arrays.contains(f,b,c)},e.size=function(){return f.length},e.isEmpty=function(){return f.length<=0},e.clear=function(){f.length=0},e.forEach=function(b){a.arrays.forEach(f,b)},e.toArray=function(){return a.arrays.copy(f)},e.equals=function(b){var c,d,f;return a.isUndefined(b)||"function"!=typeof b.removeRoot?!1:e.size()!==b.size()?!1:(c=e.toArray(),d=b.toArray(),f=a.compareToEquals(g),c.sort(g),d.sort(g),a.arrays.equals(c,d,f))},e},a.LinkedList=function(){function b(a){var b,e;if(0>a||a>=f)return void 0;if(a===f-1)return d;for(b=c,e=0;a>e;e+=1)b=b.next;return b}var c,d,e={},f=0;return e.add=function(e,g){var h,i;return a.isUndefined(g)&&(g=f),0>g||g>f||a.isUndefined(e)?!1:(h={element:e,next:void 0},0===f?(c=h,d=h):g===f?(d.next=h,d=h):0===g?(h.next=c,c=h):(i=b(g-1),h.next=i.next,i.next=h),f+=1,!0)},e.first=function(){return void 0!==c?c.element:void 0},e.last=function(){return void 0!==d?d.element:void 0},e.elementAtIndex=function(a){var c=b(a);return void 0===c?void 0:c.element},e.indexOf=function(b,d){var e=d||a.defaultEquals,f=c,g=0;if(a.isUndefined(b))return-1;for(;void 0!==f;){if(e(f.element,b))return g;g+=1,f=f.next}return-1},e.contains=function(a,b){return e.indexOf(a,b)>=0},e.remove=function(b,e){var g,h=e||a.defaultEquals,i=c;if(1>f||a.isUndefined(b))return!1;for(;void 0!==i;){if(h(i.element,b))return i===c?(c=c.next,i===d&&(d=void 0)):i===d?(d=g,g.next=i.next,i.next=void 0):(g.next=i.next,i.next=void 0),f-=1,!0;g=i,i=i.next}return!1},e.clear=function(){c=void 0,d=void 0,f=0},e.equals=function(b,d){var f=d||a.defaultEquals,g=!0,h=c;return a.isUndefined(b)||"function"!=typeof b.elementAtIndex?!1:e.size()!==b.size()?!1:(b.forEach(function(a){return g=f(a,h.element),h=h.next,g}),g)},e.removeElementAtIndex=function(a){var e,g;return 0>a||a>=f?void 0:(1===f?(e=c.element,c=void 0,d=void 0):(g=b(a-1),void 0===g?(e=c.element,c=c.next):g.next===d&&(e=d.element,d=g),void 0!==g&&(e=g.next.element,g.next=g.next.next)),f-=1,e)},e.forEach=function(a){for(var b=c;void 0!==b&&a(b.element)!==!1;)b=b.next},e.reverse=function(){for(var a,b,e=c;void 0!==e;)b=e.next,e.next=a,a=e,e=b;b=c,c=d,d=b},e.toArray=function(){var a=[];return e.forEach(function(b){a.push(b)}),a},e.size=function(){return f},e.isEmpty=function(){return 0>=f},e},a.MultiDictionary=function(b,c){var d={},e=new a.Dictionary(b),f=c||a.defaultEquals;return d.get=function(b){var c=e.get(b);return a.isUndefined(c)?[]:a.arrays.copy(c)},d.set=function(b,c){var g;return a.isUndefined(b)||a.isUndefined(c)?!1:d.containsKey(b)?(g=e.get(b),a.arrays.contains(g,c,f)?!1:(g.push(c),!0)):(e.set(b,[c]),!0)},d.remove=function(b,c){var d,g;return a.isUndefined(c)?(d=e.remove(b),a.isUndefined(d)?!1:!0):(g=e.get(b),a.arrays.remove(g,c,f)?(0===g.length&&e.remove(b),!0):!1)},d.keys=function(){return e.keys()},d.values=function(){var a,b,c,d=e.values(),f=[];for(a=0;a<d.length;a+=1)for(c=d[a],b=0;b<c.length;b+=1)f.push(c[b]);return f},d.containsKey=function(a){return e.containsKey(a)},d.clear=function(){return e.clear()},d.size=function(){return e.size()},d.isEmpty=function(){return e.isEmpty()},d.forEach=function(a){return e.forEach(a)},d.equals=function(b){var c,e=!0;return a.isUndefined(b)||"function"!=typeof b.values?!1:d.size()!==b.size()?!1:(b.forEach(function(b,g){return c=d.get(b)||[],c.length!==g.length?e=!1:a.arrays.forEach(c,function(b){return e=a.arrays.contains(g,b,f)}),e}),e)},d},a.PriorityQueue=function(b){var c={},d=a.reverseCompareFunction(b),e=new a.Heap(d);return c.enqueue=function(a){return e.add(a)},c.add=function(a){return e.add(a)},c.dequeue=function(){var a;return 0!==e.size()?(a=e.peek(),e.removeRoot(),a):void 0},c.peek=function(){return e.peek()},c.contains=function(a){return e.contains(a)},c.isEmpty=function(){return e.isEmpty()},c.size=function(){return e.size()},c.clear=function(){e.clear()},c.forEach=function(a){e.forEach(a)},c.toArray=function(){return e.toArray()},c.equals=function(b){var e,f,g;return a.isUndefined(b)||"function"!=typeof b.dequeue?!1:c.size()!==b.size()?!1:(e=c.toArray(),f=b.toArray(),g=a.compareToEquals(d),e.sort(d),f.sort(d),a.arrays.equals(e,f,g))},c},a.Queue=function(){var b={},c=new a.LinkedList;return b.enqueue=function(a){return c.add(a)},b.add=function(a){return c.add(a)},b.dequeue=function(){var a;return 0!==c.size()?(a=c.first(),c.removeElementAtIndex(0),a):void 0},b.peek=function(){return 0!==c.size()?c.first():void 0},b.size=function(){return c.size()},b.contains=function(a,b){return c.contains(a,b)},b.isEmpty=function(){return c.size()<=0},b.clear=function(){c.clear()},b.forEach=function(a){c.forEach(a)},b.toArray=function(){return c.toArray()},b.equals=function(c,d){var e,f,g;return a.isUndefined(c)||"function"!=typeof c.dequeue?!1:b.size()!==c.size()?!1:(e=d||a.defaultEquals,f=!0,c.forEach(function(a){return g=b.dequeue(),b.enqueue(g),f=e(g,a)}),f)},b},a.Set=function(b){var c={},d=new a.Dictionary(b);return c.contains=function(a){return d.containsKey(a)},c.add=function(b){return c.contains(b)||a.isUndefined(b)?!1:(d.set(b,b),!0)},c.intersection=function(a){c.forEach(function(b){a.contains(b)||c.remove(b)})},c.union=function(a){a.forEach(function(a){c.add(a)})},c.difference=function(a){a.forEach(function(a){c.remove(a)})},c.isSubsetOf=function(a){var b=!0;return c.size()>a.size()?!1:(c.forEach(function(c){return a.contains(c)?void 0:(b=!1,!1)}),b)},c.remove=function(a){return c.contains(a)?(d.remove(a),!0):!1},c.forEach=function(a){d.forEach(function(b,c){return a(c)})},c.toArray=function(){return d.values()},c.isEmpty=function(){return d.isEmpty()},c.size=function(){return d.size()},c.clear=function(){d.clear()},c.equals=function(b){var d;return a.isUndefined(b)||"function"!=typeof b.isSubsetOf?!1:c.size()!==b.size()?!1:(d=!0,b.forEach(function(a){return d=c.contains(a)}),d)},c},a.Stack=function(){var b={},c=new a.LinkedList;return b.push=function(a){return c.add(a,0)},b.add=function(a){return c.add(a,0)},b.pop=function(){return c.removeElementAtIndex(0)},b.peek=function(){return c.first()},b.size=function(){return c.size()},b.contains=function(a,b){return c.contains(a,b)},b.isEmpty=function(){return c.isEmpty()},b.clear=function(){c.clear()},b.forEach=function(a){c.forEach(a)},b.toArray=function(){return c.toArray()},b.equals=function(d,e){var f,g,h;return a.isUndefined(d)||"function"!=typeof d.peek?!1:b.size()!==d.size()?!1:(f=e||a.defaultEquals,g=!0,d.forEach(function(a){return h=b.pop(),c.add(h),g=f(h,a)}),g)},b},a});var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(text1,text2,opt_checklines,opt_deadline,opt_cleanup){opt_deadline||(opt_deadline=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var deadline=opt_deadline;if(null==text1||null==text2)throw new Error("Null input. (diff_main)");if(text1==text2)return text1?[[DIFF_EQUAL,text1]]:[];"undefined"==typeof opt_checklines&&(opt_checklines=!0);var checklines=opt_checklines,commonlength=this.diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);text1=text1.substring(commonlength),text2=text2.substring(commonlength),commonlength=this.diff_commonSuffix(text1,text2);var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength),text2=text2.substring(0,text2.length-commonlength);var diffs=this.diff_compute_(text1,text2,checklines,deadline);return diffs||(diffs=buckets.LinkedList()),commonprefix&&diffs.add([DIFF_EQUAL,commonprefix],0),commonsuffix&&diffs.add([DIFF_EQUAL,commonsuffix]),diffs},diff_match_patch.prototype.createDiffText=function(text1,text2){var diffs=this.diff_with_token(text1,text2);return diffs=diffs.toArray(),this.diff_cleanupForCorrectionArrangement(diffs),this.diff_cleanupForSingleCharacterCorrection(diffs),this.diff_cleanupArrange(diffs),this.diff_prettyHtml(diffs)},diff_match_patch.prototype.diff_with_token=function(text1,text2){var a=this.diff_tokensToChars_(text1,text2);text1=a.chars1,text2=a.chars2;var tokenArray=a.tokenArray,diffs=this.diff_main(text1,text2,!1,Number.MAX_VALUE,!1);return this.diff_charsToTokens_(diffs,tokenArray),diffs},diff_match_patch.prototype.diff_compute_=function(text1,text2,checklines,deadline){var diffs;if(!text1)return diffs=buckets.LinkedList(),diffs.add([DIFF_INSERT,text2]),diffs;if(!text2)return diffs=buckets.LinkedList(),diffs.add([DIFF_DELETE,text1]),diffs;var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);if(-1!=i)return diffs=buckets.LinkedList(),diffs.add([DIFF_INSERT,longtext.substring(0,i)]),diffs.add([DIFF_EQUAL,shorttext]),diffs.add([DIFF_INSERT,longtext.substring(i+shorttext.length)]),text1.length>text2.length&&(diffs.elementAtIndex(0)[0]=diffs.elementAtIndex(2)[0]=DIFF_DELETE),diffs;var hm=this.diff_halfMatch_(text1,text2);if(hm){var text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3],mid_common=hm[4],diffs_a=this.diff_main(text1_a,text2_a,checklines,deadline),diffs_b=this.diff_main(text1_b,text2_b,checklines,deadline);Array.isArray(diffs_a)||(diffs_a=diffs_a.toArray()),Array.isArray(diffs_b)||(diffs_b=diffs_b.toArray());var concatResults=diffs_a.concat([[DIFF_EQUAL,mid_common]],diffs_b),result=buckets.LinkedList();for(var i in concatResults)result.add(concatResults[i]);return result}return diffs=this.diff_map(text1,text2,deadline),diffs&&0!=diffs.length||(diffs=buckets.LinkedList(),diffs.add([DIFF_INSERT,text2]),diffs.add([DIFF_DELETE,text1])),diffs},diff_match_patch.prototype.diff_map=function(text1,text2,deadline){var text1_length=text1.length,text2_length=text2.length,max_d=text1_length+text2_length-1,v_map1=buckets.LinkedList(),v_map2=buckets.LinkedList(),v1=buckets.Dictionary(),v2=buckets.Dictionary();v1.set(1,0),v2.set(1,0);for(var x,y,footstep=0,footsteps=buckets.Dictionary(),done=!1,d=0;max_d>d;d++){if((new Date).getTime()>deadline)return null;v_map1.add(buckets.Set());for(var k=-d;d>=k;k+=2){for(x=k==-d||k!=d&&v1.get(k-1)<v1.get(k+1)?v1.get(k+1):v1.get(k-1)+1,y=x-k;!done&&text1_length>x&&text2_length>y&&text1.charAt(x)==text2.charAt(y);)x++,y++;if(v1.set(k,x),v_map1.elementAtIndex(d).add(this.diff_footprint(x,y)),x==text1_length&&y==text2_length)return this.diff_path1(v_map1,text1,text2);if(done){var subList=v_map2.toArray().slice(0,footsteps.get(footstep)+1);v_map2=buckets.LinkedList(subList);var a=this.diff_path1(v_map1,text1.substring(0,x),text2.substring(0,y)),b=this.diff_path2(v_map2,text1.substring(x),text2.substring(y));return b.forEach(function(value){a.add(value)}),a}}}return null},diff_match_patch.prototype.diff_path1=function(v_map,text1,text2){for(var path=buckets.LinkedList(),x=text1.length,y=text2.length,last_op=null,d=v_map.size()-2;d>=0;d--)for(;;){if(v_map.elementAtIndex(d).contains(this.diff_footprint(x-1,y))){if(x--,last_op==DIFF_DELETE){var diff=path.first();diff[1]=text1.charAt(x)+diff[1]}else path.add([DIFF_DELETE,text1.substring(x,x+1)],0);last_op=DIFF_DELETE;break}if(v_map.elementAtIndex(d).contains(this.diff_footprint(x,y-1))){if(y--,last_op==DIFF_INSERT){var diff=path.first();diff[1]=text2.charAt(y)+diff[1]}else path.add([DIFF_INSERT,text2.substring(y,y+1)],0);last_op=DIFF_INSERT;break}if(x--,y--,last_op==DIFF_EQUAL){var diff=path.first();diff[1]=text1.charAt(x)+diff[1]}else path.add([DIFF_EQUAL,text1.substring(x,x+1)],0);last_op=DIFF_EQUAL}return path},diff_match_patch.prototype.diff_path2=function(v_map,text1,text2){for(var path=buckets.LinkedList(),x=text1.length,y=text2.length,last_op=null,d=v_map.size()-2;d>=0;d--)for(;;){if(v_map.elementAtIndex(d).contains(this.diff_footprint(x-1,y))){x--,last_op==DIFF_DELETE?path.last().text+=text1.charAt(text1.length-x-1):path.add([DIFF_DELETE,text1.substring(text1.length-x-1,text1.length-x)]),last_op=DIFF_DELETE;break}if(v_map.elementAtIndex(d).contains(this.diff_footprint(x,y-1))){y--,last_op==DIFF_INSERT?path.last().text+=text2.charAt(text2.length-y-1):path.add([DIFF_INSERT,text2.substring(text2.length-y-1,text2.length-y)]),last_op=DIFF_INSERT;break}x--,y--,last_op==DIFF_EQUAL?path.last().text+=text1.charAt(text1.length-x-1):path.add([DIFF_EQUAL,text1.substring(text1.length-x-1,text1.length-x)]),last_op=DIFF_EQUAL}return path},diff_match_patch.prototype.diff_footprint=function(x,y){var result=x;return result<<=16,result+=y},diff_match_patch.prototype.diff_tokensToChars_=function(text1,text2){function diff_tokenToCharsMunge_(text){var chars="",tokenArrayLength=tokenArray.length,tokens=(text+"").split(/([\s\n.,])/g);for(var i in tokens){var token=tokens[i];0!=token.length&&(tokenHash.hasOwnProperty(token)?chars+=String.fromCharCode(tokenHash[token]):(chars+=String.fromCharCode(tokenArrayLength),tokenHash[token]=tokenArrayLength,tokenArray[tokenArrayLength++]=token))}return chars}var tokenArray=[],tokenHash={};tokenArray[0]="";var chars1=diff_tokenToCharsMunge_(text1),chars2=diff_tokenToCharsMunge_(text2);return{chars1:chars1,chars2:chars2,tokenArray:tokenArray}},diff_match_patch.prototype.diff_charsToTokens_=function(diffs,lineArray){diffs.forEach(function(diff){for(var chars=diff[1],text=[],y=0;y<chars.length;y++)text[y]=lineArray[chars.charCodeAt(y)];diff[1]=text.join("")})},diff_match_patch.prototype.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charAt(0)!=text2.charAt(0))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;pointermid>pointermin;)text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)?(pointermin=pointermid,pointerstart=pointermin):pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.startsWith=function(str,prefix){return 0===str.indexOf(prefix)},diff_match_patch.prototype.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charAt(text1.length-1)!=text2.charAt(text2.length-1))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;pointermid>pointermin;)text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)?(pointermin=pointermid,pointerend=pointermin):pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.endsWith=function(str,suffix){return-1!==str.indexOf(suffix,str.length-suffix.length)},diff_match_patch.prototype.diff_commonOverlap_=function(text1,text2){var text1_length=text1.length,text2_length=text2.length;if(0==text1_length||0==text2_length)return 0;text1_length>text2_length?text1=text1.substring(text1_length-text2_length):text2_length>text1_length&&(text2=text2.substring(0,text1_length));var text_length=Math.min(text1_length,text2_length);if(text1==text2)return text_length;for(var best=0,length=1;;){var pattern=text1.substring(text_length-length),found=text2.indexOf(pattern);if(-1==found)return best;length+=found,(0==found||text1.substring(text_length-length)==text2.substring(0,length))&&(best=length,length++)}},diff_match_patch.prototype.diff_halfMatch_=function(text1,text2){function diff_halfMatchI_(longtext,shorttext,i){for(var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,seed=longtext.substring(i,i+Math.floor(longtext.length/4)),j=-1,best_common="";-1!=(j=shorttext.indexOf(seed,j+1));){var prefixLength=dmp.diff_commonPrefix(longtext.substring(i),shorttext.substring(j)),suffixLength=dmp.diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));best_common.length<suffixLength+prefixLength&&(best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength),best_longtext_a=longtext.substring(0,i-suffixLength),best_longtext_b=longtext.substring(i+prefixLength),best_shorttext_a=shorttext.substring(0,j-suffixLength),best_shorttext_b=shorttext.substring(j+prefixLength))}return 2*best_common.length>=longtext.length?[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]:null}if(this.Diff_Timeout<=0)return null;var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||2*shorttext.length<longtext.length)return null;var hm,dmp=this,hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));if(!hm1&&!hm2)return null;hm=hm2?hm1&&hm1[4].length>hm2[4].length?hm1:hm2:hm1;var text1_a,text1_b,text2_a,text2_b;text1.length>text2.length?(text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3]):(text2_a=hm[0],text2_b=hm[1],text1_a=hm[2],text1_b=hm[3]);var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]},diff_match_patch.prototype.diff_cleanupArrange=function(diffs){var result=[],tempDiffs=[];for(var i in diffs){var diff=diffs[i];if(diff[0]==DIFF_EQUAL){for(i in tempDiffs)result.push(tempDiffs[i]);tempDiffs.length=0,result.push(diff)}else if(diff[0]==DIFF_INSERT)tempDiffs.push(diff);else{result.push(diff);for(i in tempDiffs)result.push(tempDiffs[i]);tempDiffs.length=0}}for(i in tempDiffs)result.push(tempDiffs[i]);diffs.length=0;for(i in result)diffs.push(result[i])},diff_match_patch.prototype.diff_cleanupForCorrectionArrangement=function(diffs){var result=[],tempDeleteDiffs=[],tempInsertDiffs=[],spaceInsert=[DIFF_INSERT," "],spaceDelete=[DIFF_DELETE," "],spaceEqual=[DIFF_EQUAL," "];for(var i in diffs){var diff=diffs[i];if(diff[0]==DIFF_DELETE)tempDeleteDiffs.length>0&&tempDeleteDiffs.push(spaceDelete),tempDeleteDiffs.push(diff);else if(diff[0]==DIFF_INSERT)tempInsertDiffs.length>0&&tempInsertDiffs.push(spaceInsert),tempInsertDiffs.push(diff);else{if(" "!=diff[1]&&"\n"!=diff[1]){for(var hasLastDiffWhiteSpace=!1,i=0;i<tempDeleteDiffs.length;i++){var tempDeleteDiff=tempDeleteDiffs[i],diffText=tempDeleteDiff[1];i==tempDeleteDiffs.length-1&&this.endsWith(diffText," ")&&(diffText=diffText.substring(0,diffText.lastIndexOf(" ")),tempDeleteDiff.text=diffText,hasLastDiffWhiteSpace=!0),result.push(tempDeleteDiff)}for(i in tempInsertDiffs)result.push(tempInsertDiffs[i]);hasLastDiffWhiteSpace&&result.push(spaceEqual),tempDeleteDiffs.length=0,tempInsertDiffs.length=0}result.push(diff)}}for(i in tempDeleteDiffs)result.push(tempDeleteDiffs[i]);for(i in tempInsertDiffs)result.push(tempInsertDiffs[i]);diffs.length=0;for(i in result)diffs.push(result[i])},diff_match_patch.prototype.diff_cleanupForSingleCharacterCorrection=function(diffs){var result=[],tempDiff=null;for(var i in diffs){var diff=diffs[i];if(diff[0]==DIFF_DELETE)null!=tempDiff&&result.push(tempDiff),tempDiff=diff;else if(diff[0]==DIFF_INSERT)if(null!=tempDiff){var longtext=diff[1].length>tempDiff[1].length?diff[1]:tempDiff[1],shorttext=diff[1].length>tempDiff[1].length?tempDiff[1]:diff[1];longtext=longtext.toLowerCase(),shorttext=shorttext.toLowerCase();var incorrectCount=parseInt(Math.abs(longtext.length-shorttext.length)),isSufOrPrefix=this.startsWith(longtext,shorttext)||this.endsWith(longtext,shorttext);if(2>=incorrectCount&&isSufOrPrefix){var subDiff=this.diff_main(tempDiff[1],diff[1],!1,Number.MAX_VALUE,!1);subDiff.forEach(function(value){result.push(value)}),tempDiff=null}else result.push(tempDiff),result.push(diff),tempDiff=null}else result.push(diff);else null!=tempDiff&&result.push(tempDiff),tempDiff=null,result.push(diff)}null!=tempDiff&&result.push(tempDiff),diffs.length=0;for(i in result)diffs.push(result[i])},diff_match_patch.prototype.diff_prettyHtml=function(diffs){for(var html=[],pattern_amp=/&/g,pattern_lt=/</g,pattern_gt=/>/g,pattern_para=/\n/g,x=0;x<diffs.length;x++){var op=diffs[x][0],data=diffs[x][1],text=data.replace(pattern_amp,"&amp;").replace(pattern_lt,"&lt;").replace(pattern_gt,"&gt;").replace(pattern_para,"<br>");switch(op){case DIFF_INSERT:html[x]='<span style="background-color:rgba(92,200,203,.5); color:#6E6D6D;">'+text+"</span>";break;case DIFF_DELETE:html[x]='<del style="color:rgba(194,15,44,.5);">'+text+"</del>";break;case DIFF_EQUAL:html[x]='<span style="color:#6E6D6D;">'+text+"</span>"}}return html.join("")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,angular.module("chattingCatApp",["accountFactoryModule","chatBoxDirectiveModule","commonFactoryModule","configModule","filterModule","layoutDirectiveModule","modalServiceModule","anchorSmoothScrollModule","notificationFactoryModule","topicEventModule","apisFactoryModule","tutorCorrectBoxDirectiveModule","notificationDirectiveModule","routeModule","videoFactoryModule","socketFactoryModule","socketEventModule","ngAnimate","langTextFactoryModule","ngImgCrop","file-model","underscore","angular-timezone-selector","tutor-profile-box","rating-star","qnaDirectiveModule","qnaListDirectiveModule","ngclipboard","angulartics","angulartics.facebook.pixel","angulartics.google.analytics","chatRespondTimeDirectiveModule"]),angular.module("configModule",[]).constant("serviceUrlConfig","https://chattingcat.com").constant("accountUrlConfig","https://account.chattingcat.com").constant("apiUrlConfig","https://api.chattingcat.com").constant("imgHost","https://cdn.chattingcat.com").constant("oauthClientIdConfig","014c562cb66617e020d7bc60ce93ff106d11e5916dbc8f1de9ed0ac8581add6b").constant("oauthClientRedirectUriConfig","https://chattingcat.com/oauth/callback").constant("oauthClientResponseTypeConfig","token").constant("oauthClientDefaultScopeConfig",'["public","user.update","user.me"]').constant("isProduction",!0).constant("gtmContainerIDConfig","GTM-54W96W").constant("googleTrackingIDConfig","@@GoogleTrackingIDConfig").constant("mixpanelIDConfig","2b566534e2cf86796861093cdb799ebf").constant("stripePubKey","pk_live_vPZ4fpb0q7cz0oLdTfZIUZew").constant("pubnubPublishKey","pub-c-7815ef04-74d6-4f57-b493-80c38a9ba1c1").constant("pubnubSubscribeKey","sub-c-54a7f0f2-25b4-11e5-83e8-02ee2ddab7fe").constant("pubnubSecretKey","sec-c-MWVhMGY0M2ItZTg2Yy00ZWRkLWEyZjYtYmZiN2ViNjE1YjI3").constant("pubnubSSL","true").constant("notificationSocketType","PUBNUB").constant("socketHeartbeatInterval","30").constant("socketHeartbeatTimeout","120"),
angular.module("routeModule",["ui.router"]).constant("routeName",{ROOT:"root",INDEX:"index",OAUTH:"oauth",CONFIRMATION:"confirmation",MY_ACCOUNT:"my-account",MY_ACCOUNT_PROFILE:"my-account.profile",MY_ACCOUNT_TUTOR_INFO:"my-account.tutor-info",MY_ACCOUNT_SETTINGS:"my-account.settings",MY_ACCOUNT_NOTIFICATION:"my-account.notification",MY_ACCOUNT_CATNIP:"my-account.catnip",MY_ACCOUNT_CATNIP_HISTORY:"my-account.catnip-history",MY_ACCOUNT_COUPON:"my-account.coupon",MY_ACCOUNT_REFERRAL:"my-account.referral",MY_ACCOUNT_CASH_OUT:"my-account.cash-out",MY_ACCOUNT_CASH_OUT_HISTORY:"my-account.cash-out-history",MY_ACCOUNT_NOTIFICATION_CENTER:"my-account.notification-center",CONTACT_US:"contact-us",PRESS:"press",FAQ:"faq",TERMS:"terms",PRIVACY:"privacy",SAMPLES:"samples",BUSINESS:"business",BECOMEATUTOR:"becomeatutor",COUPON_DESC:"coupon-desc",PAYMENT_COMPLETED:"payment-completed",STUDENT:"student",STUDENT_INDEX:"student.index",STUDENT_NEW_CHAT:"student.new-chat",STUDENT_ONE_CHAT:"student.one-chat",STUDENT_INACTIVE:"student.inactive",TUTOR:"tutor",TUTOR_INDEX:"tutor.index",TUTOR_INFO_VIEW:"tutor.info-view",TUTOR_ONE_CHAT:"tutor.one-chat",TUTOR_HISTORY:"tutor.history",TUTOR_ONE_HISTORY:"tutor.one-history",TUTOR_QUALIFY:"tutor-qualify",TUTOR_INACTIVE:"tutor.inactive",TUTOR_FAQ:"tutor.faq",TUTOR_QUALIFY_INDEX:"tutor-qualify.index",TUTOR_QUALIFY_INFO:"tutor-qualify.info",TUTOR_QUALIFY_TEST:"tutor-qualify.test",TUTOR_QUALIFY_STATE:"tutor-qualify.state",TUTOR_REVIEW_TEXT:"tutor.review-text"}),angular.module("chattingCatApp").config(["$stateProvider","$urlRouterProvider","$locationProvider","routeName",function($stateProvider,$urlRouterProvider,$locationProvider,routeName){$stateProvider.state("base",{"abstract":!0,template:"<ui-view/>",resolve:{accountInfo:["$q","accountFactory","commonFactory","$window",function($q,accountFactory,commonFactory,$window){var def=$q.defer();null===commonFactory.getLangCode()&&commonFactory.setLangCode(commonFactory.getFirstBrowserLanguage());var promise=accountFactory.loadInfo();return promise.then(function(d){def.resolve(d)},function(e){$window.location.href=commonFactory.getLoginUrl(),def.reject(e)}),def.promise}]}}),$stateProvider.state("main",{"abstract":!0,template:"<ui-view/>",resolve:{isLogin:["$q","accountFactory","commonFactory","$state","$timeout",function($q,accountFactory,commonFactory,$state,$timeout){var deferred=$q.defer();null===commonFactory.getLangCode()&&commonFactory.setLangCode(commonFactory.getFirstBrowserLanguage());var promise=accountFactory.loadInfo();return promise.then(function(){accountFactory.isLogin()?($timeout(function(){$state.go(accountFactory.getRoleHome())},0),deferred.reject()):deferred.resolve()},function(){deferred.resolve()}),deferred.promise}]}}),$stateProvider.state(routeName.ROOT,{url:"/",templateUrl:"/views/landing/index.html",parent:"main",controller:"Root.IndexController"}).state(routeName.INDEX,{url:"/index",templateUrl:"/views/landing/index.html",parent:"main",controller:"Root.IndexController"}),$stateProvider.state(routeName.OAUTH,{url:"/oauth/callback",controller:"Oauth.CallbackController"}),$stateProvider.state(routeName.PAYMENT_COMPLETED,{url:"/payment-completed",template:" ",controller:["accountFactory","$timeout",function(accountFactory,$timeout){$timeout(function(){accountFactory.checkRole(accountFactory.accountRole.AUTH)},1e3)}]}),$stateProvider.state(routeName.CONFIRMATION,{url:"/confirmation",templateUrl:"/views/account/confirmation.html",controller:"Account.ConfirmationController"}),$stateProvider.state("organization",{url:"/organizations/:slug","abstract":!0,parent:"base",templateUrl:"/views/organizations/main.html",controller:"Organization.MainController"}).state("organization.members",{url:"/",templateUrl:"/views/organizations/members.html",controller:"Organization.MembersController"}).state("organization.payments",{url:"/payments",templateUrl:"/views/organizations/payments.html",controller:"Organization.PaymentsController"}),$stateProvider.state(routeName.MY_ACCOUNT,{url:"/my-account","abstract":!0,parent:"base",templateUrl:"/views/account/account.html",controller:"Account.MainController"}).state(routeName.MY_ACCOUNT_PROFILE,{url:"/index",templateUrl:"/views/account/my-account.html",controller:"Account.MyAccountController"}).state(routeName.MY_ACCOUNT_TUTOR_INFO,{url:"/tutor-info",templateUrl:"/views/account/tutor-info.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]},controller:"Account.TutorInfoController"}).state(routeName.MY_ACCOUNT_SETTINGS,{url:"/settings",templateUrl:"/views/account/settings.html",controller:"Account.SettingsController"}).state(routeName.MY_ACCOUNT_CATNIP,{url:"/catnip",templateUrl:"/views/account/buy-catnip-global.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_ACTIVE)}]},controller:"Student.BuyCatnipGlobalController"}).state(routeName.MY_ACCOUNT_CATNIP_HISTORY,{url:"/buy-catnip-history",templateUrl:"/views/account/buy-catnip-history.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_ACTIVE)}]},controller:"Student.BuyCatnipHistoryController"}).state(routeName.MY_ACCOUNT_COUPON,{url:"/coupon",templateUrl:"/views/account/coupon.html",controller:"Account.CouponController"}).state(routeName.MY_ACCOUNT_REFERRAL,{url:"/referral",templateUrl:"/views/account/referral.html",controller:"Account.ReferralController"}).state(routeName.MY_ACCOUNT_CASH_OUT,{url:"/cash-out",templateUrl:"/views/account/cash-out.html",controller:"Tutor.CashOutController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.MY_ACCOUNT_CASH_OUT_HISTORY,{url:"/cash-out-history",templateUrl:"/views/account/cash-out-history.html",controller:"Tutor.CashOutHistoryController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.MY_ACCOUNT_NOTIFICATION_CENTER,{url:"/notification-center",templateUrl:"/views/account/notification-center.html",controller:"Account.NotificationCenterController"}),$stateProvider.state(routeName.CONTACT_US,{url:"/contact-us",templateUrl:"/views/footer/contact-us.html",controller:"Footer.ContactUsController"}),$stateProvider.state(routeName.PRESS,{url:"/press",templateUrl:"/views/footer/press.html"}),$stateProvider.state(routeName.FAQ,{url:"/faq",templateUrl:"/views/footer/faq.html",controller:"Footer.FaqController"}),$stateProvider.state(routeName.TERMS,{url:"/terms",templateUrl:"/views/footer/terms.html"}),$stateProvider.state(routeName.PRIVACY,{url:"/privacy",templateUrl:"/views/footer/privacy.html"}),$stateProvider.state(routeName.SAMPLES,{url:"/samples",templateUrl:"/views/footer/samples.html",controller:"Footer.SamplesController"}),$stateProvider.state(routeName.BUSINESS,{url:"/business",templateUrl:"/views/footer/business.html",controller:"Footer.BusinessController"}),$stateProvider.state(routeName.BECOMEATUTOR,{url:"/becomeatutor",templateUrl:"/views/footer/becomeatutor.html",controller:"Footer.BecomeATutorController"}),$stateProvider.state(routeName.COUPON_DESC,{url:"/coupon-desc",templateUrl:"/views/help/coupon-desc.html",controller:"Help.CouponDescController"}),$stateProvider.state(routeName.STUDENT,{url:"/student","abstract":!0,parent:"base",templateUrl:"/views/student/student.html",controller:"Student.MainController"}).state(routeName.STUDENT_INDEX,{url:"/index",templateUrl:"/views/student/chat.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_ACTIVE)}]},controller:"Student.ChatController"}).state(routeName.STUDENT_NEW_CHAT,{url:"/new-chat",templateUrl:"/views/student/new-chat.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_ACTIVE)}]},controller:"Student.NewChatController"}).state(routeName.STUDENT_ONE_CHAT,{url:"/one-chat",templateUrl:"/views/student/one-chat.html",reloadOnSearch:!0,params:{topicId:null,topic:null,hiddenParam:"YES"},resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_ACTIVE)}]},controller:"Student.OneChatController"}).state(routeName.STUDENT_INACTIVE,{url:"/inactive",views:{"":{templateUrl:"/views/student/inactive.html",controller:"Student.InactiveController"},header:{template:" ",controller:function(){}}},resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.STUDENT_INACTIVE)}]}}),$stateProvider.state(routeName.TUTOR,{url:"/tutor","abstract":!0,parent:"base",templateUrl:"/views/tutor/tutor.html",controller:"Tutor.MainController"}).state(routeName.TUTOR_INDEX,{url:"/index",templateUrl:"/views/tutor/chat.html",controller:"Tutor.ChatController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.TUTOR_INFO_VIEW,{url:"/tutor-view",params:{id:null,hiddenParam:"YES"},templateUrl:"/views/tutor/info-view.html",controller:"Tutor.InfoViewController"}).state(routeName.TUTOR_ONE_CHAT,{url:"/one-chat",templateUrl:"/views/tutor/one-chat.html",params:{topic:null,hiddenParam:"YES"},resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]},controller:"Tutor.OneChatController"}).state(routeName.TUTOR_HISTORY,{url:"/history",templateUrl:"/views/tutor/history.html",controller:"Tutor.HistoryController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.TUTOR_ONE_HISTORY,{url:"/one-history",templateUrl:"/views/tutor/one-history.html",reloadOnSearch:!0,params:{topicId:null,hiddenParam:"YES"},controller:"Tutor.OneHistoryController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.TUTOR_FAQ,{url:"/faq",views:{"":{templateUrl:"/views/tutor/faq.html",controller:"Tutor.FaqController"},header:{template:" ",controller:function(){}}},controller:"Tutor.FaqController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}).state(routeName.TUTOR_INACTIVE,{url:"/inactive",views:{"":{templateUrl:"/views/tutor/inactive.html",controller:"Tutor.InactiveController"},header:{template:" ",controller:function(){}}},resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_INACTIVE)}]}}).state(routeName.TUTOR_REVIEW_TEXT,{url:"/reviews/:corrected_text_id",templateUrl:"/views/tutor/review_text.html",controller:"Tutor.ReviewTextController",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_SUCCESS)}]}}),$stateProvider.state(routeName.TUTOR_QUALIFY,{url:"/tutor-qualify","abstract":!0,parent:"base",templateUrl:"/views/tutor-qualify/tutor-qualify.html",controller:"TutorQualify.MainController"}).state(routeName.TUTOR_QUALIFY_INDEX,{url:"/index",templateUrl:"/views/tutor-qualify/index.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_READY)}]},controller:"TutorQualify.ProfileController"}).state(routeName.TUTOR_QUALIFY_INFO,{url:"/info",templateUrl:"/views/tutor-qualify/info.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_READY)}]},controller:"TutorQualify.InfoController"}).state(routeName.TUTOR_QUALIFY_TEST,{url:"/test",templateUrl:"/views/tutor-qualify/test.html",resolve:{checkRole:["accountFactory",function(accountFactory){return accountFactory.checkRole(accountFactory.accountRole.TUTOR_READY)}]},controller:"TutorQualify.TestController"}).state(routeName.TUTOR_QUALIFY_STATE,{url:"/state",templateUrl:"/views/tutor-qualify/state.html",controller:"TutorQualify.StateController"}),$stateProvider.state("otherwise",{url:"*path",templateUrl:"/404.html"}),$urlRouterProvider.otherwise("otherwise")}]),angular.module("chattingCatApp").config(["$locationProvider",function($locationProvider){$locationProvider.html5Mode(!0)}]),angular.module("topicEventModule",[]).constant("topicCorrectionEvent",{timeout:"topic_correction:timeout",originalLock:"topic_correction:lock",originalUnlock:"topic_correction:unlock",createCompleted:"topic_correction:createCompleted",realtimeCorrecting:"topic_correction:realtime:correcting",setCorrect:"topic_correction:setCorrect",releaseCorrect:"topic_correction:releaseCorrect"}),angular.module("socketEventModule",[]).constant("socketEvent",{topicUpdatedBroadcasted:"stomp:broadcast:topic:updated",topicCreatedBroadcasted:"stomp:broadcast:topic:created",topicRemovedBroadcasted:"stomp:broadcast:topic:removed",topicLockedBroadcasted:"stomp:broadcast:topic:locked",topicUnlockedBroadcasted:"stomp:broadcast:topic:unlocked",topicDeclinedBroadcasted:"stomp:broadcast:topic:declined",topicCanceledBroadcasted:"stomp:broadcast:topic:canceled",originalRatedBroadcasted:"stomp:broadcast:original:rated",realtimeCorrection:"stomp:realtime:correction",userInfoUpdated:"stomp:user:info:updated",heartBeatBroadcasted:"stomp:broadcast:heartbeat",reviewLockedBroadcasted:"stomp:broadcast:review:locked"}),angular.module("chattingCatApp").constant("paymentConfigs",[{paymentType:"playstore",productCode:10,paymentTypeDisplay:"Google Play",catnipDisplay:10,priceBefore20150201:"$1.25",priceAfter20150201:"$1.25"},{paymentType:"playstore",productCode:50,paymentTypeDisplay:"Google Play",catnipDisplay:50,priceBefore20150201:"$6.25",priceAfter20150201:"$6.25"},{paymentType:"playstore",productCode:100,paymentTypeDisplay:"Google Play",catnipDisplay:100,priceBefore20150201:"$12.50",priceAfter20150201:"$12.50"},{paymentType:"playstore",productCode:110,paymentTypeDisplay:"Google Play",catnipDisplay:110,priceBefore20150201:"$8.50",priceAfter20150201:"$8.50"},{paymentType:"playstore",productCode:200,paymentTypeDisplay:"Google Play",catnipDisplay:200,priceBefore20150201:"$25.00",priceAfter20150201:"$25.00"},{paymentType:"naverstore",productCode:10,paymentTypeDisplay:"Naver Appstore",catnipDisplay:10,priceBefore20150201:"$1.25",priceAfter20150201:"$1.25"},{paymentType:"naverstore",productCode:50,paymentTypeDisplay:"Naver Appstore",catnipDisplay:50,priceBefore20150201:"$6.25",priceAfter20150201:"$6.25"},{paymentType:"naverstore",productCode:100,paymentTypeDisplay:"Naver Appstore",catnipDisplay:100,priceBefore20150201:"$12.50",priceAfter20150201:"$12.50"},{paymentType:"naverstore",productCode:200,paymentTypeDisplay:"Naver Appstore",catnipDisplay:200,priceBefore20150201:"$25.00",priceAfter20150201:"$25.00"},{paymentType:"ollehmarket",productCode:10,paymentTypeDisplay:"Olleh Market",catnipDisplay:10,priceBefore20150201:"$1.25",priceAfter20150201:"$1.25"},{paymentType:"ollehmarket",productCode:50,paymentTypeDisplay:"Olleh Market",catnipDisplay:50,priceBefore20150201:"$6.25",priceAfter20150201:"$6.25"},{paymentType:"ollehmarket",productCode:100,paymentTypeDisplay:"Olleh Market",catnipDisplay:100,priceBefore20150201:"$12.50",priceAfter20150201:"$12.50"},{paymentType:"ollehmarket",productCode:200,paymentTypeDisplay:"Olleh Market",catnipDisplay:200,priceBefore20150201:"$25.00",priceAfter20150201:"$25.00"},{paymentType:"appstore",productCode:10,paymentTypeDisplay:"Apple Appstore",catnipDisplay:10,priceBefore20150201:"$1.99",priceAfter20150201:"$1.99"},{paymentType:"appstore",productCode:50,paymentTypeDisplay:"Apple Appstore",catnipDisplay:50,priceBefore20150201:"$6.99",priceAfter20150201:"$6.99"},{paymentType:"appstore",productCode:100,paymentTypeDisplay:"Apple Appstore",catnipDisplay:100,priceBefore20150201:"$12.99",priceAfter20150201:"$12.99"},{paymentType:"appstore",productCode:200,paymentTypeDisplay:"Apple Appstore",catnipDisplay:200,priceBefore20150201:"$24.99",priceAfter20150201:"$24.99"},{paymentType:"bank_kr",productCode:50,paymentTypeDisplay:"Bank Transfer",catnipDisplay:50,priceBefore20150201:"6.000",priceAfter20150201:"7,500"},{paymentType:"bank_kr",productCode:100,paymentTypeDisplay:"Bank Transfer",catnipDisplay:100,priceBefore20150201:"12,000",priceAfter20150201:"15,000"},{paymentType:"bank_kr",productCode:210,paymentTypeDisplay:"Bank Transfer",catnipDisplay:200,priceBefore20150201:"24,000",priceAfter20150201:"30,000"},{paymentType:"bank_kr",productCode:300,paymentTypeDisplay:"Bank Transfer",catnipDisplay:300,priceBefore20150201:"45,000",priceAfter20150201:"45,000"},{paymentType:"bank_kr",productCode:500,paymentTypeDisplay:"Bank Transfer",catnipDisplay:500,priceBefore20150201:"75,000",priceAfter20150201:"75,000"},{paymentType:"bank_kr",productCode:1e3,paymentTypeDisplay:"Bank Transfer",catnipDisplay:1e3,priceBefore20150201:"120,000",priceAfter20150201:"150,000"},{paymentType:"paypal",productCode:50,paymentTypeDisplay:"Paypal",catnipDisplay:50,priceBefore20150201:"$4.99",priceAfter20150201:"$6.25"},{paymentType:"paypal",productCode:103,paymentTypeDisplay:"Paypal",catnipDisplay:103,priceBefore20150201:"$9.99",priceAfter20150201:"$12.50"},{paymentType:"paypal",productCode:210,paymentTypeDisplay:"Paypal",catnipDisplay:210,priceBefore20150201:"$19.99",priceAfter20150201:"$25.00"},{paymentType:"paypal",productCode:315,paymentTypeDisplay:"Paypal",catnipDisplay:315,priceBefore20150201:"$37.50",priceAfter20150201:"$37.50"},{paymentType:"paypal",productCode:525,paymentTypeDisplay:"Paypal",catnipDisplay:525,priceBefore20150201:"$62.50",priceAfter20150201:"$62.50"},{paymentType:"paypal",productCode:1050,paymentTypeDisplay:"Paypal",catnipDisplay:1050,priceBefore20150201:"$99.99",priceAfter20150201:"$125.00"},{paymentType:"stripe",productCode:50,paymentTypeDisplay:"Credit Card",catnipDisplay:50,priceBefore20150201:"$4.99",priceAfter20150201:"$6.25"},{paymentType:"stripe",productCode:103,paymentTypeDisplay:"Credit Card",catnipDisplay:103,priceBefore20150201:"$9.99",priceAfter20150201:"$12.50"},{paymentType:"stripe",productCode:315,paymentTypeDisplay:"Credit Card",catnipDisplay:315,priceBefore20150201:"$37.50",priceAfter20150201:"$37.50"},{paymentType:"stripe",productCode:525,paymentTypeDisplay:"Credit Card",catnipDisplay:525,priceBefore20150201:"$62.50",priceAfter20150201:"$62.50"},{paymentType:"stripe",productCode:1050,paymentTypeDisplay:"Credit Card",catnipDisplay:1050,priceBefore20150201:"$99.99",priceAfter20150201:"$125.00"}]);var mixpanelDistinctId=null;angular.module("chattingCatApp").config(["mixpanelIDConfig",function(mixpanelIDConfig){!function(f,b){if(!b.__SV){var a,e,i,g;window.mixpanel=b,b._i=[],b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]),b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;for("undefined"!=typeof d?c=b[d]=[]:d="mixpanel",c.people=c.people||[],c.toString=function(b){var a="mixpanel";return"mixpanel"!==d&&(a+="."+d),b||(a+=" (stub)"),a},c.people.toString=function(){return c.toString(1)+".people (stub)"},i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" "),g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])},b.__SV=1.2,a=f.createElement("script"),a.type="text/javascript",a.async=!0,a.src="undefined"!=typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js",e=f.getElementsByTagName("script")[0],e.parentNode.insertBefore(a,e)}}(document,window.mixpanel||[]),mixpanel.init(mixpanelIDConfig,{loaded:function(){-1===navigator.appVersion.indexOf("MSIE 10")&&(mixpanelDistinctId=mixpanel.get_distinct_id())}})}]),angular.module("filterModule",[]).filter("fromNow",["$window",function($window){return function(value){var result=$window.moment(new Date(value)).fromNow();return("in a minute"===result||"in a few seconds ago"===result||"in two minutes"===result||"in 2 minutes"===result)&&(result="a few seconds ago"),result}}]),angular.module("filterModule").filter("isHangul",function(){return function(value){var len=value.length;if(len>0){var pattern=/(?:[-]|[-]|[-])/g;return pattern.test(value)}return!1}}),angular.module("filterModule").filter("isLengthOver",function(){return function(value,maxLength){return value.length>maxLength}}),angular.module("filterModule").filter("newlines",["$sce",function($sce){return function(text){var result="";return text&&(result=text.replace(/</g,"&lt;"),result=result.replace(/>/g,"&gt;"),result=result.replace(/\n/g,"<br/>"),result=result.replace(/\s(\S)/g,"###_###$1"),result=result.replace(/\s/g,"&nbsp;"),result=result.replace(/###\_###/g," ")),$sce.trustAsHtml(result)}}]),angular.module("filterModule").filter("diffnewlines",["$sce",function($sce){return function(text){var result="";return text&&(result=text.replace(/<ins class="diffins">/g,"###start_ins###").replace(/<\/ins>/g,"###end_ins###"),result=result.replace(/<ins class="diffmod">/g,"###start_insmod###"),result=result.replace(/<del class="diffmod">/g,"###start_del###").replace(/<\/del>/g,"###end_del###"),result=result.replace(/<del class="diffdel">/g,"###start_deldel###"),result=result.replace(/</g,"&lt;"),result=result.replace(/>/g,"&gt;"),result=result.replace(/\n/g,"<br/>"),result=result.replace(/\s(\S)/g,"###_###$1"),result=result.replace(/\s/g,"&nbsp;"),result=result.replace(/###\_###/g," "),result=result.replace(/###start_ins###/g,'<ins class="diffins">').replace(/###end_ins###/g,"</ins>"),result=result.replace(/###start_insmod###/g,'<ins class="diffmod">'),result=result.replace(/###start_del###/g,'<del class="diffmod">').replace(/###end_del###/g,"</del>"),result=result.replace(/###start_deldel###/g,'<del class="diffdel">')),$sce.trustAsHtml(result)}}]),angular.module("filterModule").filter("parseTopic",["$filter",function($filter){return function(topic){if(topic.originContent=topic.content,topic.content=$filter("newlines")(topic.content),topic.org_created_at=topic.created_at,topic.created_at=$filter("fromNow")(topic.created_at),topic.hasOwnProperty("corrected_texts"))for(var i=-1,cnt=topic.corrected_texts.length;++i<cnt;)topic.corrected_texts[i].originContent=topic.corrected_texts[i].content,topic.corrected_texts[i].content=$filter("newlines")(topic.corrected_texts[i].content),topic.corrected_texts[i].diff_text=$filter("diffnewlines")(topic.corrected_texts[i].diff_text),topic.corrected_texts[i].created_at=$filter("fromNow")(topic.corrected_texts[i].created_at);return topic}}]),angular.module("filterModule").filter("myHistory",function(){return function(correctTexts,tutorID){for(var result=[],i=-1,cnt=correctTexts.length;++i<cnt;)correctTexts[i].user.id===tutorID&&result.push(correctTexts[i]);return result}}),angular.module("filterModule").filter("amountToDollar",function(){return function(input){switch(input=parseInt(input)){case 50:return 5;case 103:return 10;case 210:return 20;case 100:return 5;case 200:return 10;case 400:return 20;case 1e3:return 50;case 200:return 100;case 2e3:return 100}}}),angular.module("filterModule").filter("invitedStatus",function(){return function(input){switch(input){case 1:return"Pending 5% Off";case 2:return"Earned 5% Off";case 3:return"Used 5% Off"}}}),angular.module("filterModule").filter("moneyShow",["$filter",function($filter){return function(input,currency,default_value){switch(currency){case"krw":return $filter("number")(input)+"";case"usd":return"$"+input/100;default:return default_value}}}]);var format=function(str,col){return col="object"==typeof col?col:Array.prototype.slice.call(arguments,1),str.replace(/\{\{|\}\}|\{(\w+)\}/g,function(m,n){return"{{"===m?"{":"}}"===m?"}":col[n]})};angular.module("filterModule").filter("noti",["$filter",function($filter){return function(type,args){switch(type){case"rating":return format($filter("localized")("notification.rating"),args);case"cashout":return format($filter("localized")("notification.cashout"),args);case"promotion":return format($filter("localized")("notification.promotion"),args);case"bank_charge":return format($filter("localized")("notification.bank.charge"),args);case"corrected":return format($filter("localized")("notification.corrected"),args);case"qna_question":return format($filter("localized")("notification.qna.question"),args);case"qna_answer":return format($filter("localized")("notification.qna.answer"),args);default:return args}}}]),angular.module("filterModule").filter("localized",["langTextFactory",function(langTextFactory){return function(input){return langTextFactory.getText(input)}}]),angular.module("filterModule").filter("nl2br",["$sanitize",function($sanitize){var tag=/xhtml/i.test(document.doctype)?"<br />":"<br>";return function(msg){return msg&&(msg=(msg+"").replace(/(\r\n|\n\r|\r|\n|&#10;&#13;|&#13;&#10;|&#10;|&#13;)/g,tag+"$1")),$sanitize(msg)}}]),angular.module("accountFactoryModule",["webStorageModule","commonFactoryModule","resourceFactoryModule","configModule","ui.router","routeModule"]),angular.module("accountFactoryModule").constant("accountRole",{STUDENT_ACTIVE:0,STUDENT_INACTIVE:1,TUTOR_READY:2,TUTOR_SUCCESS:3,TUTOR_ETC:4,AUTH:5,NAV:6,NOT_LOGIN:7,TUTOR_INACTIVE:8}),angular.module("accountFactoryModule").factory("accountFactory",["webStorage","commonFactory","resourceFactory","$q","accountRole","$window","serviceUrlConfig","$state","routeName","imgHost",function(webStorage,commonFactory,resourceFactory,$q,accountRole,$window,serviceUrlConfig,$state,routeName,imgHost){var result={};return result.accountRole=accountRole,result.isLogin=function(){return!!webStorage.session.get(commonFactory.constant.ACCOUNT_INFO_KEY)},result.getInfo=function(){var emptyAccountInfo={credentials:{access_token:"",expires_in_seconds:0,scopes:["public","user.update","user.me"]},info:{id:0,uid:"",email:"",username:"",available_catnips:"",role:"",confirmed:!0,locked:!1,qualify_state:"",qualified:!1,name:"",avatar_original:"",avatar_thumb:"",account_type:""}},accountInfo=webStorage.session.get(commonFactory.constant.ACCOUNT_INFO_KEY),result=commonFactory.parseJson(accountInfo,emptyAccountInfo);return result},result.screeningTutor=function(tutorResponse,tutorID){var def=$q.defer(),promise=resourceFactory.screeningTutor(tutorResponse,tutorID);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.isPremium=function(){return result.isLogin()&&"premium1"===result.getInfo().info.account_type?!0:!1},result.getUserRole=function(){return result.isLogin()?result.getInfo().info.role:"visitor"},result.autoLogin=function(){if(!result.isLogin()){var accessToken=commonFactory.getAuth().accessToken;if(accessToken){var promise=resourceFactory.getAccount();promise.then(function(d){ga("set","userId",d.info.id),webStorage.session.add(commonFactory.constant.ACCOUNT_INFO_KEY,JSON.stringify(d)),result.checkRole(result.accountRole.AUTH,!0)},function(){webStorage.local.remove(commonFactory.constant.AUTH_KEY),webStorage.session.remove(commonFactory.constant.ACCOUNT_INFO_KEY)})}}},result.loadInfo=function(){var def=$q.defer(),accessToken=commonFactory.getAuth().accessToken;if(!accessToken)return def.reject("AccessToken invalid"),def.promise;var promise=resourceFactory.getAccount();return promise.then(function(d){ga("set","userId",d.info.id),webStorage.session.add(commonFactory.constant.ACCOUNT_INFO_KEY,JSON.stringify(d)),def.resolve()},function(e){def.reject(e)}),def.promise},result.getRoleHome=function(){if(!result.isLogin())return commonFactory.getLoginUrl();var role=result.getRoleState();switch(role){case accountRole.STUDENT_ACTIVE:return routeName.STUDENT_INDEX;case accountRole.STUDENT_INACTIVE:return routeName.STUDENT_INACTIVE;case accountRole.TUTOR_INACTIVE:return routeName.TUTOR_INACTIVE;case accountRole.TUTOR_READY:return routeName.TUTOR_QUALIFY_INDEX;case accountRole.TUTOR_SUCCESS:return routeName.TUTOR_INDEX;case accountRole.TUTOR_ETC:return routeName.TUTOR_QUALIFY_STATE}},result.getRoleState=function(){var currentRoleState,currentAccount=result.getInfo().info;if(currentAccount.confirmed)if("student"===currentAccount.role)currentRoleState=accountRole.STUDENT_ACTIVE;else switch(currentAccount.role){case"tutor":case"trainee_tutor":case"experienced_tutor":switch(currentAccount.qualify_state){case"ready":currentRoleState=accountRole.TUTOR_READY;break;case"success":currentRoleState=accountRole.TUTOR_SUCCESS;break;default:currentRoleState=accountRole.TUTOR_ETC}break;default:currentRoleState=accountRole.TUTOR_ETC}else if("student"===currentAccount.role)currentRoleState=accountRole.STUDENT_INACTIVE;else switch(currentAccount.role){case"tutor":case"trainee_tutor":case"experienced_tutor":currentRoleState=accountRole.TUTOR_INACTIVE;break;default:currentRoleState=accountRole.TUTOR_ETC}return currentRoleState},result.checkRole=function(currentRole){var def=$q.defer(),role=result.getRoleState();if(role===currentRole)def.resolve(!0);else{if(!result.isLogin())return void($window.location.href=commonFactory.getLoginUrl());$window.location.href=serviceUrlConfig+"/"+result.getRoleHome().replace(/\./g,"/"),def.reject(!1)}return def.promise},result.clearAccount=function(){webStorage.local.remove(commonFactory.constant.AUTH_KEY),webStorage.local.remove(commonFactory.constant.MAIN_PAGE),webStorage.session.remove(commonFactory.constant.ACCOUNT_INFO_KEY),webStorage.session.remove(commonFactory.constant.CHAT_LIST),Cookies.remove("_session_id");var domain=serviceUrlConfig.replace("http://",".").replace("https://",".");Cookies.remove("_chattingcat_session_id",{path:"/",domain:domain})},result.logout=function(){var promise=resourceFactory.logoutAccount();promise.then(function(){result.clearAccount(),$window.location.href=serviceUrlConfig},function(){result.clearAccount(),$window.location.href=serviceUrlConfig})},result.cashOutTutor=function(cashOutInfo){var def=$q.defer(),promise=resourceFactory.cashOutTutor(cashOutInfo);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.checkOutStudent=function(checkOutInfo){var def=$q.defer(),promise=resourceFactory.checkOutStudent(checkOutInfo);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.checkOutStripe=function(checkOutInfo){var def=$q.defer(),promise=resourceFactory.checkOutStripe(checkOutInfo);return promise.then(function(d){def.resolve(d)},function(e){def.reject(e)}),def.promise},result.bankTransferStudent=function(bankTransferInfo){var def=$q.defer(),promise=resourceFactory.bankTransferStudent(bankTransferInfo);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.contactUs=function(feedback){var def=$q.defer(),promise=resourceFactory.contactUs(feedback);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.enrollCoupon=function(code){var def=$q.defer(),promise=resourceFactory.enrollCoupon(code);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.blockTutor=function(tutor_id){var def=$q.defer(),promise=resourceFactory.blockTutor(tutor_id);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.unBlockTutor=function(tutor_id){var def=$q.defer(),promise=resourceFactory.unBlockTutor(tutor_id);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.resetConfirmation=function(emailInfo){var def=$q.defer(),promise=resourceFactory.resetConfirmation(emailInfo);
return promise.then(function(d){def.resolve(d)},function(e){def.reject(e)}),def.promise},result.confirmation=function(confirmationToken,distinct_id){var def=$q.defer(),promise=resourceFactory.confirmation(confirmationToken,distinct_id);return promise.then(function(d){def.resolve(d)},function(e){def.reject(e)}),def.promise},result.updateAccount=function(accountInfo,id){var def=$q.defer(),promise=resourceFactory.updateAccount(accountInfo,id);return promise.then(function(d){def.resolve(d)},function(e){def.reject(e)}),def.promise},result.getIcon=function(){var icon="";if(result.isLogin()){var currentAccount=result.getInfo().info;icon="student"===currentAccount.role?"/images/default_profile_nav.af3d0252.png":"experienced_tutor"===currentAccount.role||"professional_tutor"===currentAccount.role?"/images/tutor_default_avatar.fb88ac38.png":"/images/trainee_tutor_default_avatar.265b73a4.png"}return icon},result.getCashOutListTutor=function(offset,limit){return resourceFactory.cashOutListTutor(offset,limit)},result.getBuyCatnipListTutor=function(offset,limit){return resourceFactory.buyCatnipList(offset,limit)},result.getCouponList=function(offset,limit){return resourceFactory.getCouponList(offset,limit)},result.subscribe=function(id){return resourceFactory.subscribe(id)},result.referralCode=function(){return resourceFactory.referralCode()},result.getReferralJoinList=function(offset,limit){return resourceFactory.referralJoinList(offset,limit)},result.sendReferralEmail=function(invited_email){var def=$q.defer(),promise=resourceFactory.sendReferralEmail(invited_email);return promise.then(function(d){def.resolve(d)},function(){def.reject()}),def.promise},result.getBlockList=function(){return resourceFactory.getBlockList()},result.getDiscountReferral=function(){return resourceFactory.getDiscountReferral()},result.getImageUrl=function(url){return null===url||""===url||void 0===url?"":url.indexOf("http")>=0?url:imgHost+"/"+url},result.getProfileUrl=function(){return result.getImageUrl(result.getInfo().info.profile_img)},result.getThumbnail=function(){return result.getImageUrl(result.getInfo().info.thumbnail)},result}]),angular.module("commonFactoryModule",["webStorageModule","configModule"]).factory("commonFactory",["webStorage","accountUrlConfig","oauthClientIdConfig","oauthClientRedirectUriConfig","oauthClientResponseTypeConfig","oauthClientDefaultScopeConfig","$window",function(webStorage,accountUrlConfig,oauthClientIdConfig,oauthClientRedirectUriConfig,oauthClientResponseTypeConfig,oauthClientDefaultScopeConfig,$window){var result={};return result.currentAuth=null,result.htmlVersion="11",result.langList=[{langCode:"en-us",langDisplay:"English",videoUrl:"//player.vimeo.com/video/92312600?autoplay=1&hd=1&show_title=1&show_byline=1&show_portrait=0&fullscreen=1"},{langCode:"ko-kr",langDisplay:"",videoUrl:"//player.vimeo.com/video/90090184?autoplay=1&hd=1&show_title=1&show_byline=1&show_portrait=0&fullscreen=1"},{langCode:"ja-jp",langDisplay:"",videoUrl:"//player.vimeo.com/video/107328476?autoplay=1&hd=1&show_title=1&show_byline=1&show_portrait=0&fullscreen=1"}],result.constant={AUTH_KEY:"Authorization",LANG_KEY:"Language",ACCOUNT_INFO_KEY:"Account",DISABLE_NOTIFICATION_SOUND:"DisableNotificationSound",MAIN_PAGE:"Page",CATNIP_POPUP_CLOSE:"CatnipPopupClose",PREMIUM_POPUP_CLOSE:"PremiumPopupClose",FAVORITE:"Favorite",CHAT_LIST:"chat-list"},result.tutorOpenType={open:2,close:1},result.degreeList=["High School","Diploma","Bachelor's Degree","Master's Degree","Doctoral Degree (PhD)","Professional (Doctor, Lawyer, etc)","Other"],result.englishList=["American","British","Canadian","Irish","Australian","New Zealand","South African","Scottish","Other"],result.studyOptions=["Anthropology","Archaeology","Architecture","Arts","Biology","Business","Chemistry","Communication","Computer sciences","Earth sciences","Economics","Education","Engineering","Environmental studies","Geography","History","Journalism","Law","Linguistics","Literature","Mathematics","Medicine","Philosophy","Physics","Political science","Psychology","Public administration","Social work","Sociology","TESOL/TEFL/TESL ","Other"],result.bindEvent=function(el,eventName,eventHandler){el.addEventListener?el.addEventListener(eventName,eventHandler,!1):el.attachEvent&&el.attachEvent("on"+eventName,eventHandler)},result.parseJson=function(json,defulat){return json?"string"==typeof json?JSON.parse(json):json:defulat},result.getLangCode=function(){var key=webStorage.local.get(result.constant.LANG_KEY);return null===key?"en-us":key},result.setLangCode=function(langCode){for(var i=0;i<result.langList.length;i++)if(result.langList[i].langCode===langCode)return void webStorage.local.add(result.constant.LANG_KEY,langCode);webStorage.local.add(result.constant.LANG_KEY,"en-us")},result.getLangDisplay=function(){for(var langCode=result.getLangCode(),i=0;i<result.langList.length;i++)if(result.langList[i].langCode===langCode)return result.langList[i].langDisplay;return result.langList[0].langDisplay},result.getLangVideoUrl=function(){for(var langCode=result.getLangCode(),i=0;i<result.langList.length;i++)if(result.langList[i].langCode===langCode)return result.langList[i].videoUrl;return result.langList[0].videoUrl},result.saveAuth=function(accessToken,tokenType,expiresIn){var auth={accessToken:accessToken,tokenType:tokenType,expiresIn:expiresIn};result.currentAuth=auth,webStorage.local.add(result.constant.AUTH_KEY,JSON.stringify(auth))},result.getAuth=function(){var emptyAuth={accessToken:"",tokenType:"",expiresIn:""};return result.currentAuth||result.parseJson(webStorage.local.get(result.constant.AUTH_KEY),emptyAuth)},result.getUrlParam=function(sParam){for(var sParameterName,sPageURL=window.location.search.substring(1),sURLVariables=sPageURL.split("&"),i=0;i<sURLVariables.length;i++)if(sParameterName=sURLVariables[i].split("="),sParameterName[0].toLowerCase()===sParam.toLowerCase())return sParameterName[1];for(sPageURL=location.hash.substring(1),sURLVariables=sPageURL.split("&"),i=0;i<sURLVariables.length;i++)if(sParameterName=sURLVariables[i].split("="),sParameterName[0].replace("/","").toLowerCase()===sParam.toLowerCase())return sParameterName[1];return""},result.handleIE=function(){var ua=window.navigator.userAgent,msie=ua.indexOf("MSIE ");if(msie>0){var ieVer=parseInt(ua.substring(msie+5,ua.indexOf(".",msie)),10);9>ieVer&&require(["es5-shim","json3"],function(){})}if(navigator.userAgent.match(/IEMobile\/10\.0/)){var msViewportStyle=document.createElement("style");msViewportStyle.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),document.querySelector("head").appendChild(msViewportStyle)}},result.getLoginUrl=function(){var oauthClientDefaultScope=result.parseJson(oauthClientDefaultScopeConfig).join("+");return accountUrlConfig+"/users/login?role_text=student&client_id="+oauthClientIdConfig+"&scope="+oauthClientDefaultScope+"&distinct_id="+mixpanelDistinctId},result.getJoinUrl=function(){return result.getRoleJoinUrl("student")},result.getRoleJoinUrl=function(role){var oauthClientDefaultScope=result.parseJson(oauthClientDefaultScopeConfig).join("+");return accountUrlConfig+"/users/sign_up?role_text="+role+"&client_id="+oauthClientIdConfig+"&scope="+oauthClientDefaultScope+"&distinct_id="+mixpanelDistinctId},result.getBrowser=function(){var userAgent=$window.navigator.userAgent,browsers={chrome:/chrome/i,safari:/safari/i,firefox:/firefox/i,ie:/MSIE|Trident/i};for(var key in browsers)if(browsers[key].test(userAgent))return key;return"unknown"},result.savePage=function(pageNumber){result.page=pageNumber,webStorage.local.add(result.constant.MAIN_PAGE,pageNumber)},result.getPage=function(){return result.page||webStorage.local.get(result.constant.MAIN_PAGE)||1},result.saveFavorite=function(on){result.favorite=on,webStorage.local.add(result.constant.FAVORITE,on)},result.getFavorite=function(){return result.favorite||webStorage.local.get(result.constant.FAVORITE)||!1},result.getCatnipPopupClose=function(){return result.catnipPopupClose||webStorage.local.get(result.constant.CATNIP_POPUP_CLOSE)||!1},result.getPremiumPopupClose=function(){return result.premiumPopupClose||webStorage.local.get(result.constant.PREMIUM_POPUP_CLOSE)||!1},result.setCatnipPopupClose=function(v){result.catnipPopupClose=v,webStorage.local.add(result.constant.CATNIP_POPUP_CLOSE,v)},result.setPremiumPopupClose=function(v){result.premiumPopupClose=v,webStorage.local.add(result.constant.PREMIUM_POPUP_CLOSE,v)},result.getCost=function(topic){var cost=parseFloat(topic.cost),rejectCost=cost/2;if(topic.corrected_texts)for(var i=-1,cnt=topic.corrected_texts.length;++i<cnt;)"rejected"===topic.corrected_texts[i].state&&(cost+=rejectCost);return cost},result.hasDeclined=function(topic,accountId){if(topic.hasOwnProperty("original_text_declined")&&topic&&null!==topic.original_text_declined)for(var i=-1,cnt=topic.original_text_declined.length;++i<cnt;)if(accountId===topic.original_text_declined[i].user_id)return!0;return!1},result.getFirstBrowserLanguage=function(){var i,language,nav=window.navigator,browserLanguagePropertyKeys=["language","browserLanguage","systemLanguage","userLanguage"];if(Array.isArray(nav.languages))for(i=0;i<nav.languages.length;i++)if(language=nav.languages[i],language&&language.length)return language.toLowerCase();for(i=0;i<browserLanguagePropertyKeys.length;i++)if(language=nav[browserLanguagePropertyKeys[i]],language&&language.length)return language.toLowerCase();return null},result.showWaiting=function(){$("body").addClass("wait")},result.hideWaiting=function(){$("body").removeClass("wait")},result.isTopicCompletedState=function(state){return"corrected"===state||"accepted"===state||"declined"===state},result.isNotModifiedState=function(state){return result.isTopicCompletedState(state)||"correcting"===state},result.backColor={white:"#ffffff",overMint:"#f7f9fa",waitMint:"#EEF9F9"},result.countryList=[{n:"Afghanistan",i:"af"},{n:"land Islands",i:"ax"},{n:"Albania",i:"al"},{n:"Algeria",i:"dz"},{n:"American Samoa",i:"as"},{n:"Andorra",i:"ad"},{n:"Angola",i:"ao"},{n:"Anguilla",i:"ai"},{n:"Antigua and Barbuda",i:"ag"},{n:"Argentina",i:"ar"},{n:"Armenia",i:"am"},{n:"Aruba",i:"aw"},{n:"Australia",i:"au"},{n:"Austria",i:"at"},{n:"Azerbaijan",i:"az"},{n:"Bahamas",i:"bs"},{n:"Bahrain",i:"bh"},{n:"Bangladesh",i:"bd"},{n:"Barbados",i:"bb"},{n:"Belarus",i:"by"},{n:"Belgium",i:"be"},{n:"Belize",i:"bz"},{n:"Benin",i:"bj"},{n:"Bermuda",i:"bm"},{n:"Bhutan",i:"bt"},{n:"Bolivia",i:"bo"},{n:"Bosnia and Herzegovina",i:"ba"},{n:"Botswana",i:"bw"},{n:"Brazil",i:"br"},{n:"British Indian Ocean Territory",i:"io"},{n:"British Virgin Islands",i:"vg"},{n:"Brunei",i:"bn"},{n:"Bulgaria",i:"bg"},{n:"Burkina Faso",i:"bf"},{n:"Burundi",i:"bi"},{n:"Cambodia",i:"kh"},{n:"Cameroon",i:"cm"},{n:"Canada",i:"ca"},{n:"Cape Verde",i:"cv"},{n:"Caribbean Netherlands",i:"bq"},{n:"Cayman Islands",i:"ky"},{n:"Central African Republic",i:"cf"},{n:"Chad",i:"td"},{n:"Chile",i:"cl"},{n:"China",i:"cn"},{n:"Christmas Island",i:"cx"},{n:"Cocos",i:"cc"},{n:"Colombia",i:"co"},{n:"Comoros",i:"km"},{n:"Congo",i:"cd"},{n:"Congo",i:"cg"},{n:"Cook Islands",i:"ck"},{n:"Costa Rica",i:"cr"},{n:"Cte dIvoire",i:"ci"},{n:"Croatia",i:"hr"},{n:"Cuba",i:"cu"},{n:"Curaao",i:"cw"},{n:"Cyprus",i:"cy"},{n:"Czech Republic",i:"cz"},{n:"Denmark",i:"dk"},{n:"Djibouti",i:"dj"},{n:"Dominica",i:"dm"},{n:"Dominican Republic",i:"do"},{n:"Ecuador",i:"ec"},{n:"Egypt",i:"eg"},{n:"El Salvador",i:"sv"},{n:"Equatorial Guinea",i:"gq"},{n:"Eritrea",i:"er"},{n:"Estonia",i:"ee"},{n:"Ethiopia",i:"et"},{n:"Falkland Islands",i:"fk"},{n:"Faroe Islands",i:"fo"},{n:"Fiji",i:"fj"},{n:"Finland",i:"fi"},{n:"France",i:"fr"},{n:"French Guiana",i:"gf"},{n:"French Polynesia",i:"pf"},{n:"Gabon",i:"ga"},{n:"Gambia",i:"gm"},{n:"Georgia",i:"ge"},{n:"Germany",i:"de"},{n:"Ghana",i:"gh"},{n:"Gibraltar",i:"gi"},{n:"Greece",i:"gr"},{n:"Greenland",i:"gl"},{n:"Grenada",i:"gd"},{n:"Guadeloupe",i:"gp"},{n:"Guam",i:"gu"},{n:"Guatemala",i:"gt"},{n:"Guernsey",i:"gg"},{n:"Guinea",i:"gn"},{n:"Guinea-Bissau",i:"gw"},{n:"Guyana",i:"gy"},{n:"Haiti",i:"ht"},{n:"Honduras",i:"hn"},{n:"Hong Kong",i:"hk"},{n:"Hungary",i:"hu"},{n:"Iceland",i:"is"},{n:"India",i:"in"},{n:"Indonesia",i:"id"},{n:"Iran",i:"ir"},{n:"Iraq",i:"iq"},{n:"Ireland",i:"ie"},{n:"Isle of Man",i:"im"},{n:"Israel",i:"il"},{n:"Italy",i:"it"},{n:"Jamaica",i:"jm"},{n:"Japan",i:"jp"},{n:"Jersey",i:"je"},{n:"Jordan",i:"jo"},{n:"Kazakhstan",i:"kz"},{n:"Kenya",i:"ke"},{n:"Kiribati",i:"ki"},{n:"Kosovo",i:"xk"},{n:"Kuwait",i:"kw"},{n:"Kyrgyzstan",i:"kg"},{n:"Laos",i:"la"},{n:"Latvia",i:"lv"},{n:"Lebanon",i:"lb"},{n:"Lesotho",i:"ls"},{n:"Liberia",i:"lr"},{n:"Libya",i:"ly"},{n:"Liechtenstein",i:"li"},{n:"Lithuania",i:"lt"},{n:"Luxembourg",i:"lu"},{n:"Macau",i:"mo"},{n:"Macedonia",i:"mk"},{n:"Madagascar",i:"mg"},{n:"Malawi",i:"mw"},{n:"Malaysia",i:"my"},{n:"Maldives",i:"mv"},{n:"Mali",i:"ml"},{n:"Malta",i:"mt"},{n:"Marshall Islands",i:"mh"},{n:"Martinique",i:"mq"},{n:"Mauritania",i:"mr"},{n:"Mauritius",i:"mu"},{n:"Mayotte",i:"yt"},{n:"Mexico",i:"mx"},{n:"Micronesia",i:"fm"},{n:"Moldova",i:"md"},{n:"Monaco",i:"mc"},{n:"Mongolia",i:"mn"},{n:"Montenegro",i:"me"},{n:"Montserrat",i:"ms"},{n:"Morocco",i:"ma"},{n:"Mozambique",i:"mz"},{n:"Myanmar",i:"mm"},{n:"Namibia",i:"na"},{n:"Nauru",i:"nr"},{n:"Nepal",i:"np"},{n:"Netherlands",i:"nl"},{n:"New Caledonia",i:"nc"},{n:"New Zealand",i:"nz"},{n:"Nicaragua",i:"ni"},{n:"Niger",i:"ne"},{n:"Nigeria",i:"ng"},{n:"Niue",i:"nu"},{n:"Norfolk Island",i:"nf"},{n:"North Korea",i:"kp"},{n:"Northern Mariana Islands",i:"mp"},{n:"Norway",i:"no"},{n:"Oman",i:"om"},{n:"Pakistan",i:"pk"},{n:"Palau",i:"pw"},{n:"Palestine",i:"ps"},{n:"Panama",i:"pa"},{n:"Papua New Guinea",i:"pg"},{n:"Paraguay",i:"py"},{n:"Peru",i:"pe"},{n:"Philippines",i:"ph"},{n:"Pitcairn Islands",i:"pn"},{n:"Poland",i:"pl"},{n:"Portugal",i:"pt"},{n:"Puerto Rico",i:"pr"},{n:"Qatar",i:"qa"},{n:"Runion",i:"re"},{n:"Romania",i:"ro"},{n:"Russia",i:"ru"},{n:"Rwanda",i:"rw"},{n:"Saint Barthlemy",i:"bl"},{n:"Saint Helena",i:"sh"},{n:"Saint Kitts and Nevis",i:"kn"},{n:"Saint Lucia",i:"lc"},{n:"Saint Martin",i:"mf"},{n:"Saint Pierre and Miquelon",i:"pm"},{n:"Saint Vincent and the Grenadines",i:"vc"},{n:"Samoa",i:"ws"},{n:"San Marino",i:"sm"},{n:"So Tom and Prncipe",i:"st"},{n:"Saudi Arabia",i:"sa"},{n:"Senegal",i:"sn"},{n:"Serbia",i:"rs"},{n:"Seychelles",i:"sc"},{n:"Sierra Leone",i:"sl"},{n:"Singapore",i:"sg"},{n:"Sint Maarten",i:"sx"},{n:"Slovakia",i:"sk"},{n:"Slovenia",i:"si"},{n:"Solomon Islands",i:"sb"},{n:"Somalia",i:"so"},{n:"South Africa",i:"za"},{n:"South Georgia & South Sandwich Islands",i:"gs"},{n:"South Korea",i:"kr"},{n:"South Sudan",i:"ss"},{n:"Spain",i:"es"},{n:"Sri Lanka",i:"lk"},{n:"Sudan",i:"sd"},{n:"Suriname",i:"sr"},{n:"Svalbard and Jan Mayen",i:"sj"},{n:"Swaziland",i:"sz"},{n:"Sweden",i:"se"},{n:"Switzerland",i:"ch"},{n:"Syria",i:"sy"},{n:"Taiwan",i:"tw"},{n:"Tajikistan",i:"tj"},{n:"Tanzania",i:"tz"},{n:"Thailand",i:"th"},{n:"Timor-Leste",i:"tl"},{n:"Togo",i:"tg"},{n:"Tokelau",i:"tk"},{n:"Tonga",i:"to"},{n:"Trinidad and Tobago",i:"tt"},{n:"Tunisia",i:"tn"},{n:"Turkey",i:"tr"},{n:"Turkmenistan",i:"tm"},{n:"Turks and Caicos Islands",i:"tc"},{n:"Tuvalu",i:"tv"},{n:"Uganda",i:"ug"},{n:"Ukraine",i:"ua"},{n:"United Arab Emirates",i:"ae"},{n:"United Kingdom",i:"gb"},{n:"United States",i:"us"},{n:"U.S. Minor Outlying Islands",i:"um"},{n:"U.S. Virgin Islands",i:"vi"},{n:"Uruguay",i:"uy"},{n:"Uzbekistan",i:"uz"},{n:"Vanuatu",i:"vu"},{n:"Vatican City",i:"va"},{n:"Venezuela",i:"ve"},{n:"Vietnam",i:"vn"},{n:"Wallis and Futuna",i:"wf"},{n:"Western Sahara",i:"eh"},{n:"Yemen",i:"ye"},{n:"Zambia",i:"zm"},{n:"Zimbabwe",i:"zw"}],result}]),angular.loaded=function(){angular.element(document.querySelectorAll(".load-none")).removeClass("load-none"),angular.element(document.querySelectorAll(".load-hidden")).removeClass("load-hidden")},angular.clearRoleCheck=function(){angular.element(document.querySelectorAll(".check-role-none")).removeClass("check-role-none")},angular.module("langTextFactoryModule",[]).factory("langTextFactory",["commonFactory",function(commonFactory){var result={};return result.langText={"en-us":{"main.sign.up":"Join","main.sign.in":"Login","main.business.button":"For Business","main.title":"Perfect Written English When You Need It!","main.subtitle":"ChattingCat delivers instant corrections from native speaking tutors.","main.try.button":"Try It Free!","main.watch.video":"Watch the Video","main.overview":"Overview","main.our.tutors.short":"Our Tutors","main.our.tutors":"Meet Our Tutors","main.pricing":"Pricing","main.testimonials":"Testimonials","main.download.app":"Download App","main.overview.first.title":"Send English Text Using Catnip","main.overview.first.desc":"Type English text into ChattingCat.<br>Your free trial allows you to enter up to 350 characters.<br>For more, just add catnip credits to your account.","main.overview.second.title":"Get Instant Corrections","main.overview.second.desc":"ChattingCat connects you with a native English speaking tutor.<br>They correct your chat and you instantly receive a revised version. <br>The current average response time is just two minutes.","main.overview.third.title":"Learn From Your Mistakes","main.overview.third.desc":"See what was corrected and improve your English skills.","main.our.tutors.subtitle":'ChattingCats tutors are native English-speaking writers, teachers,<br>professionals, and grad students from all over the world. <br>Our tutors are available <span class="chattingcat-red">24/7</span> for all your correction needs!',"main.pricing.title":"Catnip Prices","main.pricing.subtitle":"1 catnip credit = 70 characters<br>Its that simple!","main.pricing.characters":" characters","main.pricing.catnip":" catnip","main.pricing.free.catnip":" free catnip","main.app.donwload.title":"Download ChattingCat","main.app.download.subtitle":"Personal tutors in your hand, anywhere you go!","main.testimonials.1":"After I started using ChattingCat, my productivity at work has increased! Now I can communicate with native English-speaking clients worry-free!","main.testimonials.2":"Even though I have learned to speak English, it is difficult for me to write papers for school. ChattingCat has helped me learn to write with proper English grammar. I feel less stressed about school now!","main.testimonials.3":"I've been using ChattingCat for my job search and the tutors have helped me correct mistakes in my resume and cover letters. I feel more confident applying for jobs in other countries!","main.testimonials.4":"Many years of studying abroad wasnt enough in ridding my worries of broken English. After being introduced to ChattingCat, I finally felt stress-free when writing and confident at work.","main.testimonials.name.1":"Jongsuk Y.","main.testimonials.name.2":"Chris L.","main.testimonials.name.3":"Jamie S.","main.testimonials.name.4":"Fumiaki U.","main.testimonials.occupation.1":"Chief Story Manager, Awesomeribbon.com","main.testimonials.occupation.2":"Recent Grad","main.testimonials.occupation.3":"International Student","main.testimonials.occupation.4":"Consultant","common.update.success":"Update Successful","common.update.fail":"Update Failed","account.profile.title":"Profile","account.profile.error.upload.profile":"Failed to upload profile.","account.profile.error.update":"Failed to update profile.","account.profile.password.short.error":"Incorrect Password.","account.profile.password.6char.error":"Please enter at least 6 characters.","account.profile.password.match.error":"Passwords do not match.","account.setting.notification.sound.desc":"Receive a sound notification for corrected chats.","account.setting.notification.letter.desc":"Receive emails about general promotions, updates, news, and surveys.","account.setting.notification.update":"Notifications have been saved.","account.setting.notification.update.fail":"Failed to update notifications.","account.setting.error":"You cannot change your password if you logged in with Facebook or Google+.","account.setting.unregister.warning":"Are you sure you want to delete your account?","account.tutor.updated":"Information successfully updated.","student.tutor.block.message":"Your correction response time<br> could potentially increase.","student.tutor.unblock.message":'"Unblock" will allow the tutor<br>to correct your chat.',"student.chat.not-make-sense":"Sorry! Our tutors did not understand your chat.<br/>We've refunded your catnip. Please try again.","notification.rating":"{from_user_name} has rated your correction.","notification.cashout":"Your cash out has been processed!","notification.promotion":"Congratulations! You are now an {role_name} with ChattingCat.","notification.bank.charge":"    {catnip} .","notification.corrected":"'{preview}' has been corrected by {tutor_name}.","notification.empty":"No New Notifications","notification.correction.arrived":"Correction arrived","notification.qna.question":"{from_user_name} sent a message.","notification.qna.answer":"{from_user_name} sent a message.","footer.faq.title":"FAQs","footer.faq.desc":'Have a question? Look here for an answer. If you cannot find what you are looking for, please <a href="/contact-us" class="red_link">contact us.</a>',"footer.faq.menu.fundamental":"The Fundamentals","footer.faq.menu.chattingcatuser":"The ChattingCat Users","footer.faq.menu.catnip":"Tell Me About Catnip","footer.faq.menu.account":"Manage Your Account","footer.faq.menu.ourstudent":"FAQs from Our Students","footer.faq.menu1.chattingcat":"What is ChattingCat?","footer.faq.menu1.chattingcat.answer":"ChattingCat connects people who want someone to check their English writing with people who want to help. This way, writers can get instant corrections of their work via the website or app. Essentially, you can instantly perfect your English writing thanks to ChattingCat!","footer.faq.menu1.vision":"What is ChattingCats vision?","footer.faq.menu1.vision.answer":"We believe that everyone should feel free to write in English, and be able to connect with anyone, anywhere, anytime. Our service increases productivity, improves confidence, and makes writing in English easier. You do not have to fear English writing anymore, thanks to ChattingCat!","footer.faq.menu2.howwork":"For Students, how does ChattingCat work?","footer.faq.menu2.howwork.answer":"People who want someone to check and correct their writing are called Students.<br/>When a Student joins ChattingCat, they receive five free Catnips, which is our digital currency. When Students use catnip, they can upload their English writing for correction. 70 characters costs one catnip and 700 characters costs ten catnip.<br/><br/>When you use up your five free catnip, you can purchase more via the website or the app. Our prices are reasonable and you will appreciate the value that ChattingCat provides.<br/><br/>The maximum number of characters that can be sent for correction at one time is currently 1400. Anything over this will need to be split up into different chats.","footer.faq.menu2.tutorwork":"For Tutors, how does ChattingCat work?","footer.faq.menu2.tutorwork.answer":"People who correct writing are called Tutors. To join ChattingCat as a Tutor, you need to fill out a profile and pass a correction test. If successful, you join as a Trainee Tutor and you can correct sentences for Students. After each correction, Students rate your corrections from one to five points. <br/><br/>After you have received an average rating of 3.5 or above for 20 corrections, ChattingCat will review your work. We will promote you to the Experienced Tutor level, if the quality of your work is perfect.<br/><br/>As a Trainee Tutor, you do collect catnip, but you are not able to cashout via PayPal. Once promoted to the Experienced Tutor level, you have the ability to cashout via PayPal.","footer.faq.menu3.catnip":"What is Catnip?","footer.faq.menu3.catnip.answer":"Catnip is ChattingCat's digital currency. You get five free catnip when you sign up. Once you use up all these free catnip, you will need to purchase more. This can be done via the website or the app. For Students, instant correction of 70 characters costs one catnip.","footer.faq.menu3.buy":"For Students, how do you buy Catnip?","footer.faq.menu3.buy.answer":"Students can buy catnip by clicking the Buy Catnip button on the website or in the app. If you have a PayPal account, you can simply pay through your account. If you dont, you can still pay with your debit or credit card using the Buy Now button. <br/><br/>If you are using your debit or credit card on PayPal for the first time, they will verify your credit card information by submitting an authorization charge for $1. This allows PayPal to make sure the card information is accurate, thereby keeping everyone safe. This authorization charge is only temporary, and the card issuer will release (cancel) this charge, although the amount of time it takes to release the charge depends on a person's bank.","footer.faq.menu3.tutor_catnip":"For Tutors, how do you cash out Catnip?","footer.faq.menu3.tutor_catnip.answer":"Tutors can cashout Catnip using their PayPal account. The exchange rate is 5 cents per Catnip, or $1.00 for 20 Catnips. You can cash out a minimum of $5 at a time. Please note that PayPal charges $0.30 cents per transaction plus a 2.9% fee (As of January 2014). Please review your PayPal and bank account account details for more information on transaction charges and turnaround times.","footer.faq.menu3.expire":"When do my Catnip expire?","footer.faq.menu3.expire.answer":"Catnip expire two years after they are added to your account.","footer.faq.menu4.delete":"How do I delete my account?","footer.faq.menu4.delete.answer":"<br>To do this, please follow these steps:<br>1. Log into your account and go to your Settings.<br>2. Scroll down to the bottom of the page and click the red Delete Account button.<br>3. Click the Confirm button on the window that appears. Your account will then be deleted.<br><br>Note: This will permanently erase all your chat history, personal settings, and remaining Catnips.","footer.faq.menu5.correction":"How does ChattingCat maintain quality corrections?","footer.faq.menu5.correction.answer":"Before Tutors can correct sentences, ChattingCat evaluates their education, experience, and gives them a test. Those who pass become Trainee Tutors. As a Trainee, they are closely monitored, and if they receives high rankings from Students, and pass a quality control review after 20 chats, they become an Experienced Tutor and can cash out their Catnip.<br/><br/> ChattingCat continuously monitors and reviews Tutor corrections to ensure they provide a high quality service. Also, ratings are examined on a regular basis in order to identify quality control issues.","footer.faq.menu5.option":"What if I want another opinion about my chat?","footer.faq.menu5.option.answer":"If you want a second opinion, you can resend your chat to another Tutor for 50% off. The chat will be reviewed by a different tutor and you will have two corrections for the same chat.","footer.faq.menu5.time":"Will my chats be corrected immediately?","footer.faq.menu5.time.answer":"ChattingCat's goal is to provide instant corrections immediately after you send a request. However, corrections can take up to a maximum of one hour. We guarantee that most corrections will be completed much faster than this. In fact, our average response time is less than 2 minutes.<br/><br/>ChattingCat's Tutors work hard to give you outstanding service and quality by providing corrections as soon as possible.","footer.faq.menu5.block":"Can I block tutors who I dont want to get corrections from?","footer.faq.menu5.block.answer":"Yes, you can. When you click the username of a tutor, you will see the down arrow symbol next to the username on the tutor information page. When you click the button, you can block or unblock the tutor.<br><br>Please remember that when you block tutors, the response time may drop.","business.title":"ChattingCat Business","business.sub_title":"Enhancing Your Global Success","business.title_desc":"We offer premium services for startups, language institutions,<br>higher education, enterprises, and the government.","business.contact_us":"Contact Us","business.company_desc":"See whos relying on ChattingCat Business","business.desc1_title":"For Longer Writing with Specialized and Dedicated Experts","business.desc1_sub":"ChattingCat Business allows up to 7,000 characters per request, and only premium tutors with relevant backgrounds and specific expertise provide high quality corrections for your sophisticated needs.","business.desc2_title":"Improved English Quality that Reaches a Global Audience","business.desc2_sub":"ChattingCat knows how important effective global communication is. English that is of the highest quality helps you deliver your message with people all over the world.<br><br>Startups like Bravepops and business conglomerates like SK Telecom are currently using ChattingCat Business to reach their global audiences.","business.desc3_title":"We Support All Formats and Files to Meet Your Customized Needs","business.desc3_sub":"ChattingCat Business supports web copy, presentation content, presentation scripts, product descriptions, brochures, landing pages, app text, and more. Our content experts will transform your writing from good to outstanding.","business.contact_us_title":"Get Expert Help with ChattingCat Business!"},"ko-kr":{"main.sign.up":"","main.sign.in":"","main.business.button":"","main.title":" <br> !","main.subtitle":"       .","main.try.button":" ","main.watch.video":" ","main.overview":"","main.our.tutors.short":"","main.our.tutors":"  ","main.pricing":"","main.testimonials":"","main.download.app":" ","main.overview.first.title":"    ","main.overview.first.desc":"  350      .","main.overview.second.title":"      ","main.overview.second.desc":"     .<br>     .","main.overview.third.title":"     ","main.overview.third.desc":"    .<br>       .","main.our.tutors.subtitle":"     <br> ,    .","main.pricing.title":" ","main.pricing.subtitle":"1  70    .","main.pricing.characters":" ","main.pricing.catnip":" ","main.pricing.free.catnip":"  ","main.app.donwload.title":"  ","main.app.download.subtitle":"    <br>    .","main.testimonials.1":"     .              .","main.testimonials.2":"  ,       .        ,     .","main.testimonials.3":"      ,   .       .      .","main.testimonials.4":"          .     ,       .","main.testimonials.name.1":" Y","main.testimonials.name.2":" L","main.testimonials.name.3":" S","main.testimonials.name.4":" U","main.testimonials.occupation.1":"  ","main.testimonials.occupation.2":"","main.testimonials.occupation.3":"","main.testimonials.occupation.4":"","common.update.success":".","common.update.fail":" .","account.profile.title":"","account.profile.error.upload.profile":"   .","account.profile.error.update":"  .","account.profile.password.short.error":"Incorrect Password.","account.profile.password.6char.error":"Please enter at least 6 characters.","account.profile.password.match.error":"Passwords do not match.","account.setting.notification.sound.desc":"Receive a sound notification for corrected chats.","account.setting.notification.letter.desc":"Receive emails about general promotions, updates, news, and surveys.",
"account.setting.notification.update":"Notifications have been saved.","account.setting.notification.update.fail":"Failed to update notifications.","account.setting.error":"Facebook/Google      .","account.setting.unregister.warning":"Are you sure you want to delete your account?","account.tutor.updated":"Information successfully updated.","student.tutor.block.message":"Your correction response time<br> could potentially increase.","student.tutor.unblock.message":"You can ... from now","student.chat.not-make-sense":"Sorry! Our tutors did not understand your chat.<br/>We've refunded your catnip. Please try again.","notification.bank.charge":"    {catnip} .","notification.corrected":" '{preview}'  {tutor_name}  .","notification.correction.arrived":" .","notification.qna.question":"{from_user_name}  .","notification.qna.answer":"{from_user_name}  .","footer.faq.title":"  (FAQs)","footer.faq.desc":" ","footer.faq.menu.fundamental":"","footer.faq.menu.chattingcatuser":" ","footer.faq.menu.catnip":"   ","footer.faq.menu.account":" ","footer.faq.menu.ourstudent":"  ","footer.faq.menu1.chattingcat":" ?","footer.faq.menu1.chattingcat.answer":"                .            .","footer.faq.menu1.vision":"  ?","footer.faq.menu1.vision.answer":"          .","footer.faq.menu2.howwork":"     ?","footer.faq.menu2.howwork.answer":'    "Students" .  "Student"   5 Catnip  . "Student" Catnip       . 70 , Catnip ,   700(10 Catnip)   .',"footer.faq.menu2.tutorwork":"     ?","footer.faq.menu2.tutorwork.answer":'    "Tutors" . "Tutor"            .<br/><br/>    "Trainee",  "Students"     .  "Student"     .<br/><br/> 20 Catnip , "Student"   3.5/5.0  ,       "Experienced"  . "Experienced"  Catnip   ,   Catnip    .',"footer.faq.menu3.catnip":"Catnip ?","footer.faq.menu3.catnip.answer":"Catnip   . 70              .","footer.faq.menu3.buy":"Catnip  ?","footer.faq.menu3.buy.answer":"<strong>Buy Catnip</strong>   Catnip   . PayPal  , PayPal    .   Buy Catnip      .<br/><br/>PayPal    , PayPal      .   authorization charge $1      ,          .","footer.faq.menu3.tutor_catnip":"    Catnip  ?","footer.faq.menu3.tutor_catnip.answer":"PayPal    Catnip    . Catnip 5 20 Catnip  $1.   $5  ,   PayPal   $0.30 + 2.9%     .  PayPal         .","footer.faq.menu3.expire":"   ?","footer.faq.menu3.expire.answer":"    2.","footer.faq.menu4.delete":"    ?","footer.faq.menu4.delete.answer":"     .<br>1.   Settings  .<br>2. Settings  Delete Account  .<br>3.      Confirm .<br><br>:    ,      .","footer.faq.menu5.correction":"    ?","footer.faq.menu5.correction.answer":" Tutors      Tutors    .   Tutors Trainees  .   Trainees  ,  Trainees Students        Experienced  . Experienced   Tutors   .<br/><br/>          .","footer.faq.menu5.option":"          ?","footer.faq.menu5.option.answer":"    Tutor    Resend   50%       .","footer.faq.menu5.time":"    ?","footer.faq.menu5.time.answer":"  ,            .<br/><br/>    2    ,       1  .<br/><br/>         .        .","footer.faq.menu5.block":"      ?","footer.faq.menu5.block.answer":", .       .         ,   /     .<br><br>,   ,     .","business.title":" ","business.sub_title":"  .","business.title_desc":" ,   , , ,     .","business.contact_us":"","business.company_desc":"    .","business.desc1_title":"     .","business.desc1_sub":"             .<br><br>     7,000     .","business.desc2_title":"       .","business.desc2_sub":"         .<br><br>        .<br><br>123  , SK         . ","business.desc3_title":"       .","business.desc3_sub":"  / , ,  ,   ,         .<br><br>              .","business.contact_us_title":"     ."},"ja-jp":{"main.sign.up":"","main.sign.in":"","main.business.button":"","main.title":"<br>","main.subtitle":"","main.try.button":"","main.watch.video":"","main.overview":"","main.our.tutors.short":"","main.our.tutors":"","main.testimonials":"","main.pricing":"","main.download.app":"","main.overview.first.title":"","main.overview.first.desc":"<br>350","main.overview.second.title":"","main.overview.second.desc":"","main.overview.third.title":"","main.overview.third.desc":"","main.our.tutors.subtitle":"","main.pricing.title":"","main.pricing.subtitle":"170","main.app.donwload.title":"","main.app.download.subtitle":"<br>","main.pricing.characters":" ","main.pricing.catnip":"","main.pricing.free.catnip":"","account.setting.error":"Facebook/Google!","footer.faq.title":"FAQs","footer.faq.desc":'\n<a href="/contact-us" class="red_link"></a>',"footer.faq.menu.fundamental":"","footer.faq.menu.chattingcatuser":"","footer.faq.menu.catnip":"","footer.faq.menu.ourstudent":"","footer.faq.menu1.chattingcat":"","footer.faq.menu1.chattingcat.answer":"\n","footer.faq.menu1.vision":"","footer.faq.menu1.vision.answer":"","footer.faq.menu2.howwork":"","footer.faq.menu2.howwork.answer":"CatnipCatnip17001Catnip70","footer.faq.menu2.tutorwork":"","footer.faq.menu2.tutorwork.answer":"  20Catnip3.5/5.0CatnipCatnip","footer.faq.menu3.catnip":"Catnip","footer.faq.menu3.catnip.answer":"Catnip Catnip","footer.faq.menu3.buy":"Catnip","footer.faq.menu3.buy.answer":"Buy CatnipCatnipPayPalPayPalBuy Catnip PayPalauthorization charge1","footer.faq.menu3.tutor_catnip":"Catnip","footer.faq.menu3.tutor_catnip.answer":"PayPalCatnipCatnip152015PayPal1$0.30 + 2.9%PayPal","footer.faq.menu5.correction":"","footer.faq.menu5.correction.answer":"Resend50%","footer.faq.menu5.time":"","footer.faq.menu5.time.answer":" 41  ","footer.faq.menu5.option":"","footer.faq.menu5.option.answer":"50","footer.faq.menu5.block":"","footer.faq.menu5.block.answer":"<br>[]","business.title_desc":"ChattingCat","footer.faq.menu.account":"","footer.faq.menu3.expire":"Catnip","footer.faq.menu3.expire.answer":"Catnip2","footer.faq.menu4.delete":"","footer.faq.menu4.delete.answer":"1. SettingsDelete Account<br>2. Delete Account<br>CatnipCatnip","main.testimonials.1":"After I started using ChattingCat, my productivity at work has increased! Now I can communicate with native English-speaking clients worry-free!","main.testimonials.2":"Even though I have learned to speak English, it is difficult for me to write papers for school. ChattingCat has helped me learn to write with proper English grammar. I feel less stressed about school now!","main.testimonials.3":"I've been using ChattingCat for my job search and the tutors have helped me correct mistakes in my resume and cover letters. I feel more confident applying for jobs in other countries!","main.testimonials.4":"Many years of studying abroad wasnt enough in ridding my worries of broken English. After being introduced to ChattingCat, I finally felt stress-free when writing and confident at work.","main.testimonials.name.1":"Jongsuk Y.","main.testimonials.name.2":"Chris L.","main.testimonials.name.3":"Jamie S.","main.testimonials.name.4":"Fumiaki U.","main.testimonials.occupation.1":"Chief Story Manager, Awesomeribbon.com","main.testimonials.occupation.2":"Recent Grad","main.testimonials.occupation.3":"International Student","main.testimonials.occupation.4":"Consultant"}},result.get=function(lang,key){return result.langText[lang][key]},result.getText=function(key){var val=result.langText[commonFactory.getLangCode()][key];return void 0===val?result.langText["en-us"][key]:val},result}]),angular.module("resourceFactoryModule",["ngResource","configModule","commonFactoryModule"]),angular.module("resourceFactoryModule").factory("headerConfigFactory",["commonFactory","$location",function(commonFactory,$location){var result={};return result.request=function(config){if(config.headers.Accept="application/json",config.headers["Content-type"]="application/json",/(iPhone OS 9)/i.test(navigator.userAgent)&&"http"===$location.protocol()&&/(coupon-desc)/i.test($location.url()))return config;var accessToken=commonFactory.getAuth().accessToken;return accessToken&&(config.headers.Authorization="Bearer "+accessToken),config},result}]),angular.module("resourceFactoryModule").config(["$httpProvider",function($httpProvider){$httpProvider.defaults.withCredentials=!0,$httpProvider.interceptors.push("headerConfigFactory")}]),angular.module("resourceFactoryModule").factory("resourceFactory",["apiUrlConfig","$resource",function(apiUrlConfig,$resource){var accountAction={logout:{url:apiUrlConfig+"/api/logout",method:"DELETE",isArray:!1},saveTutorScreening:{url:apiUrlConfig+"/api/users/:id/screening",method:"POST",isArray:!1,params:{id:"@id"}},cashOutTutor:{url:apiUrlConfig+"/api/cashouts",method:"POST",isArray:!1},cashOutListTutor:{url:apiUrlConfig+"/api/cashouts",method:"GET",isArray:!1,params:{offset:"@offset",limit:"@limit"}},checkOutStudent:{url:apiUrlConfig+"/api/paypal_checkout",method:"POST",isArray:!1},checkOutStripe:{url:apiUrlConfig+"/api/stripe_checkout",method:"POST",isArray:!1},bankTransferStudent:{url:apiUrlConfig+"/api/bank_transfer/korea",method:"POST",isArray:!1},buyCatnipList:{url:apiUrlConfig+"/api/payments",method:"GET",isArray:!1,params:{offset:"@offset",limit:"@limit"}},getCouponList:{url:apiUrlConfig+"/api/coupons",method:"GET",isArray:!1,params:{offset:"@offset",limit:"@limit"}},contactUs:{url:apiUrlConfig+"/api/contactus",method:"POST",isArray:!1},enrollCoupon:{url:apiUrlConfig+"/api/coupons/enroll",method:"POST",isArray:!1,params:{code:"@code"}},blockTutor:{url:apiUrlConfig+"/api/blocked_users",method:"POST",isArray:!1,params:{tutor_id:"@tutor_id"}},unBlockTutor:{url:apiUrlConfig+"/api/blocked_users/:tutor_id",method:"DELETE",isArray:!1,params:{tutor_id:"@tutor_id"}},resetConfirmation:{url:apiUrlConfig+"/api/users/reset_confirmation",method:"POST",isArray:!1},confirmation:{url:apiUrlConfig+"/api/users/confirmation",method:"GET",isArray:!1,params:{confirmation_token:"@confirmation_token",distinct_id:"@distinct_id"}},updateAccount:{url:apiUrlConfig+"/api/users/:id",method:"PUT",isArray:!1,params:{id:"@id"}},subscribe:{url:apiUrlConfig+"/api/users/:id/subscribe",method:"PUT",isArray:!1,params:{id:"@id"}},getDiscountReferral:{url:apiUrlConfig+"/api/referrals/discount",method:"GET",isArray:!1},sendReferralEmail:{url:apiUrlConfig+"/api/referrals/send_email",method:"POST",isArray:!1,params:{invited_email:"@invited_email"}},referralCode:{url:apiUrlConfig+"/api/referrals/code",method:"GET",isArray:!1},referralJoinList:{url:apiUrlConfig+"/api/referrals/joined_list",method:"GET",isArray:!1,params:{offset:"@offset",limit:"@limit"}},blockList:{url:apiUrlConfig+"/api/blocked_users",method:"GET",isArray:!1}},Account=$resource(apiUrlConfig+"/api/me",{},accountAction),result={};result.getAccount=function(){return Account.get().$promise},result.logoutAccount=function(){return Account.logout().$promise},result.screeningTutor=function(tutorResponse,tutorID){var tutorScreening=new Account(tutorResponse);return tutorScreening.$saveTutorScreening({id:tutorID})},result.cashOutTutor=function(cashOutInfo){var tutor=new Account(cashOutInfo);return tutor.$cashOutTutor()},result.buyCatnipList=function(offset,limit){var tutor=new Account;return tutor.$buyCatnipList({offset:offset,limit:limit})},result.getCouponList=function(offset,limit){var account=new Account;return account.$getCouponList({offset:offset,limit:limit})},result.cashOutListTutor=function(offset,limit){var tutor=new Account;return tutor.$cashOutListTutor({offset:offset,limit:limit})},result.checkOutStudent=function(checkOutInfo){var tutor=new Account(checkOutInfo);return tutor.$checkOutStudent()},result.checkOutStripe=function(checkOutInfo){var account=new Account(checkOutInfo);return account.$checkOutStripe()},result.bankTransferStudent=function(bankTransferInfo){var student=new Account(bankTransferInfo);return student.$bankTransferStudent()},result.contactUs=function(feedback){var account=new Account(feedback);return account.$contactUs()},result.enrollCoupon=function(code){var account=new Account;return account.$enrollCoupon({code:code})},result.blockTutor=function(tutor_id){var account=new Account;return account.$blockTutor({tutor_id:tutor_id})},result.unBlockTutor=function(tutor_id){var account=new Account;return account.$unBlockTutor({tutor_id:tutor_id})},result.resetConfirmation=function(emailInfo){var account=new Account(emailInfo);return account.$resetConfirmation()},result.confirmation=function(confirmationToken,distinct_id){return Account.confirmation({confirmation_token:confirmationToken,distinct_id:distinct_id}).$promise},result.updateAccount=function(accountInfo,id){var account=new Account(accountInfo);return account.$updateAccount({id:id})},result.subscribe=function(id){var account=new Account;return account.$subscribe({id:id})},result.referralCode=function(){var tutor=new Account;return tutor.$referralCode()},result.referralJoinList=function(offset,limit){var account=new Account;return account.$referralJoinList({offset:offset,limit:limit})},result.getDiscountReferral=function(){var student=new Account;return student.$getDiscountReferral()},result.sendReferralEmail=function(invited_email){var account=new Account;return account.$sendReferralEmail({invited_email:invited_email})},result.getBlockList=function(){var account=new Account;return account.$blockList()};var topicAction={query:{method:"GET",withCredentials:!1,isArray:!1,params:{offset:"@offset",limit:"@limit"}},get:{url:apiUrlConfig+"/api/topics/:id",method:"GET",isArray:!1,params:{id:"@id"}},history:{url:apiUrlConfig+"/api/topics/history",method:"GET",isArray:!1,params:{offset:"@offset",limit:"@limit"}}},Topic=$resource(apiUrlConfig+"/api/topics",{},topicAction);result.getTopicList=function(offset,limit,favorite){return Topic.query({offset:offset,limit:limit,favorite:favorite}).$promise},result.favoriteTopic=function(orginalTextID){var originalText=new OriginalText;return originalText.$favorite({id:orginalTextID,action:"favorite"})},result.addTopic=function(topic){var newTopic=new Topic(topic);return newTopic.$save()},result.getTopic=function(id){return Topic.get({id:id}).$promise},result.getHistory=function(offset,limit){return Topic.history({offset:offset,limit:limit}).$promise};var originalTextAction={update:{method:"PUT"},save:{method:"POST"},decline:{method:"PUT"},favorite:{method:"PUT"},cancel:{method:"PUT"}},OriginalText=$resource(apiUrlConfig+"/api/original_texts/:id/:action",{id:"@id",action:"@action"},originalTextAction);result.updateTopicState=function(orginalTextID,tutorID,action){var tutor={};tutor[action]={tutor_id:tutorID};var originalText=new OriginalText(tutor);return originalText.$update({id:orginalTextID,action:action})},result.correctedTopic=function(orginalTextID,correctedInfo){var originalText=new OriginalText(correctedInfo);return originalText.$save({id:orginalTextID,action:"corrected_texts"})},result.declineTopic=function(orginalTextID){var originalText=new OriginalText;return originalText.$decline({id:orginalTextID,action:"decline"})},result.favoriteTopic=function(orginalTextID){var originalText=new OriginalText;return originalText.$favorite({id:orginalTextID,action:"favorite"})},result.cancelTopic=function(orginalTextID){var originalText=new OriginalText;return originalText.$cancel({id:orginalTextID,action:"cancel"})};var correctedTextAction={feedback:{method:"PUT"}},CorrectedText=$resource(apiUrlConfig+"/api/corrected_texts/:id/:action",{id:"@id"},correctedTextAction);result.feedback=function(orginalTextID,feedback,action){var correctedText=new CorrectedText(feedback);return correctedText.$feedback({id:orginalTextID,action:action})};var organizationActions={show:{method:"GET"}},Organization=$resource(apiUrlConfig+"/api/organizations/:slug",{slug:"@slug"},organizationActions);result.getOrganization=function(slug){return(new Organization).$show({slug:slug})};var organizationMemberActions={index:{method:"GET"}},OrganizationMember=$resource(apiUrlConfig+"/api/organizations/:slug/members",{slug:"@slug"},organizationMemberActions);result.getOrganizationMembers=function(slug){return(new OrganizationMember).$index({slug:slug})};var organizationPaymentActions={index:{method:"GET"}},OrganizationPayment=$resource(apiUrlConfig+"/api/organizations/:slug/payments",{slug:"@slug"},organizationPaymentActions);result.getOrganizationPayments=function(slug){return(new OrganizationPayment).$index({slug:slug})};var reviewTextActions={index:{method:"GET"},show:{url:apiUrlConfig+"/api/review_texts/:id",method:"GET",params:{id:"@id"}},commit:{url:apiUrlConfig+"/api/review_texts/:id/commit",method:"POST",params:{id:"@id"}},uncommit:{url:apiUrlConfig+"/api/review_texts/:id/commit",method:"DELETE",params:{id:"@id"}}},ReviewText=$resource(apiUrlConfig+"/api/review_texts",{},reviewTextActions);result.getReviewTextList=function(){return(new ReviewText).$index()},result.getReviewText=function(id){return(new ReviewText).$show({id:id})},result.commitChatReview=function(id){return(new ReviewText).$commit({id:id})},result.uncommitChatReview=function(id){return(new ReviewText).$uncommit({id:id})};var chatReviewActions={},ChatReview=$resource(apiUrlConfig+"/api/review_texts/:id/reviews",{id:"@id"},chatReviewActions);return result.submitChatReview=function(id,review){return new ChatReview(review).$save({id:id})},result}]),angular.module("videoFactoryModule",["ui.bootstrap"]).factory("videoFactory",["$modal",function($modal){var result={};return result.open=function(videoUrl){$modal.open({templateUrl:"/views/directives/video.html",controller:"VideoModalInstanceCtrl",size:"lg",resolve:{videoUrl:function(){return videoUrl}}})},result}]),angular.module("videoFactoryModule").controller("VideoModalInstanceCtrl",["$scope","$modalInstance","videoUrl","$sce",function($scope,$modalInstance,videoUrl,$sce){$scope.videoIframe=$sce.trustAsHtml('<iframe frameborder="0" vspace="0" hspace="0" src="'+videoUrl+'"></iframe>'),$scope.cancel=function(){$modalInstance.dismiss("cancel")}}]),angular.module("notificationFactoryModule",["ngAudio","webStorageModule","commonFactoryModule"]).factory("notificationFactory",["ngAudio","$window","$timeout","webStorage","commonFactory","$log","apiUrlConfig","accountFactory",function(ngAudio,$window,$timeout,webStorage,commonFactory,$log,apiUrlConfig,accountFactory){function initNotification(){result.titleTitmer&&$timeout.cancel(result.titleTitmer),setTitle(defaultTitle)}function playNotification(noti){var disableNotificationSound=webStorage.local.get(commonFactory.constant.DISABLE_NOTIFICATION_SOUND);if(!disableNotificationSound)if(Notification)if("granted"!==Notification.permission)Notification.requestPermission(),audio.play();else{if(!noti)return;var notification=new Notification(noti.title,{icon:"/images/apple-touch-icon-152x152.9b7ac2cf.png",body:noti.body});notification.onclick=function(){$window.focus(),noti.onclick&&noti.onclick(),notification.close()}}else audio.play()}function setTitle(title){currentTitle=title,$window.document.title=title}function animationTitle(){seq>=currentTitle.length&&(seq=0),seq++,$window.document.title=currentTitle.substring(0,seq),result.titleTitmer=$timeout(animationTitle,300)}var result={},audio=ngAudio.load("/media/ding.mp3");result.titleTitmer=0;var defaultTitle="ChattingCat - Get instant correction of written English",currentTitle="";initNotification(),result.notification=function(eventType,accountType,noti){switch($log.debug(JSON.stringify(noti)),eventType){case"correcting":case"original_lock":("correcting"===eventType||"student"===accountType)&&("student"===accountType&&playNotification(noti),setTitle("Correcting..."),animationTitle());break;case"topic_unlocked":playNotification(noti),initNotification();break;case"original_unlock":initNotification(noti);break;case"corrected_created":setTitle("Correction arrived"),result.titleTitmer&&$timeout.cancel(result.titleTitmer),$timeout(initNotification,3e3),"student"===accountType&&playNotification(noti);break;case"topic_created":case"newchat":setTitle("A new chat arrived"),$timeout(initNotification,3e3),playNotification(noti)}};var seq=0;return result.notificationLink=function($state,noti){var id=noti.type,args=noti.args;switch(id){case"rating":return void $state.go("tutor.one-history",{topicId:args.original_text_id},{reload:!0});case"cashout":return void $state.go("my-account.cash-out-history");case"promotion":return;case"bank_charge":return void $state.go("my-account.catnip-history");case"corrected":return void $state.go("student.one-chat",{topicId:args.original_text_id,topic:void 0},{reload:!0});case"qna_question":return void $state.go("tutor.one-history",{topicId:args.original_text_id},{reload:!0});case"qna_answer":return void $state.go("student.one-chat",{topicId:args.original_text_id,topic:void 0},{reload:!0});default:return}},result.loadNotifications=function(offset,limit,success,fail){$.ajax({url:apiUrlConfig+"/api/notifications?offset="+offset+"&limit="+limit,processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){for(var i in result.notifications){var noti=result.notifications[i];("corrected"===noti.type||"qna_answer"===noti.type)&&(noti.thumbnailUrl="/images/tutor_default_avatar.fb88ac38.png",noti.args.thumbnail&&(noti.thumbnailUrl=accountFactory.getImageUrl(noti.args.thumbnail)))}success(result)},error:function(result){fail(result)}})},result}]),angular.module("pubnubFactoryModule",["configModule","socketEventModule","pubnub.angular.service"]).factory("pubnubFactory",["$q","PubNub","socketEvent","$rootScope","$window","pubnubPublishKey","pubnubSubscribeKey","pubnubSecretKey","$log","socketHeartbeatInterval","socketHeartbeatTimeout","pubnubSSL",function($q,PubNub,socketEvent,$rootScope,$window,pubnubPublishKey,pubnubSubscribeKey,pubnubSecretKey,$log,socketHeartbeatInterval,socketHeartbeatTimeout,pubnubSSL){var result={},pubnubObj=null,client=null;return result.initialized=!1,result.subscribeList=[],result.getClient=function(account,accessToken,callScope){var defer=$q.defer(),state={username:account.username,role:account.role};return result.initialized?(defer.resolve(client),defer.promise):(null===pubnubObj&&(pubnubObj=PubNub.init({publish_key:pubnubPublishKey,subscribe_key:pubnubSubscribeKey,secret_key:pubnubSecretKey,uuid:account.uuid,state:state,ssl:pubnubSSL,heartbeat:parseInt(socketHeartbeatTimeout),heartbeat_interval:parseInt(socketHeartbeatInterval)})),client={},callScope=callScope||$rootScope,client.send=function(channel,message){PubNub.ngPublish({channel:channel,message:message})},client.subscribe=function(channel,callback){result.subscribeList.push(channel),PubNub.ngSubscribe({channel:channel,state:state}),$rootScope.$on(PubNub.ngMsgEv(channel),function(ngEvent,payload){callScope.$apply(function(){callback(payload.message)})})},defer.resolve(client),defer.promise)},result}]),angular.module("socketFactoryModule",["commonFactoryModule","socketEventModule","pubnubFactoryModule"]).constant("socketType",{PUBNUB:"PUBNUB"}),angular.module("socketFactoryModule").factory("socketFactory",["accountFactory","commonFactory","$q","socketType","pubnubFactory","notificationSocketType",function(accountFactory,commonFactory,$q,socketType,pubnubFactory,notificationSocketType){var result={},socketFactory=pubnubFactory,accessToken=commonFactory.getAuth().accessToken,account=accountFactory.getInfo().info,_currentSocket=null;return result.isSupportWebSocket=function(){return!0},result.currentSocketType=notificationSocketType,result.getClient=function(callScope){var defer=$q.defer(),errorObject={};return accessToken?(null===_currentSocket?socketFactory.getClient(account,accessToken,callScope).then(function(socket){_currentSocket=socket,defer.resolve(socket)},function(){try{socketFactory.disconnect()}catch(e){}defer.reject()}):defer.resolve(_currentSocket),defer.promise):(errorObject={message:"invalid auth_token",code:"507"},defer.reject(errorObject),defer.promise)}.bind(this),result}]),angular.module("apisFactoryModule",["resourceFactoryModule"]).factory("apisFactory",["resourceFactory","apiUrlConfig","commonFactory",function(resourceFactory,apiUrlConfig,commonFactory){var result={};return result.loadTopicList=function(offset,limit,favorite){return resourceFactory.getTopicList(offset,limit,favorite)},result.getHistory=function(offset,limit){return resourceFactory.getHistory(offset,limit)},result.addTopic=function(topic){return resourceFactory.addTopic(topic)},result.getTopic=function(id){return resourceFactory.getTopic(id)},result.declineTopic=function(orginalTextID){return resourceFactory.declineTopic(orginalTextID)},result.cancelTopic=function(orginalTextID){return resourceFactory.cancelTopic(orginalTextID)},result.favoriteTopic=function(orginalTextID){return resourceFactory.favoriteTopic(orginalTextID)},result.updateTopicState=function(orginalTextID,tutorID,action){return resourceFactory.updateTopicState(orginalTextID,tutorID,action)},result.correctedTopic=function(orginalTextID,correctedInfo){return resourceFactory.correctedTopic(orginalTextID,correctedInfo)},result.feedback=function(orginalTextID,feedback,action){return resourceFactory.feedback(orginalTextID,feedback,action)},result.getOrganization=function(slug){return resourceFactory.getOrganization(slug)},result.getOrganizationMembers=function(slug){return resourceFactory.getOrganizationMembers(slug)},result.getOrganizationPayments=function(slug){return resourceFactory.getOrganizationPayments(slug)},result.loadReviewTextList=function(){return resourceFactory.getReviewTextList()},result.getReviewText=function(id){return resourceFactory.getReviewText(id)},result.submitChatReview=function(id,review){return resourceFactory.submitChatReview(id,review)},result.commitChatReview=function(id){return resourceFactory.commitChatReview(id)},result.uncommitChatReview=function(id){return resourceFactory.uncommitChatReview(id)},result.getTutorInfo=function(tutorId,success,fail){$.ajax({url:apiUrlConfig+"/api/tutor_infos/"+tutorId,processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){success(result)},error:function(result){fail(result)}})},result.setTutorInfo=function(exist,tutor,success,fail){var timezone=moment.tz(tutor.timezone_name);tutor.timezone_offset=Math.ceil(timezone._offset/60);var method="POST",tutorInfoUrl=apiUrlConfig+"/api/tutor_infos";exist&&(method="PUT",tutorInfoUrl=tutorInfoUrl+"/"+tutor.user_id);var tutor_info=JSON.parse(JSON.stringify(tutor));tutor_info.careers_attributes=tutor_info.careers,tutor_info.educations_attributes=tutor_info.educations,tutor_info.speciality=tutor_info.speciality.toString(),delete tutor_info.careers,delete tutor_info.educations,delete tutor_info.user,delete tutor_info.resume_url,delete tutor_info.resume_file_name,$.ajax({url:tutorInfoUrl,processData:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify({tutor_info:tutor_info}),dataType:"json",type:method,withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){success(result)},error:function(result){fail(result)}})},result.uploadResume=function(path,user_id,success,fail){var fd=new FormData;fd.append("resume",path),fd.append("ext","pdf"),$.ajax({url:apiUrlConfig+"/api/tutor_infos/"+user_id+"/upload_resume",processData:!1,contentType:!1,data:fd,type:"PUT",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){success(result)},error:function(result){fail(result)}})},result}]),angular.module("chattingCatApp").factory("advancedOptionsFactory",function(){var result={};return result.option=[{
key:"purpose",category:"Type of Chat",items:[{id:1,name:"Business",desc:"Email, Document, Marketing Material, Slides, Presentation"},{id:2,name:"Academic",desc:"Essay, Report, Research Paper, Manuscript"},{id:3,name:"Recruitment / Admission",desc:"Cover Letter, Reference Letter, Resume, Essay"},{id:4,name:"Test Prep",desc:"TOEIC, TOEFL, IELTS, GMAT"},{id:5,name:"Social Media",desc:"Blog, Chats, Facebook"},{id:6,name:"Script",desc:"Presentation, Interview, Speech"}]},{key:"english_type",category:"Type of English",items:[{id:1,name:"American English"},{id:2,name:"British English"}]},{key:"tone",category:"Tone",items:[{id:1,name:"Formal"},{id:2,name:"Casual"}]}],result.getOptionCategory=function(key){for(var i=-1,cnt=result.option.length;++i<cnt;)if(result.option[i].key===key)return result.option[i].category;return"undefinded"},result.getOptionName=function(key,id){for(var i=-1,cnt=result.option.length;++i<cnt;)if(result.option[i].key===key)for(var j=-1,subCnt=result.option[i].items.length;++j<subCnt;)if(result.option[i].items[j].id===parseInt(id))return result.option[i].items[j].name;return"undefined"},result.prevOption=[{key:"purpose",category:"Type of Chat",items:[{id:1,name:"Business"},{id:2,name:"Academic Assignment"},{id:3,name:"Test Prep. (TOEFL, TOEIC)"},{id:4,name:"Online Content (Blog, Facebook, Twitter)"},{id:5,name:"Other"}]},{key:"english_type",category:"Type of English",items:[{id:6,name:"American English"},{id:7,name:"British English"}]},{key:"tone",category:"Tone",items:[{id:8,name:"Formal"},{id:9,name:"Casual"}]}],result.getPrevAdvancedOptionName=function(key){for(var i=-1,cnt=result.prevOption.length;++i<cnt;)if(result.prevOption[i].key===key)return result.prevOption[i].category;return""},result.getPrevAdvancedOptionItemName=function(key,itemId){for(var i=-1,cnt=result.prevOption.length;++i<cnt;)if(result.prevOption[i].key===key)for(var j=-1,subCnt=result.prevOption[i].items.length;++j<subCnt;)if(result.prevOption[i].items[j].id===parseInt(itemId))return result.prevOption[i].items[j].name;return"Not Selected"},result.convertPrevAdvancedOptionFormat=function(opt){var arr=Object.keys(opt).map(function(k){var result={key:k,itemId:opt[k]};return result});return arr},result}),angular.module("modalServiceModule",["ui.bootstrap","ngSanitize"]).service("modalService",["$modal",function($modal){var result={};return result.open=function(modalInfo){var option={title:"",content:"",isOnlyClose:!0,closeBtnName:"Close",okBtnName:"OK",alertIcon:!1,closeFunc:function(){},okFunc:function(){}};angular.extend(option,modalInfo),$modal.open({templateUrl:"/views/directives/modal.html",controller:"LangSupportModalInstanceCtrl",resolve:{data:function(){return option}}})},result}]),angular.module("modalServiceModule").controller("LangSupportModalInstanceCtrl",["$scope","$modalInstance","data",function($scope,$modalInstance,data){$scope.data=data,$scope.close=function(){data.closeFunc(),$modalInstance.close()},$scope.ok=function(){data.okFunc(),$modalInstance.close()}}]),angular.module("anchorSmoothScrollModule",[]).service("anchorSmoothScroll",function(){this.scrollTo=function(eID,height,banner){function currentYPosition(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function elmYPosition(eID){for(var elm=document.getElementById(eID),y=elm.offsetTop,node=elm;node.offsetParent&&node.offsetParent!=document.body;)node=node.offsetParent,y+=node.offsetTop;return y}var startY=currentYPosition(),stopY=elmYPosition(eID);stopY-=banner>startY?2*height:height;var distance=stopY>startY?stopY-startY:startY-stopY;if(100>distance)return void scrollTo(0,stopY);var speed=Math.round(distance/100);speed>=20&&(speed=20);var step=Math.round(distance/25),leapY=stopY>startY?startY+step:startY-step,timer=0;if(stopY>startY)for(var i=startY;stopY>i;i+=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY+=step,leapY>stopY&&(leapY=stopY),timer++;else for(var i=startY;i>stopY;i-=step)setTimeout("window.scrollTo(0, "+leapY+")",timer*speed),leapY-=step,stopY>leapY&&(leapY=stopY),timer++}}),angular.module("chattingCatApp").controller("Oauth.CallbackController",["commonFactory","accountFactory","$window","serviceUrlConfig","isProduction",function(commonFactory,accountFactory,$window,serviceUrlConfig,isProduction){var accessToken=commonFactory.getUrlParam("access_token"),tokenType=commonFactory.getUrlParam("token_type"),expiresIn=commonFactory.getUrlParam("expires_in");if(!accessToken)return void($window.location.href=commonFactory.getLoginUrl());isProduction&&document.referrer.indexOf("sign_up")>=0&&(window.fbq&&fbq("track","CompleteRegistration"),"function"==typeof window.google_trackConversion&&window.google_trackConversion({google_conversion_id:974372961,google_conversion_label:"cG7FCJatmmYQ4YDP0AM",google_remarketing_only:!1,google_conversion_format:3})),commonFactory.saveAuth(accessToken,tokenType,expiresIn);var promise=accountFactory.loadInfo();promise.then(function(){$window.location.href=serviceUrlConfig+"/"+accountFactory.getRoleHome().replace(/\./g,"/")},function(){$window.location.href=commonFactory.getLoginUrl()})}]),angular.module("chattingCatApp").config(["$logProvider","isProduction",function($logProvider,isProduction){$logProvider.debugEnabled(!isProduction)}]).controller("Root.IndexController",["$state","$window","accountFactory","oauthClientIdConfig","accountUrlConfig","$anchorScroll","$location","$scope","$timeout","oauthClientDefaultScopeConfig","commonFactory","anchorSmoothScroll","serviceUrlConfig",function($state,$window,accountFactory,oauthClientIdConfig,accountUrlConfig,$anchorScroll,$location,$scope,$timeout,oauthClientDefaultScopeConfig,commonFactory,anchorSmoothScroll,serviceUrlConfig){function logMixpanel(event,url){accountFactory.getInfo()&&mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track(event,{Path:url})}$scope.myAccountMenuOpenCss="",$("#mobile-menu").click(function(){$scope.myAccountMenuOpenCss=""===$scope.myAccountMenuOpenCss?"open":"","open"===$scope.myAccountMenuOpenCss?$(".mobile-menus").css("display","block"):($(".mobile-menus").css("display","none"),$scope.myAccountMenuOpenCss="")}),$scope.login=function(){$window.location.href=commonFactory.getLoginUrl()},$scope.join=function(){$window.location.href=commonFactory.getJoinUrl()},$scope.reload=function(){$window.location.reload(!0)},$scope.currentLanguage=commonFactory.getLangDisplay(),$scope.langList=commonFactory.langList,$scope.videoUrl=commonFactory.getLangVideoUrl(),$scope.isOpenLanguage=!1,$scope.setLang=function(langCode){$scope.isOpenLanguage=!0,$scope.videoUrl=commonFactory.getLangVideoUrl(),commonFactory.setLangCode(langCode),$state.go($state.current,{},{reload:!0})},$scope.showLangChange=!1,$scope.scrollPos=0,$window.onscroll=function(){$scope.scrollPos=document.body.scrollTop||document.documentElement.scrollTop||0,$scope.$apply()},$("a.fancybox-media").click(function(){$("a.fancybox-media").fancybox($window.innerWidth<768?{width:300,height:200,type:"iframe",fitToView:!1}:{width:600,height:400,type:"iframe",fitToView:!1})}),$scope.topBarHeight=55,$scope.topBannerHeight=600,$scope.topNavHeight=55,$scope.goToOverview=function(id){anchorSmoothScroll.scrollTo(id,$scope.topNavHeight,$scope.topBannerHeight),logMixpanel("Link Click","/"+id)};var frame=$("#hsscroll1"),wrap=frame.parent();frame.sly({horizontal:!0,itemNav:"basic",smart:0,scrollBy:1,mouseDragging:1,swingSpeed:.2,dragHandle:1,clickBar:1,elasticBounds:1,speed:600,startAt:0}),wrap.find(".toStart").on("click",function(){var item=$(this).data("item");frame.sly("toStart",item)}),wrap.find(".toEnd").on("click",function(){var item=$(this).data("item");frame.sly("toEnd",item)}),$scope.$on("$viewContentLoaded",function(){logMixpanel("Page Viewed","/")}),$scope.goToBusiness=function(){$window.location.href=serviceUrlConfig+"/business"},void 0!==$location.search().rc&&("localhost"===document.domain?Cookies.set("rc",$location.search().rc):Cookies.set("rc",$location.search().rc,{domain:document.domain.split(".").slice(-2).join(".")}))}]),angular.module("chattingCatApp").controller("Account.ConfirmationController",["$scope","commonFactory","accountFactory","$state","$window",function($scope,commonFactory,accountFactory,$state,$window){$scope.accountType=accountFactory.getUserRole();var token=commonFactory.getUrlParam("confirmation_token"),distinct_id=commonFactory.getUrlParam("distinct_id");$scope.isAuthenticated=!1,$scope.showButton=!1,$scope.message="",$scope.buttonLabel="Go mycc",$scope.transUrl="login",$scope.invalidVerification=!1;var promise=accountFactory.loadInfo();promise.then(function(){return accountFactory.confirmation(token,distinct_id)},function(){return accountFactory.confirmation(token,distinct_id)}).then(function(){return accountFactory.loadInfo()},function(){return accountFactory.loadInfo()}).then(function(){accountFactory.isLogin()?($scope.$broadcast("reloadNav",{}),$scope.buttonLabel="START",$scope.showButton=!0):($scope.buttonLabel="LOGIN",$scope.showButton=!0)},function(){accountFactory.isLogin()?($scope.buttonLabel="START",$scope.showButton=!0,accountFactory.loadInfo()):($scope.buttonLabel="LOGIN",$scope.showButton=!0)}),$scope.nextAction=function(){accountFactory.isLogin()?$state.go(accountFactory.getRoleHome()):$window.location.href=commonFactory.getLoginUrl()}}]),angular.module("chattingCatApp").controller("Account.MainController",["$scope","$state","accountFactory","routeName","isProduction",function($scope,$state,accountFactory,routeName,isProduction){$scope.currentPath=$state.current.name,$scope.isProduction=isProduction,$scope.isPremium=accountFactory.isPremium(),$scope.accountType=accountFactory.getUserRole(),$scope.accountInfo=accountFactory.getInfo().info;var defaultImg="/images/default_profile.1c98470a.png";$scope.profileUrl=""===accountFactory.getProfileUrl()?defaultImg:accountFactory.getProfileUrl(),$scope.$on("profileHasChanged",function(event,data){$scope.profileUrl=data}),$scope.$on("$stateChangeStart",function(next,current){$scope.currentPath=current.name}),$scope.menuClass="",$scope.toggleMenu=function(){$scope.menuClass=""===$scope.menuClass?"active":""},$scope.goToInviteFriend=function(){$("body").scrollTop(0),$state.go(routeName.MY_ACCOUNT_REFERRAL)}}]);var dataURItoBlob=function(dataURI){for(var binary=atob(dataURI.split(",")[1]),mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],array=[],i=0;i<binary.length;i++)array.push(binary.charCodeAt(i));return new Blob([new Uint8Array(array)],{type:mimeString})};angular.module("chattingCatApp").directive("ngFileSelect",function(){return{link:function($scope,elem){var reader=new FileReader;reader.onload=function(e){$scope.myImage=e.target.result,$scope.$apply()},elem.on("change",function(){reader.readAsDataURL(elem[0].files[0])})}}}),angular.module("chattingCatApp").controller("Account.MyAccountController",["$scope","$log","commonFactory","accountFactory","apiUrlConfig","langTextFactory","modalService",function($scope,$log,commonFactory,accountFactory,apiUrlConfig,langTextFactory,modalService){$scope.profileUrl=""===accountFactory.getProfileUrl()?"/images/default_profile.1c98470a.png":accountFactory.getProfileUrl(),$scope.myImage="",$scope.myCroppedImage="",$scope.accountType=accountFactory.getUserRole(),$scope.account=accountFactory.getInfo().info,$scope.user={name:$scope.account.name},$scope.$on("profileHasChanged",function(event,data){$scope.profileUrl=data}),$scope.updateUser=function(){$scope.myImage.length>0&&$scope.myCroppedImage.length>0?$scope.uploadProfile():$scope.updateUserName()},$scope.uploadProfile=function(){var blob=dataURItoBlob($scope.myCroppedImage),fd=new FormData;fd.append("avatar",blob),fd.append("ext","jpg"),$.ajax({url:apiUrlConfig+"/api/users/"+accountFactory.getInfo().info.id+"/upload_profile",processData:!1,contentType:!1,data:fd,type:"PUT",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(){$scope.myImage="",$scope.myCroppedImage="";var promise=accountFactory.loadInfo();promise.then(function(){$scope.$emit("profileHasChanged",accountFactory.getProfileUrl())},function(){}),$scope.updateUserName()},error:function(){var modalInfo={title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"account.profile.error.upload.profile"),isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0};modalService.open(modalInfo)}})},$scope.updateUserName=function(){if($scope.account.name!==$scope.user.name){var param={name:$scope.user.name},promise=accountFactory.updateAccount({user:param},accountFactory.getInfo().info.id);promise.then(function(){var promise=accountFactory.loadInfo();promise.then(function(){var modalInfo={title:"Success",content:"User update Completed.",isOnlyClose:!0,closeBtnName:"Close"};modalService.open(modalInfo)},function(){}),$scope.userForm.$dirty=!1},function(e){var errors=422===e.status?langTextFactory.get(commonFactory.getLangCode(),"account.profile.error.update"):e.statusText,modalInfo={title:"Fail",content:errors,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0};modalService.open(modalInfo)})}}}]),angular.module("chattingCatApp").controller("Account.TutorInfoController",["$scope","$window","$http","commonFactory","accountFactory","langTextFactory","modalService","apisFactory",function($scope,$window,$http,commonFactory,accountFactory,langTextFactory,modalService,apisFactory){function alertEmptyInfo(){modalService.open({title:"Important Notice!",content:"You must update your profile information including a picture by June 30th.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0}),$scope.$apply()}var accountType=accountFactory.getUserRole();"student"===accountType&&$window.history.back(),$(document).ready(function(){$("#uploadBtn").change(function(){var path=$(this).val();$("#uploadFile").text(path.substring(path.lastIndexOf("\\")+1,path.length))})}),$scope.degreeList=commonFactory.degreeList,$scope.englishList=commonFactory.englishList,$scope.countryList=commonFactory.countryList,$scope.studyOptions=commonFactory.studyOptions,$scope.account=accountFactory.getInfo(),$scope.tutor={user_id:0,educations:[],careers:[],speciality:[],resume_url:"",payment:"p",paypal_email:"",exist:!1,agreement:1},$scope.$on("$viewContentLoaded",function(){$scope.getTutorInfo()}),$scope.getTutorInfo=function(){apisFactory.getTutorInfo($scope.account.info.id,function(success){angular.equals({},success)||($scope.tutor=success.info,$scope.tutor.exist=!0,void 0===$scope.tutor.careers&&($scope.tutor.careers=[]),void 0===$scope.tutor.educations&&($scope.tutor.educations=[]),(void 0===$scope.tutor.speciality||'[""]'===JSON.stringify($scope.tutor.speciality))&&($scope.tutor.speciality=[]),$scope.tutor.payment=""!==$scope.tutor.paypal_email?"p":"c"),$scope.$apply()},function(){alertEmptyInfo()})},$scope.addEducationRow=function(){$scope.tutor.educations.push({university_name:"",degree:"",major:"",from_year:"",to_year:""})},$scope.removeEducationRow=function(index){$scope.tutor.educations.splice(index,1)},$scope.addCareerRow=function(){$scope.tutor.careers.push({name:"",position:"",from_year:"",to_year:""})},$scope.removeCareerRow=function(index){$scope.tutor.careers.splice(index,1)},$scope.updateStudyOption=function(d){var idx=$scope.tutor.speciality.indexOf(d);idx>-1?$scope.tutor.speciality.splice(idx,1):$scope.tutor.speciality.push(d)},$scope.getDisabled=function(d){return $scope.tutor.speciality.length>=3&&-1===$scope.tutor.speciality.indexOf(d)},$scope.getCheckedStudyOption=function(optionName){return $scope.tutor.speciality.indexOf(optionName)>-1},$scope.getCheckedAgreement=function(){return 1===$scope.tutor.agreement},$scope.changeAgreement=function(){1===$scope.tutor.agreement?$scope.tutor.agreement=0:$scope.tutor.agreement=1},$scope.tutorFormSubmitted=!1,$scope.tutorCareerOrCompany=!0,$scope.submitTutorInfo=function(isValid,tutor){$scope.tutorFormSubmitted=!0,$scope.tutor.speciality.length<1||isValid&&$scope.updateTutorInfo(tutor)},$scope.resumeFile=null,$scope.uploadResume=function(){$scope.resumeFile&&apisFactory.uploadResume($scope.resumeFile,$scope.account.info.id,function(success){$scope.tutor.resume_url=success.resume_url,modalService.open({title:"Success",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.success"),isOnlyClose:!0,closeBtnName:"Close"})},function(){modalService.open({title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.fail"),isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})},$scope.updateTutorInfo=function(tutor){apisFactory.setTutorInfo($scope.tutor.exist,tutor,function(){$scope.tutorFormSubmitted=!1,$scope.tutor.exist=!0,$scope.resumeFile?$scope.uploadResume():(modalService.open({title:"Success",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.success"),isOnlyClose:!0,closeBtnName:"Close"}),$scope.$apply())},function(){$scope.tutorFormSubmitted=!1,modalService.open({title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.fail"),closeBtnName:"Close",alertIcon:!0})})}}]),angular.module("chattingCatApp").directive("pwCheck",function(){return{require:"ngModel",link:function(scope,elem,attrs,ctrl){var firstPassword="#"+attrs.pwCheck;elem.add(firstPassword).on("keyup",function(){scope.$apply(function(){var v=elem.val()===$(firstPassword).val();ctrl.$setValidity("is_match",v)})})}}}),angular.module("chattingCatApp").controller("Account.SettingsController",["$scope","$log","commonFactory","accountFactory","webStorage","langTextFactory","modalService","apiUrlConfig","$window","serviceUrlConfig",function($scope,$log,commonFactory,accountFactory,webStorage,langTextFactory,modalService,apiUrlConfig,$window,serviceUrlConfig){$scope.accountType=accountFactory.getUserRole(),$scope.account=accountFactory.getInfo().info,$scope.user={name:$scope.account.name,currentPassword:"",password:""},$scope.lang={"short":langTextFactory.get(commonFactory.getLangCode(),"account.profile.password.short.error"),sixChar:langTextFactory.get(commonFactory.getLangCode(),"account.profile.password.6char.error"),match:langTextFactory.get(commonFactory.getLangCode(),"account.profile.password.match.error")},$scope.notificationDesc={sound:{tutor:"Receive a sound notification of new chats.",student:langTextFactory.get(commonFactory.getLangCode(),"account.setting.notification.sound.desc")},letter:{tutor:"Receive emails about general promotions, updates, news, and surveys.",student:langTextFactory.get(commonFactory.getLangCode(),"account.setting.notification.letter.desc")}},$scope.disableSubscribe=$scope.account.subscribe;var disableNotificationSound=webStorage.local.get(commonFactory.constant.DISABLE_NOTIFICATION_SOUND);$scope.notificationSound=!disableNotificationSound,$scope.updateNotification=function(){if(webStorage.local.add(commonFactory.constant.DISABLE_NOTIFICATION_SOUND,!$scope.notificationSound),$scope.disableSubscribe!==$scope.account.subscribe){var subscribePromise=accountFactory.subscribe(accountFactory.getInfo().info.id);subscribePromise.then(function(){$scope.account.subscribe=$scope.disableSubscribe,modalService.open({title:"Success",content:langTextFactory.get(commonFactory.getLangCode(),"account.setting.notification.update"),isOnlyClose:!0,closeBtnName:"Close"})},function(){$scope.disableSubscribe=$scope.account.subscribe,modalService.open({title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"account.setting.notification.update.fail"),isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})}else modalService.open({title:"Success",content:langTextFactory.get(commonFactory.getLangCode(),"account.setting.notification.update"),isOnlyClose:!0,closeBtnName:"Close"})},$scope.updatePassword=function(isValid){if(isValid){if($scope.userForm.currentPassword.$dirty=!0,$scope.userForm.currentPassword.$error.minlength||$scope.userForm.password.$dirty&&$scope.userForm.password.$error.minlength)return void $scope.userForm.currentPassword.$setValidity("currentPassword",!1);var param={name:$scope.user.name,current_password:$scope.user.currentPassword,password:$scope.user.password},promise=accountFactory.updateAccount({user:param},accountFactory.getInfo().info.id);promise.then(function(){modalService.open({title:"Success",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.success"),isOnlyClose:!0,closeBtnName:"Close"}),$scope.userForm.$dirty=!1,$scope.userForm.currentPassword.$dirty=!1,$scope.user.currentPassword="",$scope.user.password="",$scope.user.confirmPassword=""},function(e){var errors=422===e.status?langTextFactory.get(commonFactory.getLangCode(),"account.setting.error"):e.data.message;modalService.open({title:"Success",content:errors,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})}},$scope.unregister=function(){modalService.open({title:"Warning!",content:langTextFactory.get(commonFactory.getLangCode(),"account.setting.unregister.warning"),isOnlyClose:!1,okBtnName:"Delete Account",closeBtnName:"Close",okFunc:function(){$.ajax({url:apiUrlConfig+"/api/users/"+accountFactory.getInfo().info.id+"/unregister",type:"PUT",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(){accountFactory.clearAccount(),$window.location.href=serviceUrlConfig},error:function(){modalService.open({title:"Error",content:"Fail to remove your account. Please, contact us.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})}})}})}}]),angular.module("chattingCatApp").controller("Account.CouponController",["$scope","$window","commonFactory","accountFactory","modalService",function($scope,$window,commonFactory,accountFactory,modalService){$scope.account=accountFactory.getInfo().info,$scope.code1="",$scope.code2="",$scope.code3="",$scope.code4="",$scope.enroll=function(){var code=$scope.code1+$scope.code2+$scope.code3+$scope.code4;if(16!==code.length)return void modalService.open({title:"Error",content:"Please check your coupon code.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0});var promise=accountFactory.enrollCoupon(code);promise.then(function(d){modalService.open(d.status?{title:"Success",content:d.quantity+" Catnips have been charged.",isOnlyClose:!0,closeBtnName:"Close",closeFunc:function(){$window.location.reload()}}:{title:"Warning",content:d.message,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})},function(){$window.alert("error")})};var offset=0,limit=5;$scope.currentPageNo=1,$scope.totalPageCnt=1,$scope.couponList=[],$scope.loadCouponList=function(){var promise=accountFactory.getCouponList(offset,limit);promise.then(function(d){$scope.couponList=d.coupons,d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit)},function(){})},$scope.loadCouponList(),$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadCouponList()}}}]),angular.module("chattingCatApp").controller("Account.ReferralController",["$scope","$state","$window","$location","$timeout","serviceUrlConfig","accountFactory","routeName",function($scope,$state,$window,$location,$timeout,serviceUrlConfig,accountFactory,routeName){if($location.search().close){var daddy=window.self;return daddy.opener=window.self,void daddy.close()}var offset=0,limit=5;$scope.currentPageNo=1,$scope.totalPageCnt=1,$scope.totalCnt=0,$scope.discount_rate=0,$scope.referralUrl="",$scope.referralJoinList=[],$scope.referralCode="";var sendEmailStatus="";$scope.language="",$scope.$watch("language",function(value){$scope.referralUrl=serviceUrlConfig+"/"+value+"?rc="+$scope.referralCode}),accountFactory.referralCode().then(function(d){$scope.referralCode=d.code,$scope.referralUrl=serviceUrlConfig+"/?rc="+d.code}),$scope.sendReferralEmail=function(email,isResend){if(sendEmailStatus=angular.element(document.querySelector("#sendEmailStatus")),void 0===email||""===email)return void sendEmailStatus.text("Please enter your friend's email.");if(-1===email.indexOf("@"))return void sendEmailStatus.text("Sorry, this is not a valid email format.");var promise=accountFactory.sendReferralEmail(email);promise.then(function(rs){rs.status?isResend?$("#"+email.replace("@","").replace(".","")).text("Sent!"):($scope.referralJoinList.unshift(rs.data),sendEmailStatus.text("Sent! Thank you.")):sendEmailStatus.text("Your friend already has an account with ChattingCat.")})},$scope.goToBuyCatnip=function(){$("body").scrollTop(0),$state.go(routeName.STUDENT_BUY_CATNIP)},$scope.loadReferralJoin=function(){var promise=accountFactory.getReferralJoinList(offset,limit);promise.then(function(d){$scope.referralJoinList=d.referral_list,$scope.discount_rate=d.discount_rate,$scope.totalCnt=d.meta.paging.total,d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit)},function(){})},$scope.loadReferralJoin(),$scope.getSeq=function(index){return $scope.totalCnt-index-($scope.currentPageNo-1)*limit},$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadReferralJoin()}}}]),angular.module("chattingCatApp").controller("Account.NotificationCenterController",["$scope","$state","commonFactory","$log","notificationFactory",function($scope,$state,commonFactory,$log,notificationFactory){$scope.notificationList=[],$scope.isEmpty=!1;var limit=5,offset=0;$scope.currentPageNo=1,$scope.totalPageCnt=1,$scope.currentPageNo>1&&(offset=($scope.currentPageNo-1)*limit),$scope.loadNotifications=function(){notificationFactory.loadNotifications(offset,limit,function(result){$log.debug("notification center:"+JSON.stringify(result)),$scope.notificationList=result.notifications,result.length<1&&($scope.isEmpty=!0),result.meta.total%limit===0?($scope.totalPageCnt=result.meta.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(result.meta.total/limit),$scope.$apply()},function(result){$log.debug("notification center-fail!:"+JSON.stringify(result))})},$scope.loadNotifications(),$scope.link=function(noti){notificationFactory.notificationLink($state,noti)},$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadNotifications()}}}]),angular.module("chattingCatApp").controller("Footer.ContactUsController",["$scope","commonFactory","accountFactory","$state",function($scope,commonFactory,accountFactory,$state){var account=accountFactory.getInfo().info;$scope.isLogin=accountFactory.isLogin(),$scope.completed=!1,$scope.feedback={},$scope.feedback.name=account?account.name:"",$scope.feedback.email=account?account.email:"",$scope.feedback.subject="ChattingCat Web Issue",$scope.feedback.message="",$scope.submitted=!1,$scope.submitFeedback=function(valid){if($scope.submitted=!0,valid){$scope.completed=!0;var promise=accountFactory.contactUs($scope.feedback);promise.then(function(){},function(){})}},$scope.redirectHome=function(){$state.go(accountFactory.getRoleHome())}}]),angular.module("chattingCatApp").controller("Footer.AboutUsController",["$scope","$window","serviceUrlConfig",function($scope,$window,serviceUrlConfig){$scope.redirectTo=function(path){$window.location.href=serviceUrlConfig+path}}]),function(){"use strict";angular.module("chattingCatApp").controller("Footer.FaqController",["$scope","commonFactory",function($scope,commonFactory){var $groups=$(".panel-group"),$leftTabs=$(".nav-sidebar a");$leftTabs.each(function(seq){$(this).click(function(){return $leftTabs.removeClass("active"),$(this).addClass("active"),$groups.hide(),$groups.eq(seq).show(),!1})}),$scope.lang=commonFactory.getLangCode()}])}(),angular.module("chattingCatApp").controller("Footer.SamplesController",["$scope","$window","commonFactory","accountFactory",function($scope,$window,commonFactory,accountFactory){$scope.join=function(){$window.location.href=commonFactory.getJoinUrl()},$scope.isLogin=accountFactory.isLogin()}]),angular.module("chattingCatApp").controller("Footer.BusinessController",["$scope","$window","commonFactory","accountFactory",function($scope,$window,commonFactory,accountFactory){$scope.join=function(){$window.location.href=commonFactory.getJoinUrl()},$scope.isLogin=accountFactory.isLogin()}]),angular.module("chattingCatApp").controller("Footer.BecomeATutorController",["$scope","commonFactory","$log","$window","accountFactory",function($scope,commonFactory,$log,$window,accountFactory){$scope.isLogin=accountFactory.isLogin(),$scope.join=function(){$window.location.href=commonFactory.getRoleJoinUrl("tutor")}}]),angular.module("chattingCatApp").controller("Student.MainController",["$rootScope","$scope","$location","commonFactory","accountFactory","socketFactory","$window","socketEvent","notificationFactory","$timeout","$state","socketHeartbeatInterval","langTextFactory","$log",function($rootScope,$scope,$location,commonFactory,accountFactory,socketFactory,$window,socketEvent,notificationFactory,$timeout,$state,socketHeartbeatInterval,langTextFactory,$log){function socketConfig(){socketFactory.getClient($scope).then(function(socket){socketClient=socket,socketClient.subscribe($scope.account.id+"-topics",function(message){$log.debug("student-main="+JSON.stringify(message));var recipient=message.recipient,action=message.event_type;if(parseInt(recipient)===parseInt(accountFactory.getInfo().info.id))switch(action){case"diff_created":$scope.$broadcast(socketEvent.topicUpdatedBroadcasted,message);break;case"topic_corrected":var noti={title:"ChattingCat",body:langTextFactory.get(commonFactory.getLangCode(),"notification.correction.arrived"),onclick:function(){$state.go("student.one-chat",{topicId:message.original_text_id
},{reload:!0})}};notificationFactory.notification("corrected_created","student",noti),$scope.$broadcast(socketEvent.topicUpdatedBroadcasted,message),$rootScope.$broadcast("reloadAccount");break;case"topic_correcting":$scope.$broadcast(socketEvent.realtimeCorrection,message);break;case"topic_updated":notificationFactory.notification(message.event_type,"student"),$scope.$broadcast(socketEvent.topicUpdatedBroadcasted,message),$rootScope.$broadcast("reloadAccount")}})},function(){socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))})}function checksocketConnection(){++socketReconnectedCnt<=3?(socketConfig(),socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))):$scope.$broadcast("controlPolling",{isPolling:!0})}$scope.accountType=accountFactory.getUserRole(),$scope.account=accountFactory.getInfo().info,$scope.currentPath=$state.current.name;var socketClient,socketCheckTimerIDList=[],socketCheckTime=1e3*parseInt(socketHeartbeatInterval)+2e3,socketReconnectedCnt=0;socketFactory.isSupportWebSocket()?socketConfig():$scope.$broadcast("controlPolling",{isPolling:!0}),$scope.$on(socketEvent.heartBeatBroadcasted,function(){for(var i=-1,cnt=socketCheckTimerIDList.length;++i<cnt;)$timeout.cancel(socketCheckTimerIDList[i]);socketReconnectedCnt=0,socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))}),$scope.$on("$stateChangeStart",function(next,current){$scope.currentPath=current.name})}]),angular.module("chattingCatApp").controller("Student.ChatController",["$rootScope","$scope","apisFactory","$filter","$timeout","socketEvent","$q","accountFactory","$anchorScroll","advancedOptionsFactory","$window","webStorage","commonFactory","modalService",function($rootScope,$scope,apisFactory,$filter,$timeout,socketEvent,$q,accountFactory,$anchorScroll,advancedOptionsFactory,$window,webStorage,commonFactory,modalService){function initList(newTopics,isClear){var result=[],i=0,cnt=0;if(newTopics)for(cnt=newTopics.length,i=-1;++i<cnt;)result.push($filter("parseTopic")(newTopics[i]));if(0===$scope.topicList.length||isClear)$scope.topicList=result;else for(i=-1,cnt=newTopics.length;++i<cnt;)newTopics[i].id!==$scope.topicList[i].id&&$scope.topicList.splice(i,1,newTopics[i]),i>=$scope.topicList.length?$scope.topicList.push(result[i]):($scope.topicList[i].corrected_texts.length!==newTopics[i].corrected_texts.length||$scope.topicList[i].state!==newTopics[i].state)&&$scope.topicList.splice(i,1,result[i])}$scope.accountType=accountFactory.getUserRole(),$scope.$on("$viewContentLoaded",function(){mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Page Viewed",{Path:"/student/index"});var modalInfo={};modalInfo.title="Announcement - Service Closure",modalInfo.content="We are sorry. ChattingCat's service will shut down on May 14th, 2017, 23:59:59 Eastern Time. More details, including Catnip refund policy, has been sent via email.",modalService.open(modalInfo)}),$scope.visibleSearch={visibility:"hidden"};var pollingTimer,offset=0,limit=5,pollingTime=3e4;$scope.catnipPerText=70,$scope.maxContentLength=2100,$scope.topicList=[],$scope.isEmptyChatShow=$scope.topicList&&0===$scope.topicList.length?!0:!1,$scope.emptyChatDisplayStyle={},$scope.currentPageNo=commonFactory.getPage(),$scope.totalPageCnt=1,$scope.topicComment="",$scope.isAllVaildContent=!1,$scope.isPolling=!1,$scope.isGetTopicProgress=!1,$scope.search="",$scope.noSearchResultShow=!1,$scope.favorite=commonFactory.getFavorite(),$scope.currentPageNo>1&&(offset=($scope.currentPageNo-1)*limit);var list=webStorage.session.get(commonFactory.constant.CHAT_LIST);list&&initList(angular.fromJson(list),!0),$scope.ShowFavorite=function(){$scope.favorite=!commonFactory.getFavorite(),commonFactory.saveFavorite($scope.favorite),$scope.currentPageNo=1,limit=5,offset=0,$scope.loadChat(!0)},$scope.$on("controlPolling",function(event,params){params.isPolling?($scope.isPolling=!0,pollingTimer||$scope.loadChat()):($scope.isPolling=!1,pollingTimer&&$timeout.cancel(pollingTimer))}),$scope.loadChat=function(isClear){if(!$scope.isGetTopicProgress){$scope.isGetTopicProgress=!0;var defered=$q.defer();commonFactory.showWaiting();var promise=apisFactory.loadTopicList(offset,limit,$scope.favorite?1:0);return promise.then(function(d){webStorage.session.add(commonFactory.constant.CHAT_LIST,JSON.stringify(d.topics)),initList(d.topics,isClear),d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit),$scope.isEmptyChatShow=$scope.topicList&&0===$scope.topicList.length&&!$scope.isNewChatBoxShow,$scope.emptyChatDisplayStyle={visibility:"visible"},$scope.isGetTopicProgress=!1,$scope.isPolling&&(pollingTimer=$timeout($scope.loadChat,pollingTime)),commonFactory.hideWaiting(),defered.resolve()},function(){commonFactory.hideWaiting(),defered.reject()}),defered.promise}},$scope.loadChat(),$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(pollingTimer&&$timeout.cancel(pollingTimer),moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadChat(!0)}},$scope.$watch("currentPageNo",function(){commonFactory.savePage($scope.currentPageNo)})}]),angular.module("chattingCatApp").controller("Student.NewChatController",["$rootScope","$scope","$state","apisFactory","$filter","$timeout","socketEvent","$q","accountFactory","$anchorScroll","advancedOptionsFactory","$window","webStorage","commonFactory","modalService","_","isProduction",function($rootScope,$scope,$state,apisFactory,$filter,$timeout,socketEvent,$q,accountFactory,$anchorScroll,advancedOptionsFactory,$window,webStorage,commonFactory,modalService,_,isProduction){function calcCatnip(){if(0===$scope.topicContent.length&&0===$scope.topicComment.length)return 0;var catnip=Math.ceil($scope.topicContent.length/$scope.catnipPerText);return $scope.topicComment.length>0&&catnip++,catnip}var constant={TOPIC_CONTENT:"topicContent"};$scope.isPremium=accountFactory.isPremium(),$scope.accountType=accountFactory.getUserRole(),$scope.advancedOptions=_.reject(advancedOptionsFactory.option,function(option){return"tone"===option.key}),$scope.submitOptions=[],$scope.catnipPerText=70,$scope.maxContentLength=$scope.isPremium?14e3:2100,$scope.topicContent="",$scope.topicComment="",$scope.useCatnip=0,webStorage.session.get(constant.TOPIC_CONTENT)&&webStorage.session.get(constant.TOPIC_CONTENT).length>0&&($scope.topicContent=webStorage.session.get(constant.TOPIC_CONTENT)),$scope.$watch("topicContent",function(content){$scope.isLengthError=$filter("isLengthOver")(content,$scope.maxContentLength),$scope.isCatnipsError=parseFloat($scope.account.available_catnips)<calcCatnip(),$scope.isInvalidCharError=$filter("isHangul")(content)||$filter("isHangul")($scope.topicComment),$scope.useCatnip=calcCatnip(),$scope.isAllVaildContent=content.length>0&&!$scope.isLengthError&&!$scope.isCatnipsError&&!$scope.isInvalidCharError,$scope.isLengthError||$scope.isInvalidCharError||webStorage.session.add("topicContent",content)}),$scope.$watch("topicComment",function(comment){$scope.isCatnipsError=parseFloat($scope.account.available_catnips)<calcCatnip(),$scope.isInvalidCharError=$filter("isHangul")(comment)||$filter("isHangul")($scope.topicContent),$scope.isAllVaildContent=$scope.topicContent.length>0&&!$scope.isLengthError&&!$scope.isCatnipsError&&!$scope.isInvalidCharError,$scope.useCatnip=calcCatnip()});var isSubmitProgress=!1;$scope.submitTopic=function(){if(!$scope.isLengthError&&""!==$scope.topicContent&&!isSubmitProgress){if(isSubmitProgress=!0,$scope.isInvalidCharError)return void(isSubmitProgress=!1);commonFactory.showWaiting();var topic={topic:{title:"",original_texts:[{content:$scope.topicContent,comment:$scope.topicComment}]}},hasOptions=!1,hasComment=$scope.topicComment?!0:!1;if($scope.submitOptions.length>0){hasOptions=!0;for(var i=0;i<$scope.submitOptions.length;i++){var key=$scope.submitOptions[i].n,value=$scope.submitOptions[i].v;topic.topic[key]=value}}var promise=apisFactory.addTopic(topic);promise.then(function(d){var result={id:d.id,content:$scope.topicContent,comment:$scope.topicComment,state:"waiting",cost:0};$scope.topicContent="",$scope.topicComment="",webStorage.session.remove(constant.TOPIC_CONTENT),$rootScope.$emit("reloadAccount",{}),commonFactory.hideWaiting(),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Create",{"Used Catnip":$scope.useCatnip,"Has Comment":hasComment,"Has Options":hasOptions}),mixpanel.people.increment({"Chats Created":1,"Catnips Spent":$scope.useCatnip}),mixpanel.people.set({"Catnip Remaining":accountFactory.getInfo().info.available_catnips,"Last Chat Created":$window.moment().toISOString()}),isProduction&&(window.fbq&&fbq("trackCustom","ChatCreation",{used_catnips:$scope.useCatnip}),"function"==typeof window.google_trackConversion&&window.google_trackConversion({google_conversion_id:974372961,google_conversion_label:"cFurCIj-mWYQ4YDP0AM",google_remarketing_only:!1,google_conversion_format:3})),$state.go("student.one-chat",{topic:result},{location:"replace"})},function(result){if(commonFactory.hideWaiting(),isSubmitProgress=!1,400===result.data.code){var modalInfo={};modalInfo.title="You don't have enough catnip.",modalInfo.content="You don't have enough catnip. Please buy some.",modalInfo.isOnlyClose=!1,modalInfo.okBtnName="Confirm",modalInfo.closeBtnName="No",modalInfo.okFunc=function(){$state.go("my-account.catnip")},modalService.open(modalInfo)}})}},$scope.changeOption=function(categoryKey,value){$scope.submitOptions.push({n:categoryKey,v:value})},$scope.refreshOptions=function(option){for(var i=-1,cnt=option.items.length;++i<cnt;)$("#"+option.key+"_"+option.items[i].id).prop("checked",!1);$scope.submitOptions.splice($scope.submitOptions.indexOf(option.key),1)}}]),angular.module("chattingCatApp").controller("Student.OneChatController",["$rootScope","$scope","$stateParams","$window","$filter","$location","commonFactory","apisFactory","accountFactory","webStorage","modalService","advancedOptionsFactory","socketEvent","langTextFactory","$state","$log","$sce",function($rootScope,$scope,$stateParams,$window,$filter,$location,commonFactory,apisFactory,accountFactory,webStorage,modalService,advancedOptionsFactory,socketEvent,langTextFactory,$state,$log,$sce){function initTopic(){if($scope.topic){$scope.cost=commonFactory.getCost($scope.topic),$scope.realtimeCorrection=$scope.topic.content,$scope.count=Math.floor(($window.moment.utc($scope.topic.expired_at).valueOf()-$window.moment.utc().valueOf())/1e3),$scope.countStart=$scope.count>0&&"correcting"===$scope.topic.state?!0:!1,$scope.isNotModifiedState=commonFactory.isNotModifiedState($scope.topic.state),accountFactory.isPremium()?$scope.topic.comment=$filter("nl2br")($filter("linky")($scope.topic.comment,"_blank")):$scope.topic.comment=$filter("nl2br")($scope.topic.comment);var correctedTextSize=$scope.topic.corrected_texts?$scope.topic.corrected_texts.length:0;$scope.rating=new Array(correctedTextSize);for(var i=0;correctedTextSize>i;i++)accountFactory.isPremium()?$scope.topic.corrected_texts[i].comment=$filter("nl2br")($filter("linky")($scope.topic.corrected_texts[i].comment,"_blank")):$scope.topic.corrected_texts[i].comment=$filter("nl2br")($scope.topic.corrected_texts[i].comment),$scope.topic.corrected_texts[i].index=i,$scope.lastCorrectedText.id<$scope.topic.corrected_texts[i].id&&($scope.lastCorrectedText=$scope.topic.corrected_texts[i])}}function loadTopic(){commonFactory.showWaiting();var promise=apisFactory.getTopic($scope.topicId);promise.then(function(d){$scope.advancedOptionNames=[],$scope.topic=$filter("parseTopic")(d),initTopic(),$scope.topic.purpose&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("purpose",$scope.topic.purpose)),$scope.topic.tone&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("tone",$scope.topic.tone)),$scope.topic.english_type&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("english_type",$scope.topic.english_type)),$scope.getPrevAdvancedOptionItemName=advancedOptionsFactory.getPrevAdvancedOptionItemName,$scope.prevAdvancedOptions=advancedOptionsFactory.convertPrevAdvancedOptionFormat($scope.topic.advanced_options),$scope.haveAdvancedOptions=$scope.advancedOptionNames.length>0||$scope.prevAdvancedOptions.length>0,commonFactory.hideWaiting()},function(){commonFactory.hideWaiting(),$window.history.back()})}var constant={TOPIC_ID:"topicId"};$scope.topic=$stateParams.topic,null!==$scope.topic?($log.debug(JSON.stringify($scope.topic)),$scope.topicId=$scope.topic.id):$stateParams.topicId&&($scope.topicId=$stateParams.topicId),$scope.account=accountFactory.getInfo().info,$scope.ratingArr=new Array(5),$scope.rating=null,$scope.isCopySupport="chrome"===commonFactory.getBrowser()||"ie"===commonFactory.getBrowser(),$scope.realtimeCorrection="",$scope.cost="",$scope.isNotModifiedState=!0,$scope.lastCorrectedText={id:0},$scope.notMakeSense=langTextFactory.get("en-us","student.chat.not-make-sense"),$scope.haveAdvancedOptions=!1,$scope.topicId?webStorage.session.add(constant.TOPIC_ID,$scope.topicId):$scope.topicId=webStorage.session.get(constant.TOPIC_ID),$scope.$on("$viewContentLoaded",function(){mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Page Viewed",{Path:"/student/one-chat"})}),null!==$scope.topic&&initTopic(),loadTopic(),$scope.favoriteTopic=function(){commonFactory.showWaiting();var promise=apisFactory.favoriteTopic($scope.topic.id);promise.then(function(d){$scope.topic=$filter("parseTopic")(d),commonFactory.hideWaiting()},function(){commonFactory.hideWaiting()})},$scope.showDiff=function(index){for(var i=0;i<$scope.topic.corrected_texts.length;i++)if($scope.topic.corrected_texts[i].index===index){var dmp=new diff_match_patch;$scope.topic.corrected_texts[index].diff_text=$sce.trustAsHtml(dmp.createDiffText($scope.topic.originContent,$scope.topic.corrected_texts[index].originContent)),$scope.topic.corrected_texts[index].isShowDiff||($scope.topic.corrected_texts[index].isShowDiff=!1),$scope.topic.corrected_texts[index].isShowDiff=!$scope.topic.corrected_texts[index].isShowDiff}},$scope.select=function(correctedText,index,correctedTextIndex){$scope.rating[correctedTextIndex]=index+1,$scope.topic.corrected_texts[correctedTextIndex].rating=$scope.rating[correctedTextIndex],correctedText.isRatingWarning=!1},$scope.isSelected=function(index,correctedTextIndex){return index<$scope.rating[correctedTextIndex]},$scope.$on(socketEvent.realtimeCorrection,function(event,args){if(args.original_text_id===$scope.topic.id){var chat1=String(args.content).substr(0,args.cursor),chat2=String(args.content).substr(args.cursor),modChat=String($filter("newlines")(chat1))+'<span class="fake-cursor"></span>'+String($filter("newlines")(chat2));$scope.realtimeCorrection=modChat}}),$scope.$on(socketEvent.topicUpdatedBroadcasted,function(event,args){args.original_text_id===$scope.topic.id&&($scope.realtimeCorrection=$scope.topic.content,loadTopic())}),$scope.$watch("topic.state",function(newVal){$scope.showWatingMsg=("waiting"===newVal||"reopened"===newVal)&&"correcting"!==newVal}),$scope.countEnd=function(){loadTopic()};var isAcceptRequest=!1;$scope.requestAccept=function(index,correcttedTextIndex){for(var correctedData=null,i=0;i<$scope.topic.corrected_texts.length;i++)$scope.topic.corrected_texts[i].index===correcttedTextIndex&&(correctedData=$scope.topic.corrected_texts[i]);if(void 0===$scope.rating[index]||0===$scope.rating[index])return void(correctedData.isRatingWarning=!0);if(!correctedData.feedback||(correctedData.isInvalidCharError=$filter("isHangul")(correctedData.feedback),!correctedData.isInvalidCharError)){commonFactory.showWaiting();var feedback={accept:{score:$scope.rating[index],student_id:$scope.account.id,feedback:correctedData.feedback}};if(!isAcceptRequest){isAcceptRequest=!0;var promise=apisFactory.feedback(correctedData.id,feedback,"accept");promise.then(function(){loadTopic(),commonFactory.hideWaiting(),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Accept",{Rating:$scope.rating}),mixpanel.people.increment({"Chats Accepted":1})},function(){isAcceptRequest=!1,commonFactory.hideWaiting()})}}},$scope.onCopySuccess=function(e,id){e.clearSelection();var resultText=$("#"+id);resultText.text("Copied!"),resultText.css("opacity",1),resultText.fadeTo(2e3,0)},$scope.getTextToCopy=function(content){return content.toString().replace(/<br\/>/g,"\n").replace(/\&nbsp\;/g," ")},$scope.notEnoughCatnipCheck=function(){var modalInfo={};modalInfo.title="You don't have enough catnip.",modalInfo.content="You don't have enough catnip. Please buy some.",modalInfo.isOnlyClose=!1,modalInfo.okBtnName="Confirm",modalInfo.closeBtnName="No",modalInfo.okFunc=function(){$state.go("my-account.catnip")},modalService.open(modalInfo)};var isReopenRequest=!1;$scope.requestReopen=function(){if(accountFactory.getInfo().info.available_catnips<$scope.topic.cost/2)return $("#notEnoughCatnip").css("display","block"),void $scope.notEnoughCatnipCheck();var modalInfo={};modalInfo.title="Are You Sure?",modalInfo.content="Your chat will be corrected by a different tutor. Resending requires additional catnips.",modalInfo.isOnlyClose=!1,modalInfo.closeBtnName="Cancel",modalInfo.okFunc=function(){commonFactory.showWaiting();var feedback={reopen:{score:3,student_id:$scope.account.id,feedback:""}};if(!isReopenRequest){isReopenRequest=!0;var promise=apisFactory.feedback($scope.lastCorrectedText.id,feedback,"reopen");promise.then(function(){loadTopic(),$rootScope.$emit("reloadAccount",{}),commonFactory.hideWaiting(),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Resend",{Rating:feedback.reopen.score}),mixpanel.people.increment({"Chats Resent":1,"Catnips Spent":$scope.topic.cost/2}),mixpanel.people.set({"Catnip Remaining":accountFactory.getInfo().info.available_catnips}),isReopenRequest=!1},function(result){commonFactory.hideWaiting(),isReopenRequest=!1,400===result.data.code&&$scope.notEnoughCatnipCheck()})}},modalInfo.closeFunc=function(){isReopenRequest=!1},modalService.open(modalInfo)},$scope.cancel=function(){var elapsed=($window.moment.utc().valueOf()-$window.moment.utc($scope.topic.org_created_at).valueOf())/1e3,modalInfo={};modalInfo.title="Are You Sure?";var spent=-1*$scope.topic.cost,isReopened="reopened"===$scope.topic.state;isReopened?(modalInfo.content="By clicking confirm, resending will be canceled.",spent=-1*$scope.topic.cost*.5):modalInfo.content='Clicking "Confirm" will remove your chat.',modalInfo.isOnlyClose=!1,modalInfo.okBtnName="Confirm",modalInfo.closeBtnName="No",modalInfo.okFunc=function(){var promise=apisFactory.cancelTopic($scope.topic.id);promise.then(function(){$rootScope.$emit("reloadAccount",{}),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Cancel",{Elapsed:elapsed,"Reopen Cancel":isReopened}),mixpanel.people.increment({"Chats Canceled":1,"Catnips Spent":spent}),mixpanel.people.set({"Catnip Remaining":accountFactory.getInfo().info.available_catnips}),$state.go("student.index")},function(){var errorModalInfo={};errorModalInfo.title="Oops!",errorModalInfo.content="You are a little late. A tutor is working on your chat.",errorModalInfo.isOnlyClose=!0,errorModalInfo.closeBtnName="OK",modalService.open(errorModalInfo)})},modalService.open(modalInfo)}}]),angular.module("chattingCatApp").controller("Tutor.InfoViewController",["$scope","$stateParams","$log","commonFactory","apiUrlConfig","webStorage","accountFactory","modalService","langTextFactory",function($scope,$stateParams,$log,commonFactory,apiUrlConfig,webStorage,accountFactory,modalService,langTextFactory){function loadTutorInfo(){$.ajax({url:apiUrlConfig+"/api/blocked_users",type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){$log.debug(JSON.stringify(result)),$scope.blockList=[];for(var i=0;i<result.length;i++)$scope.blockList.push(result[i].blocked_user_id);$scope.isBlocked=isBlocked($scope.tutorId),initAlertMessage(),$scope.$apply()},error:function(){}}),$.ajax({url:apiUrlConfig+"/api/tutor_infos/"+$scope.tutorId,processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){$log.debug(JSON.stringify(result)),$scope.tutor=result,$scope.isOpen=result.info.open_type===commonFactory.tutorOpenType.open?!0:!1,($scope.isOpen||$scope.me)&&($scope.profileUrl=accountFactory.getImageUrl($scope.tutor.info.user.profile_img)),$scope.$apply()},error:function(){}})}function initAlertMessage(){$scope.alertMessage=$scope.isBlocked?langTextFactory.get("en-us","student.tutor.unblock.message"):langTextFactory.get("en-us","student.tutor.block.message")}function isBlocked(userId){return $scope.blockList.indexOf(userId)>=0}$scope.tutorId=$stateParams.id,$scope.tutorId?webStorage.session.add("tutorId",$scope.tutorId):$scope.tutorId=webStorage.session.get("tutorId"),$scope.me=$scope.tutorId===accountFactory.getInfo().info.id,$scope.tutor=null,$scope.profileUrl="/images/default_profile.1c98470a.png",$scope.isShow=!1,$scope.alertMessage="",$scope.blockList=null,$scope.isBlocked=!1,$scope.isOpen=!1,$log.debug("tutorId="+$scope.tutorId),$scope.blockPopup=function(){$scope.isShow=!$scope.isShow},$scope.toggleBlock=function(){var promise=accountFactory.blockTutor($scope.tutorId);promise.then(function(rs){rs&&($scope.blockList.push($scope.tutorId),modalService.open({title:"Success",content:"Blocked!",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0}),$scope.isBlocked=!0,initAlertMessage(),$scope.blockPopup())},function(){modalService.open({title:"Fail",content:"Fail to update",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})},$scope.toggleUnBlock=function(){var promise=accountFactory.unBlockTutor($scope.tutorId);promise.then(function(rs){rs&&($scope.blockList.splice($scope.blockList.indexOf($scope.tutorId),1),modalService.open({title:"Success",content:"Unblocked!",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0}),$scope.isBlocked=!1,initAlertMessage(),$scope.blockPopup())},function(){modalService.open({title:"Fail",content:"Fail to update",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})},$scope.canSeeTitleAndSection=function(value){return $scope.me||$scope.isOpen&&value},loadTutorInfo()}]),angular.module("chattingCatApp").controller("Student.BuyCatnipGlobalController",["$scope","$filter","accountFactory","serviceUrlConfig","modalService","$window","isProduction","stripePubKey",function($scope,$filter,accountFactory,serviceUrlConfig,modalService,$window,isProduction,stripePubKey){function clearBankSelected(){for(var i=-1,cnt=$scope.paypalPrices.length;++i<cnt;)$("#"+$scope.paypalPrices[i].name).css("border","1px #C9C9C9 solid");$("#"+$scope.paypalPrices[0].name).css("border","1px #C20F2C solid"),$("#totalPrice").text("$"+$filter("number")($scope.roundToTwo($scope.paypalPrices[0].price*((100-$scope.discountRate)/100)),2)),$("#totalCatnips").text($scope.paypalPrices[0].name)}function clearPaypalSelected(){for(var i=-1,cnt=$scope.bankTransfer.length;++i<cnt;)$("#"+$scope.bankTransfer[i].b_name).css("border","1px #C9C9C9 solid");$("#"+$scope.bankTransfer[0].b_name).css("border","1px #C20F2C solid"),$("#totalPrice").text($filter("number")($scope.roundToTwo($scope.bankTransfer[0].price*((100-$scope.discountRate)/100)),0)+""),$("#totalCatnips").text($scope.bankTransfer[0].name)}$scope.accountType=accountFactory.getUserRole(),$scope.paymentMethods=[{name:"PayPal",value:"p"},{name:"Credit Card",value:"c"},{name:"Bank Transfer (Korean Only)",value:"b"}],$scope.paypalPrices=[{name:"50",value:50,price:6.25,bonus_value:"-"},{name:"100",value:103,price:12.5,bonus_value:"+3"},{name:"300",value:315,price:37.5,bonus_value:"+15"},{name:"500",value:525,price:62.5,bonus_value:"+25"},{name:"1000",value:1050,price:125,bonus_value:"+50"}],$scope.bankTransfer=[{b_name:"b_50",name:"50",value:50,price:7500},{b_name:"b_100",name:"100",value:100,price:15e3,bonus_value:""},{b_name:"b_300",name:"300",value:300,price:45e3},{b_name:"b_500",name:"500",value:500,price:75e3},{b_name:"b_1000",name:"1000",value:1e3,price:15e4}],$scope.roundToTwo=function(num){return+(Math.round(num+"e+2")+"e-2")},$scope.showHowtoUse=!1,$scope.paypalLoading=!1,$scope.payment={currentItem:$scope.paymentMethods[0]},$scope.paypal={currentItem:$scope.paypalPrices[0]},$scope.bank={currentItem:$scope.bankTransfer[0]},$scope.bank.accountName="",$scope.isVaildAccountName=!0,$scope.checkedBankTransfer=!1,$scope.checkedCreditCard=!1,$("#totalCatnips").text($scope.paypal.currentItem.name),$("#totalPrice").text("$"+$scope.paypal.currentItem.price),$("#elecPayment").show(),$("#bankPayment").hide(),$scope.isProduction=isProduction,$scope.discountReferralList=[],$scope.getDiscountReferral=function(){var promise=accountFactory.getDiscountReferral();promise.then(function(d){$scope.discountReferralList=d.list,$("#"+$scope.paypalPrices[0].name).css("border","1px #C20F2C solid")},function(){})},$scope.discountRate=0,$scope.basicDiscountRate=5,$scope.usedDiscount=[],$scope.getDiscountReferral(),$scope.totalOffRate=0,$scope.changeDiscount=function(id,isChecked){isChecked?$scope.usedDiscount.push(id):$scope.usedDiscount.splice($scope.usedDiscount.indexOf(id),1),$scope.discountRate=$scope.basicDiscountRate*$scope.usedDiscount.length,$("#offRate").text($scope.discountRate+"% OFF");var currentPrice="";currentPrice=$scope.checkedBankTransfer?$filter("number")($scope.roundToTwo($scope.bank.currentItem.price*((100-$scope.discountRate)/100)),0)+"":"$"+$filter("number")($scope.roundToTwo($scope.paypal.currentItem.price*((100-$scope.discountRate)/100)),2),$("#totalPrice").text(currentPrice)},$scope.changeTotal=function(currentItem){if($scope.checkedBankTransfer){$scope.bank.currentItem=currentItem;for(var i=-1,cnt=$scope.bankTransfer.length;++i<cnt;)$("#"+$scope.bankTransfer[i].b_name).css("border","1px #C9C9C9 solid");$("#"+currentItem.b_name).css("border","1px #C20F2C solid");var value=$filter("number")($scope.roundToTwo(currentItem.price*((100-$scope.discountRate)/100)),0);$("#totalPrice").text(value+"")}else{$scope.paypal.currentItem=currentItem;for(var j=-1,b_cnt=$scope.paypalPrices.length;++j<b_cnt;)$("#"+$scope.paypalPrices[j].name).css("border","1px #C9C9C9 solid");$("#"+currentItem.name).css("border","1px #C20F2C solid"),$("#totalPrice").text("$"+$filter("number")($scope.roundToTwo(currentItem.price*((100-$scope.discountRate)/100)),2))}$("#totalCatnips").text(currentItem.value)},$scope.changePayment=function(){"p"===$scope.payment.currentItem.value?(clearBankSelected(),$scope.checkedBankTransfer=!1,$("#paymentDesc").text("If you are using PayPal for the first time, an authorization charge for $1 will appear. You will not be charged $1, this charge will disappear."),$("#elecPayment").show(),$("#paymentDescLine").show(),$("#bankPayment").hide()):"c"===$scope.payment.currentItem.value?(clearBankSelected(),$scope.checkedCreditCard=!0,$scope.checkedBankTransfer=!1,$("#elecPayment").show(),$("#paymentDescLine").hide(),$("#bankPayment").hide()):(clearPaypalSelected(),$scope.checkedCreditCard=!1,$scope.checkedBankTransfer=!0,$("#paymentDesc").text("   Buy Now     .    24    ."),$("#paymentDescLine").show(),$("#elecPayment").hide(),$("#bankPayment").show())},$scope.checkout=function(){if(accountFactory.isPremium()){var modalInfo={};return modalInfo.title="Error",modalInfo.content="Sorry, but you cannot buy Catnip on this page because you are Premium User. Please contact ChattingCat directly.",modalInfo.isOnlyClose=!0,modalInfo.closeBtnName="Close",void modalService.open(modalInfo)}if("c"===$scope.payment.currentItem.value){isProduction&&window.fbq&&fbq("track","InitiateCheckout",{payment_method:"Credit Card"}),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Purchase Try",{Platform:"Credit Card","Catnip Amount":$scope.paypal.currentItem.value,Item:$scope.paypal.currentItem.value+" Catnips"});var handler=StripeCheckout.configure({key:stripePubKey,image:"/images/logo_x_name.cebc0760.png",locale:"auto",allowRememberMe:!1,token:function(token){var checkOutInfo={type:$scope.paypal.currentItem.value,redirect_uri:serviceUrlConfig.replace("https://","https://app.")+"/payment-completed",discount_id_list:$scope.usedDiscount,stripeToken:token.id};isProduction&&(window.fbq&&fbq("track","Purchase",{value:100*$scope.roundToTwo($scope.paypal.currentItem.price*((100-$scope.discountRate)/100)),currency:"USD"}),"function"==typeof window.google_trackConversion&&window.google_trackConversion({google_conversion_id:974372961,google_conversion_label:"51W6CKOSmGYQ4YDP0AM",google_remarketing_only:!1,google_conversion_format:3}));var promise=accountFactory.checkOutStripe(checkOutInfo);promise.then(function(d){$window.location.replace(d.redirect_uri)},function(e){$window.alert(e.data.message)})}});handler.open({name:"ChattingCat",description:$scope.paypal.currentItem.value+" Catnips",email:accountFactory.getInfo().info.email,amount:100*$scope.roundToTwo($scope.paypal.currentItem.price*((100-$scope.discountRate)/100))})}else if("p"===$scope.payment.currentItem.value){isProduction&&window.fbq&&fbq("track","InitiateCheckout",{payment_method:"PayPal"}),$scope.paypalLoading=!0,mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Purchase Try",{Platform:"Paypal","Catnip Amount":$scope.paypal.currentItem.value,Item:$scope.paypal.currentItem.value+" Catnips"});var checkOutInfo={type:$scope.paypal.currentItem.value,redirect_uri:serviceUrlConfig.replace("https://","https://app.")+"/payment-completed",discount_id_list:$scope.usedDiscount};isProduction&&(window.fbq&&fbq("track","Purchase",{value:100*$scope.roundToTwo($scope.paypal.currentItem.price*((100-$scope.discountRate)/100)),currency:"USD"}),"function"==typeof window.google_trackConversion&&window.google_trackConversion({google_conversion_id:974372961,google_conversion_label:"51W6CKOSmGYQ4YDP0AM",google_remarketing_only:!1,google_conversion_format:3}));var promise=accountFactory.checkOutStudent(checkOutInfo);promise.then(function(d){$window.location.replace(d.redirect_uri)},function(){$window.alert("invalid request")})}else{isProduction&&window.fbq&&fbq("track","InitiateCheckout",{payment_method:"Bank Transfer"});var isBankTransferRequest=!1;if($scope.bank_result_price=0,""===$scope.bank.accountName)return void($scope.isVaildAccountName=!1);if(isBankTransferRequest)return;isBankTransferRequest=!0,mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Purchase Try",{Platform:"Bank","Catnip Amount":$scope.bank.currentItem.value,Item:$scope.bank.currentItem.value+" Catnips"});var bankTransferInfo={type:$scope.bank.currentItem.value,account_name:$scope.bank.accountName,discount_id_list:$scope.usedDiscount},promiseBank=accountFactory.bankTransferStudent(bankTransferInfo);promiseBank.then(function(rs){isProduction&&(window.fbq&&fbq("track","Purchase",{value:rs.discount_price,currency:"KRW"}),"function"==typeof window.google_trackConversion&&window.google_trackConversion({google_conversion_id:974372961,google_conversion_label:"51W6CKOSmGYQ4YDP0AM",
google_remarketing_only:!1,google_conversion_format:3})),$scope.bank_result_price=rs.discount_price,$scope.showBankTransferStudent=!0,$scope.discountReferralList=[],isBankTransferRequest=!1},function(){$scope.bank.accountName="";var modalInfo={};modalInfo.title=" ",modalInfo.content=" . contact@chattingcat.com  .",modalInfo.isOnlyClose=!0,modalInfo.closeBtnName="",modalService.open(modalInfo),isBankTransferRequest=!1})}},$scope.$watch("bank.accountName",function(){""!==$scope.bank.accountName&&($scope.isVaildAccountName=!0)})}]),angular.module("chattingCatApp").controller("Student.BuyCatnipHistoryController",["$scope","accountFactory","$filter","paymentConfigs","$window",function($scope,accountFactory,$filter,paymentConfigs,$window){function getPaymentData(payments){for(var result=[],i=-1,cnt=payments.length;++i<cnt;)for(var j=-1,subCnt=paymentConfigs.length;++j<subCnt;)if(payments[i].payment_type===paymentConfigs[j].paymentType&&parseInt(payments[i].product_code)===parseInt(paymentConfigs[j].productCode)){result.push(angular.extend(payments[i],paymentConfigs[j]));break}return result}var offset=0,limit=5;$scope.currentPageNo=1,$scope.totalPageCnt=1,$scope.accountType=accountFactory.getUserRole(),$scope.buyCatnipList=[],$scope.loadByuCatnip=function(){var promise=accountFactory.getBuyCatnipListTutor(offset,limit);promise.then(function(d){$scope.buyCatnipList=getPaymentData(d.payments),d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit)},function(){})},$scope.loadByuCatnip(),$scope.getCash=function(buyCatnip){return $window.moment(buyCatnip.created_at).isBefore("2015-01-31 23:59")?buyCatnip.priceBefore20150201:buyCatnip.priceAfter20150201},$scope.getUpdatedAt=function(buyCatnip){return buyCatnip.updated_at&&buyCatnip.created_at!==buyCatnip.updated_at?$filter("date")(buyCatnip.updated_at,"MM/dd/yy"):"-"},$scope.getStatusDisplay=function(status){return"open"===status?"pending":status},$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadByuCatnip()}}}]),angular.module("chattingCatApp").controller("Student.InactiveController",["$scope","commonFactory","accountFactory","$state","$window","serviceUrlConfig","$interval",function($scope,commonFactory,accountFactory,$state,$window,serviceUrlConfig,$interval){function checkConfirmAtInterval(){accountFactory.loadInfo(),accountFactory.getInfo().info.confirmed&&($interval.cancel(interval),$state.go(accountFactory.getRoleHome()))}$scope.accountType=accountFactory.getUserRole(),$scope.state="confirmMesssage",$scope.alerts=[],$scope.email="",$scope.accountEmail=accountFactory.getInfo().info.email,$scope.showEmailForm=function(){$scope.state="emailForm"},$scope.sendEmail=function(email){var promise=accountFactory.resetConfirmation({user:{email:email}});promise.then(function(){$scope.alerts=[],$scope.state="resendMessage"},function(error){var message=error.data.message;"not found user"===message&&($scope.alerts.pop(),$scope.alerts.push({type:"danger",msg:"We couldn't find your account with that information."}))})},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.backHome=function(){$window.location.href=serviceUrlConfig};var interval=$interval(checkConfirmAtInterval,5e3)}]),angular.module("chattingCatApp").controller("Tutor.CashOutController",["$scope","accountFactory","$window","$state","routeName","apiUrlConfig","commonFactory","$log",function($scope,accountFactory,$window,$state,routeName,apiUrlConfig,commonFactory,$log){function clearPriceSelected(){for(var i=-1,cnt=amounts.length;++i<cnt;)$("#"+amounts[i]).css("border","1px #C9C9C9 solid")}function validateAmount(){var availableCatnips=parseInt(accountFactory.getInfo().info.available_catnips);return availableCatnips<parseInt($scope.cashout.amount)?($scope.notEnoughCatnips=!0,!1):($scope.notEnoughCatnips=!1,!0)}function getTutorInfo(){$.ajax({url:apiUrlConfig+"/api/tutor_infos/"+accountFactory.getInfo().info.id,processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){$log.debug(JSON.stringify(result)),$scope.tutor=result,$scope.$apply()}})}$scope.accountType=accountFactory.getUserRole(),$scope.cashout={},$scope.cashout.amount="100",$scope.cashout.method="paypal",$scope.cashout.message="",$scope.isCompleted=!1,$scope.notEnoughCatnips=!1,$scope.scopeLoaded=!0,$scope.hasAuthority="experienced_tutor"===$scope.accountType||"professional_tutor"===$scope.accountType,$scope.tutor=null,$("#100").css("border","1px #C20F2C solid"),$scope.cashout.amount=100;var amounts=[100,200,400,1e3,2e3];$scope.$watch("paypal_email",function(){""!==$("#paypal_email").val()&&$("#paypal_email").css("border","1px #e5e5e5 solid")}),$scope.$watch("check_name",function(){""!==$("#check_name").val()&&$("#check_name").css("border","1px #e5e5e5 solid")}),$scope.$watch("check_address",function(){""!==$("#check_address").val()&&$("#check_address").css("border","1px #e5e5e5 solid")}),$scope.changePayment=function(){clearPriceSelected(),"paypal"===$scope.cashout.method?($("#"+amounts[0]).css("border","1px #C20F2C solid"),$scope.cashout.amount=100):"check"===$scope.cashout.method&&($("#1000").css("border","1px #C20F2C solid"),$scope.cashout.amount=1e3)};var isRequestProgress=!1;$scope.requestCashout=function(){if("paypal"===$scope.cashout.method){if(""===$("#paypal_email").val())return void $("#paypal_email").css("border","1px #C20F2C solid");$scope.cashout.message="email : "+$("#paypal_email").val()}else{if(""===$("#check_name").val()||""===$("#check_address").val())return""===$("#check_name").val()&&$("#check_name").css("border","1px #C20F2C solid"),void(""===$("#check_address").val()&&$("#check_address").css("border","1px #C20F2C solid"));$scope.cashout.message="name : "+$("#check_name").val()+" address : "+$("#check_address").val()}if($log.debug($scope.cashout.method),$log.debug($scope.cashout.amount),$log.debug($scope.cashout.message),!isRequestProgress&&(isRequestProgress=!0,validateAmount())){var promise=accountFactory.cashOutTutor($scope.cashout);promise.then(function(){$scope.isCompleted=!0,isRequestProgress=!1,$state.go(routeName.MY_ACCOUNT_CASH_OUT_HISTORY)},function(){$scope.isCompleted=!1,isRequestProgress=!1,$window.alert("something wrong, please contact to 'contact@chattingcat.com'")})}},$scope.changeTotal=function(value){if(!("check"===$scope.cashout.method&&parseInt(value)<1e3)){for(var i=-1,cnt=amounts.length;++i<cnt;)$("#"+amounts[i]).css("border","1px #C9C9C9 solid");$("#"+value).css("border","1px #C20F2C solid"),$scope.cashout.amount=value}},getTutorInfo()}]),angular.module("chattingCatApp").controller("Tutor.CashOutHistoryController",["$scope","accountFactory","$filter",function($scope,accountFactory,$filter){var offset=0,limit=5;$scope.currentPageNo=1,$scope.totalPageCnt=1,$scope.accountType=accountFactory.getUserRole(),$scope.cashOutList=[],$scope.loadCashOut=function(){var promise=accountFactory.getCashOutListTutor(offset,limit);promise.then(function(d){$scope.cashOutList=d.cashouts,d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit)},function(){})},$scope.loadCashOut(),$scope.getUpdatedAt=function(cashOut){return cashOut.created_at===cashOut.updated_at?"-":$filter("date")(cashOut.updated_at,"MM/dd/yy")},$scope.getStatusDisplay=function(status){return"request"===status?"pending":status},$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}$scope.loadCashOut()}}}]),angular.module("chattingCatApp").controller("Tutor.ChatController",["$scope","$location","apisFactory","socketEvent","$timeout","accountFactory","$filter","advancedOptionsFactory","notificationFactory","commonFactory","modalService","$state","$log","_",function($scope,$location,apisFactory,socketEvent,$timeout,accountFactory,$filter,advancedOptionsFactory,notificationFactory,commonFactory,modalService,$state,$log,_){function isEmptyList(){return $scope.topicList&&0===$scope.topicList.length&&$scope.reviewTextList&&0===$scope.reviewTextList.length}function loadChat(){if(!$scope.isGetTopicProgress){$scope.isGetTopicProgress=!0,commonFactory.showWaiting();var promise=apisFactory.loadTopicList(offset,limit);promise.then(function(d){if(d.topics){for(var i=d.topics.length;--i>=0;)if(d.topics[i]=$filter("parseTopic")(d.topics[i]),"correcting"===d.topics[i].state&&d.topics[i].locked_by&&d.topics[i].locked_by.id!==$scope.account.id&&d.topics.splice(i,1),d.topics[i].original_text_declineds_count>0)for(var j=0;j<d.topics[i].original_text_declined.length;j++)if(d.topics[i].original_text_declined[j].user_id===$scope.account.id){d.topics.splice(i,1);break}$scope.topicList=d.topics}accountFactory.isPremium()&&$scope.topicList&&$scope.topicList.length<=3&&apisFactory.loadReviewTextList().then(function(result){$scope.reviewTextList=result.review_texts,$scope.isEmptyChatShow=isEmptyList()}),d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit),$scope.isEmptyChatShow=isEmptyList(),$scope.isPolling&&(pollingTimer=$timeout(loadChat,pollingTime)),$scope.isGetTopicProgress=!1,commonFactory.hideWaiting()},function(){commonFactory.hideWaiting()})}}function deleteTopic(originalTextId){for(var i=-1,cnt=$scope.topicList.length;++i<cnt;)if(originalTextId===$scope.topicList[i].id){$scope.topicList.splice(i,1);break}}function deleteReviewText(correctedTextId){$scope.reviewTextList=_.reject($scope.reviewTextList,function(reviewText){return reviewText.corrected_text.id===correctedTextId})}function addTopic(newTopic){deleteTopic(newTopic.id),$scope.topicList.push(newTopic)}$scope.accountType=accountFactory.getUserRole(),$scope.$on("$viewContentLoaded",function(){var modalInfo={};modalInfo.title="Announcement - Service Closure",modalInfo.content="We are sorry. ChattingCat's service will shut down on May 14th, 2017, 23:59:59 Eastern Time. More details, including Catnip refund policy, has been sent via email.",modalService.open(modalInfo)});var pollingTimer,offset=0,limit=5,pollingTime=3e4,isCommitMode=!1;$scope.currentPageNo=commonFactory.getPage(),$scope.totalPageCnt=1,$scope.topicList=[],$scope.isEmptyChatShow=$scope.topicList&&0===$scope.topicList.length?!0:!1,$scope.isPolling=!1,$scope.isGetTopicProgress=!1,$scope.reviewTextList=[],$scope.currentPageNo>1&&(offset=($scope.currentPageNo-1)*limit),loadChat(),$scope.$on("controlPolling",function(event,params){params.isPolling?($scope.isPolling=!0,pollingTimer||isCommitMode||loadChat()):($scope.isPolling=!1,pollingTimer&&$timeout.cancel(pollingTimer))}),$scope.$on(socketEvent.topicCreatedBroadcasted,function(event,params){commonFactory.showWaiting();var promise=apisFactory.getTopic(params.original_text_id);promise.then(function(d){if(!d.hasOwnProperty("status")||d.status){var newTopic=$filter("parseTopic")(d);if("correcting"!==newTopic.state||!newTopic.locked_by||newTopic.locked_by.id===$scope.account.id){addTopic(newTopic),$scope.isEmptyChatShow=isEmptyList();var noti={title:"ChattingCat",body:"A new chat arrived.",onclick:function(){$state.go("tutor.index")}};notificationFactory.notification("topic_created","tutor",noti),commonFactory.hideWaiting()}}},function(){commonFactory.hideWaiting()})}),$scope.$on(socketEvent.topicLockedBroadcasted,function(event,params){params.locked_by!==$scope.account.id&&(deleteTopic(params.original_text_id),$scope.isEmptyChatShow=isEmptyList())}),$scope.$on(socketEvent.reviewLockedBroadcasted,function(event,params){deleteReviewText(params.corrected_text_id),$scope.isEmptyChatShow=isEmptyList()}),$scope.$on(socketEvent.topicDeclinedBroadcasted,function(event,params){commonFactory.showWaiting();var promise=apisFactory.getTopic(params.original_text_id);promise.then(function(d){if(commonFactory.hideWaiting(),d.hasOwnProperty("status")&&!d.status)return void deleteTopic(params.original_text_id);var newTopic=$filter("parseTopic")(d);return"declined"===newTopic.state?void deleteTopic(newTopic.id):(addTopic(newTopic),void($scope.isEmptyChatShow=isEmptyList()))},function(){commonFactory.hideWaiting()})}),$scope.$on(socketEvent.topicCanceledBroadcasted,function(event,params){deleteTopic(params.original_text_id),$scope.isEmptyChatShow=isEmptyList()}),$scope.$on(socketEvent.topicUnlockedBroadcasted,function(event,params){if(params.unlocked_by===$scope.account.id)return void $scope.$broadcast("emitOffCommitMode",{id:params.original_text_id});commonFactory.showWaiting();var promise=apisFactory.getTopic(params.original_text_id);promise.then(function(d){if(commonFactory.hideWaiting(),!d.hasOwnProperty("status")||d.status){var newTopic=$filter("parseTopic")(d);if("correcting"!==newTopic.state||!newTopic.locked_by||newTopic.locked_by.id===$scope.account.id){addTopic(newTopic),$scope.isEmptyChatShow=isEmptyList();var noti={title:"ChattingCat",body:"A new chat arrived.",onclick:function(){$state.go("tutor.index")}};notificationFactory.notification("topic_unlocked","tutor",noti)}}},function(){commonFactory.hideWaiting()})}),$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}loadChat(!0)}},$scope.$watch("currentPageNo",function(){commonFactory.savePage($scope.currentPageNo)}),$scope.commitToReview=function(reviewText){apisFactory.commitChatReview(reviewText.corrected_text.id).then(function(){$state.go("tutor.review-text",{corrected_text_id:reviewText.corrected_text.id})},function(err){$log.debug(err)})}}]),angular.module("chattingCatApp").controller("Tutor.OneChatController",["$rootScope","$scope","$stateParams","$window","$filter","$location","commonFactory","apisFactory","accountFactory","$log","$state","webStorage","advancedOptionsFactory","socketEvent","modalService","topicCorrectionEvent","notificationFactory",function($rootScope,$scope,$stateParams,$window,$filter,$location,commonFactory,apisFactory,accountFactory,$log,$state,webStorage,advancedOptionsFactory,socketEvent,modalService,topicCorrectionEvent,notificationFactory){function loadTopic(){commonFactory.showWaiting();var promise=apisFactory.getTopic($scope.topicId);promise.then(function(d){$scope.topic=$filter("parseTopic")(d),initTopic(),commonFactory.hideWaiting()},function(){commonFactory.hideWaiting(),$window.history.back()})}function initTopic(){$scope.topicCorrectContent=$scope.topic.originContent,$scope.topicMessageContent="",$scope.catnip=parseFloat($scope.topic.cost),$scope.count=Math.floor(($window.moment.utc($scope.topic.expired_at).valueOf()-$window.moment.utc().valueOf())/1e3),$scope.countStart=$scope.count>0&&"correcting"===$scope.topic.state?!0:!1,accountFactory.isPremium()?$scope.topic.comment=$filter("nl2br")($filter("linky")($scope.topic.comment,"_blank")):$scope.topic.comment=$filter("nl2br")($scope.topic.comment),$scope.advancedOptionNames=[],$scope.topic.purpose&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("purpose",$scope.topic.purpose)),$scope.topic.tone&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("tone",$scope.topic.tone)),$scope.topic.english_type&&$scope.advancedOptionNames.push(advancedOptionsFactory.getOptionName("english_type",$scope.topic.english_type)),$scope.hasAdvancedOptions=$scope.advancedOptionNames.length>0}function releaseLock(){notificationFactory.notification("original_unlock","tutor"),$rootScope.$emit("emitOffCommitMode"),$rootScope.$emit("reloadAccount",{})}$("#txtMessage").bind("cut copy paste",function(e){e.preventDefault()}),$scope.topic=$stateParams.topic,null!==$scope.topic&&($scope.topicId=$scope.topic.id),$scope.topicId?webStorage.session.add("topicId",$scope.topicId):$scope.topicId=webStorage.session.get("topicId"),$scope.hasAdvancedOptions=!1,loadTopic(),$scope.account=accountFactory.getInfo().info,$scope.cancel=function(){commonFactory.showWaiting();var promise=apisFactory.updateTopicState($scope.topic.id,$scope.account.id,"unlock");promise.then(function(){commonFactory.hideWaiting(),releaseLock(),mixpanel.track("Chat: Cancel"),$state.go("tutor.index",{},{location:"replace"})},function(){commonFactory.hideWaiting()})},$scope.shoterThan30=!1,$scope.changeComment=function(){$scope.topicMessageContent.length>30||0===$scope.topicMessageContent.length?$scope.shorterThan30=!1:$scope.shorterThan30=!0},$scope.isSubmitProgress=!1,$scope.submitTopic=function(){if(!$scope.isSubmitProgress){if($filter("isHangul")($scope.topicCorrectContent))return void modalService.open({title:"Warning",content:"Please write in English. ChattingCat is an English to English correction service.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0});if(0===$scope.topicCorrectContent.length||$scope.topicCorrectContent===$scope.topic.originContent&&!$scope.isPerfect)return void modalService.open({title:"Warning",content:"If there is nothing to correct, please check the This chat is perfect. box.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0});$scope.topicCorrectContent!==$scope.topic.originContent&&($scope.isPerfect=!1),$scope.isSubmitProgress=!0,commonFactory.showWaiting();var correctedInfo={corrected_text:{original_text_id:$scope.topic.id,content:$scope.topicCorrectContent,comment:$scope.topicMessageContent,perfect:$scope.isPerfect}},promise=apisFactory.correctedTopic($scope.topic.id,correctedInfo);promise.then(function(d){$scope.isSubmitProgress=!1,commonFactory.hideWaiting(),$log.debug("result:"+d),releaseLock(),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Correct",{"Earned Catnips":$scope.catnip,Perfect:$scope.isPerfect}),mixpanel.people.set({Id:accountFactory.getInfo().info.id,$email:accountFactory.getInfo().info.email,$name:accountFactory.getInfo().info.name,Role:accountFactory.getInfo().info.role,"Catnip Remaining":accountFactory.getInfo().info.available_catnips,"Last Chat Corrected":$window.moment().toISOString()}),mixpanel.people.increment({"Chats Corrected":1,"Catnips Earned":$scope.catnip}),$state.go("tutor.index",{},{location:"replace"})},function(d){modalService.open({title:"Warning",content:d.data.message,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0}),$scope.isSubmitProgress=!1,commonFactory.hideWaiting()})}};var isDeclineProcess=!1;$scope.declineTopic=function(){if(!isDeclineProcess){isDeclineProcess=!0,commonFactory.showWaiting();var promise=apisFactory.updateTopicState($scope.topic.id,$scope.account.id,"unlock");promise.then(function(){var promise=apisFactory.declineTopic($scope.topic.id);promise.then(function(d){var newTopic=$filter("parseTopic")(d);$scope.topic=newTopic,initTopic(),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Decline",{Elapsed:($window.moment.utc().valueOf()-$window.moment.utc(newTopic.org_created_at).valueOf())/1e3}),mixpanel.people.increment({"Chats Declined":1}),commonFactory.hideWaiting(),releaseLock(),isDeclineProcess=!1,$state.go("tutor.index",{},{location:"replace"})},function(e){isDeclineProcess=!1,commonFactory.hideWaiting();var code=e.data.code,message=e.data.message;switch(code){case 205:modalService.open({title:"Warning",content:"You already declined this chat.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0});break;case 998:modalService.open({title:"Warning",content:message,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})}})},function(){commonFactory.hideWaiting()})}},$scope.onCorrectBoxChange=function($event){var oField=$event.target,cursorPosVal=0;if(document.selection){oField.focus();var oSel=document.selection.createRange();oSel.moveStart("character",-oField.value.length),cursorPosVal=oSel.text.length}else(oField.selectionStart||"0"===oField.selectionStart)&&(cursorPosVal=oField.selectionStart);$scope.topicCorrectContent!==$scope.topic.originContent&&($scope.isPerfect=!1);var params={id:$scope.topic.topic_id,original_text_id:$scope.topic.id,content:$scope.topicCorrectContent,owner:$scope.topic.owner_id,cursor:cursorPosVal};$scope.$emit(topicCorrectionEvent.realtimeCorrecting,params)},$scope.countEnd=function(){$scope.cancel()},$scope.$on("$locationChangeStart",function(event,next,current){return next.indexOf("/tutor/index")>=0&&current.indexOf("/tutor/one-chat")?(modalService.open({title:"Warning",content:"If you want to go back to the Chat list, please close and click Cancel.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0}),void event.preventDefault()):void 0}),$scope.$on("$viewContentLoaded",function(){$("#txtChat").focus()}),$scope.$watch("isPerfect",function(){$scope.isPerfect&&($scope.topicCorrectContent=$scope.topic.originContent)})}]),angular.module("chattingCatApp").controller("Tutor.HistoryController",["$scope","apisFactory","$filter","accountFactory","$state","commonFactory",function($scope,apisFactory,$filter,accountFactory,$state,commonFactory){function loadChat(){commonFactory.showWaiting();var promise=apisFactory.getHistory(offset,limit);promise.then(function(d){commonFactory.hideWaiting();for(var i=-1,cnt=d.history.length;++i<cnt;)d.history[i]=$filter("parseTopic")(d.history[i]),d.history[i].corrected_texts&&d.history[i].corrected_texts[0].content.toString().length>495&&(d.history[i].corrected_texts[0].content=$filter("limitTo")(d.history[i].corrected_texts[0].content.toString(),495,0)+"...");$scope.topicList=d.history,d.meta.paging.total%limit===0?($scope.totalPageCnt=d.meta.paging.total/limit,$scope.totalPageCnt=0===$scope.totalPageCnt?1:$scope.totalPageCnt):$scope.totalPageCnt=Math.ceil(d.meta.paging.total/limit),$scope.isEmptyChatShow=$scope.topicList&&0===$scope.topicList.length?!0:!1},function(){commonFactory.hideWaiting()})}$scope.accountType=accountFactory.getUserRole();var offset=0,limit=5;$scope.topicList=[],$scope.isNewChatBoxShow=!1,$scope.isEmptyChatShow=$scope.topicList&&0===$scope.topicList.length?!0:!1,$scope.currentPageNo=1,$scope.totalPageCnt=1,loadChat(),$scope.getEmptyArray=function(rating){return new Array(rating)},$scope.getRatingStar=function(idx,rating){return rating>idx?"fa-star":"fa-star-o"},$scope.goOneHistory=function(topicId){$state.go("tutor.one-history",{topicId:topicId})},$scope.movePage=function(moveType){if(!($scope.totalPageCnt<1)){switch(moveType){case"start":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);offset=0,$scope.currentPageNo=1;break;case"prev":if($scope.currentPageNo<=1)return offset=0,void($scope.currentPageNo=1);$scope.currentPageNo--,offset=($scope.currentPageNo-1)*limit;break;case"next":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo++,offset=($scope.currentPageNo-1)*limit;break;case"end":if($scope.currentPageNo>=$scope.totalPageCnt)return $scope.currentPageNo=$scope.totalPageCnt,void(offset=($scope.currentPageNo-1)*limit);$scope.currentPageNo=$scope.totalPageCnt,offset=($scope.currentPageNo-1)*limit}loadChat()}},$scope.getCost=function(topic){var cost=parseFloat(topic.cost);return cost}}]),angular.module("chattingCatApp").controller("Tutor.OneHistoryController",["$scope","$log","$stateParams","$filter","webStorage","commonFactory","apisFactory","accountFactory","$window","$sce",function($scope,$log,$stateParams,$filter,webStorage,commonFactory,apisFactory,accountFactory,$window,$sce){function loadTopic(){commonFactory.showWaiting();var promise=apisFactory.getTopic($scope.topicId);promise.then(function(d){$log.debug(JSON.stringify(d)),$scope.topic=$filter("parseTopic")(d),accountFactory.isPremium()?$scope.topic.comment=$filter("nl2br")($filter("linky")($scope.topic.comment,"_blank")):$scope.topic.comment=$filter("nl2br")($scope.topic.comment);for(var i=0;i<$scope.topic.corrected_texts.length;i++){var correctedText=$scope.topic.corrected_texts[i];if(correctedText.user.id===$scope.account.id){if($scope.myCorrectedText=correctedText,accountFactory.isPremium()?$scope.myCorrectedText.comment=$filter("nl2br")($filter("linky")($scope.myCorrectedText.comment,"_blank")):$scope.myCorrectedText.comment=$filter("nl2br")($scope.myCorrectedText.comment),correctedText.perfect)$scope.myCorrectedText.diff_text=$scope.myCorrectedText.originContent;else{var dmp=new diff_match_patch;$scope.myCorrectedText.diff_text=$sce.trustAsHtml(dmp.createDiffText($scope.topic.originContent,$scope.myCorrectedText.originContent))}break}}commonFactory.hideWaiting()},function(){commonFactory.hideWaiting(),$window.history.back()})}$scope.topicId=$stateParams.topicId,$scope.topic=null,$scope.myCorrectedText=null,$scope.account=accountFactory.getInfo().info,$scope.accountFactory=accountFactory,$scope.isShowDiff=!0,$scope.topicId?webStorage.session.add("topicId",$scope.topicId):$scope.topicId=webStorage.session.get("topicId"),loadTopic(),$scope.showDiff=function(){$scope.isShowDiff=!$scope.isShowDiff}}]),angular.module("chattingCatApp").service("faqData",["$sce",function($sce){var result=[{category:"General Topics",faqs:[{title:"Who is the typical ChattingCat student?",content:"Our students vary from people using our service for fun to others that use it in their day-to-day work correspondence. We have students from all over the world who want their writing to be corrected. Most students copy and paste your final correction directly into their document so make sure it is perfect."},{title:"My corrected chat was sent for a second opinion. What does this mean?",content:"Students have the option of sending a corrected chat to another tutor for a second opinion. Do not take offense to this, as it does not mean your correction was wrong. In fact, we are sure it was absolutely perfect. <br /><br /> Requesting a second opinion just means that the student is willing to use extra catnip to have another tutor read their chat. It is kind of like having a second pair of eyes read the same thing."},{title:"Do students have any way to communicate with their tutors?",content:"For extra catnip, students can opt to leave a tutor message. This will be shown below the chat box. <br /><br />For example, sometimes students will say that the chat is a cover letter, resume, or formal business email. Please check if your students have left a message as it could help you better understand the chat."},{title:"Is it Chatting Cat, ChattingCat, chatting cat, or Chattingcat?",content:"Please use ChattingCat for all your corrections. As it is our company and our brand, this is an important one for us. Surprisingly, this question does come up from our tutors, and we do occasionally have to remind tutors about this."},{title:"It seems like ChattingCat is really growing. Are you hiring for any other positions?",content:$sce.trustAsHtml("We are always expanding our services and looking for qualified, experienced, and motivated individuals to join our growing team. We mainly seek ESL/EFL teachers or lecturers, proofreaders, editors, copywriters, journalists, or anyone else with highly developed writing skills. All work correspondence is via email, so you can work from anywhere in the world and at your own schedule! <br /><br />If you are interested in such opportunities, email your resume (.pdf preferred) and writing sample(s) to  <a href='mailto:tutorjobs@chattingcat.com'.>tutorjobs@chattingcat.com</a>. We have big plans for the future of ChattingCat and would like you to grow with us!")}]},{category:"Suggestions and Tips",faqs:[{title:"On some of the short chats, I feel like I am rushing. What happens if I run out of time?",content:"The easiest way to make mistakes is to rush your corrections. Keep an eye on the remaining time and if you run out, it is not a big deal. It will not affect your status with ChattingCat. We would rather you take your time and get it right. Just to let you know, when you run out of time, the chat will reappear again in the chat list. Refresh your browser and you will see it again.<br /><br /><strong>Tip</strong>: If you only have a few seconds left and you are not finished, copy (ctrl + C) the corrections you have done so far and hit the 'x' button at the top right of the chat box. Refresh your browser and the chat will pop up again. Then you can just paste (ctrl + v) and continue your correction."},{title:"Why cant I see any chats? Have they already been taken?",content:"Try refreshing your browser and you will see the chats in the correct order. The key to getting chats when the site is busy is to keep refreshing your browser and be quick to hit the commit button.<br /><br /><strong>Tip</strong>: The majority of our students are located in South Korea. The busiest times are typically Monday to Friday, from 1:00 to 10:00 PM, Korea Standard Time (KST). This is when you will find the most chats available on ChattingCat."},{title:"How can I make sure that my corrections are perfect?",content:"A first suggestion would be to confirm that the spelling and grammar is flawless. These are mistakes that will definitely lead to flagging by our Quality Control Team.<br /><br />The second suggestion is to change the wording to make it sound more like a native speaker. We want students chats to be more natural and this means using your knowledge to substitute words for more appropriate vocabulary.<br /><br />The third suggestion is to take your time while correcting. Mistakes happen when you rush to correct the chat or do not give it your 100% attention. Slow down and make it perfect.<br /><br />Finally, double and even triple check your work before hitting the submit button. By reading it over a few times before submitting, you may catch a few more things you may have missed."}]},{category:"Format and Writing",faqs:[{title:"What style of writing should I use: formal or casual?",
content:"We ask you to use your best judgement. If the chat seems like a casual chat between friends, then using contractions, appropriate slang, and shorter sentences are acceptable.<br /><br />On the other hand, if the chat seems like a formal business email or letter of reference, then avoid contractions, use formal words, and try not to start a sentence with 'but', 'and', or 'because'. Basically, write in the style you think is appropriate for the chat."},{title:"I do not know what the student is trying to say? How do I correct this chat?",content:"If you do not know the exact meaning of the chat or the context, make a guess and try your best! Sometimes reading the entire chat first will help you understand what the student is trying to say and comprehend the overall meaning of the message.<br /><br />Start with the apparent grammatical or spelling mistakes, capitalization or punctuation errors, and then move to the meaning. Just make it better and the student will appreciate it."},{title:"Is punctuation important?",content:"As a tutor, you should make sure all punctuation is perfect, including proper comma usage, adding periods, parentheses use, etc.<br /><br />Also, consider the formality of the chat (See formal vs. casual above). If the chat seems like a text message, then three exclamation points and a smiley face might be appropriate. If it seems like a business email, then it needs more formality."},{title:"Should I change the format and structure of the chat?",content:"You should make sure the overall structure, message, and paragraph format are perfect. Many of our students copy and paste what you have corrected without any further revisions, so make sure it is ready for the world to see."},{title:"How much can I change the original message?",content:"We ask you to keep the original message as close to its intended meaning as possible. Avoid exaggerating or adding too much extra meaning to the chat. Just take what you have and make it sound like a native English speaker wrote it."},{title:"There are several ways a chat could be corrected. Can I leave several corrections?",content:"Yes you can, but make sure that you have enough time to do so. Leaving two or three different ways to correct a chat is good because it allows the student the choice of which one they like the best.<br /><br />However, your primary goal is to correct what you see. You are not required to leave more than one correction for the same chat. But, also keep in mind that some students give higher ratings when tutors leave multiple corrections."},{title:"The students chat is perfect. What do I do?",content:"Below the tutors text box, there is a checkbox that reads This chat is perfect. When the chat is perfect, you can leave an encouraging message for your student.<br /><br />This also assures students that a chat that needs no correction is a good thing and not a mistake. Essentially, it means the student did a great job and you are encouraged to let them know that (See below)."},{title:"Can I leave personal messages for students?",content:"Yes you can, and we encourage you to do this, if you have time. You can write anything you would like as long as it is related the chat. When leaving a personal message, try to use the following structure: <p class='tutor-faq-message'>Message: Your chat was really well done and I think you did a great job expressing yourself.</p> Please do not provide your personal information or email address in your messages. Your account will be disabled if you do this.<br /><br /> Messages should be an encouragement or an explanation of what you corrected, and why you corrected it the way you did. Some students provide higher ratings to tutors who leave them messages, but you are not required to do so."},{title:"What if a student asks a question in the chat?",content:"Your number one job at ChattingCat is to provide perfect corrections. After correcting the question to make it perfect, it is OK to answer it as a personal message stated above. <br />Keep in mind that you do not have to do this as our service is strictly an English correction service."}]},{category:"Tutor Quality Control",faqs:[{title:"How does ChattingCat monitor the quality of tutor corrections?",content:"Our Quality Control Team reads each and every chat that is corrected. If there is a mistake, the chat gets flagged. After two instances of chats being flagged, you will be sent a warning email.<br /><br />You will then be placed on our warning list and our Quality Control Team will closely monitor all your corrections from then on to see if the quality improves.<br /><br />If the quality does not improve, then a second warning email will be sent. After this second warning, you will not get any more warnings. If mistakes continue, then your account will be deactivated without notice, and you will no longer be a ChattingCat tutor.<br /><br />We understand that mistakes can sometimes happen because we are human. What we worry about is when a tutor continually makes mistakes and does not improve. Thus, please make sure you check the quality of your correction before hitting the submit button.<br /><br />If you are placed on the tutor warning list and your corrections improve, you will be removed after three months of mistake-free chat corrections."}]},{category:"Cashouts and Payments",faqs:[{title:"How do you pay out catnip? How long does it take?",content:"Tutors can cashout a minimum of $5 USD (100 catnips) to a maximum of $100 USD (2,000 catnips). Our preferred and most common payment method is via PayPal because it is a fast and easy way to get your funds. Please remember that PayPal charges $0.30 cents per transaction plus a 2.9% fee (as of January 2015).<br /><br />We will send you a PayPal payment within two business days after you request it on the ChattingCat website.<br /><br />You must know that PayPal transfers to your bank account, and it may take 3-5 business days depending on your bank. We have no control over this part of the process, but we have noticed that most tutors receive their funds around the three day mark.<br /><br />We can mail out bank checks, but this service is not available outside the Continental United States. The minimum cash out amount to receive a check payment is $20 (400 catnips)."}]},{category:"Star Rating System",faqs:[{title:"How does the tutor rating system work? What do the stars mean?",content:"When students receive corrected chats, they must rate the corrections. This system is used by ChattingCat only, and students cannot see your average ratings.<br /><br />We must provide consistently accurate corrections, so these ratings allow us to investigate tutors who have low star ratings to see if there is a problem."},{title:"Why did the student give me a low rating when the correction was perfect?",content:"We understand that some students may leave you a low rating even though your correction was perfect. We look at these instances on a case-by-case basis, and this will not negatively impact your status at ChattingCat.<br /><br />Low ratings are sometimes given when students do not fully understand the vocabulary, expressions, grammar, or meaning of your correction because their native language is not English.<br /><br />Do not worry too much about low ratings unless they are due to obvious mistakes by you.<br />We do monitor low rated chats to make sure that they are not due to obvious tutor mistakes."}]}];return result}]),angular.module("chattingCatApp").controller("Tutor.FaqController",["$scope","faqData","accountFactory","$state","commonFactory",function($scope,faqData,accountFactory,$state,commonFactory){var $groups=$(".panel-group"),$leftTabs=$(".nav-sidebar a");$leftTabs.each(function(seq){$(this).click(function(){return $leftTabs.removeClass("active"),$(this).addClass("active"),$groups.hide(),$groups.eq(seq).show(),!1})}),$scope.lang=commonFactory.getFirstBrowserLanguage(),console.info($scope.lang),$scope.accountType=accountFactory.getUserRole();var account=accountFactory.getInfo().info;if("student"===account.role)return void $state.go(accountFactory.getRoleHome());var accordionIcon={};$scope.faqData=faqData,$scope.getCss=function(obj){return accordionIcon["seq"+obj.$id]||"glyphicon-chevron-right"},$scope.toggleIcon=function(obj){var currentCss=accordionIcon["seq"+obj.$id];currentCss&&"glyphicon-chevron-right"!==currentCss?accordionIcon["seq"+obj.$id]="glyphicon-chevron-right":accordionIcon["seq"+obj.$id]="glyphicon-chevron-down"},$scope.showSearch=function(title,searchText){return searchText&&0!==searchText.length?title.toLocaleLowerCase().indexOf(searchText)>-1?!0:!1:!0}}]),angular.module("chattingCatApp").controller("Tutor.MainController",["$scope","$location","accountFactory","commonFactory","socketFactory","$log","socketEvent","notificationFactory","topicCorrectionEvent","$timeout","$state","socketHeartbeatInterval",function($scope,$location,accountFactory,commonFactory,socketFactory,$log,socketEvent,notificationFactory,topicCorrectionEvent,$timeout,$state,socketHeartbeatInterval){function socketConfig(){socketFactory.getClient($scope).then(function(socket){socketClient=socket,socketClient.subscribe("tutors-account",function(message){var action=message.event_type;switch(action){}}),socketClient.subscribe("tutors-topics",function(message){$log.debug("tutor-main="+JSON.stringify(message));var recipient=message.recipient,event_type=message.event_type,chat_type=message.type;if(recipient===accountFactory.getInfo().info.id||"tutors"===recipient)switch(event_type){case"topic_created":if("premium"===chat_type&&!accountFactory.isPremium())return;return $scope.$broadcast(socketEvent.topicCreatedBroadcasted,message);case"topic_locked":return $scope.$broadcast(socketEvent.topicLockedBroadcasted,message);case"topic_unlocked":return $scope.$broadcast(socketEvent.topicUnlockedBroadcasted,message);case"topic_declined":return notificationFactory.notification(event_type,"tutor"),$scope.$broadcast(socketEvent.topicDeclinedBroadcasted,message);case"topic_canceled":return notificationFactory.notification(event_type,"tutor"),$scope.$broadcast(socketEvent.topicCanceledBroadcasted,message);case"premium_topic_created":return $scope.$broadcast(socketEvent.topicCreatedBroadcasted,message);case"review_locked":return $scope.$broadcast(socketEvent.reviewLockedBroadcasted,message)}})},function(){socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))})}function checksocketConnection(){if(++socketReconnectedCnt<=3){try{socketClient.disconnect()}catch(e){}socketConfig(),socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))}else $scope.$broadcast("controlPolling",{isPolling:!0})}$scope.accountType=accountFactory.getUserRole(),$scope.account=accountFactory.getInfo().info,$scope.currentPath=$state.current.name,$scope.tutorIcon=accountFactory.getIcon();var socketClient,socketCheckTimerIDList=[],socketCheckTime=1e3*parseInt(socketHeartbeatInterval)+2e3,socketReconnectedCnt=0;socketFactory.isSupportWebSocket()?socketConfig():$scope.$broadcast("controlPolling",{isPolling:!0}),$scope.$on(socketEvent.heartBeatBroadcasted,function(){for(var i=-1,cnt=socketCheckTimerIDList.length;++i<cnt;)$timeout.cancel(socketCheckTimerIDList[i]);socketReconnectedCnt=0,socketCheckTimerIDList.push($timeout(checksocketConnection,socketCheckTime))}),$scope.$on("$stateChangeStart",function(next,current){$scope.currentPath=current.name}),$scope.$on(topicCorrectionEvent.realtimeCorrecting,function(event,params){socketFactory.isSupportWebSocket()&&socketClient&&socketClient.send(params.owner+"-topics",angular.extend(params,{recipient:params.owner,event_type:"topic_correcting"}))})}]),angular.module("chattingCatApp").controller("Tutor.InactiveController",["$scope","commonFactory","accountFactory","$state","$window","serviceUrlConfig",function($scope,commonFactory,accountFactory,$state,$window,serviceUrlConfig){$scope.accountType=accountFactory.getUserRole(),$scope.state="confirmMesssage",$scope.alerts=[],$scope.email="",$scope.accountEmail=accountFactory.getInfo().info.email,$scope.showEmailForm=function(){$scope.state="emailForm"},$scope.sendEmail=function(email){var promise=accountFactory.resetConfirmation({user:{email:email}});promise.then(function(){$scope.alerts=[],$scope.state="resendMessage"},function(error){var message=error.data.message;"not found user"===message&&($scope.alerts.pop(),$scope.alerts.push({type:"danger",msg:"We couldn't find your account with that information."}))})},$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$scope.backHome=function(){$window.location.href=serviceUrlConfig}}]),angular.module("chattingCatApp").controller("TutorQualify.ProfileController",["$scope","$location","videoFactory","accountFactory","$state","routeName","commonFactory","$window",function($scope,$location,videoFactory,accountFactory,$state,routeName,commonFactory,$window){$scope.accountType=accountFactory.getUserRole(),$scope.goNext=function(){$state.go(routeName.TUTOR_QUALIFY_INFO)},$scope.videoUrl=commonFactory.getLangVideoUrl(),$("a.fancybox-media").click(function(){$("a.fancybox-media").fancybox($window.innerWidth<768?{width:300,height:200,type:"iframe",fitToView:!1}:{width:600,height:400,type:"iframe",fitToView:!1})})}]),angular.module("chattingCatApp").controller("TutorQualify.InfoController",["$scope","$location","videoFactory","accountFactory","$state","routeName","$http","commonFactory","$log","apisFactory","modalService","langTextFactory",function($scope,$location,videoFactory,accountFactory,$state,routeName,$http,commonFactory,$log,apisFactory,modalService,langTextFactory){$scope.accountType=accountFactory.getUserRole(),$scope.myFile=null,$scope.degreeList=commonFactory.degreeList,$scope.englishList=commonFactory.englishList,$scope.countryList=commonFactory.countryList,$scope.studyOptions=commonFactory.studyOptions,$scope.tutorFormSubmitted=!1,$scope.tutorCareerOrCompany=!0,$scope.tutor={educations:[],careers:[],speciality:[],resume_path:"",payment:"p",paypal_email:"",exist:!1,agreement:1},$scope.getCheckedAgreement=function(){return 1===$scope.tutor.agreement},$scope.changeAgreement=function(){1===$scope.tutor.agreement?$scope.tutor.agreement=0:$scope.tutor.agreement=1},$scope.addEducationRow=function(){$scope.tutor.educations.push({university_name:"",degree:"",major:"",from_year:"",to_year:""})},$scope.removeEducationRow=function(index){$scope.tutor.educations.splice(index,1)},$scope.addCareerRow=function(){$scope.tutor.careers.push({name:"",position:"",from_year:"",to_year:""})},$scope.removeCareerRow=function(index){$scope.tutor.careers.splice(index,1)},$scope.updateStudyOption=function(d){var idx=$scope.tutor.speciality.indexOf(d);idx>-1?$scope.tutor.speciality.splice(idx,1):$scope.tutor.speciality.push(d)},$scope.getDisabled=function(d){return $scope.tutor.speciality.length>=3&&-1===$scope.tutor.speciality.indexOf(d)},$scope.getCheckedStudyOption=function(optionName){return $scope.tutor.speciality.indexOf(optionName)>-1},$scope.submitTutorInfo=function(valid,tutor){$scope.tutorFormSubmitted=!0,$scope.tutorCareerOrCompany=$scope.tutor.educations.length>0||$scope.tutor.careers.length>0,$scope.tutorCareerOrCompany&&($scope.tutor.speciality.length<1||($scope.tutor.resume_path||$scope.resumeFile)&&($log.debug("tutorInfoForm.valid="+valid),valid&&$scope.updateTutorInfo(tutor)))},$scope.updateTutorInfo=function(tutor){apisFactory.setTutorInfo($scope.tutor.exist,tutor,function(){$scope.tutorFormSubmitted=!1,$scope.tutor.exist=!0,$scope.resumeFile?$scope.uploadResume():$state.go(routeName.TUTOR_QUALIFY_TEST)},function(){$scope.tutorFormSubmitted=!1,modalService.open({title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.fail"),closeBtnName:"Close",alertIcon:!0})})},$(document).ready(function(){$("#uploadBtn").change(function(){var path=$(this).val();$("#uploadFile").text(path.substring(path.lastIndexOf("\\")+1,path.length))})}),$scope.resumeFile=null,$scope.uploadResume=function(){$scope.resumeFile&&apisFactory.uploadResume($scope.resumeFile,accountFactory.getInfo().info.id,function(success){$scope.tutor.resume_path=success.resume_path,$state.go(routeName.TUTOR_QUALIFY_TEST)},function(){modalService.open({title:"Fail",content:langTextFactory.get(commonFactory.getLangCode(),"common.update.fail"),isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})})},$scope.$on("$viewContentLoaded",function(){$scope.getTutorInfo()}),$scope.getTutorInfo=function(){apisFactory.getTutorInfo(accountFactory.getInfo().info.id,function(success){$log.debug("getTutorInfo:"+JSON.stringify(success)),angular.equals({},success)||($scope.tutor=success.info,$scope.tutor.exist=!0,void 0===$scope.tutor.careers&&($scope.tutor.careers=[]),void 0===$scope.tutor.educations&&($scope.tutor.educations=[]),(void 0===$scope.tutor.speciality||'[""]'===JSON.stringify($scope.tutor.speciality))&&($scope.tutor.speciality=[])),$scope.$apply()})}}]),angular.module("chattingCatApp").controller("TutorQualify.TestController",["$scope","accountFactory","$state","routeName","$log",function($scope,accountFactory,$state,routeName,$log){$scope.accountType=accountFactory.getUserRole(),$scope.testset=[{quiz_id:1,sentence:"Now I am ordering some food watching football."},{quiz_id:2,sentence:"This article is about a new weight loss drug, which is under the approval procedure by FDA."},{quiz_id:3,sentence:"Please correct my English in the email, if you find anything that needs to be edited."},{quiz_id:4,sentence:"Please answer to the rest of the questionnaire."},{quiz_id:5,sentence:"Dave is born to be a singer."}],$scope.random_quizzes=[{quiz_id:6,sentence:"If you were an animal, what would you be and why?"},{quiz_id:7,sentence:"Who has been the most influential person in your life and why?"},{quiz_id:8,sentence:"What makes you happiest and why?"},{quiz_id:9,sentence:"What is your favorite word and why?"},{quiz_id:10,sentence:"Who is your role model and why?"},{quiz_id:11,sentence:"Why should you be a ChattingCat tutor?"},{quiz_id:12,sentence:"What five things would you bring to a deserted island and why?"},{quiz_id:13,sentence:"Which is better: Pepsi or Coke? Explain."},{quiz_id:14,sentence:"What are your strengths and weaknesses?"},{quiz_id:15,sentence:"Are you a cat or dog person and why?"}],$scope.quizResponse="",$scope.currentProfileWordCount=0,$scope.$watch("quizResponse",function(value){value&&($scope.currentProfileWordCount=value.replace(/(\s+)/g," ").split(" ").length)}),$scope.question=[];for(var i=-1,cnt=$scope.testset.length;++i<cnt;)$scope.question.push({quiz_id:$scope.testset[i].quiz_id,sentence:$scope.testset[i].sentence});var index=parseInt(5*Math.random());$scope.quiz=$scope.random_quizzes[index],$scope.validatedMinWordsProfile=!0,$scope.sendTest=function(){if(!($scope.currentProfileWordCount>=150))return void($scope.validatedMinWordsProfile=!1);$scope.validatedMinWordsProfile=!0,$scope.profile=[],$scope.profile.push({quiz_id:$scope.random_quizzes[index].quiz_id,response:$scope.quizResponse});var tutorResponse={};tutorResponse.screening={},tutorResponse.screening.test=$scope.question,tutorResponse.screening.profile=$scope.profile,$log.debug(tutorResponse.screening.test),$log.debug(tutorResponse.screening.profile);var promise=accountFactory.screeningTutor(tutorResponse,accountFactory.getInfo().info.id);promise.then(function(){$state.go(routeName.TUTOR_QUALIFY_STATE)},function(){})}}]),angular.module("chattingCatApp").controller("TutorQualify.StateController",["$scope","accountFactory",function($scope,accountFactory){$scope.accountType=accountFactory.getUserRole();var promise=accountFactory.loadInfo();promise.then(function(){$scope.account=accountFactory.getInfo().info,$scope.tutorState=$scope.account.qualify_state},function(){accountFactory.logout()})}]),angular.module("chattingCatApp").controller("TutorQualify.MainController",["$scope","accountFactory",function($scope,accountFactory){$scope.accountType=accountFactory.getUserRole()}]),angular.module("chattingCatApp").controller("Help.CouponDescController",["$window","$location","$scope",function($window,$location,$scope){function resize(){window.innerWidth<900?($("#large").attr("width",200),$("#large").css("margin-left","-100px"),$("#button").attr("width",62),$("#button").css("margin-left","-31px"),$("#button").css("margin-top","220px"),$("#desc").css("width",200),$("#desc").css("margin-left","-100px"),$("#desc").css("margin-top","242px")):($("#large").attr("width",800),$("#large").css("margin-left","-400px"),$("#button").attr("width",250),$("#button").css("margin-left","-125px"),$("#button").css("margin-top","800px"),$("#desc").css("width",800),$("#desc").css("margin-left","-400px"),$("#desc").css("margin-top","890px"))}$location.search().lang?($scope.backImgUrl="/images/back_korea.5fb437bc.png",$scope.buttonImgUrl="/images/button_korea.6e4cd4d9.png",$scope.descImgUrl="/images/desc_korea.3a49ff04.png"):($scope.backImgUrl="/images/back.1825c9dc.png",$scope.buttonImgUrl="/images/button.6f90c94e.png",$scope.descImgUrl="/images/desc.2c80e844.png");var w=angular.element($window);w.bind("resize",function(){resize()}),resize()}]),angular.module("chattingCatApp").controller("Organization.MainController",["$scope","$state","$stateParams","$log","apisFactory","_",function($scope,$state,$stateParams,$log,apisFactory,_){function loadOrganization(slug){var promise=apisFactory.getOrganization(slug);promise.then(function(response){$scope.org=_.pick(response,"name","slug","owner","available_catnips","used_catnips","members_count")},function(failure){$log.debug(failure)})}$scope.currentPath=$state.current.name,$scope.$stateParams=$stateParams;var defaultValues={name:null,slug:null,owner:null,available_catnips:0,used_catnips:0,members_count:0};$scope.org=defaultValues,$scope.$on("$stateChangeStart",function(next,current){$scope.currentPath=current.name}),loadOrganization($stateParams.slug)}]),angular.module("chattingCatApp").controller("Organization.MembersController",["$scope","$stateParams","$log","apisFactory","_",function($scope,$stateParams,$log,apisFactory,_){function loadOrganizationMembers(slug){var promise=apisFactory.getOrganizationMembers(slug);promise.then(function(response){$scope.members=_.map(response.members,function(member){return _.pick(member,"id","username","name","email","role","chats","used_catnips","joined_at")})},function(failure){$log.debug(failure)})}$scope.members=[],loadOrganizationMembers($stateParams.slug)}]),angular.module("chattingCatApp").controller("Organization.PaymentsController",["$scope","$stateParams","$filter","$log","apisFactory","_",function($scope,$stateParams,$filter,$log,apisFactory,_){function loadOrganizationPayments(slug){var promise=apisFactory.getOrganizationPayments(slug);promise.then(function(response){$scope.payments=_.map(response.payments,function(payment){return _.pick(payment,"id","amount","original_price","payment_type","currency","status","created_at","updated_at")}),$scope.showEmptyList=0===$scope.payments.length},function(failure){$log.debug(failure)})}$scope.payments=[],$scope.showEmptyList=!1,$scope.paymentAmount=function(payment){return"krw"===payment.currency?$filter("currency")(payment.original_price,"",0)+"":"usd"===payment.currency?$filter("currency")(payment.original_price,"$",2):void 0},$scope.paymentMethod=function(payment){return"b2b"===payment.payment_type?"Bank Transfer":void 0},$scope.paymentStatus=function(payment){return"open"===payment.status?"Pending":payment.status.charAt(0).toUpperCase()+payment.status.slice(1)},loadOrganizationPayments($stateParams.slug)}]),angular.module("chattingCatApp").controller("Tutor.ReviewTextController",["$rootScope","$scope","$state","$stateParams","$log","apisFactory","_","$sce","$filter",function($rootScope,$scope,$state,$stateParams,$log,apisFactory,_,$sce,$filter){function loadReviewText(id){var promise=apisFactory.getReviewText(id);promise.then(function(res){if($scope.reviewText=_.pick(res,"original_text","corrected_text","cost","reviewed"),$scope.content.original=$filter("newlines")($scope.reviewText.original_text.content),$scope.content.corrected=$filter("newlines")($scope.reviewText.corrected_text.content),$scope.reviewText.corrected_text.perfect)$scope.content.diff=$scope.content.original;else{var dmp=new diff_match_patch;$scope.content.diff=$sce.trustAsHtml(dmp.createDiffText($scope.reviewText.original_text.content,$scope.reviewText.corrected_text.content))}},function(err){$log.debug(err),$state.go("tutor.index")})}var ratingTexts=["Very Bad","Bad","Ok","Good","Excellent"],$ratingReasonSelect=$("#select-rating-reason"),$reviewComment=$("#review-comment");$ratingReasonSelect.chosen(),$ratingReasonSelect.on("change",function(){$scope.warnings.reason=!1}),$scope.reviewText=null,$scope.displayMode="diff",$scope.content={original:"",corrected:"",diff:""},$scope.warnings={score:!1,reason:!1},$scope.ratings=new Array(5),$scope.rating=0,$scope.ratingText="",$scope.ratingSelect=function(index){$scope.rating=index+1,$scope.warnings.reason=!1},$scope.ratingSelected=function(index){return index<$scope.rating},$scope.showRatingText=function(index){$scope.ratingText=ratingTexts[index],$scope.warnings.score=!1},$scope.showSelectedRatingText=function(){$scope.ratingText=$scope.rating>0?ratingTexts[$scope.rating-1]:""},$scope.showContent=function(mode){$scope.displayMode=mode},$scope.submitReview=function(){if($scope.rating||$scope.rating>0||($scope.warnings.score=!0),1!==$scope.rating&&2!==$scope.rating||$ratingReasonSelect.val()||($scope.warnings.reason=!0),!_.any(_.values($scope.warnings))){var params={score:$scope.rating||0,tags:$ratingReasonSelect.val()||[],comment:$reviewComment.val()||""},review={review:params},promise=apisFactory.submitChatReview($scope.reviewText.corrected_text.id,review);promise.then(function(res){$scope.reviewText=_.pick(res,"original_text","corrected_text","cost","reviewed"),$rootScope.$emit("reloadAccount",{}),$state.go("tutor.index")},function(err){$log.debug(err)})}},loadReviewText($stateParams.corrected_text_id),$scope.$on("$destroy",function(){$ratingReasonSelect.off("change"),$scope.reviewText.reviewed===!1&&apisFactory.uncommitChatReview($scope.reviewText.corrected_text.id)}),$(window).scrollTop(0)}]),function(){"use strict";var crop=angular.module("ngImgCrop",[]);crop.factory("cropAreaCircle",["cropArea",function(CropArea){var CropAreaCircle=function(){CropArea.apply(this,arguments),this._boxResizeBaseSize=20,this._boxResizeNormalRatio=.9,this._boxResizeHoverRatio=1.2,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._boxResizeNormalSize=this._boxResizeBaseSize*this._boxResizeNormalRatio,this._boxResizeHoverSize=this._boxResizeBaseSize*this._boxResizeHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._boxResizeIsHover=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!1,this._areaIsDragging=!1};return CropAreaCircle.prototype=new CropArea,CropAreaCircle.prototype._calcCirclePerimeterCoords=function(angleDegrees){var hSize=this._size/2,angleRadians=angleDegrees*(Math.PI/180),circlePerimeterX=this._x+hSize*Math.cos(angleRadians),circlePerimeterY=this._y+hSize*Math.sin(angleRadians);return[circlePerimeterX,circlePerimeterY]},CropAreaCircle.prototype._calcResizeIconCenterCoords=function(){return this._calcCirclePerimeterCoords(-45)},CropAreaCircle.prototype._isCoordWithinArea=function(coord){return Math.sqrt((coord[0]-this._x)*(coord[0]-this._x)+(coord[1]-this._y)*(coord[1]-this._y))<this._size/2},CropAreaCircle.prototype._isCoordWithinBoxResize=function(coord){var resizeIconCenterCoords=this._calcResizeIconCenterCoords(),hSize=this._boxResizeHoverSize/2;return coord[0]>resizeIconCenterCoords[0]-hSize&&coord[0]<resizeIconCenterCoords[0]+hSize&&coord[1]>resizeIconCenterCoords[1]-hSize&&coord[1]<resizeIconCenterCoords[1]+hSize},CropAreaCircle.prototype._drawArea=function(ctx,centerCoords,size){ctx.arc(centerCoords[0],centerCoords[1],size/2,0,2*Math.PI)},CropAreaCircle.prototype.draw=function(){CropArea.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio),this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(),this._boxResizeBaseSize,this._boxResizeIsHover?this._boxResizeHoverRatio:this._boxResizeNormalRatio)},CropAreaCircle.prototype.processMouseMove=function(mouseCurX,mouseCurY){var cursor="default",res=!1;if(this._boxResizeIsHover=!1,this._areaIsHover=!1,this._areaIsDragging)this._x=mouseCurX-this._posDragStartX,this._y=mouseCurY-this._posDragStartY,this._areaIsHover=!0,cursor="move",res=!0,this._events.trigger("area-move");else if(this._boxResizeIsDragging){cursor="nesw-resize";var iFR,iFX,iFY;iFX=mouseCurX-this._posResizeStartX,iFY=this._posResizeStartY-mouseCurY,iFR=iFX>iFY?this._posResizeStartSize+2*iFY:this._posResizeStartSize+2*iFX,this._size=Math.max(this._minSize,iFR),this._boxResizeIsHover=!0,res=!0,this._events.trigger("area-resize")}else this._isCoordWithinBoxResize([mouseCurX,mouseCurY])?(cursor="nesw-resize",this._areaIsHover=!1,this._boxResizeIsHover=!0,res=!0):this._isCoordWithinArea([mouseCurX,mouseCurY])&&(cursor="move",this._areaIsHover=!0,res=!0);return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:cursor}),res},CropAreaCircle.prototype.processMouseDown=function(mouseDownX,mouseDownY){this._isCoordWithinBoxResize([mouseDownX,mouseDownY])?(this._areaIsDragging=!1,this._areaIsHover=!1,this._boxResizeIsDragging=!0,this._boxResizeIsHover=!0,this._posResizeStartX=mouseDownX,this._posResizeStartY=mouseDownY,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([mouseDownX,mouseDownY])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._boxResizeIsDragging=!1,this._boxResizeIsHover=!1,this._posDragStartX=mouseDownX-this._x,this._posDragStartY=mouseDownY-this._y,this._events.trigger("area-move-start"))},CropAreaCircle.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._boxResizeIsDragging&&(this._boxResizeIsDragging=!1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._boxResizeIsHover=!1,this._posDragStartX=0,this._posDragStartY=0},CropAreaCircle}]),crop.factory("cropAreaSquare",["cropArea",function(CropArea){var CropAreaSquare=function(){CropArea.apply(this,arguments),this._resizeCtrlBaseRadius=10,this._resizeCtrlNormalRatio=.75,this._resizeCtrlHoverRatio=1,this._iconMoveNormalRatio=.9,this._iconMoveHoverRatio=1.2,this._resizeCtrlNormalRadius=this._resizeCtrlBaseRadius*this._resizeCtrlNormalRatio,this._resizeCtrlHoverRadius=this._resizeCtrlBaseRadius*this._resizeCtrlHoverRatio,this._posDragStartX=0,this._posDragStartY=0,this._posResizeStartX=0,this._posResizeStartY=0,this._posResizeStartSize=0,this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._resizeCtrlIsDragging=-1,this._areaIsDragging=!1};return CropAreaSquare.prototype=new CropArea,CropAreaSquare.prototype._calcSquareCorners=function(){var hSize=this._size/2;return[[this._x-hSize,this._y-hSize],[this._x+hSize,this._y-hSize],[this._x-hSize,this._y+hSize],[this._x+hSize,this._y+hSize]]},CropAreaSquare.prototype._calcSquareDimensions=function(){var hSize=this._size/2;return{left:this._x-hSize,top:this._y-hSize,right:this._x+hSize,bottom:this._y+hSize}},CropAreaSquare.prototype._isCoordWithinArea=function(coord){var squareDimensions=this._calcSquareDimensions();return coord[0]>=squareDimensions.left&&coord[0]<=squareDimensions.right&&coord[1]>=squareDimensions.top&&coord[1]<=squareDimensions.bottom},CropAreaSquare.prototype._isCoordWithinResizeCtrl=function(coord){for(var resizeIconsCenterCoords=this._calcSquareCorners(),res=-1,i=0,len=resizeIconsCenterCoords.length;len>i;i++){var resizeIconCenterCoords=resizeIconsCenterCoords[i];if(coord[0]>resizeIconCenterCoords[0]-this._resizeCtrlHoverRadius&&coord[0]<resizeIconCenterCoords[0]+this._resizeCtrlHoverRadius&&coord[1]>resizeIconCenterCoords[1]-this._resizeCtrlHoverRadius&&coord[1]<resizeIconCenterCoords[1]+this._resizeCtrlHoverRadius){
res=i;break}}return res},CropAreaSquare.prototype._drawArea=function(ctx,centerCoords,size){var hSize=size/2;ctx.rect(centerCoords[0]-hSize,centerCoords[1]-hSize,size,size)},CropAreaSquare.prototype.draw=function(){CropArea.prototype.draw.apply(this,arguments),this._cropCanvas.drawIconMove([this._x,this._y],this._areaIsHover?this._iconMoveHoverRatio:this._iconMoveNormalRatio);for(var resizeIconsCenterCoords=this._calcSquareCorners(),i=0,len=resizeIconsCenterCoords.length;len>i;i++){var resizeIconCenterCoords=resizeIconsCenterCoords[i];this._cropCanvas.drawIconResizeCircle(resizeIconCenterCoords,this._resizeCtrlBaseRadius,this._resizeCtrlIsHover===i?this._resizeCtrlHoverRatio:this._resizeCtrlNormalRatio)}},CropAreaSquare.prototype.processMouseMove=function(mouseCurX,mouseCurY){var cursor="default",res=!1;if(this._resizeCtrlIsHover=-1,this._areaIsHover=!1,this._areaIsDragging)this._x=mouseCurX-this._posDragStartX,this._y=mouseCurY-this._posDragStartY,this._areaIsHover=!0,cursor="move",res=!0,this._events.trigger("area-move");else if(this._resizeCtrlIsDragging>-1){var xMulti,yMulti;switch(this._resizeCtrlIsDragging){case 0:xMulti=-1,yMulti=-1,cursor="nwse-resize";break;case 1:xMulti=1,yMulti=-1,cursor="nesw-resize";break;case 2:xMulti=-1,yMulti=1,cursor="nesw-resize";break;case 3:xMulti=1,yMulti=1,cursor="nwse-resize"}var iFR,iFX=(mouseCurX-this._posResizeStartX)*xMulti,iFY=(mouseCurY-this._posResizeStartY)*yMulti;iFR=iFX>iFY?this._posResizeStartSize+iFY:this._posResizeStartSize+iFX;var wasSize=this._size;this._size=Math.max(this._minSize,iFR);var posModifier=(this._size-wasSize)/2;this._x+=posModifier*xMulti,this._y+=posModifier*yMulti,this._resizeCtrlIsHover=this._resizeCtrlIsDragging,res=!0,this._events.trigger("area-resize")}else{var hoveredResizeBox=this._isCoordWithinResizeCtrl([mouseCurX,mouseCurY]);if(hoveredResizeBox>-1){switch(hoveredResizeBox){case 0:cursor="nwse-resize";break;case 1:cursor="nesw-resize";break;case 2:cursor="nesw-resize";break;case 3:cursor="nwse-resize"}this._areaIsHover=!1,this._resizeCtrlIsHover=hoveredResizeBox,res=!0}else this._isCoordWithinArea([mouseCurX,mouseCurY])&&(cursor="move",this._areaIsHover=!0,res=!0)}return this._dontDragOutside(),angular.element(this._ctx.canvas).css({cursor:cursor}),res},CropAreaSquare.prototype.processMouseDown=function(mouseDownX,mouseDownY){var isWithinResizeCtrl=this._isCoordWithinResizeCtrl([mouseDownX,mouseDownY]);isWithinResizeCtrl>-1?(this._areaIsDragging=!1,this._areaIsHover=!1,this._resizeCtrlIsDragging=isWithinResizeCtrl,this._resizeCtrlIsHover=isWithinResizeCtrl,this._posResizeStartX=mouseDownX,this._posResizeStartY=mouseDownY,this._posResizeStartSize=this._size,this._events.trigger("area-resize-start")):this._isCoordWithinArea([mouseDownX,mouseDownY])&&(this._areaIsDragging=!0,this._areaIsHover=!0,this._resizeCtrlIsDragging=-1,this._resizeCtrlIsHover=-1,this._posDragStartX=mouseDownX-this._x,this._posDragStartY=mouseDownY-this._y,this._events.trigger("area-move-start"))},CropAreaSquare.prototype.processMouseUp=function(){this._areaIsDragging&&(this._areaIsDragging=!1,this._events.trigger("area-move-end")),this._resizeCtrlIsDragging>-1&&(this._resizeCtrlIsDragging=-1,this._events.trigger("area-resize-end")),this._areaIsHover=!1,this._resizeCtrlIsHover=-1,this._posDragStartX=0,this._posDragStartY=0},CropAreaSquare}]),crop.factory("cropArea",["cropCanvas",function(CropCanvas){var CropArea=function(ctx,events){this._ctx=ctx,this._events=events,this._minSize=80,this._cropCanvas=new CropCanvas(ctx),this._image=new Image,this._x=0,this._y=0,this._size=200};return CropArea.prototype.getImage=function(){return this._image},CropArea.prototype.setImage=function(image){this._image=image},CropArea.prototype.getX=function(){return this._x},CropArea.prototype.setX=function(x){this._x=x,this._dontDragOutside()},CropArea.prototype.getY=function(){return this._y},CropArea.prototype.setY=function(y){this._y=y,this._dontDragOutside()},CropArea.prototype.getSize=function(){return this._size},CropArea.prototype.setSize=function(size){this._size=Math.max(this._minSize,size),this._dontDragOutside()},CropArea.prototype.getMinSize=function(){return this._minSize},CropArea.prototype.setMinSize=function(size){this._minSize=size,this._size=Math.max(this._minSize,this._size),this._dontDragOutside()},CropArea.prototype._dontDragOutside=function(){var h=this._ctx.canvas.height,w=this._ctx.canvas.width;this._size>w&&(this._size=w),this._size>h&&(this._size=h),this._x<this._size/2&&(this._x=this._size/2),this._x>w-this._size/2&&(this._x=w-this._size/2),this._y<this._size/2&&(this._y=this._size/2),this._y>h-this._size/2&&(this._y=h-this._size/2)},CropArea.prototype._drawArea=function(){},CropArea.prototype.draw=function(){this._cropCanvas.drawCropArea(this._image,[this._x,this._y],this._size,this._drawArea)},CropArea.prototype.processMouseMove=function(){},CropArea.prototype.processMouseDown=function(){},CropArea.prototype.processMouseUp=function(){},CropArea}]),crop.factory("cropCanvas",[function(){var shapeArrowNW=[[-.5,-2],[-3,-4.5],[-.5,-7],[-7,-7],[-7,-.5],[-4.5,-3],[-2,-.5]],shapeArrowNE=[[.5,-2],[3,-4.5],[.5,-7],[7,-7],[7,-.5],[4.5,-3],[2,-.5]],shapeArrowSW=[[-.5,2],[-3,4.5],[-.5,7],[-7,7],[-7,.5],[-4.5,3],[-2,.5]],shapeArrowSE=[[.5,2],[3,4.5],[.5,7],[7,7],[7,.5],[4.5,3],[2,.5]],shapeArrowN=[[-1.5,-2.5],[-1.5,-6],[-5,-6],[0,-11],[5,-6],[1.5,-6],[1.5,-2.5]],shapeArrowW=[[-2.5,-1.5],[-6,-1.5],[-6,-5],[-11,0],[-6,5],[-6,1.5],[-2.5,1.5]],shapeArrowS=[[-1.5,2.5],[-1.5,6],[-5,6],[0,11],[5,6],[1.5,6],[1.5,2.5]],shapeArrowE=[[2.5,-1.5],[6,-1.5],[6,-5],[11,0],[6,5],[6,1.5],[2.5,1.5]],colors={areaOutline:"#fff",resizeBoxStroke:"#fff",resizeBoxFill:"#444",resizeBoxArrowFill:"#fff",resizeCircleStroke:"#fff",resizeCircleFill:"#444",moveIconFill:"#fff"};return function(ctx){var calcPoint=function(point,offset,scale){return[scale*point[0]+offset[0],scale*point[1]+offset[1]]},drawFilledPolygon=function(shape,fillStyle,centerCoords,scale){ctx.save(),ctx.fillStyle=fillStyle,ctx.beginPath();var pc,pc0=calcPoint(shape[0],centerCoords,scale);ctx.moveTo(pc0[0],pc0[1]);for(var p in shape)p>0&&(pc=calcPoint(shape[p],centerCoords,scale),ctx.lineTo(pc[0],pc[1]));ctx.lineTo(pc0[0],pc0[1]),ctx.fill(),ctx.closePath(),ctx.restore()};this.drawIconMove=function(centerCoords,scale){drawFilledPolygon(shapeArrowN,colors.moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowW,colors.moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowS,colors.moveIconFill,centerCoords,scale),drawFilledPolygon(shapeArrowE,colors.moveIconFill,centerCoords,scale)},this.drawIconResizeCircle=function(centerCoords,circleRadius,scale){var scaledCircleRadius=circleRadius*scale;ctx.save(),ctx.strokeStyle=colors.resizeCircleStroke,ctx.lineWidth=2,ctx.fillStyle=colors.resizeCircleFill,ctx.beginPath(),ctx.arc(centerCoords[0],centerCoords[1],scaledCircleRadius,0,2*Math.PI),ctx.fill(),ctx.stroke(),ctx.closePath(),ctx.restore()},this.drawIconResizeBoxBase=function(centerCoords,boxSize,scale){var scaledBoxSize=boxSize*scale;ctx.save(),ctx.strokeStyle=colors.resizeBoxStroke,ctx.lineWidth=2,ctx.fillStyle=colors.resizeBoxFill,ctx.fillRect(centerCoords[0]-scaledBoxSize/2,centerCoords[1]-scaledBoxSize/2,scaledBoxSize,scaledBoxSize),ctx.strokeRect(centerCoords[0]-scaledBoxSize/2,centerCoords[1]-scaledBoxSize/2,scaledBoxSize,scaledBoxSize),ctx.restore()},this.drawIconResizeBoxNESW=function(centerCoords,boxSize,scale){this.drawIconResizeBoxBase(centerCoords,boxSize,scale),drawFilledPolygon(shapeArrowNE,colors.resizeBoxArrowFill,centerCoords,scale),drawFilledPolygon(shapeArrowSW,colors.resizeBoxArrowFill,centerCoords,scale)},this.drawIconResizeBoxNWSE=function(centerCoords,boxSize,scale){this.drawIconResizeBoxBase(centerCoords,boxSize,scale),drawFilledPolygon(shapeArrowNW,colors.resizeBoxArrowFill,centerCoords,scale),drawFilledPolygon(shapeArrowSE,colors.resizeBoxArrowFill,centerCoords,scale)},this.drawCropArea=function(image,centerCoords,size,fnDrawClipPath){var xRatio=image.width/ctx.canvas.width,yRatio=image.height/ctx.canvas.height,xLeft=centerCoords[0]-size/2,yTop=centerCoords[1]-size/2;ctx.save(),ctx.strokeStyle=colors.areaOutline,ctx.lineWidth=2,ctx.beginPath(),fnDrawClipPath(ctx,centerCoords,size),ctx.stroke(),ctx.clip(),size>0&&ctx.drawImage(image,xLeft*xRatio,yTop*yRatio,size*xRatio,size*yRatio,xLeft,yTop,size,size),ctx.beginPath(),fnDrawClipPath(ctx,centerCoords,size),ctx.stroke(),ctx.clip(),ctx.restore()}}}]),crop.service("cropEXIF",[function(){function imageHasData(img){return!!img.exifdata}function base64ToArrayBuffer(base64,contentType){contentType=contentType||base64.match(/^data\:([^\;]+)\;base64,/im)[1]||"",base64=base64.replace(/^data\:([^\;]+)\;base64,/gim,"");for(var binary=atob(base64),len=binary.length,buffer=new ArrayBuffer(len),view=new Uint8Array(buffer),i=0;len>i;i++)view[i]=binary.charCodeAt(i);return buffer}function objectURLToBlob(url,callback){var http=new XMLHttpRequest;http.open("GET",url,!0),http.responseType="blob",http.onload=function(e){(200==this.status||0===this.status)&&callback(this.response)},http.send()}function getImageData(img,callback){function handleBinaryFile(binFile){var data=findEXIFinJPEG(binFile),iptcdata=findIPTCinJPEG(binFile);img.exifdata=data||{},img.iptcdata=iptcdata||{},callback&&callback.call(img)}if(img.src)if(/^data\:/i.test(img.src)){var arrayBuffer=base64ToArrayBuffer(img.src);handleBinaryFile(arrayBuffer)}else if(/^blob\:/i.test(img.src)){var fileReader=new FileReader;fileReader.onload=function(e){handleBinaryFile(e.target.result)},objectURLToBlob(img.src,function(blob){fileReader.readAsArrayBuffer(blob)})}else{var http=new XMLHttpRequest;http.onload=function(){if(200!=this.status&&0!==this.status)throw"Could not load image";handleBinaryFile(http.response),http=null},http.open("GET",img.src,!0),http.responseType="arraybuffer",http.send(null)}else if(window.FileReader&&(img instanceof window.Blob||img instanceof window.File)){var fileReader=new FileReader;fileReader.onload=function(e){debug&&console.log("Got file of length "+e.target.result.byteLength),handleBinaryFile(e.target.result)},fileReader.readAsArrayBuffer(img)}}function findEXIFinJPEG(file){var dataView=new DataView(file);if(debug&&console.log("Got file of length "+file.byteLength),255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;for(var marker,offset=2,length=file.byteLength;length>offset;){if(255!=dataView.getUint8(offset))return debug&&console.log("Not a valid marker at offset "+offset+", found: "+dataView.getUint8(offset)),!1;if(marker=dataView.getUint8(offset+1),debug&&console.log(marker),225==marker)return debug&&console.log("Found 0xFFE1 marker"),readEXIFData(dataView,offset+4,dataView.getUint16(offset+2)-2);offset+=2+dataView.getUint16(offset+2)}}function findIPTCinJPEG(file){var dataView=new DataView(file);if(debug&&console.log("Got file of length "+file.byteLength),255!=dataView.getUint8(0)||216!=dataView.getUint8(1))return debug&&console.log("Not a valid JPEG"),!1;for(var offset=2,length=file.byteLength,isFieldSegmentStart=function(dataView,offset){return 56===dataView.getUint8(offset)&&66===dataView.getUint8(offset+1)&&73===dataView.getUint8(offset+2)&&77===dataView.getUint8(offset+3)&&4===dataView.getUint8(offset+4)&&4===dataView.getUint8(offset+5)};length>offset;){if(isFieldSegmentStart(dataView,offset)){var nameHeaderLength=dataView.getUint8(offset+7);nameHeaderLength%2!==0&&(nameHeaderLength+=1),0===nameHeaderLength&&(nameHeaderLength=4);var startOffset=offset+8+nameHeaderLength,sectionLength=dataView.getUint16(offset+6+nameHeaderLength);return readIPTCData(file,startOffset,sectionLength)}offset++}}function readIPTCData(file,startOffset,sectionLength){for(var fieldValue,fieldName,dataSize,segmentType,segmentSize,dataView=new DataView(file),data={},segmentStartPos=startOffset;startOffset+sectionLength>segmentStartPos;)28===dataView.getUint8(segmentStartPos)&&2===dataView.getUint8(segmentStartPos+1)&&(segmentType=dataView.getUint8(segmentStartPos+2),segmentType in IptcFieldMap&&(dataSize=dataView.getInt16(segmentStartPos+3),segmentSize=dataSize+5,fieldName=IptcFieldMap[segmentType],fieldValue=getStringFromDB(dataView,segmentStartPos+5,dataSize),data.hasOwnProperty(fieldName)?data[fieldName]instanceof Array?data[fieldName].push(fieldValue):data[fieldName]=[data[fieldName],fieldValue]:data[fieldName]=fieldValue)),segmentStartPos++;return data}function readTags(file,tiffStart,dirStart,strings,bigEnd){var entryOffset,tag,i,entries=file.getUint16(dirStart,!bigEnd),tags={};for(i=0;entries>i;i++)entryOffset=dirStart+12*i+2,tag=strings[file.getUint16(entryOffset,!bigEnd)],!tag&&debug&&console.log("Unknown tag: "+file.getUint16(entryOffset,!bigEnd)),tags[tag]=readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd);return tags}function readTagValue(file,entryOffset,tiffStart,dirStart,bigEnd){var offset,vals,val,n,numerator,denominator,type=file.getUint16(entryOffset+2,!bigEnd),numValues=file.getUint32(entryOffset+4,!bigEnd),valueOffset=file.getUint32(entryOffset+8,!bigEnd)+tiffStart;switch(type){case 1:case 7:if(1==numValues)return file.getUint8(entryOffset+8,!bigEnd);for(offset=numValues>4?valueOffset:entryOffset+8,vals=[],n=0;numValues>n;n++)vals[n]=file.getUint8(offset+n);return vals;case 2:return offset=numValues>4?valueOffset:entryOffset+8,getStringFromDB(file,offset,numValues-1);case 3:if(1==numValues)return file.getUint16(entryOffset+8,!bigEnd);for(offset=numValues>2?valueOffset:entryOffset+8,vals=[],n=0;numValues>n;n++)vals[n]=file.getUint16(offset+2*n,!bigEnd);return vals;case 4:if(1==numValues)return file.getUint32(entryOffset+8,!bigEnd);for(vals=[],n=0;numValues>n;n++)vals[n]=file.getUint32(valueOffset+4*n,!bigEnd);return vals;case 5:if(1==numValues)return numerator=file.getUint32(valueOffset,!bigEnd),denominator=file.getUint32(valueOffset+4,!bigEnd),val=new Number(numerator/denominator),val.numerator=numerator,val.denominator=denominator,val;for(vals=[],n=0;numValues>n;n++)numerator=file.getUint32(valueOffset+8*n,!bigEnd),denominator=file.getUint32(valueOffset+4+8*n,!bigEnd),vals[n]=new Number(numerator/denominator),vals[n].numerator=numerator,vals[n].denominator=denominator;return vals;case 9:if(1==numValues)return file.getInt32(entryOffset+8,!bigEnd);for(vals=[],n=0;numValues>n;n++)vals[n]=file.getInt32(valueOffset+4*n,!bigEnd);return vals;case 10:if(1==numValues)return file.getInt32(valueOffset,!bigEnd)/file.getInt32(valueOffset+4,!bigEnd);for(vals=[],n=0;numValues>n;n++)vals[n]=file.getInt32(valueOffset+8*n,!bigEnd)/file.getInt32(valueOffset+4+8*n,!bigEnd);return vals}}function getStringFromDB(buffer,start,length){for(var outstr="",n=start;start+length>n;n++)outstr+=String.fromCharCode(buffer.getUint8(n));return outstr}function readEXIFData(file,start){if("Exif"!=getStringFromDB(file,start,4))return debug&&console.log("Not valid EXIF data! "+getStringFromDB(file,start,4)),!1;var bigEnd,tags,tag,exifData,gpsData,tiffOffset=start+6;if(18761==file.getUint16(tiffOffset))bigEnd=!1;else{if(19789!=file.getUint16(tiffOffset))return debug&&console.log("Not valid TIFF data! (no 0x4949 or 0x4D4D)"),!1;bigEnd=!0}if(42!=file.getUint16(tiffOffset+2,!bigEnd))return debug&&console.log("Not valid TIFF data! (no 0x002A)"),!1;var firstIFDOffset=file.getUint32(tiffOffset+4,!bigEnd);if(8>firstIFDOffset)return debug&&console.log("Not valid TIFF data! (First offset less than 8)",file.getUint32(tiffOffset+4,!bigEnd)),!1;if(tags=readTags(file,tiffOffset,tiffOffset+firstIFDOffset,TiffTags,bigEnd),tags.ExifIFDPointer){exifData=readTags(file,tiffOffset,tiffOffset+tags.ExifIFDPointer,ExifTags,bigEnd);for(tag in exifData){switch(tag){case"LightSource":case"Flash":case"MeteringMode":case"ExposureProgram":case"SensingMethod":case"SceneCaptureType":case"SceneType":case"CustomRendered":case"WhiteBalance":case"GainControl":case"Contrast":case"Saturation":case"Sharpness":case"SubjectDistanceRange":case"FileSource":exifData[tag]=StringValues[tag][exifData[tag]];break;case"ExifVersion":case"FlashpixVersion":exifData[tag]=String.fromCharCode(exifData[tag][0],exifData[tag][1],exifData[tag][2],exifData[tag][3]);break;case"ComponentsConfiguration":exifData[tag]=StringValues.Components[exifData[tag][0]]+StringValues.Components[exifData[tag][1]]+StringValues.Components[exifData[tag][2]]+StringValues.Components[exifData[tag][3]]}tags[tag]=exifData[tag]}}if(tags.GPSInfoIFDPointer){gpsData=readTags(file,tiffOffset,tiffOffset+tags.GPSInfoIFDPointer,GPSTags,bigEnd);for(tag in gpsData){switch(tag){case"GPSVersionID":gpsData[tag]=gpsData[tag][0]+"."+gpsData[tag][1]+"."+gpsData[tag][2]+"."+gpsData[tag][3]}tags[tag]=gpsData[tag]}}return tags}var debug=!1,ExifTags=this.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",42016:"ImageUniqueID"},TiffTags=this.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},GPSTags=this.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},StringValues=this.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},IptcFieldMap={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",105:"headline",116:"copyright",15:"category"};this.getData=function(img,callback){return(img instanceof Image||img instanceof HTMLImageElement)&&!img.complete?!1:(imageHasData(img)?callback&&callback.call(img):getImageData(img,callback),!0)},this.getTag=function(img,tag){return imageHasData(img)?img.exifdata[tag]:void 0},this.getAllTags=function(img){if(!imageHasData(img))return{};var a,data=img.exifdata,tags={};for(a in data)data.hasOwnProperty(a)&&(tags[a]=data[a]);return tags},this.pretty=function(img){if(!imageHasData(img))return"";var a,data=img.exifdata,strPretty="";for(a in data)data.hasOwnProperty(a)&&(strPretty+="object"==typeof data[a]?data[a]instanceof Number?a+" : "+data[a]+" ["+data[a].numerator+"/"+data[a].denominator+"]\r\n":a+" : ["+data[a].length+" values]\r\n":a+" : "+data[a]+"\r\n");return strPretty},this.readFromBinaryFile=function(file){return findEXIFinJPEG(file)}}]),crop.factory("cropHost",["$document","cropAreaCircle","cropAreaSquare","cropEXIF",function($document,CropAreaCircle,CropAreaSquare,cropEXIF){var getElementOffset=function(elem){var box=elem.getBoundingClientRect(),body=document.body,docElem=document.documentElement,scrollTop=window.pageYOffset||docElem.scrollTop||body.scrollTop,scrollLeft=window.pageXOffset||docElem.scrollLeft||body.scrollLeft,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0,top=box.top+scrollTop-clientTop,left=box.left+scrollLeft-clientLeft;return{top:Math.round(top),left:Math.round(left)}};return function(elCanvas,opts,events){function drawScene(){ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height),null!==image&&(ctx.drawImage(image,0,0,ctx.canvas.width,ctx.canvas.height),ctx.save(),ctx.fillStyle="rgba(0, 0, 0, 0.65)",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),ctx.restore(),theArea.draw())}var ctx=null,image=null,theArea=null,minCanvasDims=[100,100],maxCanvasDims=[300,300],resImgSize=200,resImgFormat="image/png",resImgQuality=null,resetCropHost=function(){if(null!==image){theArea.setImage(image);var imageDims=[image.width,image.height],imageRatio=image.width/image.height,canvasDims=imageDims;canvasDims[0]>maxCanvasDims[0]?(canvasDims[0]=maxCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio):canvasDims[0]<minCanvasDims[0]&&(canvasDims[0]=minCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio),canvasDims[1]>maxCanvasDims[1]?(canvasDims[1]=maxCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio):canvasDims[1]<minCanvasDims[1]&&(canvasDims[1]=minCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio),elCanvas.prop("width",canvasDims[0]).prop("height",canvasDims[1]).css({"margin-left":-canvasDims[0]/2+"px","margin-top":-canvasDims[1]/2+"px"}),theArea.setX(ctx.canvas.width/2),theArea.setY(ctx.canvas.height/2),theArea.setSize(Math.min(200,ctx.canvas.width/2,ctx.canvas.height/2))}else elCanvas.prop("width",0).prop("height",0).css({"margin-top":0});drawScene()},getChangedTouches=function(event){return angular.isDefined(event.changedTouches)?event.changedTouches:event.originalEvent.changedTouches},onMouseMove=function(e){if(null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchmove"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseMove(pageX-offset.left,pageY-offset.top),drawScene()}},onMouseDown=function(e){if(e.preventDefault(),e.stopPropagation(),null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchstart"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseDown(pageX-offset.left,pageY-offset.top),drawScene()}},onMouseUp=function(e){if(null!==image){var pageX,pageY,offset=getElementOffset(ctx.canvas);"touchend"===e.type?(pageX=getChangedTouches(e)[0].pageX,pageY=getChangedTouches(e)[0].pageY):(pageX=e.pageX,pageY=e.pageY),theArea.processMouseUp(pageX-offset.left,pageY-offset.top),drawScene()}};this.getResultImageDataURI=function(){var temp_ctx,temp_canvas;return temp_canvas=angular.element("<canvas></canvas>")[0],temp_ctx=temp_canvas.getContext("2d"),temp_canvas.width=resImgSize,temp_canvas.height=resImgSize,null!==image&&temp_ctx.drawImage(image,(theArea.getX()-theArea.getSize()/2)*(image.width/ctx.canvas.width),(theArea.getY()-theArea.getSize()/2)*(image.height/ctx.canvas.height),theArea.getSize()*(image.width/ctx.canvas.width),theArea.getSize()*(image.height/ctx.canvas.height),0,0,resImgSize,resImgSize),null!==resImgQuality?temp_canvas.toDataURL(resImgFormat,resImgQuality):temp_canvas.toDataURL(resImgFormat)},this.setNewImageSource=function(imageSource){if(image=null,resetCropHost(),events.trigger("image-updated"),imageSource){var newImage=new Image;"http"===imageSource.substring(0,4).toLowerCase()&&(newImage.crossOrigin="anonymous"),newImage.onload=function(){events.trigger("load-done"),cropEXIF.getData(newImage,function(){var orientation=cropEXIF.getTag(newImage,"Orientation");if([3,6,8].indexOf(orientation)>-1){var canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),cw=newImage.width,ch=newImage.height,cx=0,cy=0,deg=0;switch(orientation){case 3:cx=-newImage.width,cy=-newImage.height,deg=180;break;case 6:cw=newImage.height,ch=newImage.width,cy=-newImage.height,deg=90;break;case 8:cw=newImage.height,ch=newImage.width,cx=-newImage.width,deg=270}canvas.width=cw,canvas.height=ch,ctx.rotate(deg*Math.PI/180),ctx.drawImage(newImage,cx,cy),image=new Image,image.src=canvas.toDataURL("image/png")}else image=newImage;resetCropHost(),events.trigger("image-updated")})},newImage.onerror=function(){events.trigger("load-error")},events.trigger("load-start"),newImage.src=imageSource}},this.setMaxDimensions=function(width,height){if(maxCanvasDims=[width,height],null!==image){var curWidth=ctx.canvas.width,curHeight=ctx.canvas.height,imageDims=[image.width,image.height],imageRatio=image.width/image.height,canvasDims=imageDims;canvasDims[0]>maxCanvasDims[0]?(canvasDims[0]=maxCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio):canvasDims[0]<minCanvasDims[0]&&(canvasDims[0]=minCanvasDims[0],canvasDims[1]=canvasDims[0]/imageRatio),canvasDims[1]>maxCanvasDims[1]?(canvasDims[1]=maxCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio):canvasDims[1]<minCanvasDims[1]&&(canvasDims[1]=minCanvasDims[1],canvasDims[0]=canvasDims[1]*imageRatio),elCanvas.prop("width",canvasDims[0]).prop("height",canvasDims[1]).css({"margin-left":-canvasDims[0]/2+"px","margin-top":-canvasDims[1]/2+"px"});var ratioNewCurWidth=ctx.canvas.width/curWidth,ratioNewCurHeight=ctx.canvas.height/curHeight,ratioMin=Math.min(ratioNewCurWidth,ratioNewCurHeight);theArea.setX(theArea.getX()*ratioNewCurWidth),theArea.setY(theArea.getY()*ratioNewCurHeight),theArea.setSize(theArea.getSize()*ratioMin)}else elCanvas.prop("width",0).prop("height",0).css({"margin-top":0});drawScene()},this.setAreaMinSize=function(size){size=parseInt(size,10),isNaN(size)||(theArea.setMinSize(size),drawScene())},this.setResultImageSize=function(size){size=parseInt(size,10),isNaN(size)||(resImgSize=size)},this.setResultImageFormat=function(format){resImgFormat=format},this.setResultImageQuality=function(quality){quality=parseFloat(quality),!isNaN(quality)&&quality>=0&&1>=quality&&(resImgQuality=quality)},this.setAreaType=function(type){var curSize=theArea.getSize(),curMinSize=theArea.getMinSize(),curX=theArea.getX(),curY=theArea.getY(),AreaClass=CropAreaCircle;"square"===type&&(AreaClass=CropAreaSquare),theArea=new AreaClass(ctx,events),theArea.setMinSize(curMinSize),theArea.setSize(curSize),theArea.setX(curX),theArea.setY(curY),null!==image&&theArea.setImage(image),drawScene()},ctx=elCanvas[0].getContext("2d"),theArea=new CropAreaCircle(ctx,events),$document.on("mousemove",onMouseMove),elCanvas.on("mousedown",onMouseDown),$document.on("mouseup",onMouseUp),$document.on("touchmove",onMouseMove),elCanvas.on("touchstart",onMouseDown),$document.on("touchend",onMouseUp),this.destroy=function(){$document.off("mousemove",onMouseMove),elCanvas.off("mousedown",onMouseDown),$document.off("mouseup",onMouseMove),$document.off("touchmove",onMouseMove),elCanvas.off("touchstart",onMouseDown),$document.off("touchend",onMouseMove),elCanvas.remove()}}}]),crop.factory("cropPubSub",[function(){return function(){var events={};this.on=function(names,handler){return names.split(" ").forEach(function(name){events[name]||(events[name]=[]),events[name].push(handler)}),this},this.trigger=function(name,args){return angular.forEach(events[name],function(handler){handler.call(null,args)}),this}}}]),crop.directive("imgCrop",["$timeout","cropHost","cropPubSub",function($timeout,CropHost,CropPubSub){return{restrict:"E",scope:{image:"=",resultImage:"=",changeOnFly:"=",areaType:"@",areaMinSize:"=",resultImageSize:"=",resultImageFormat:"@",resultImageQuality:"=",onChange:"&",onLoadBegin:"&",onLoadDone:"&",onLoadError:"&"},template:"<canvas></canvas>",controller:["$scope",function($scope){$scope.events=new CropPubSub}],link:function(scope,element){var storedResultImage,events=scope.events,cropHost=new CropHost(element.find("canvas"),{},events),updateResultImage=function(scope){var resultImage=cropHost.getResultImageDataURI();storedResultImage!==resultImage&&(storedResultImage=resultImage,angular.isDefined(scope.resultImage)&&(scope.resultImage=resultImage),scope.onChange({$dataURI:scope.resultImage}))},fnSafeApply=function(fn){return function(){$timeout(function(){scope.$apply(function(scope){fn(scope)})})}};events.on("load-start",fnSafeApply(function(scope){scope.onLoadBegin({})})).on("load-done",fnSafeApply(function(scope){scope.onLoadDone({})})).on("load-error",fnSafeApply(function(scope){scope.onLoadError({});
})).on("area-move area-resize",fnSafeApply(function(scope){scope.changeOnFly&&updateResultImage(scope)})).on("area-move-end area-resize-end image-updated",fnSafeApply(function(scope){updateResultImage(scope)})),scope.$watch("image",function(){cropHost.setNewImageSource(scope.image)}),scope.$watch("areaType",function(){cropHost.setAreaType(scope.areaType),updateResultImage(scope)}),scope.$watch("areaMinSize",function(){cropHost.setAreaMinSize(scope.areaMinSize),updateResultImage(scope)}),scope.$watch("resultImageSize",function(){cropHost.setResultImageSize(scope.resultImageSize),updateResultImage(scope)}),scope.$watch("resultImageFormat",function(){cropHost.setResultImageFormat(scope.resultImageFormat),updateResultImage(scope)}),scope.$watch("resultImageQuality",function(){cropHost.setResultImageQuality(scope.resultImageQuality),updateResultImage(scope)}),scope.$watch(function(){return[element[0].clientWidth,element[0].clientHeight]},function(value){cropHost.setMaxDimensions(value[0],value[1]),updateResultImage(scope)},!0),scope.$on("$destroy",function(){cropHost.destroy()})}}}])}(),angular.module("angular-timezone-selector",[]).constant("_",_).constant("moment",moment).factory("timezones",["_","moment",function(_,moment){var timezoneMap={};return _.forEach(moment.tz.names(),function(zoneName){var tz=moment.tz(zoneName);timezoneMap[zoneName]={id:zoneName,name:zoneName.replace(/_/g," "),offset:"UTC"+tz.format("Z"),nOffset:tz.utcOffset()}}),timezoneMap}]).factory("zoneToCC",["_",function(_){var zones=[{id:"1",cca2:"AD",name:"Europe/Andorra"},{id:"2",cca2:"AE",name:"Asia/Dubai"},{id:"3",cca2:"AF",name:"Asia/Kabul"},{id:"4",cca2:"AG",name:"America/Antigua"},{id:"5",cca2:"AI",name:"America/Anguilla"},{id:"6",cca2:"AL",name:"Europe/Tirane"},{id:"7",cca2:"AM",name:"Asia/Yerevan"},{id:"8",cca2:"AO",name:"Africa/Luanda"},{id:"9",cca2:"AQ",name:"Antarctica/McMurdo"},{id:"10",cca2:"AQ",name:"Antarctica/Rothera"},{id:"11",cca2:"AQ",name:"Antarctica/Palmer"},{id:"12",cca2:"AQ",name:"Antarctica/Mawson"},{id:"13",cca2:"AQ",name:"Antarctica/Davis"},{id:"14",cca2:"AQ",name:"Antarctica/Casey"},{id:"15",cca2:"AQ",name:"Antarctica/Vostok"},{id:"16",cca2:"AQ",name:"Antarctica/DumontDUrville"},{id:"17",cca2:"AQ",name:"Antarctica/Syowa"},{id:"18",cca2:"AQ",name:"Antarctica/Troll"},{id:"19",cca2:"AR",name:"America/Argentina/Buenos_Aires"},{id:"20",cca2:"AR",name:"America/Argentina/Cordoba"},{id:"21",cca2:"AR",name:"America/Argentina/Salta"},{id:"22",cca2:"AR",name:"America/Argentina/Jujuy"},{id:"23",cca2:"AR",name:"America/Argentina/Tucuman"},{id:"24",cca2:"AR",name:"America/Argentina/Catamarca"},{id:"25",cca2:"AR",name:"America/Argentina/La_Rioja"},{id:"26",cca2:"AR",name:"America/Argentina/San_Juan"},{id:"27",cca2:"AR",name:"America/Argentina/Mendoza"},{id:"28",cca2:"AR",name:"America/Argentina/San_Luis"},{id:"29",cca2:"AR",name:"America/Argentina/Rio_Gallegos"},{id:"30",cca2:"AR",name:"America/Argentina/Ushuaia"},{id:"31",cca2:"AS",name:"Pacific/Pago_Pago"},{id:"32",cca2:"AT",name:"Europe/Vienna"},{id:"33",cca2:"AU",name:"Australia/Lord_Howe"},{id:"34",cca2:"AU",name:"Antarctica/Macquarie"},{id:"35",cca2:"AU",name:"Australia/Hobart"},{id:"36",cca2:"AU",name:"Australia/Currie"},{id:"37",cca2:"AU",name:"Australia/Melbourne"},{id:"38",cca2:"AU",name:"Australia/Sydney"},{id:"39",cca2:"AU",name:"Australia/Broken_Hill"},{id:"40",cca2:"AU",name:"Australia/Brisbane"},{id:"41",cca2:"AU",name:"Australia/Lindeman"},{id:"42",cca2:"AU",name:"Australia/Adelaide"},{id:"43",cca2:"AU",name:"Australia/Darwin"},{id:"44",cca2:"AU",name:"Australia/Perth"},{id:"45",cca2:"AU",name:"Australia/Eucla"},{id:"46",cca2:"AW",name:"America/Aruba"},{id:"47",cca2:"AX",name:"Europe/Mariehamn"},{id:"48",cca2:"AZ",name:"Asia/Baku"},{id:"49",cca2:"BA",name:"Europe/Sarajevo"},{id:"50",cca2:"BB",name:"America/Barbados"},{id:"51",cca2:"BD",name:"Asia/Dhaka"},{id:"52",cca2:"BE",name:"Europe/Brussels"},{id:"53",cca2:"BF",name:"Africa/Ouagadougou"},{id:"54",cca2:"BG",name:"Europe/Sofia"},{id:"55",cca2:"BH",name:"Asia/Bahrain"},{id:"56",cca2:"BI",name:"Africa/Bujumbura"},{id:"57",cca2:"BJ",name:"Africa/Porto-Novo"},{id:"58",cca2:"BL",name:"America/St_Barthelemy"},{id:"59",cca2:"BM",name:"Atlantic/Bermuda"},{id:"60",cca2:"BN",name:"Asia/Brunei"},{id:"61",cca2:"BO",name:"America/La_Paz"},{id:"62",cca2:"BQ",name:"America/Kralendijk"},{id:"63",cca2:"BR",name:"America/Noronha"},{id:"64",cca2:"BR",name:"America/Belem"},{id:"65",cca2:"BR",name:"America/Fortaleza"},{id:"66",cca2:"BR",name:"America/Recife"},{id:"67",cca2:"BR",name:"America/Araguaina"},{id:"68",cca2:"BR",name:"America/Maceio"},{id:"69",cca2:"BR",name:"America/Bahia"},{id:"70",cca2:"BR",name:"America/Sao_Paulo"},{id:"71",cca2:"BR",name:"America/Campo_Grande"},{id:"72",cca2:"BR",name:"America/Cuiaba"},{id:"73",cca2:"BR",name:"America/Santarem"},{id:"74",cca2:"BR",name:"America/Porto_Velho"},{id:"75",cca2:"BR",name:"America/Boa_Vista"},{id:"76",cca2:"BR",name:"America/Manaus"},{id:"77",cca2:"BR",name:"America/Eirunepe"},{id:"78",cca2:"BR",name:"America/Rio_Branco"},{id:"79",cca2:"BS",name:"America/Nassau"},{id:"80",cca2:"BT",name:"Asia/Thimphu"},{id:"81",cca2:"BW",name:"Africa/Gaborone"},{id:"82",cca2:"BY",name:"Europe/Minsk"},{id:"83",cca2:"BZ",name:"America/Belize"},{id:"84",cca2:"CA",name:"America/St_Johns"},{id:"85",cca2:"CA",name:"America/Halifax"},{id:"86",cca2:"CA",name:"America/Glace_Bay"},{id:"87",cca2:"CA",name:"America/Moncton"},{id:"88",cca2:"CA",name:"America/Goose_Bay"},{id:"89",cca2:"CA",name:"America/Blanc-Sablon"},{id:"90",cca2:"CA",name:"America/Toronto"},{id:"91",cca2:"CA",name:"America/Nipigon"},{id:"92",cca2:"CA",name:"America/Thunder_Bay"},{id:"93",cca2:"CA",name:"America/Iqaluit"},{id:"94",cca2:"CA",name:"America/Pangnirtung"},{id:"95",cca2:"CA",name:"America/Resolute"},{id:"96",cca2:"CA",name:"America/Atikokan"},{id:"97",cca2:"CA",name:"America/Rankin_Inlet"},{id:"98",cca2:"CA",name:"America/Winnipeg"},{id:"99",cca2:"CA",name:"America/Rainy_River"},{id:"100",cca2:"CA",name:"America/Regina"},{id:"101",cca2:"CA",name:"America/Swift_Current"},{id:"102",cca2:"CA",name:"America/Edmonton"},{id:"103",cca2:"CA",name:"America/Cambridge_Bay"},{id:"104",cca2:"CA",name:"America/Yellowknife"},{id:"105",cca2:"CA",name:"America/Inuvik"},{id:"106",cca2:"CA",name:"America/Creston"},{id:"107",cca2:"CA",name:"America/Dawson_Creek"},{id:"108",cca2:"CA",name:"America/Vancouver"},{id:"109",cca2:"CA",name:"America/Whitehorse"},{id:"110",cca2:"CA",name:"America/Dawson"},{id:"111",cca2:"CC",name:"Indian/Cocos"},{id:"112",cca2:"CD",name:"Africa/Kinshasa"},{id:"113",cca2:"CD",name:"Africa/Lubumbashi"},{id:"114",cca2:"CF",name:"Africa/Bangui"},{id:"115",cca2:"CG",name:"Africa/Brazzaville"},{id:"116",cca2:"CH",name:"Europe/Zurich"},{id:"117",cca2:"CI",name:"Africa/Abidjan"},{id:"118",cca2:"CK",name:"Pacific/Rarotonga"},{id:"119",cca2:"CL",name:"America/Santiago"},{id:"120",cca2:"CL",name:"Pacific/Easter"},{id:"121",cca2:"CM",name:"Africa/Douala"},{id:"122",cca2:"CN",name:"Asia/Shanghai"},{id:"123",cca2:"CN",name:"Asia/Harbin"},{id:"124",cca2:"CN",name:"Asia/Chongqing"},{id:"125",cca2:"CN",name:"Asia/Urumqi"},{id:"126",cca2:"CN",name:"Asia/Kashgar"},{id:"127",cca2:"CO",name:"America/Bogota"},{id:"128",cca2:"CR",name:"America/Costa_Rica"},{id:"129",cca2:"CU",name:"America/Havana"},{id:"130",cca2:"CV",name:"Atlantic/Cape_Verde"},{id:"131",cca2:"CW",name:"America/Curacao"},{id:"132",cca2:"CX",name:"Indian/Christmas"},{id:"133",cca2:"CY",name:"Asia/Nicosia"},{id:"134",cca2:"CZ",name:"Europe/Prague"},{id:"135",cca2:"DE",name:"Europe/Berlin"},{id:"136",cca2:"DE",name:"Europe/Busingen"},{id:"137",cca2:"DJ",name:"Africa/Djibouti"},{id:"138",cca2:"DK",name:"Europe/Copenhagen"},{id:"139",cca2:"DM",name:"America/Dominica"},{id:"140",cca2:"DO",name:"America/Santo_Domingo"},{id:"141",cca2:"DZ",name:"Africa/Algiers"},{id:"142",cca2:"EC",name:"America/Guayaquil"},{id:"143",cca2:"EC",name:"Pacific/Galapagos"},{id:"144",cca2:"EE",name:"Europe/Tallinn"},{id:"145",cca2:"EG",name:"Africa/Cairo"},{id:"146",cca2:"EH",name:"Africa/El_Aaiun"},{id:"147",cca2:"ER",name:"Africa/Asmara"},{id:"148",cca2:"ES",name:"Europe/Madrid"},{id:"149",cca2:"ES",name:"Africa/Ceuta"},{id:"150",cca2:"ES",name:"Atlantic/Canary"},{id:"151",cca2:"ET",name:"Africa/Addis_Ababa"},{id:"152",cca2:"FI",name:"Europe/Helsinki"},{id:"153",cca2:"FJ",name:"Pacific/Fiji"},{id:"154",cca2:"FK",name:"Atlantic/Stanley"},{id:"155",cca2:"FM",name:"Pacific/Chuuk"},{id:"156",cca2:"FM",name:"Pacific/Pohnpei"},{id:"157",cca2:"FM",name:"Pacific/Kosrae"},{id:"158",cca2:"FO",name:"Atlantic/Faroe"},{id:"159",cca2:"FR",name:"Europe/Paris"},{id:"160",cca2:"GA",name:"Africa/Libreville"},{id:"161",cca2:"GB",name:"Europe/London"},{id:"162",cca2:"GD",name:"America/Grenada"},{id:"163",cca2:"GE",name:"Asia/Tbilisi"},{id:"164",cca2:"GF",name:"America/Cayenne"},{id:"165",cca2:"GG",name:"Europe/Guernsey"},{id:"166",cca2:"GH",name:"Africa/Accra"},{id:"167",cca2:"GI",name:"Europe/Gibraltar"},{id:"168",cca2:"GL",name:"America/Godthab"},{id:"169",cca2:"GL",name:"America/Danmarkshavn"},{id:"170",cca2:"GL",name:"America/Scoresbysund"},{id:"171",cca2:"GL",name:"America/Thule"},{id:"172",cca2:"GM",name:"Africa/Banjul"},{id:"173",cca2:"GN",name:"Africa/Conakry"},{id:"174",cca2:"GP",name:"America/Guadeloupe"},{id:"175",cca2:"GQ",name:"Africa/Malabo"},{id:"176",cca2:"GR",name:"Europe/Athens"},{id:"177",cca2:"GS",name:"Atlantic/South_Georgia"},{id:"178",cca2:"GT",name:"America/Guatemala"},{id:"179",cca2:"GU",name:"Pacific/Guam"},{id:"180",cca2:"GW",name:"Africa/Bissau"},{id:"181",cca2:"GY",name:"America/Guyana"},{id:"182",cca2:"HK",name:"Asia/Hong_Kong"},{id:"183",cca2:"HN",name:"America/Tegucigalpa"},{id:"184",cca2:"HR",name:"Europe/Zagreb"},{id:"185",cca2:"HT",name:"America/Port-au-Prince"},{id:"186",cca2:"HU",name:"Europe/Budapest"},{id:"187",cca2:"ID",name:"Asia/Jakarta"},{id:"188",cca2:"ID",name:"Asia/Pontianak"},{id:"189",cca2:"ID",name:"Asia/Makassar"},{id:"190",cca2:"ID",name:"Asia/Jayapura"},{id:"191",cca2:"IE",name:"Europe/Dublin"},{id:"192",cca2:"IL",name:"Asia/Jerusalem"},{id:"193",cca2:"IM",name:"Europe/Isle_of_Man"},{id:"194",cca2:"IN",name:"Asia/Kolkata"},{id:"195",cca2:"IO",name:"Indian/Chagos"},{id:"196",cca2:"IQ",name:"Asia/Baghdad"},{id:"197",cca2:"IR",name:"Asia/Tehran"},{id:"198",cca2:"IS",name:"Atlantic/Reykjavik"},{id:"199",cca2:"IT",name:"Europe/Rome"},{id:"200",cca2:"JE",name:"Europe/Jersey"},{id:"201",cca2:"JM",name:"America/Jamaica"},{id:"202",cca2:"JO",name:"Asia/Amman"},{id:"203",cca2:"JP",name:"Asia/Tokyo"},{id:"204",cca2:"KE",name:"Africa/Nairobi"},{id:"205",cca2:"KG",name:"Asia/Bishkek"},{id:"206",cca2:"KH",name:"Asia/Phnom_Penh"},{id:"207",cca2:"KI",name:"Pacific/Tarawa"},{id:"208",cca2:"KI",name:"Pacific/Enderbury"},{id:"209",cca2:"KI",name:"Pacific/Kiritimati"},{id:"210",cca2:"KM",name:"Indian/Comoro"},{id:"211",cca2:"KN",name:"America/St_Kitts"},{id:"212",cca2:"KP",name:"Asia/Pyongyang"},{id:"213",cca2:"KR",name:"Asia/Seoul"},{id:"214",cca2:"KW",name:"Asia/Kuwait"},{id:"215",cca2:"KY",name:"America/Cayman"},{id:"216",cca2:"KZ",name:"Asia/Almaty"},{id:"217",cca2:"KZ",name:"Asia/Qyzylorda"},{id:"218",cca2:"KZ",name:"Asia/Aqtobe"},{id:"219",cca2:"KZ",name:"Asia/Aqtau"},{id:"220",cca2:"KZ",name:"Asia/Oral"},{id:"221",cca2:"LA",name:"Asia/Vientiane"},{id:"222",cca2:"LB",name:"Asia/Beirut"},{id:"223",cca2:"LC",name:"America/St_Lucia"},{id:"224",cca2:"LI",name:"Europe/Vaduz"},{id:"225",cca2:"LK",name:"Asia/Colombo"},{id:"226",cca2:"LR",name:"Africa/Monrovia"},{id:"227",cca2:"LS",name:"Africa/Maseru"},{id:"228",cca2:"LT",name:"Europe/Vilnius"},{id:"229",cca2:"LU",name:"Europe/Luxembourg"},{id:"230",cca2:"LV",name:"Europe/Riga"},{id:"231",cca2:"LY",name:"Africa/Tripoli"},{id:"232",cca2:"MA",name:"Africa/Casablanca"},{id:"233",cca2:"MC",name:"Europe/Monaco"},{id:"234",cca2:"MD",name:"Europe/Chisinau"},{id:"235",cca2:"ME",name:"Europe/Podgorica"},{id:"236",cca2:"MF",name:"America/Marigot"},{id:"237",cca2:"MG",name:"Indian/Antananarivo"},{id:"238",cca2:"MH",name:"Pacific/Majuro"},{id:"239",cca2:"MH",name:"Pacific/Kwajalein"},{id:"240",cca2:"MK",name:"Europe/Skopje"},{id:"241",cca2:"ML",name:"Africa/Bamako"},{id:"242",cca2:"MM",name:"Asia/Rangoon"},{id:"243",cca2:"MN",name:"Asia/Ulaanbaatar"},{id:"244",cca2:"MN",name:"Asia/Hovd"},{id:"245",cca2:"MN",name:"Asia/Choibalsan"},{id:"246",cca2:"MO",name:"Asia/Macau"},{id:"247",cca2:"MP",name:"Pacific/Saipan"},{id:"248",cca2:"MQ",name:"America/Martinique"},{id:"249",cca2:"MR",name:"Africa/Nouakchott"},{id:"250",cca2:"MS",name:"America/Montserrat"},{id:"251",cca2:"MT",name:"Europe/Malta"},{id:"252",cca2:"MU",name:"Indian/Mauritius"},{id:"253",cca2:"MV",name:"Indian/Maldives"},{id:"254",cca2:"MW",name:"Africa/Blantyre"},{id:"255",cca2:"MX",name:"America/Mexico_City"},{id:"256",cca2:"MX",name:"America/Cancun"},{id:"257",cca2:"MX",name:"America/Merida"},{id:"258",cca2:"MX",name:"America/Monterrey"},{id:"259",cca2:"MX",name:"America/Matamoros"},{id:"260",cca2:"MX",name:"America/Mazatlan"},{id:"261",cca2:"MX",name:"America/Chihuahua"},{id:"262",cca2:"MX",name:"America/Ojinaga"},{id:"263",cca2:"MX",name:"America/Hermosillo"},{id:"264",cca2:"MX",name:"America/Tijuana"},{id:"265",cca2:"MX",name:"America/Santa_Isabel"},{id:"266",cca2:"MX",name:"America/Bahia_Banderas"},{id:"267",cca2:"MY",name:"Asia/Kuala_Lumpur"},{id:"268",cca2:"MY",name:"Asia/Kuching"},{id:"269",cca2:"MZ",name:"Africa/Maputo"},{id:"270",cca2:"NA",name:"Africa/Windhoek"},{id:"271",cca2:"NC",name:"Pacific/Noumea"},{id:"272",cca2:"NE",name:"Africa/Niamey"},{id:"273",cca2:"NF",name:"Pacific/Norfolk"},{id:"274",cca2:"NG",name:"Africa/Lagos"},{id:"275",cca2:"NI",name:"America/Managua"},{id:"276",cca2:"NL",name:"Europe/Amsterdam"},{id:"277",cca2:"NO",name:"Europe/Oslo"},{id:"278",cca2:"NP",name:"Asia/Kathmandu"},{id:"279",cca2:"NR",name:"Pacific/Nauru"},{id:"280",cca2:"NU",name:"Pacific/Niue"},{id:"281",cca2:"NZ",name:"Pacific/Auckland"},{id:"282",cca2:"NZ",name:"Pacific/Chatham"},{id:"283",cca2:"OM",name:"Asia/Muscat"},{id:"284",cca2:"PA",name:"America/Panama"},{id:"285",cca2:"PE",name:"America/Lima"},{id:"286",cca2:"PF",name:"Pacific/Tahiti"},{id:"287",cca2:"PF",name:"Pacific/Marquesas"},{id:"288",cca2:"PF",name:"Pacific/Gambier"},{id:"289",cca2:"PG",name:"Pacific/Port_Moresby"},{id:"290",cca2:"PH",name:"Asia/Manila"},{id:"291",cca2:"PK",name:"Asia/Karachi"},{id:"292",cca2:"PL",name:"Europe/Warsaw"},{id:"293",cca2:"PM",name:"America/Miquelon"},{id:"294",cca2:"PN",name:"Pacific/Pitcairn"},{id:"295",cca2:"PR",name:"America/Puerto_Rico"},{id:"296",cca2:"PS",name:"Asia/Gaza"},{id:"297",cca2:"PS",name:"Asia/Hebron"},{id:"298",cca2:"PT",name:"Europe/Lisbon"},{id:"299",cca2:"PT",name:"Atlantic/Madeira"},{id:"300",cca2:"PT",name:"Atlantic/Azores"},{id:"301",cca2:"PW",name:"Pacific/Palau"},{id:"302",cca2:"PY",name:"America/Asuncion"},{id:"303",cca2:"QA",name:"Asia/Qatar"},{id:"304",cca2:"RE",name:"Indian/Reunion"},{id:"305",cca2:"RO",name:"Europe/Bucharest"},{id:"306",cca2:"RS",name:"Europe/Belgrade"},{id:"307",cca2:"RU",name:"Europe/Kaliningrad"},{id:"308",cca2:"RU",name:"Europe/Moscow"},{id:"309",cca2:"RU",name:"Europe/Volgograd"},{id:"310",cca2:"RU",name:"Europe/Samara"},{id:"311",cca2:"RU",name:"Europe/Simferopol"},{id:"312",cca2:"RU",name:"Asia/Yekaterinburg"},{id:"313",cca2:"RU",name:"Asia/Omsk"},{id:"314",cca2:"RU",name:"Asia/Novosibirsk"},{id:"315",cca2:"RU",name:"Asia/Novokuznetsk"},{id:"316",cca2:"RU",name:"Asia/Krasnoyarsk"},{id:"317",cca2:"RU",name:"Asia/Irkutsk"},{id:"318",cca2:"RU",name:"Asia/Yakutsk"},{id:"319",cca2:"RU",name:"Asia/Khandyga"},{id:"320",cca2:"RU",name:"Asia/Vladivostok"},{id:"321",cca2:"RU",name:"Asia/Sakhalin"},{id:"322",cca2:"RU",name:"Asia/Ust-Nera"},{id:"323",cca2:"RU",name:"Asia/Magadan"},{id:"324",cca2:"RU",name:"Asia/Kamchatka"},{id:"325",cca2:"RU",name:"Asia/Anadyr"},{id:"326",cca2:"RW",name:"Africa/Kigali"},{id:"327",cca2:"SA",name:"Asia/Riyadh"},{id:"328",cca2:"SB",name:"Pacific/Guadalcanal"},{id:"329",cca2:"SC",name:"Indian/Mahe"},{id:"330",cca2:"SD",name:"Africa/Khartoum"},{id:"331",cca2:"SE",name:"Europe/Stockholm"},{id:"332",cca2:"SG",name:"Asia/Singapore"},{id:"333",cca2:"SH",name:"Atlantic/St_Helena"},{id:"334",cca2:"SI",name:"Europe/Ljubljana"},{id:"335",cca2:"SJ",name:"Arctic/Longyearbyen"},{id:"336",cca2:"SK",name:"Europe/Bratislava"},{id:"337",cca2:"SL",name:"Africa/Freetown"},{id:"338",cca2:"SM",name:"Europe/San_Marino"},{id:"339",cca2:"SN",name:"Africa/Dakar"},{id:"340",cca2:"SO",name:"Africa/Mogadishu"},{id:"341",cca2:"SR",name:"America/Paramaribo"},{id:"342",cca2:"SS",name:"Africa/Juba"},{id:"343",cca2:"ST",name:"Africa/Sao_Tome"},{id:"344",cca2:"SV",name:"America/El_Salvador"},{id:"345",cca2:"SX",name:"America/Lower_Princes"},{id:"346",cca2:"SY",name:"Asia/Damascus"},{id:"347",cca2:"SZ",name:"Africa/Mbabane"},{id:"348",cca2:"TC",name:"America/Grand_Turk"},{id:"349",cca2:"TD",name:"Africa/Ndjamena"},{id:"350",cca2:"TF",name:"Indian/Kerguelen"},{id:"351",cca2:"TG",name:"Africa/Lome"},{id:"352",cca2:"TH",name:"Asia/Bangkok"},{id:"353",cca2:"TJ",name:"Asia/Dushanbe"},{id:"354",cca2:"TK",name:"Pacific/Fakaofo"},{id:"355",cca2:"TL",name:"Asia/Dili"},{id:"356",cca2:"TM",name:"Asia/Ashgabat"},{id:"357",cca2:"TN",name:"Africa/Tunis"},{id:"358",cca2:"TO",name:"Pacific/Tongatapu"},{id:"359",cca2:"TR",name:"Europe/Istanbul"},{id:"360",cca2:"TT",name:"America/Port_of_Spain"},{id:"361",cca2:"TV",name:"Pacific/Funafuti"},{id:"362",cca2:"TW",name:"Asia/Taipei"},{id:"363",cca2:"TZ",name:"Africa/Dar_es_Salaam"},{id:"364",cca2:"UA",name:"Europe/Kiev"},{id:"365",cca2:"UA",name:"Europe/Uzhgorod"},{id:"366",cca2:"UA",name:"Europe/Zaporozhye"},{id:"367",cca2:"UG",name:"Africa/Kampala"},{id:"368",cca2:"UM",name:"Pacific/Johnston"},{id:"369",cca2:"UM",name:"Pacific/Midway"},{id:"370",cca2:"UM",name:"Pacific/Wake"},{id:"371",cca2:"US",name:"America/New_York"},{id:"372",cca2:"US",name:"America/Detroit"},{id:"373",cca2:"US",name:"America/Kentucky/Louisville"},{id:"374",cca2:"US",name:"America/Kentucky/Monticello"},{id:"375",cca2:"US",name:"America/Indiana/Indianapolis"},{id:"376",cca2:"US",name:"America/Indiana/Vincennes"},{id:"377",cca2:"US",name:"America/Indiana/Winamac"},{id:"378",cca2:"US",name:"America/Indiana/Marengo"},{id:"379",cca2:"US",name:"America/Indiana/Petersburg"},{id:"380",cca2:"US",name:"America/Indiana/Vevay"},{id:"381",cca2:"US",name:"America/Chicago"},{id:"382",cca2:"US",name:"America/Indiana/Tell_City"},{id:"383",cca2:"US",name:"America/Indiana/Knox"},{id:"384",cca2:"US",name:"America/Menominee"},{id:"385",cca2:"US",name:"America/North_Dakota/Center"},{id:"386",cca2:"US",name:"America/North_Dakota/New_Salem"},{id:"387",cca2:"US",name:"America/North_Dakota/Beulah"},{id:"388",cca2:"US",name:"America/Denver"},{id:"389",cca2:"US",name:"America/Boise"},{id:"390",cca2:"US",name:"America/Phoenix"},{id:"391",cca2:"US",name:"America/Los_Angeles"},{id:"392",cca2:"US",name:"America/Anchorage"},{id:"393",cca2:"US",name:"America/Juneau"},{id:"394",cca2:"US",name:"America/Sitka"},{id:"395",cca2:"US",name:"America/Yakutat"},{id:"396",cca2:"US",name:"America/Nome"},{id:"397",cca2:"US",name:"America/Adak"},{id:"398",cca2:"US",name:"America/Metlakatla"},{id:"399",cca2:"US",name:"Pacific/Honolulu"},{id:"400",cca2:"UY",name:"America/Montevideo"},{id:"401",cca2:"UZ",name:"Asia/Samarkand"},{id:"402",cca2:"UZ",name:"Asia/Tashkent"},{id:"403",cca2:"VA",name:"Europe/Vatican"},{id:"404",cca2:"VC",name:"America/St_Vincent"},{id:"405",cca2:"VE",name:"America/Caracas"},{id:"406",cca2:"VG",name:"America/Tortola"},{id:"407",cca2:"VI",name:"America/St_Thomas"},{id:"408",cca2:"VN",name:"Asia/Ho_Chi_Minh"},{id:"409",cca2:"VU",name:"Pacific/Efate"},{id:"410",cca2:"WF",name:"Pacific/Wallis"},{id:"411",cca2:"WS",name:"Pacific/Apia"},{id:"412",cca2:"YE",name:"Asia/Aden"},{id:"413",cca2:"YT",name:"Indian/Mayotte"},{id:"414",cca2:"ZA",name:"Africa/Johannesburg"},{id:"415",cca2:"ZM",name:"Africa/Lusaka"},{id:"416",cca2:"ZW",name:"Africa/Harare"}],zoneMap={};return _.forEach(zones,function(zone){zoneMap[zone.name]=zone.cca2}),zoneMap}]).factory("CCToCountryName",["_",function(_){var codes=[{cca2:"AF",name:"Afghanistan"},{cca2:"AX",name:"Aland Islands"},{cca2:"AL",name:"Albania"},{cca2:"DZ",name:"Algeria"},{cca2:"AS",name:"American Samoa"},{cca2:"AD",name:"Andorra"},{cca2:"AO",name:"Angola"},{cca2:"AI",name:"Anguilla"},{cca2:"AQ",name:"Antarctica"},{cca2:"AG",name:"Antigua And Barbuda"},{cca2:"AR",name:"Argentina"},{cca2:"AM",name:"Armenia"},{cca2:"AW",name:"Aruba"},{cca2:"AU",name:"Australia"},{cca2:"AT",name:"Austria"},{cca2:"AZ",name:"Azerbaijan"},{cca2:"BS",name:"Bahamas"},{cca2:"BH",name:"Bahrain"},{cca2:"BD",name:"Bangladesh"},{cca2:"BB",name:"Barbados"},{cca2:"BY",name:"Belarus"},{cca2:"BE",name:"Belgium"},{cca2:"BZ",name:"Belize"},{cca2:"BJ",name:"Benin"},{cca2:"BM",name:"Bermuda"},{cca2:"BT",name:"Bhutan"},{cca2:"BO",name:"Bolivia"},{cca2:"BA",name:"Bosnia And Herzegovina"},{cca2:"BW",name:"Botswana"},{cca2:"BV",name:"Bouvet Island"},{cca2:"BR",name:"Brazil"},{cca2:"IO",name:"British Indian Ocean Territory"},{cca2:"BN",name:"Brunei Darussalam"},{cca2:"BG",name:"Bulgaria"},{cca2:"BF",name:"Burkina Faso"},{cca2:"BI",name:"Burundi"},{cca2:"KH",name:"Cambodia"},{cca2:"CM",name:"Cameroon"},{cca2:"CA",name:"Canada"},{cca2:"CV",name:"Cape Verde"},{cca2:"KY",name:"Cayman Islands"},{cca2:"CF",name:"Central African Republic"},{cca2:"TD",name:"Chad"},{cca2:"CL",name:"Chile"},{cca2:"CN",name:"China"},{cca2:"CX",name:"Christmas Island"},{cca2:"CC",name:"Cocos (Keeling) Islands"},{cca2:"CO",name:"Colombia"},{cca2:"KM",name:"Comoros"},{cca2:"CG",name:"Congo"},{cca2:"CD",name:"Congo (Democratic Republic)"},{cca2:"CK",name:"Cook Islands"},{cca2:"CR",name:"Costa Rica"},{cca2:"CI",name:"Cote D'Ivoire"},{cca2:"HR",name:"Croatia"},{cca2:"CU",name:"Cuba"},{cca2:"CY",name:"Cyprus"},{cca2:"CZ",name:"Czech Republic"},{cca2:"DK",name:"Denmark"},{cca2:"DJ",name:"Djibouti"},{cca2:"DM",name:"Dominica"},{cca2:"DO",name:"Dominican Republic"},{cca2:"EC",name:"Ecuador"},{cca2:"EG",name:"Egypt"},{cca2:"SV",name:"El Salvador"},{cca2:"GQ",name:"Equatorial Guinea"},{cca2:"ER",name:"Eritrea"},{cca2:"EE",name:"Estonia"},{cca2:"ET",name:"Ethiopia"},{cca2:"FK",name:"Falkland Islands (Malvinas)"},{cca2:"FO",name:"Faroe Islands"},{cca2:"FJ",name:"Fiji"},{cca2:"FI",name:"Finland"},{cca2:"FR",name:"France"},{cca2:"GF",name:"French Guiana"},{cca2:"PF",name:"French Polynesia"},{cca2:"TF",name:"French Southern Territories"},{cca2:"GA",name:"Gabon"},{cca2:"GM",name:"Gambia"},{cca2:"GE",name:"Georgia"},{cca2:"DE",name:"Germany"},{cca2:"GH",name:"Ghana"},{cca2:"GI",name:"Gibraltar"},{cca2:"GR",name:"Greece"},{cca2:"GL",name:"Greenland"},{cca2:"GD",name:"Grenada"},{cca2:"GP",name:"Guadeloupe"},{cca2:"GU",name:"Guam"},{cca2:"GT",name:"Guatemala"},{cca2:"GG",name:"Guernsey"},{cca2:"GN",name:"Guinea"},{cca2:"GW",name:"Guinea-Bissau"},{cca2:"GY",name:"Guyana"},{cca2:"HT",name:"Haiti"},{cca2:"HM",name:"Heard Island & Mcdonald Islands"},{cca2:"VA",name:"Holy See (Vatican City State)"},{cca2:"HN",name:"Honduras"},{cca2:"HK",name:"Hong Kong"},{cca2:"HU",name:"Hungary"},{cca2:"IS",name:"Iceland"},{cca2:"IN",name:"India"},{cca2:"ID",name:"Indonesia"},{cca2:"IR",name:"Iran (Islamic Republic Of)"},{cca2:"IQ",name:"Iraq"},{cca2:"IE",name:"Ireland"},{cca2:"IM",name:"Isle Of Man"},{cca2:"IL",name:"Israel"},{cca2:"IT",name:"Italy"},{cca2:"JM",name:"Jamaica"},{cca2:"JP",name:"Japan"},{cca2:"JE",name:"Jersey"},{cca2:"JO",name:"Jordan"},{cca2:"KZ",name:"Kazakhstan"},{cca2:"KE",name:"Kenya"},{cca2:"KI",name:"Kiribati"},{cca2:"KR",name:"Korea"},{cca2:"KW",name:"Kuwait"},{cca2:"KG",name:"Kyrgyzstan"},{cca2:"LA",name:"Lao People's Democratic Republic"},{cca2:"LV",name:"Latvia"},{cca2:"LB",name:"Lebanon"},{cca2:"LS",name:"Lesotho"},{cca2:"LR",name:"Liberia"},{cca2:"LY",name:"Libyan Arab Jamahiriya"},{cca2:"LI",name:"Liechtenstein"},{cca2:"LT",name:"Lithuania"},{cca2:"LU",name:"Luxembourg"},{cca2:"MO",name:"Macao"},{cca2:"MK",name:"Macedonia"},{cca2:"MG",name:"Madagascar"},{cca2:"MW",name:"Malawi"},{cca2:"MY",name:"Malaysia"},{cca2:"MV",name:"Maldives"},{cca2:"ML",name:"Mali"},{cca2:"MT",name:"Malta"},{cca2:"MH",name:"Marshall Islands"},{cca2:"MQ",name:"Martinique"},{cca2:"MR",name:"Mauritania"},{cca2:"MU",name:"Mauritius"},{cca2:"YT",name:"Mayotte"},{cca2:"MX",name:"Mexico"},{cca2:"FM",name:"Micronesia (Federated States Of)"},{cca2:"MD",name:"Moldova"},{cca2:"MC",name:"Monaco"},{cca2:"MN",name:"Mongolia"},{cca2:"ME",name:"Montenegro"},{cca2:"MS",name:"Montserrat"},{cca2:"MA",name:"Morocco"},{cca2:"MZ",name:"Mozambique"},{cca2:"MM",name:"Myanmar"},{cca2:"NA",name:"Namibia"},{cca2:"NR",name:"Nauru"},{cca2:"NP",name:"Nepal"},{cca2:"NL",name:"Netherlands"},{cca2:"AN",name:"Netherlands Antilles"},{cca2:"NC",name:"New Caledonia"},{cca2:"NZ",name:"New Zealand"},{cca2:"NI",name:"Nicaragua"},{cca2:"NE",name:"Niger"},{cca2:"NG",name:"Nigeria"},{cca2:"NU",name:"Niue"},{cca2:"NF",name:"Norfolk Island"},{cca2:"MP",name:"Northern Mariana Islands"},{cca2:"NO",name:"Norway"},{cca2:"OM",name:"Oman"},{cca2:"PK",name:"Pakistan"},{cca2:"PW",name:"Palau"},{cca2:"PS",name:"Palestinian Territory (Occupied)"},{cca2:"PA",name:"Panama"},{cca2:"PG",name:"Papua New Guinea"},{cca2:"PY",name:"Paraguay"},{cca2:"PE",name:"Peru"},{cca2:"PH",name:"Philippines"},{cca2:"PN",name:"Pitcairn"},{cca2:"PL",name:"Poland"},{cca2:"PT",name:"Portugal"},{cca2:"PR",name:"Puerto Rico"},{cca2:"QA",name:"Qatar"},{cca2:"RE",name:"Reunion"},{cca2:"RO",name:"Romania"},{cca2:"RU",name:"Russian Federation"},{cca2:"RW",name:"Rwanda"},{cca2:"BL",name:"Saint Barthelemy"},{cca2:"SH",name:"Saint Helena"},{cca2:"KN",name:"Saint Kitts And Nevis"},{cca2:"LC",name:"Saint Lucia"},{cca2:"MF",name:"Saint Martin"},{cca2:"PM",name:"Saint Pierre And Miquelon"},{cca2:"VC",name:"Saint Vincent And Grenadines"},{cca2:"WS",name:"Samoa"},{cca2:"SM",name:"San Marino"},{cca2:"ST",name:"Sao Tome And Principe"},{cca2:"SA",name:"Saudi Arabia"},{cca2:"SN",name:"Senegal"},{cca2:"RS",name:"Serbia"},{cca2:"SC",name:"Seychelles"},{cca2:"SL",name:"Sierra Leone"},{cca2:"SG",name:"Singapore"},{cca2:"SK",name:"Slovakia"},{cca2:"SI",name:"Slovenia"},{cca2:"SB",name:"Solomon Islands"},{cca2:"SO",name:"Somalia"},{cca2:"SS",name:"South Sudan"},{cca2:"ZA",name:"South Africa"},{cca2:"GS",name:"South Georgia And Sandwich Isl."},{cca2:"ES",name:"Spain"},{cca2:"LK",name:"Sri Lanka"},{cca2:"SD",name:"Sudan"},{cca2:"SR",name:"Suriname"},{cca2:"SJ",name:"Svalbard And Jan Mayen"},{cca2:"SZ",name:"Swaziland"},{cca2:"SE",name:"Sweden"},{cca2:"CH",name:"Switzerland"},{cca2:"SY",name:"Syrian Arab Republic"},{cca2:"TW",name:"Taiwan"},{cca2:"TJ",name:"Tajikistan"},{cca2:"TZ",name:"Tanzania"},{cca2:"TH",name:"Thailand"},{cca2:"TL",name:"Timor-Leste"},{cca2:"TG",name:"Togo"},{cca2:"TK",name:"Tokelau"},{cca2:"TO",name:"Tonga"},{cca2:"TT",name:"Trinidad And Tobago"},{cca2:"TN",name:"Tunisia"},{cca2:"TR",name:"Turkey"},{cca2:"TM",name:"Turkmenistan"},{cca2:"TC",name:"Turks And Caicos Islands"},{cca2:"TV",name:"Tuvalu"},{cca2:"UG",name:"Uganda"},{cca2:"UA",name:"Ukraine"},{cca2:"AE",name:"United Arab Emirates"},{cca2:"GB",name:"United Kingdom"},{cca2:"US",name:"United States"},{cca2:"UM",name:"United States Outlying Islands"},{cca2:"UY",name:"Uruguay"},{cca2:"UZ",name:"Uzbekistan"},{cca2:"VU",name:"Vanuatu"},{cca2:"VE",name:"Venezuela"},{cca2:"VN",name:"Viet Nam"},{cca2:"VG",name:"Virgin Islands (British)"},{cca2:"VI",name:"Virgin Islands (U.S.)"},{cca2:"WF",name:"Wallis And Futuna"},{cca2:"EH",name:"Western Sahara"},{cca2:"YE",name:"Yemen"},{cca2:"ZM",name:"Zambia"},{cca2:"ZW",name:"Zimbabwe"},{cca2:"SX",name:"Sint Maarten"},{cca2:"CW",name:"Curacao"},{cca2:"BQ",name:"Bonaire"},{cca2:"KP",name:"North Korea"}],codeMap={};return _.forEach(codes,function(code){codeMap[code.cca2]=code.name}),codeMap}]).directive("timezoneSelector",["_","timezones","zoneToCC","CCToCountryName",function(_,timezones,zoneToCC,CCToCountryName){return{restrict:"E",replace:!0,template:'<select style="min-width:300px;"></select>',scope:{ngModel:"="},link:function($scope,elem,attrs){var data=[],timezonesGroupedByCC={};if(_.forEach(timezones,function(timezone){if(_.has(zoneToCC,timezone.id)){var CC=zoneToCC[timezone.id];timezonesGroupedByCC[CC]=timezonesGroupedByCC[CC]?timezonesGroupedByCC[CC]:[],timezonesGroupedByCC[CC].push(timezone)}}),_.forEach(timezonesGroupedByCC,function(zonesByCountry,CC){var zonesForCountry={text:CCToCountryName[CC]+": ",children:zonesByCountry,firstNOffset:zonesByCountry[0].nOffset};data.push(zonesForCountry)}),"offset"==attrs.sortBy?(data=_.sortBy(data,"firstNOffset"),_.forEach(data,function(zonesForCountry,key){zonesForCountry.children=_.sortBy(zonesForCountry.children,"nOffset")})):data=_.sortBy(data,"text"),void 0!=attrs.showLocal){if(void 0!=jstz)var extraTZs=_.where(timezones,{id:jstz.determine().name()});else var localUTC="UTC"+moment().format("Z"),extraTZs=_.where(timezones,{offset:localUTC});data.splice(0,0,{text:"Local: ",children:extraTZs,firstNOffset:extraTZs[0].nOffset,firstOffset:extraTZs[0].offset})}if(void 0!=attrs.primaryChoices){var primaryChoices=attrs.primaryChoices.split(" "),extraTZs=_.filter(timezones,function(tz){return _.contains(primaryChoices,tz.name)});data.splice(0,0,{text:"Primary: ",children:extraTZs,firstNOffset:extraTZs[0].nOffset,firstOffset:extraTZs[0].offset})}_.forEach(data,function(group){var $optgroup=$('<optgroup label="'+group.text+'">');group.children.forEach(function(option){"true"==attrs.displayUtc&&option.name.indexOf("(UTC")<=0&&(option.name=option.name+" ("+option.offset+")"),$optgroup.append('<option value="'+option.id+'">'+option.name+"</option>")}),elem.append($optgroup)});var widthVal="300px";void 0!=attrs.widthVal&&(widthVal=attrs.widthVal),elem.chosen({width:widthVal,include_group_label_in_selected:!0,search_contains:!0,no_results_text:"No results found.",placeholder_text_single:"Choose a Time Zone"}),$scope.$watch("ngModel",function(){elem.val($scope.ngModel),elem.trigger("chosen:updated")})}}}]),function($,w,undefined){"use strict";function Sly(frame,options,callbackMap){function load(isInit){var lastItemsCount=0,lastPagesCount=pages.length;if(pos.old=$.extend({},pos),frameSize=parallax?0:$frame[o.horizontal?"width":"height"](),sbSize=$sb[o.horizontal?"width":"height"](),slideeSize=parallax?frame:$slidee[o.horizontal?"outerWidth":"outerHeight"](),pages.length=0,pos.start=0,pos.end=max(slideeSize-frameSize,0),itemNav){lastItemsCount=items.length,$items=$slidee.children(o.itemSelector),items.length=0;var lastItem,paddingStart=getPx($slidee,o.horizontal?"paddingLeft":"paddingTop"),paddingEnd=getPx($slidee,o.horizontal?"paddingRight":"paddingBottom"),borderBox="border-box"===$($items).css("boxSizing"),areFloated="none"!==$items.css("float"),ignoredMargin=0,lastItemIndex=$items.length-1;slideeSize=0,$items.each(function(i,element){var $item=$(element),rect=element.getBoundingClientRect(),itemSize=round(o.horizontal?rect.width||rect.right-rect.left:rect.height||rect.bottom-rect.top),itemMarginStart=getPx($item,o.horizontal?"marginLeft":"marginTop"),itemMarginEnd=getPx($item,o.horizontal?"marginRight":"marginBottom"),itemSizeFull=itemSize+itemMarginStart+itemMarginEnd,singleSpaced=!itemMarginStart||!itemMarginEnd,item={};item.el=element,item.size=singleSpaced?itemSize:itemSizeFull,item.half=item.size/2,item.start=slideeSize+(singleSpaced?itemMarginStart:0),item.center=item.start-round(frameSize/2-item.size/2),item.end=item.start-frameSize+item.size,i||(slideeSize+=paddingStart),slideeSize+=itemSizeFull,o.horizontal||areFloated||itemMarginEnd&&itemMarginStart&&i>0&&(slideeSize-=min(itemMarginStart,itemMarginEnd)),i===lastItemIndex&&(item.end+=paddingEnd,slideeSize+=paddingEnd,ignoredMargin=singleSpaced?itemMarginEnd:0),items.push(item),lastItem=item}),$slidee[0].style[o.horizontal?"width":"height"]=(borderBox?slideeSize:slideeSize-paddingStart-paddingEnd)+"px",slideeSize-=ignoredMargin,items.length?(pos.start=items[0][forceCenteredNav?"center":"start"],pos.end=forceCenteredNav?lastItem.center:slideeSize>frameSize?lastItem.end:pos.start):pos.start=pos.end=0;
}if(pos.center=round(pos.end/2+pos.start/2),updateRelatives(),$handle.length&&sbSize>0&&(o.dynamicHandle?(handleSize=pos.start===pos.end?sbSize:round(sbSize*frameSize/slideeSize),handleSize=within(handleSize,o.minHandleSize,sbSize),$handle[0].style[o.horizontal?"width":"height"]=handleSize+"px"):handleSize=$handle[o.horizontal?"outerWidth":"outerHeight"](),hPos.end=sbSize-handleSize,renderID||syncScrollbar()),!parallax&&frameSize>0){var tempPagePos=pos.start,pagesHtml="";if(itemNav)$.each(items,function(i,item){forceCenteredNav?pages.push(item.center):item.start+item.size>tempPagePos&&tempPagePos<=pos.end&&(tempPagePos=item.start,pages.push(tempPagePos),tempPagePos+=frameSize,tempPagePos>pos.end&&tempPagePos<pos.end+frameSize&&pages.push(pos.end))});else for(;tempPagePos-frameSize<pos.end;)pages.push(tempPagePos),tempPagePos+=frameSize;if($pb[0]&&lastPagesCount!==pages.length){for(var i=0;i<pages.length;i++)pagesHtml+=o.pageBuilder.call(self,i);$pages=$pb.html(pagesHtml).children(),$pages.eq(rel.activePage).addClass(o.activeClass)}}if(rel.slideeSize=slideeSize,rel.frameSize=frameSize,rel.sbSize=sbSize,rel.handleSize=handleSize,itemNav){isInit&&null!=o.startAt&&(activate(o.startAt),self[centeredNav?"toCenter":"toStart"](o.startAt));var activeItem=items[rel.activeItem];slideTo(centeredNav&&activeItem?activeItem.center:within(pos.dest,pos.start,pos.end))}else isInit?null!=o.startAt&&slideTo(o.startAt,1):slideTo(within(pos.dest,pos.start,pos.end));trigger("load")}function slideTo(newPos,immediate,dontAlign){if(itemNav&&dragging.released&&!dontAlign){var tempRel=getRelatives(newPos),isNotBordering=newPos>pos.start&&newPos<pos.end;centeredNav?(isNotBordering&&(newPos=items[tempRel.centerItem].center),forceCenteredNav&&o.activateMiddle&&activate(tempRel.centerItem)):isNotBordering&&(newPos=items[tempRel.firstItem].start)}dragging.init&&dragging.slidee&&o.elasticBounds?newPos>pos.end?newPos=pos.end+(newPos-pos.end)/6:newPos<pos.start&&(newPos=pos.start+(newPos-pos.start)/6):newPos=within(newPos,pos.start,pos.end),animation.start=+new Date,animation.time=0,animation.from=pos.cur,animation.to=newPos,animation.delta=newPos-pos.cur,animation.tweesing=dragging.tweese||dragging.init&&!dragging.slidee,animation.immediate=!animation.tweesing&&(immediate||dragging.init&&dragging.slidee||!o.speed),dragging.tweese=0,newPos!==pos.dest&&(pos.dest=newPos,trigger("change"),renderID||render()),resetCycle(),updateRelatives(),updateButtonsState(),syncPagesbar()}function render(){if(self.initialized){if(!renderID)return renderID=rAF(render),void(dragging.released&&trigger("moveStart"));animation.immediate?pos.cur=animation.to:animation.tweesing?(animation.tweeseDelta=animation.to-pos.cur,abs(animation.tweeseDelta)<.1?pos.cur=animation.to:pos.cur+=animation.tweeseDelta*(dragging.released?o.swingSpeed:o.syncSpeed)):(animation.time=min(+new Date-animation.start,o.speed),pos.cur=animation.from+animation.delta*$.easing[o.easing](animation.time/o.speed,animation.time,0,1,o.speed)),animation.to===pos.cur?(pos.cur=animation.to,dragging.tweese=renderID=0):renderID=rAF(render),trigger("move"),parallax||(transform?$slidee[0].style[transform]=gpuAcceleration+(o.horizontal?"translateX":"translateY")+"("+-pos.cur+"px)":$slidee[0].style[o.horizontal?"left":"top"]=-round(pos.cur)+"px"),!renderID&&dragging.released&&trigger("moveEnd"),syncScrollbar()}}function syncScrollbar(){$handle.length&&(hPos.cur=pos.start===pos.end?0:((dragging.init&&!dragging.slidee?pos.dest:pos.cur)-pos.start)/(pos.end-pos.start)*hPos.end,hPos.cur=within(round(hPos.cur),hPos.start,hPos.end),last.hPos!==hPos.cur&&(last.hPos=hPos.cur,transform?$handle[0].style[transform]=gpuAcceleration+(o.horizontal?"translateX":"translateY")+"("+hPos.cur+"px)":$handle[0].style[o.horizontal?"left":"top"]=hPos.cur+"px"))}function syncPagesbar(){$pages[0]&&last.page!==rel.activePage&&(last.page=rel.activePage,$pages.removeClass(o.activeClass).eq(rel.activePage).addClass(o.activeClass),trigger("activePage",last.page))}function moveLoop(){move.speed&&pos.cur!==(move.speed>0?pos.end:pos.start)||self.stop(),continuousID=dragging.init?rAF(moveLoop):0,move.now=+new Date,move.pos=pos.cur+(move.now-move.lastTime)/1e3*move.speed,slideTo(dragging.init?move.pos:round(move.pos)),dragging.init||pos.cur!==pos.dest||trigger("moveEnd"),move.lastTime=move.now}function to(location,item,immediate){if("boolean"===type(item)&&(immediate=item,item=undefined),item===undefined)slideTo(pos[location],immediate);else{if(centeredNav&&"center"!==location)return;var itemPos=self.getPos(item);itemPos&&slideTo(itemPos[location],immediate,!centeredNav)}}function getIndex(item){return null!=item?isNumber(item)?item>=0&&item<items.length?item:-1:$items.index(item):-1}function getRelativeIndex(item){return getIndex(isNumber(item)&&0>item?item+items.length:item)}function activate(item,force){var index=getIndex(item);return!itemNav||0>index?!1:((last.active!==index||force)&&($items.eq(rel.activeItem).removeClass(o.activeClass),$items.eq(index).addClass(o.activeClass),last.active=rel.activeItem=index,updateButtonsState(),trigger("active",index)),index)}function getRelatives(slideePos){slideePos=within(isNumber(slideePos)?slideePos:pos.dest,pos.start,pos.end);var relatives={},centerOffset=forceCenteredNav?0:frameSize/2;if(!parallax)for(var p=0,pl=pages.length;pl>p;p++){if(slideePos>=pos.end||p===pages.length-1){relatives.activePage=pages.length-1;break}if(slideePos<=pages[p]+centerOffset){relatives.activePage=p;break}}if(itemNav){for(var first=!1,last=!1,center=!1,i=0,il=items.length;il>i;i++)if(first===!1&&slideePos<=items[i].start+items[i].half&&(first=i),center===!1&&slideePos<=items[i].center+items[i].half&&(center=i),i===il-1||slideePos<=items[i].end+items[i].half){last=i;break}relatives.firstItem=isNumber(first)?first:0,relatives.centerItem=isNumber(center)?center:relatives.firstItem,relatives.lastItem=isNumber(last)?last:relatives.centerItem}return relatives}function updateRelatives(newPos){$.extend(rel,getRelatives(newPos))}function updateButtonsState(){var isStart=pos.dest<=pos.start,isEnd=pos.dest>=pos.end,slideePosState=(isStart?1:0)|(isEnd?2:0);if(last.slideePosState!==slideePosState&&(last.slideePosState=slideePosState,$prevPageButton.is("button,input")&&$prevPageButton.prop("disabled",isStart),$nextPageButton.is("button,input")&&$nextPageButton.prop("disabled",isEnd),$prevPageButton.add($backwardButton)[isStart?"addClass":"removeClass"](o.disabledClass),$nextPageButton.add($forwardButton)[isEnd?"addClass":"removeClass"](o.disabledClass)),last.fwdbwdState!==slideePosState&&dragging.released&&(last.fwdbwdState=slideePosState,$backwardButton.is("button,input")&&$backwardButton.prop("disabled",isStart),$forwardButton.is("button,input")&&$forwardButton.prop("disabled",isEnd)),itemNav&&null!=rel.activeItem){var isFirst=0===rel.activeItem,isLast=rel.activeItem>=items.length-1,itemsButtonState=(isFirst?1:0)|(isLast?2:0);last.itemsButtonState!==itemsButtonState&&(last.itemsButtonState=itemsButtonState,$prevButton.is("button,input")&&$prevButton.prop("disabled",isFirst),$nextButton.is("button,input")&&$nextButton.prop("disabled",isLast),$prevButton[isFirst?"addClass":"removeClass"](o.disabledClass),$nextButton[isLast?"addClass":"removeClass"](o.disabledClass))}}function moveItem(item,position,after){if(item=getRelativeIndex(item),position=getRelativeIndex(position),item>-1&&position>-1&&item!==position&&(!after||position!==item-1)&&(after||position!==item+1)){$items.eq(item)[after?"insertAfter":"insertBefore"](items[position].el);var shiftStart=position>item?item:after?position:position-1,shiftEnd=item>position?item:after?position+1:position,shiftsUp=item>position;null!=rel.activeItem&&(item===rel.activeItem?last.active=rel.activeItem=after?shiftsUp?position+1:position:shiftsUp?position:position-1:rel.activeItem>shiftStart&&rel.activeItem<shiftEnd&&(last.active=rel.activeItem+=shiftsUp?1:-1)),load()}}function callbackIndex(name,fn){for(var i=0,l=callbacks[name].length;l>i;i++)if(callbacks[name][i]===fn)return i;return-1}function resetCycle(){dragging.released&&!self.isPaused&&self.resume()}function handleToSlidee(handlePos){return round(within(handlePos,hPos.start,hPos.end)/hPos.end*(pos.end-pos.start))+pos.start}function draggingHistoryTick(){dragging.history[0]=dragging.history[1],dragging.history[1]=dragging.history[2],dragging.history[2]=dragging.history[3],dragging.history[3]=dragging.delta}function continuousInit(source){dragging.released=0,dragging.source=source,dragging.slidee="slidee"===source}function dragInit(event){var isTouch="touchstart"===event.type,source=event.data.source,isSlidee="slidee"===source;dragging.init||!isTouch&&isInteractive(event.target)||("handle"!==source||o.dragHandle&&hPos.start!==hPos.end)&&(!isSlidee||(isTouch?o.touchDragging:o.mouseDragging&&event.which<2))&&(isTouch||stopDefault(event),continuousInit(source),dragging.init=0,dragging.$source=$(event.target),dragging.touch=isTouch,dragging.pointer=isTouch?event.originalEvent.touches[0]:event,dragging.initX=dragging.pointer.pageX,dragging.initY=dragging.pointer.pageY,dragging.initPos=isSlidee?pos.cur:hPos.cur,dragging.start=+new Date,dragging.time=0,dragging.path=0,dragging.delta=0,dragging.locked=0,dragging.history=[0,0,0,0],dragging.pathToLock=isSlidee?isTouch?30:10:0,$doc.on(isTouch?dragTouchEvents:dragMouseEvents,dragHandler),self.pause(1),(isSlidee?$slidee:$handle).addClass(o.draggedClass),trigger("moveStart"),isSlidee&&(historyID=setInterval(draggingHistoryTick,10)))}function dragHandler(event){if(dragging.released="mouseup"===event.type||"touchend"===event.type,dragging.pointer=dragging.touch?event.originalEvent[dragging.released?"changedTouches":"touches"][0]:event,dragging.pathX=dragging.pointer.pageX-dragging.initX,dragging.pathY=dragging.pointer.pageY-dragging.initY,dragging.path=sqrt(pow(dragging.pathX,2)+pow(dragging.pathY,2)),dragging.delta=o.horizontal?dragging.pathX:dragging.pathY,dragging.released||!(dragging.path<1)){if(!dragging.init){if(dragging.path<o.dragThreshold)return dragging.released?dragEnd():undefined;if(!(o.horizontal?abs(dragging.pathX)>abs(dragging.pathY):abs(dragging.pathX)<abs(dragging.pathY)))return dragEnd();dragging.init=1}stopDefault(event),!dragging.locked&&dragging.path>dragging.pathToLock&&dragging.slidee&&(dragging.locked=1,dragging.$source.on(clickEvent,disableOneEvent)),dragging.released&&(dragEnd(),o.releaseSwing&&dragging.slidee&&(dragging.swing=(dragging.delta-dragging.history[0])/40*300,dragging.delta+=dragging.swing,dragging.tweese=abs(dragging.swing)>10)),slideTo(dragging.slidee?round(dragging.initPos-dragging.delta):handleToSlidee(dragging.initPos+dragging.delta))}}function dragEnd(){clearInterval(historyID),dragging.released=!0,$doc.off(dragging.touch?dragTouchEvents:dragMouseEvents,dragHandler),(dragging.slidee?$slidee:$handle).removeClass(o.draggedClass),setTimeout(function(){dragging.$source.off(clickEvent,disableOneEvent)}),pos.cur===pos.dest&&dragging.init&&trigger("moveEnd"),self.resume(1),dragging.init=0}function isInteractive(element){return~$.inArray(element.nodeName,interactiveElements)||$(element).is(o.interactive)}function movementReleaseHandler(){self.stop(),$doc.off("mouseup",movementReleaseHandler)}function buttonsHandler(event){switch(stopDefault(event),this){case $forwardButton[0]:case $backwardButton[0]:self.moveBy($forwardButton.is(this)?o.moveBy:-o.moveBy),$doc.on("mouseup",movementReleaseHandler);break;case $prevButton[0]:self.prev();break;case $nextButton[0]:self.next();break;case $prevPageButton[0]:self.prevPage();break;case $nextPageButton[0]:self.nextPage()}}function normalizeWheelDelta(event){return scrolling.curDelta=(o.horizontal?event.deltaY||event.deltaX:event.deltaY)||-event.wheelDelta,scrolling.curDelta/=1===event.deltaMode?3:100,itemNav?(time=+new Date,scrolling.last<time-scrolling.resetTime&&(scrolling.delta=0),scrolling.last=time,scrolling.delta+=scrolling.curDelta,abs(scrolling.delta)<1?scrolling.finalDelta=0:(scrolling.finalDelta=round(scrolling.delta/1),scrolling.delta%=1),scrolling.finalDelta):scrolling.curDelta}function scrollHandler(event){event.originalEvent[namespace]=self;var time=+new Date;if(lastGlobalWheel+o.scrollHijack>time&&$scrollSource[0]!==document&&$scrollSource[0]!==window)return void(lastGlobalWheel=time);if(o.scrollBy&&pos.start!==pos.end){var delta=normalizeWheelDelta(event.originalEvent);(o.scrollTrap||delta>0&&pos.dest<pos.end||0>delta&&pos.dest>pos.start)&&stopDefault(event,1),self.slideBy(o.scrollBy*delta)}}function scrollbarHandler(event){o.clickBar&&event.target===$sb[0]&&(stopDefault(event),slideTo(handleToSlidee((o.horizontal?event.pageX-$sb.offset().left:event.pageY-$sb.offset().top)-handleSize/2)))}function keyboardHandler(event){if(o.keyboardNavBy)switch(event.which){case o.horizontal?37:38:stopDefault(event),self["pages"===o.keyboardNavBy?"prevPage":"prev"]();break;case o.horizontal?39:40:stopDefault(event),self["pages"===o.keyboardNavBy?"nextPage":"next"]()}}function activateHandler(event){return isInteractive(this)?void(event.originalEvent[namespace+"ignore"]=!0):void(this.parentNode!==$slidee[0]||event.originalEvent[namespace+"ignore"]||self.activate(this))}function activatePageHandler(){this.parentNode===$pb[0]&&self.activatePage($pages.index(this))}function pauseOnHoverHandler(event){o.pauseOnHover&&self["mouseenter"===event.type?"pause":"resume"](2)}function trigger(name,arg1){if(callbacks[name]){for(l=callbacks[name].length,tmpArray.length=0,i=0;l>i;i++)tmpArray.push(callbacks[name][i]);for(i=0;l>i;i++)tmpArray[i].call(self,name,arg1)}}if(!(this instanceof Sly))return new Sly(frame,options,callbackMap);var i,l,o=$.extend({},Sly.defaults,options),self=this,parallax=isNumber(frame),$frame=$(frame),$slidee=o.slidee?$(o.slidee).eq(0):$frame.children().eq(0),frameSize=0,slideeSize=0,pos={start:0,center:0,end:0,cur:0,dest:0},$sb=$(o.scrollBar).eq(0),$handle=$sb.children().eq(0),sbSize=0,handleSize=0,hPos={start:0,end:0,cur:0},$pb=$(o.pagesBar),$pages=0,pages=[],$items=0,items=[],rel={firstItem:0,lastItem:0,centerItem:0,activeItem:null,activePage:0},frameStyles=new StyleRestorer($frame[0]),slideeStyles=new StyleRestorer($slidee[0]),sbStyles=new StyleRestorer($sb[0]),handleStyles=new StyleRestorer($handle[0]),basicNav="basic"===o.itemNav,forceCenteredNav="forceCentered"===o.itemNav,centeredNav="centered"===o.itemNav||forceCenteredNav,itemNav=!parallax&&(basicNav||centeredNav||forceCenteredNav),$scrollSource=o.scrollSource?$(o.scrollSource):$frame,$dragSource=o.dragSource?$(o.dragSource):$frame,$forwardButton=$(o.forward),$backwardButton=$(o.backward),$prevButton=$(o.prev),$nextButton=$(o.next),$prevPageButton=$(o.prevPage),$nextPageButton=$(o.nextPage),callbacks={},last={},animation={},move={},dragging={released:1},scrolling={last:0,delta:0,resetTime:200},renderID=0,historyID=0,cycleID=0,continuousID=0;parallax||(frame=$frame[0]),self.initialized=0,self.frame=frame,self.slidee=$slidee[0],self.pos=pos,self.rel=rel,self.items=items,self.pages=pages,self.isPaused=0,self.options=o,self.dragging=dragging,self.reload=function(){load()},self.getPos=function(item){if(itemNav){var index=getIndex(item);return-1!==index?items[index]:!1}var $item=$slidee.find(item).eq(0);if($item[0]){var offset=o.horizontal?$item.offset().left-$slidee.offset().left:$item.offset().top-$slidee.offset().top,size=$item[o.horizontal?"outerWidth":"outerHeight"]();return{start:offset,center:offset-frameSize/2+size/2,end:offset-frameSize+size,size:size}}return!1},self.moveBy=function(speed){move.speed=speed,!dragging.init&&move.speed&&pos.cur!==(move.speed>0?pos.end:pos.start)&&(move.lastTime=+new Date,move.startPos=pos.cur,continuousInit("button"),dragging.init=1,trigger("moveStart"),cAF(continuousID),moveLoop())},self.stop=function(){"button"===dragging.source&&(dragging.init=0,dragging.released=1)},self.prev=function(){self.activate(null==rel.activeItem?0:rel.activeItem-1)},self.next=function(){self.activate(null==rel.activeItem?0:rel.activeItem+1)},self.prevPage=function(){self.activatePage(rel.activePage-1)},self.nextPage=function(){self.activatePage(rel.activePage+1)},self.slideBy=function(delta,immediate){delta&&(itemNav?self[centeredNav?"toCenter":"toStart"](within((centeredNav?rel.centerItem:rel.firstItem)+o.scrollBy*delta,0,items.length)):slideTo(pos.dest+delta,immediate))},self.slideTo=function(pos,immediate){slideTo(pos,immediate)},self.toStart=function(item,immediate){to("start",item,immediate)},self.toEnd=function(item,immediate){to("end",item,immediate)},self.toCenter=function(item,immediate){to("center",item,immediate)},self.getIndex=getIndex,self.activate=function(item,immediate){var index=activate(item);o.smart&&index!==!1&&(centeredNav?self.toCenter(index,immediate):index>=rel.lastItem?self.toStart(index,immediate):index<=rel.firstItem?self.toEnd(index,immediate):resetCycle())},self.activatePage=function(index,immediate){isNumber(index)&&slideTo(pages[within(index,0,pages.length-1)],immediate)},self.resume=function(priority){o.cycleBy&&o.cycleInterval&&("items"!==o.cycleBy||items[0]&&null!=rel.activeItem)&&!(priority<self.isPaused)&&(self.isPaused=0,cycleID?cycleID=clearTimeout(cycleID):trigger("resume"),cycleID=setTimeout(function(){switch(trigger("cycle"),o.cycleBy){case"items":self.activate(rel.activeItem>=items.length-1?0:rel.activeItem+1);break;case"pages":self.activatePage(rel.activePage>=pages.length-1?0:rel.activePage+1)}},o.cycleInterval))},self.pause=function(priority){priority<self.isPaused||(self.isPaused=priority||100,cycleID&&(cycleID=clearTimeout(cycleID),trigger("pause")))},self.toggle=function(){self[cycleID?"pause":"resume"]()},self.set=function(name,value){$.isPlainObject(name)?$.extend(o,name):o.hasOwnProperty(name)&&(o[name]=value)},self.add=function(element,index){var $element=$(element);itemNav?(null==index||!items[0]||index>=items.length?$element.appendTo($slidee):items.length&&$element.insertBefore(items[index].el),null!=rel.activeItem&&index<=rel.activeItem&&(last.active=rel.activeItem+=$element.length)):$slidee.append($element),load()},self.remove=function(element){if(itemNav){var index=getRelativeIndex(element);if(index>-1){$items.eq(index).remove();var reactivate=index===rel.activeItem;null!=rel.activeItem&&index<rel.activeItem&&(last.active=--rel.activeItem),load(),reactivate&&(last.active=null,self.activate(rel.activeItem))}}else $(element).remove(),load()},self.moveAfter=function(item,position){moveItem(item,position,1)},self.moveBefore=function(item,position){moveItem(item,position)},self.on=function(name,fn){if("object"===type(name))for(var key in name)name.hasOwnProperty(key)&&self.on(key,name[key]);else if("function"===type(fn))for(var names=name.split(" "),n=0,nl=names.length;nl>n;n++)callbacks[names[n]]=callbacks[names[n]]||[],-1===callbackIndex(names[n],fn)&&callbacks[names[n]].push(fn);else if("array"===type(fn))for(var f=0,fl=fn.length;fl>f;f++)self.on(name,fn[f])},self.one=function(name,fn){function proxy(){fn.apply(self,arguments),self.off(name,proxy)}self.on(name,proxy)},self.off=function(name,fn){if(fn instanceof Array)for(var f=0,fl=fn.length;fl>f;f++)self.off(name,fn[f]);else for(var names=name.split(" "),n=0,nl=names.length;nl>n;n++)if(callbacks[names[n]]=callbacks[names[n]]||[],null==fn)callbacks[names[n]].length=0;else{var index=callbackIndex(names[n],fn);-1!==index&&callbacks[names[n]].splice(index,1)}},self.destroy=function(){return Sly.removeInstance(frame),$scrollSource.add($handle).add($sb).add($pb).add($forwardButton).add($backwardButton).add($prevButton).add($nextButton).add($prevPageButton).add($nextPageButton).off("."+namespace),$doc.off("keydown",keyboardHandler),$prevButton.add($nextButton).add($prevPageButton).add($nextPageButton).removeClass(o.disabledClass),$items&&null!=rel.activeItem&&$items.eq(rel.activeItem).removeClass(o.activeClass),$pb.empty(),parallax||($frame.off("."+namespace),frameStyles.restore(),slideeStyles.restore(),sbStyles.restore(),handleStyles.restore(),$.removeData(frame,namespace)),items.length=pages.length=0,last={},self.initialized=0,self},self.init=function(){if(!self.initialized){if(Sly.getInstance(frame))throw new Error("There is already a Sly instance on this element");Sly.storeInstance(frame,self),self.on(callbackMap);var holderProps=["overflow","position"],movableProps=["position","webkitTransform","msTransform","transform","left","top","width","height"];frameStyles.save.apply(frameStyles,holderProps),sbStyles.save.apply(sbStyles,holderProps),slideeStyles.save.apply(slideeStyles,movableProps),handleStyles.save.apply(handleStyles,movableProps);var $movables=$handle;return parallax||($movables=$movables.add($slidee),$frame.css("overflow","hidden"),transform||"static"!==$frame.css("position")||$frame.css("position","relative")),transform?gpuAcceleration&&$movables.css(transform,gpuAcceleration):("static"===$sb.css("position")&&$sb.css("position","relative"),$movables.css({position:"absolute"})),o.forward&&$forwardButton.on(mouseDownEvent,buttonsHandler),o.backward&&$backwardButton.on(mouseDownEvent,buttonsHandler),o.prev&&$prevButton.on(clickEvent,buttonsHandler),o.next&&$nextButton.on(clickEvent,buttonsHandler),o.prevPage&&$prevPageButton.on(clickEvent,buttonsHandler),o.nextPage&&$nextPageButton.on(clickEvent,buttonsHandler),$scrollSource.on(wheelEvent,scrollHandler),$sb[0]&&$sb.on(clickEvent,scrollbarHandler),itemNav&&o.activateOn&&$frame.on(o.activateOn+"."+namespace,"*",activateHandler),$pb[0]&&o.activatePageOn&&$pb.on(o.activatePageOn+"."+namespace,"*",activatePageHandler),$dragSource.on(dragInitEvents,{source:"slidee"},dragInit),$handle&&$handle.on(dragInitEvents,{source:"handle"},dragInit),$doc.on("keydown",keyboardHandler),parallax||($frame.on("mouseenter."+namespace+" mouseleave."+namespace,pauseOnHoverHandler),$frame.on("scroll."+namespace,resetScroll)),self.initialized=1,load(!0),o.cycleBy&&!parallax&&self[o.startPaused?"pause":"resume"](),self}}}function type(value){return null==value?String(value):"object"==typeof value||"function"==typeof value?Object.prototype.toString.call(value).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof value}function stopDefault(event,noBubbles){event.preventDefault(),noBubbles&&event.stopPropagation()}function disableOneEvent(event){stopDefault(event,1),$(this).off(event.type,disableOneEvent)}function resetScroll(){this.scrollLeft=0,this.scrollTop=0}function isNumber(value){return!isNaN(parseFloat(value))&&isFinite(value)}function getPx($item,property){return 0|round(String($item.css(property)).replace(/[^\-0-9.]/g,""))}function within(number,min,max){return min>number?min:number>max?max:number}function StyleRestorer(element){var self={};return self.style={},self.save=function(){if(element&&element.nodeType){for(var i=0;i<arguments.length;i++)self.style[arguments[i]]=element.style[arguments[i]];return self}},self.restore=function(){if(element&&element.nodeType){for(var prop in self.style)self.style.hasOwnProperty(prop)&&(element.style[prop]=self.style[prop]);return self}},self}var transform,gpuAcceleration,time,pluginName="sly",className="Sly",namespace=pluginName,cAF=w.cancelAnimationFrame||w.cancelRequestAnimationFrame,rAF=w.requestAnimationFrame,$doc=$(document),dragInitEvents="touchstart."+namespace+" mousedown."+namespace,dragMouseEvents="mousemove."+namespace+" mouseup."+namespace,dragTouchEvents="touchmove."+namespace+" touchend."+namespace,wheelEvent=(document.implementation.hasFeature("Event.wheel","3.0")?"wheel.":"mousewheel.")+namespace,clickEvent="click."+namespace,mouseDownEvent="mousedown."+namespace,interactiveElements=["INPUT","SELECT","BUTTON","TEXTAREA"],tmpArray=[],abs=Math.abs,sqrt=Math.sqrt,pow=Math.pow,round=Math.round,max=Math.max,min=Math.min,lastGlobalWheel=0;$doc.on(wheelEvent,function(event){var sly=event.originalEvent[namespace],time=+new Date;(!sly||sly.options.scrollHijack<time-lastGlobalWheel)&&(lastGlobalWheel=time)}),Sly.getInstance=function(element){return $.data(element,namespace)},Sly.storeInstance=function(element,sly){return $.data(element,namespace,sly)},Sly.removeInstance=function(element){return $.removeData(element,namespace)},function(w){function fallback(fn){var curr=(new Date).getTime(),ms=Math.max(0,16-(curr-prev)),req=setTimeout(fn,ms);return prev=curr,req}rAF=w.requestAnimationFrame||w.webkitRequestAnimationFrame||fallback;var prev=(new Date).getTime(),cancel=w.cancelAnimationFrame||w.webkitCancelAnimationFrame||w.clearTimeout;cAF=function(id){cancel.call(w,id)}}(window),function(){function testProp(prop){for(var p=0,pl=prefixes.length;pl>p;p++){var prefixedProp=prefixes[p]?prefixes[p]+prop.charAt(0).toUpperCase()+prop.slice(1):prop;if(null!=el.style[prefixedProp])return prefixedProp}}var prefixes=["","Webkit","Moz","ms","O"],el=document.createElement("div");transform=testProp("transform"),gpuAcceleration=testProp("perspective")?"translateZ(0) ":""}(),w[className]=Sly,$.fn[pluginName]=function(options,callbackMap){var method,methodArgs;return $.isPlainObject(options)||(("string"===type(options)||options===!1)&&(method=options===!1?"destroy":options,methodArgs=Array.prototype.slice.call(arguments,1)),options={}),this.each(function(i,element){var plugin=Sly.getInstance(element);plugin||method?plugin&&method&&plugin[method]&&plugin[method].apply(plugin,methodArgs):plugin=new Sly(element,options,callbackMap).init()})},Sly.defaults={slidee:null,horizontal:!1,itemNav:null,itemSelector:null,smart:!1,activateOn:null,activateMiddle:!1,scrollSource:null,scrollBy:0,scrollHijack:300,scrollTrap:!1,dragSource:null,mouseDragging:!1,touchDragging:!1,releaseSwing:!1,swingSpeed:.2,elasticBounds:!1,dragThreshold:3,interactive:null,scrollBar:null,dragHandle:!1,dynamicHandle:!1,minHandleSize:50,clickBar:!1,syncSpeed:.5,pagesBar:null,activatePageOn:null,pageBuilder:function(index){return"<li>"+(index+1)+"</li>"},forward:null,backward:null,prev:null,next:null,prevPage:null,nextPage:null,cycleBy:null,cycleInterval:5e3,pauseOnHover:!1,startPaused:!1,moveBy:300,speed:0,easing:"swing",startAt:null,keyboardNavBy:null,draggedClass:"dragged",activeClass:"active",disabledClass:"disabled"}}(jQuery,window),angular.module("layoutDirectiveModule",["accountFactoryModule","ui.bootstrap","configModule"]).directive("layoutNavDirective",["accountFactory","serviceUrlConfig","$window","commonFactory","$log",function(accountFactory,serviceUrlConfig,$window,commonFactory,$log){var result={};return result.restrict="A",result.scope={title:"@"},result.templateUrl="/views/directives/layout-nav.html?v="+commonFactory.htmlVersion,result.controller=function($rootScope,$scope,$state){function reloadNav(){$scope.nav.getLogoUrl=accountFactory.getRoleHome(),$scope.nav.accountFactory=accountFactory,$scope.nav.account=accountFactory.getInfo(),$scope.nav.isLogin=accountFactory.isLogin(),$scope.nav.accountIcon=accountFactory.getIcon()}function toggleMenuPopup(open){$("#account-menu").css("display",open?"block":"none"),$(".tool-tip").css("visibility",open?"hidden":""),$(".tool-tip").css("opacity",open?"0":"")}function isOpenMenuPopup(){return"block"===$("#account-menu").css("display")}$scope.currentPath=$state.current.name,$scope.accountType=accountFactory.getUserRole(),$scope.isPremium=accountFactory.isPremium(),$scope.indexPath="student"===$scope.accountType?"student.index":"tutor.index",$scope.catnipImagePath="images/catnip_student.f792a611.png","student"!==$scope.accountType&&($scope.catnipImagePath="images/catnip_tutor.4c654578.png"),$scope.nav={},$scope.tutorCommitMode=!1,$scope.$on("$stateChangeStart",function(next,current){$scope.currentPath=current.name}),$scope.$on("reloadNav",function(){reloadNav()}),$scope.$on("profileHasChanged",function(){reloadNav()}),$scope.$on("profileHasChanged",function(){reloadNav()}),$rootScope.$on("emitOnCommitMode",function(){$scope.tutorCommitMode=!0}),$rootScope.$on("emitOffCommitMode",function(){$scope.tutorCommitMode=!1}),$rootScope.$on("reloadAccount",function(){var promise=accountFactory.loadInfo();promise.then(function(){$scope.nav.account=accountFactory.getInfo()},function(){accountFactory.logout()})}),$scope.goIndex=function(){return $scope.tutorCommitMode?void 0:(commonFactory.savePage(1),commonFactory.saveFavorite(!1),$scope.nav.isLogin?void($state.current.name===$scope.indexPath?$state.reload():$state.go($scope.indexPath)):void $state.go("index"))},$scope.join=function(){"becomeatutor"===$scope.currentPath?$window.location.href=commonFactory.getRoleJoinUrl("tutor"):$window.location.href=commonFactory.getJoinUrl()},$scope.login=function(){$window.location.href=commonFactory.getLoginUrl()},reloadNav(),$scope.nav.logout=function(){$scope.tutorCommitMode||accountFactory.logout()},$scope.nav.goApp=function(){accountFactory.checkRole(accountFactory.accountRole.NAV,!0)},$scope.nav.goToBuyCatnip=function(){$scope.tutorCommitMode||$state.go("student"===$scope.accountType?"my-account.catnip":"my-account.cash-out")},$scope.nav.goChatHistory=function(){$scope.tutorCommitMode||$state.go("tutor.history")},$scope.nav.closeCatnipPopup=function(){commonFactory.setCatnipPopupClose(!0),$(".tool-tip").css("visibility","hidden"),$(".tool-tip").css("opacity","0")},$scope.nav.closePremiumPopup=function(){commonFactory.setPremiumPopupClose(!0),$("#premiumPopup").css("visibility","hidden")},$scope.nav.catnipPopupClose=commonFactory.getCatnipPopupClose(),$scope.nav.premiumPopupClose=commonFactory.getPremiumPopupClose(),$("#accountInfo").click(function(e){e.stopPropagation(),$scope.nav.closePremiumPopup(),isOpenMenuPopup()?(toggleMenuPopup(!1),$scope.$broadcast("nav-menu-popup-hide")):(toggleMenuPopup(!0),$scope.$broadcast("nav-menu-popup-open")),$("body").click(function(){toggleMenuPopup(!1)})}),$scope.$on("noti-popup-open",function(){$scope.nav.closePremiumPopup(),$log.debug("noti-popup-open"),isOpenMenuPopup()&&toggleMenuPopup(!1)}),$scope.$on("noti-popup-hide",function(){$log.debug("noti-popup-hide")}),$scope.GoFaq=function(){$window.location.href=serviceUrlConfig+"/faq"}},result}]),angular.module("layoutDirectiveModule").animation(".banner",["$window",function($window){return{addClass:function(element,className,done){"menu-open"===className?$window.TweenMax.to(element,1,{"max-height":"1000px"}):done()},removeClass:function(element,className,done){"menu-open"===className?$window.TweenMax.to(element,1,{"max-height":"0"}):done()}}}]),angular.module("layoutDirectiveModule").directive("layoutFooterDirective",["accountFactory","serviceUrlConfig","commonFactory",function(accountFactory,serviceUrlConfig,commonFactory){var result={};return result.restrict="A",result.templateUrl="/views/directives/layout-footer.html?v="+commonFactory.htmlVersion,result.controller=function($scope,$window){$scope.serviceUrlConfig=serviceUrlConfig,$scope.accountType=accountFactory.getUserRole(),$scope.isLogin=accountFactory.isLogin(),$scope.isShowTutorFaq="experienced_tutor"===$scope.accountType||"trainee_tutor"===$scope.accountType,$scope.isShowStudentFaq="student"===$scope.accountType,$scope.redirectTo=function(path){$window.location.href=$scope.serviceUrlConfig+path}},result}]),angular.module("countDirectiveModule",[]).directive("countDirective",["$timeout","$window",function($timeout,$window){var result={};return result.restrict="A",result.scope={expiredAt:"=expiredAt",start:"=start",countEndCallback:"=countEndCallback"},result.template="{{count}} sec",result.controller=function($scope){function setCount(){return $scope.count=Math.floor(($window.moment.utc($scope.expiredAt).valueOf()-$window.moment.utc().valueOf())/1e3),$scope.count<=0?(closeCount(),void $scope.countEndCallback()):void(countTimer=$timeout(setCount,1e3))}function closeCount(){$scope.count="---",countTimer&&$timeout.cancel(countTimer)}$scope.count="---",$scope.$watch("start",function(newVal){newVal?setCount():closeCount()});var countTimer},result}]),angular.module("chatBoxDirectiveModule",["apisFactoryModule","countDirectiveModule","filterModule","ngSanitize","accountFactoryModule","modalServiceModule"]).directive("chatBoxDirective",["apisFactory","socketEvent","$filter","$sce","accountFactory","$timeout","advancedOptionsFactory","modalService","$window","commonFactory","langTextFactory","$state",function(apisFactory,socketEvent,$filter,$sce,accountFactory,$timeout,advancedOptionsFactory,modalService,$window,commonFactory,langTextFactory,$state){
var result={};return result.restrict="A",result.scope={topic:"=topic",currentPage:"=currentPage"},result.templateUrl="/views/directives/chat-box.html?v="+commonFactory.htmlVersion,result.controller=function($scope){function getListContent(content){var result=content;return content&&content.length>495&&(result=$filter("limitTo")(content,495,0)+"..."),result=$filter("newlines")(result)}function initListContent(){$scope.listContent=getListContent($scope.topic.originContent);for(var i=0;i<$scope.topic.corrected_texts.length;i++){var c=$scope.topic.corrected_texts[i];c.listContent=getListContent($scope.topic.corrected_texts[i].originContent)}}function isWaiting(newVal){return("waiting"===newVal||"reopened"===newVal)&&"correcting"!==newVal}var id=$scope.topic.id;$scope.accountType=accountFactory.getUserRole(),$scope.notMakeSense=langTextFactory.get("en-us","student.chat.not-make-sense"),$scope.listContent="",initListContent(),$scope.$on(socketEvent.topicUpdatedBroadcasted,function(event,args){args.original_text_id===$scope.topic.id&&$timeout($scope.reloadTopic,1500)}),$scope.backColorMint=commonFactory.backColor.waitMint,$scope.showWaitingMsg=isWaiting($scope.topic.state),$scope.$watch("topic.state",function(newVal){$scope.showWaitingMsg=isWaiting(newVal)}),$scope.hoverItem=function(hover){hover?($("#"+id+"_panel").css("background-color",commonFactory.backColor.overMint),$("#"+id+"_panel").css("box-shadow","2px 2px 2px #f0f0f0")):($("#"+id+"_panel").css("background-color",commonFactory.isTopicCompletedState($scope.topic.state)?commonFactory.backColor.white:commonFactory.backColor.waitMint),$("#"+id+"_panel").css("box-shadow","1px 0 1px #f0f0f0"))},$scope.cost=commonFactory.getCost($scope.topic),$scope.reloadTopic=function(){var promise=apisFactory.getTopic($scope.topic.id);promise.then(function(d){$scope.topic=$filter("parseTopic")(d),initListContent(),$scope.showWaitingMsg=isWaiting($scope.topic.state)},function(){})},$scope.favoriteTopic=function(){commonFactory.showWaiting();var promise=apisFactory.favoriteTopic($scope.topic.id);promise.then(function(d){$scope.topic=$filter("parseTopic")(d),initListContent(),commonFactory.hideWaiting()},function(){commonFactory.hideWaiting()})},$scope.goToOneChat=function(){$state.go("student.one-chat",{topic:$scope.topic})}},result}]),angular.module("tutorCorrectBoxDirectiveModule",["accountFactoryModule","apisFactoryModule","countDirectiveModule","topicEventModule","filterModule","notificationFactoryModule"]).directive("tutorCorrectBoxDirective",["apisFactory","accountFactory","$timeout","topicCorrectionEvent","notificationFactory","socketEvent","$filter","$window","advancedOptionsFactory","commonFactory","$log","$state","modalService",function(apisFactory,accountFactory,$timeout,topicCorrectionEvent,notificationFactory,socketEvent,$filter,$window,advancedOptionsFactory,commonFactory,$log,$state,modalService){var result={};return result.restrict="A",result.scope={topic:"=topicData"},result.transclude=!0,result.templateUrl="/views/directives/tutor-correct-box.html?v="+commonFactory.htmlVersion,result.controller=function($scope){function checkAlreadyCorrected(){if($scope.alerts=[],$scope.topic.hasOwnProperty("corrected_texts"))for(var i=-1,cnt=$scope.topic.corrected_texts.length;++i<cnt;)if(parseInt($scope.account.id)===parseInt($scope.topic.corrected_texts[i].user.id)){$scope.alerts.push({type:"danger",msg:"You are correcting this chat."}),$scope.hideCommitBtn=!0;break}}function checkOwnThisChat(){return"correcting"===$scope.topic.state&&$scope.topic.locked_by&&$scope.topic.locked_by.id===$scope.account.id}$log.debug(JSON.stringify($scope.topic));var id=$scope.topic.id;$scope.accountType=accountFactory.getUserRole(),$scope.catnip=parseFloat($scope.topic.cost),$scope.hideCommitBtn=!1,$scope.account=accountFactory.getInfo().info,$scope.topicCorrectContent=$scope.topic.originContent,$scope.topicCorrectContent&&$scope.topicCorrectContent.length>495&&($scope.topicCorrectContent=$filter("limitTo")($scope.topicCorrectContent,495,0)+"..."),$scope.topicCorrectContent=$filter("newlines")($scope.topicCorrectContent),$scope.alerts=[],$scope.isPremium="premium"===$scope.topic.type?!0:!1,$scope.hoverItem=function(hover){hover?($("#"+id+"_panel").css("background-color",commonFactory.backColor.overMint),$("#"+id+"_panel").css("box-shadow","2px 2px 2px #f0f0f0")):($("#"+id+"_panel").css("background-color",commonFactory.backColor.white),$("#"+id+"_panel").css("box-shadow","1px 0 1px #f0f0f0"))},$scope.hideCommitBtn=commonFactory.hasDeclined($scope.topic,$scope.account.id),checkAlreadyCorrected(),checkOwnThisChat()&&$scope.alerts.push({type:"danger",msg:"You already committed this chat."}),$scope.commitTopic=function(){if($scope.alerts=[],checkOwnThisChat())return notificationFactory.notification("correcting","tutor"),void $state.go("tutor.one-chat",{topic:$scope.topic});var promise=apisFactory.updateTopicState($scope.topic.id,$scope.account.id,"lock");promise.then(function(d){notificationFactory.notification("correcting","tutor");var newTopic=$filter("parseTopic")(d);$scope.topic=newTopic,$state.go("tutor.one-chat",{topic:$scope.topic}),mixpanel.track("Chat: Commit",{Elapsed:($window.moment.utc(newTopic.locked_at).valueOf()-$window.moment.utc(newTopic.org_created_at).valueOf())/1e3})},function(e){var code=e.data.code,message=e.data.message;switch($scope.alerts=[],code){case 201:$scope.alerts.push({type:"danger",msg:"You already corrected this chat."});break;case 998:$scope.alerts.push({type:"danger",msg:message});break;case 300:$scope.alerts.push({type:"danger",msg:"Another tutor took this chat."});break;case 204:$scope.alerts.push({type:"danger",msg:"You can only correct one chat at a time."});break;case 999:$scope.alerts.push({type:"danger",msg:message})}})},$scope.$on("onCommitMode",function(event,args){$log.debug(JSON.stringify(args)),args.id!==$scope.topic.id&&($scope.hideCommitBtn=!0)}),$scope.$on("offCommitMode",function(event,args){args.id!==$scope.topic.id&&($scope.hideCommitBtn=commonFactory.hasDeclined($scope.topic,$scope.account.id),checkAlreadyCorrected())});var isDeclineProcess=!1;$scope.declineTopic=function(){var promise=apisFactory.declineTopic($scope.topic.id);promise.then(function(d){var newTopic=$filter("parseTopic")(d);$scope.topic=newTopic,$log.debug(JSON.stringify($scope.topic)),$scope.hideCommitBtn=!0,mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("Chat: Decline",{Elapsed:($window.moment.utc().valueOf()-$window.moment.utc(newTopic.org_created_at).valueOf())/1e3}),mixpanel.people.increment({"Chats Declined":1}),commonFactory.hideWaiting(),isDeclineProcess=!1},function(e){isDeclineProcess=!1,commonFactory.hideWaiting();var code=e.data.code,message=e.data.message;switch(code){case 205:modalService.open({title:"Warning",content:"You already declined this chat.",isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0});break;case 998:modalService.open({title:"Warning",content:message,isOnlyClose:!0,closeBtnName:"Close",alertIcon:!0})}})}},result}]),angular.module("tutor-profile-box",["commonFactoryModule"]).directive("tutorProfileBox",["commonFactory","accountFactory","$log","$state","apisFactory",function(commonFactory,accountFactory,$log,$state,apisFactory){return{restrict:"E",scope:{tutor:"=tutor",tutorId:"=?tutorId",boxStyle:"=?boxStyle"},templateUrl:"/views/directives/tutor-profile-box.html?v="+commonFactory.htmlVersion,link:function(scope,element,attr){(void 0!==scope.tutor||void 0!==scope.tutorId)&&(scope.tutorInfo=null,scope.tutor&&(scope.tutorId=scope.tutor.id),apisFactory.getTutorInfo(scope.tutorId,function(success){$log.debug(JSON.stringify(success)),scope.tutorInfo=success.info,scope.isOpen=scope.tutorInfo.open_type===commonFactory.tutorOpenType.open?!0:!1,scope.isOpen&&scope.tutorInfo.user.thumbnail&&(scope.profileUrl=accountFactory.getImageUrl(scope.tutorInfo.user.thumbnail))},function(fail){$log.debug(JSON.stringify(fail))}),scope.profileUrl="/images/tutor_default_avatar.fb88ac38.png",scope.description="",void 0!==attr.description&&(scope.description=attr.description),scope.click=function(){$state.go("tutor.info-view",{id:scope.tutorId})})}}}]),angular.module("notificationDirectiveModule",["configModule"]).directive("notificationDirective",["commonFactory","webStorage","routeName","$state","$timeout","$log","notificationFactory",function(commonFactory,webStorage,routeName,$state,$timeout,$log,notificationFactory){var result={};return result.restrict="A",result.scope={},result.templateUrl="/views/directives/notification.html?v="+commonFactory.htmlVersion,result.controller=function($rootScope,$scope,socketFactory,socketHeartbeatInterval,accountFactory){function toggleNotiPopup(open){$("#noti-list").css("display",open?"block":"none")}function isOpenNotiPopup(){return"block"===$("#noti-list").css("display")}accountFactory.isLogin()&&($scope.notiList=[],$scope.notiCount=0,$scope.lastNotiCreatedAt=webStorage.local.get("last_read_noti_created_at"),null===$scope.lastNotiCreatedAt&&($scope.lastNotiCreatedAt=0),$scope.offset=0,$scope.limit=5,$scope.isMore=!1,$scope.loadNoti=function(isFirst){notificationFactory.loadNotifications($scope.offset,$scope.limit,function(success){if($log.debug(JSON.stringify(success)),$scope.notiList=$scope.notiList.concat(success.notifications),isFirst){for(var i in success.notifications){if($scope.lastNotiCreatedAt>=success.notifications[i].created_at)break;$scope.notiCount++}success.notifications&&success.notifications.length>0&&($scope.lastNotiCreatedAt=success.notifications[0].created_at)}success.more?($scope.offset+=$scope.limit,$scope.isMore=!0):$scope.isMore=!1},function(){})},$scope.loadNoti(!0),$("#noti-bell").click(function(e){0!==$scope.lastNotiId&&(webStorage.local.add("last_read_noti_created_at",$scope.lastNotiCreatedAt),$scope.notiCount=0),e.stopPropagation(),isOpenNotiPopup()?(toggleNotiPopup(!1),$scope.$emit("noti-popup-hide")):(toggleNotiPopup(!0),$scope.$emit("noti-popup-open")),$("body").click(function(){toggleNotiPopup(!1)})}),$scope.link=function(noti){notificationFactory.notificationLink($state,noti)},$scope.socketClient=null,$scope.socketCheckTime=1e3*socketHeartbeatInterval,$scope.account=accountFactory.getInfo().info,$scope.socketConfig=function(){socketFactory.getClient($scope).then(function(socket){$scope.socketClient=socket,$scope.socketClient.subscribe($scope.account.id+"-noticenter",function(message){5===$scope.notiList.length&&$scope.notiList.splice(0,1),$scope.notiCount++,$scope.notiList.unshift(message),$scope.lastNotiCreatedAt=message.created_at})},function(){$timeout($scope.socketConfig,$scope.socketCheckTime)})},$scope.socketConfig(),$scope.$on("nav-menu-popup-open",function(){$log.debug("nav-menu-popup-open"),isOpenNotiPopup()&&toggleNotiPopup(!1)}),$scope.$on("nav-menu-popup-hide",function(){$log.debug("nav-menu-popup-hide")}))},result}]),angular.module("rating-star",[]).directive("ratingStar",function(){return{replace:!0,template:'<ul class="rate"></ul>',link:function($scope,elem,attrs){function drawStar(){elem.empty();for(var i=0;total>i;i++){var selected=colored>i?"selected":"unselected",s='<li style="cursor: default; background-size: 15px; width: 17px; height: 17px;" class="'+selected+'"></li>';elem.append(s)}}var total=void 0!==attrs.total?attrs.total:5,colored=1;attrs.$observe("colored",function(data){colored=Math.round(data),drawStar()},!0)}}}),angular.module("qnaDirectiveModule",["configModule"]).directive("qnaDirective",["apiUrlConfig","commonFactory","webStorage","routeName","$state","$timeout","$log",function(apiUrlConfig,commonFactory,webStorage,routeName,$state,$timeout,$log){var result={};return result.restrict="A",result.scope={correctedChatId:"@correctedChatId",originalChatId:"@originalChatId",isTutor:"=isTutor",toUserId:"=toUserId",chatType:"=chatType",fromUserName:"=fromUserName",correctedText:"=correctedText"},result.templateUrl="/views/directives/qna.html?v="+commonFactory.htmlVersion,result.controller=function($rootScope,$scope,$timeout,socketFactory,socketHeartbeatInterval,accountFactory,modalService,apisFactory,commonFactory,$filter){function loadList(){$timeout(function(){return""===$scope.correctedChatId?void loadList():($.ajax({url:apiUrlConfig+"/api/qna/"+$scope.correctedChatId,processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){$scope.qnaList=result;for(var i=0;i<$scope.qnaList.length;i++){var originalContent=$scope.qnaList[i].content;accountFactory.isPremium()?$scope.qnaList[i].content=$filter("nl2br")($filter("linky")(originalContent,"_blank")):$scope.qnaList[i].content=$filter("nl2br")(originalContent)}$scope.isHideAskBox=0===$scope.qnaList.length&&$scope.isTutor||0!==$scope.qnaList.length&&$scope.qnaList[0].from_user_id===$scope.userId},error:function(result){console.log(JSON.stringify(result))}}),void($scope.isTutor||($scope.profileUrl="/images/tutor_default_avatar.fb88ac38.png",apisFactory.getTutorInfo($scope.toUserId,function(success){$scope.tutorInfo=success;var isOpen=success.open_type===commonFactory.tutorOpenType.open?!0:!1;isOpen?($scope.profileUrl=accountFactory.getImageUrl($scope.tutorInfo.user.thumbnail),$scope.isDefaultProfile=!1):$scope.profileUrl="/images/tutor_default_avatar.fb88ac38.png"},function(fail){$log.debug(JSON.stringify(fail))}))))},500)}$scope.qContent="",$scope.qnaList=[],$scope.catnipPerText=70,$scope.showCost=$scope.isTutor?2:3,$scope.placeholder=$scope.isTutor?"Respond and receive 2 more Catnips.":"Each message requires 3 additional Catnips.",$scope.userId=accountFactory.getInfo().info.id,$scope.accountFactory=accountFactory,$scope.profileUrl="/images/student_default_avatar.5ae42913.png",$scope.isHideAskBox=!1,$scope.isDefaultProfile=!0,$scope.requestQna=function(){if(0!==$scope.qContent.length&&($scope.isInvalidCharError=$filter("isHangul")($scope.qContent),!$scope.isInvalidCharError)){if(!$scope.isTutor&&accountFactory.getInfo().info.available_catnips<$scope.showCost){var modalInfo={};return modalInfo.title="You don't have enough catnip.",modalInfo.content="You don't have enough catnip. Please buy some.",modalInfo.isOnlyClose=!1,modalInfo.okBtnName="Confirm",modalInfo.closeBtnName="No",modalInfo.okFunc=function(){$state.go("my-account.catnip")},void modalService.open(modalInfo)}$.ajax({url:apiUrlConfig+"/api/qna",processData:!1,contentType:!1,data:JSON.stringify({corrected_chat_id:$scope.correctedChatId,from_user_id:accountFactory.getInfo().info.id,to_user_id:$scope.toUserId,content:$scope.qContent,catnip:$scope.showCost,is_answer:$scope.isTutor,is_tutor_accept:$scope.isTutor,original_chat_id:$scope.originalChatId}),type:"POST",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken,"Content-Type":"application/json"},success:function(result){PUBNUB.publish({channel:$scope.toUserId+"-qna",message:result}),accountFactory.isPremium()?result.content=$filter("nl2br")($filter("linky")(result.content,"_blank")):result.content=$filter("nl2br")(result.content),$scope.qnaList.unshift(result);for(var j=0;j<$scope.qnaList.length;j++)$scope.isTutor&&($scope.qnaList[j].is_tutor_accept=!0);$rootScope.$emit("reloadAccount",{}),$scope.isHideAskBox=!0,mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track($scope.isTutor?"QnA: Answer":"QnA: Question"),mixpanel.people.increment({"QnA Created":1}),mixpanel.people.set({"Catnip Remaining":accountFactory.getInfo().info.available_catnips})},error:function(result){console.log(JSON.stringify(result))}})}},PUBNUB.subscribe({channel:accountFactory.getInfo().info.id+"-qna",message:function(result){if("cancel"===result)return void $scope.qnaList.splice(0,1);accountFactory.isPremium()?result.content=$filter("nl2br")($filter("linky")(result.content,"_blank")):result.content=$filter("nl2br")(result.content),$scope.qnaList.unshift(result);for(var i=0;i<$scope.qnaList.length;i++)$scope.qnaList[i].is_tutor_accept=!0;$scope.qContent="",$scope.isHideAskBox=!1}}),$scope.cancelQna=function(id){$.ajax({url:apiUrlConfig+"/api/qna/"+id,processData:!1,contentType:!1,type:"DELETE",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(){$scope.qnaList.splice(0,1),$scope.qContent="",$scope.isHideAskBox=!1,$rootScope.$emit("reloadAccount",{}),PUBNUB.publish({channel:$scope.toUserId+"-qna",message:"cancel"}),mixpanel.identify(accountFactory.getInfo().info.id.toString()),mixpanel.track("QnA: Cancel"),mixpanel.people.increment({"QnA Canceled":1})},error:function(result){console.log(JSON.stringify(result))}})},loadList()},result}]),angular.module("qnaListDirectiveModule",["configModule"]).directive("qnaListDirective",["apiUrlConfig","commonFactory","webStorage","routeName","$state",function(apiUrlConfig,commonFactory,webStorage,routeName,$state){var result={};return result.restrict="A",result.scope={},result.templateUrl="/views/directives/qna-list.html?v="+commonFactory.htmlVersion,result.controller=function($rootScope,$scope,$timeout,socketFactory,socketHeartbeatInterval,accountFactory,modalService,apisFactory,commonFactory,apiUrlConfig,$filter){$scope.qnaList=[],$.ajax({url:apiUrlConfig+"/api/qna",processData:!1,contentType:!1,type:"GET",withCredentials:!1,headers:{Authorization:"Bearer "+commonFactory.getAuth().accessToken},success:function(result){console.log(JSON.stringify(result)),$scope.qnaList=result.qnas;for(var i=0;i<$scope.qnaList.length;i++)$scope.qnaList[i].corrected_content&&$scope.qnaList[i].corrected_content.length>495&&($scope.qnaList[i].corrected_content=$filter("limitTo")($scope.qnaList[i].corrected_content,495,0)+"..."),$scope.qnaList[i].corrected_content=$filter("newlines")($scope.qnaList[i].corrected_content),$scope.qnaList[i].content=$filter("newlines")($scope.qnaList[i].content)},error:function(result){console.log(JSON.stringify(result))}}),$scope.goChatOneHistory=function(originalChatId){$state.go("tutor.one-history",{topicId:originalChatId})}},result}]),angular.module("chatRespondTimeDirectiveModule",[]).directive("chatRespondTimeDirective",["apiUrlConfig","commonFactory",function(apiUrlConfig,commonFactory){var result={};return result.restrict="A",result.templateUrl="/views/directives/chat-respond-time.html?v="+commonFactory.htmlVersion,result.controller=function($scope){$scope.roundedMin=0,$scope.unit="-",$scope.min="00",$scope.sec="00",$.getJSON(apiUrlConfig+"/api/current_respond_time",function(response){response.respond_time_in_sec<60?($scope.unit="Sec",$scope.roundedMin=response.respond_time_in_sec):($scope.unit="Min",$scope.roundedMin=Math.ceil(response.respond_time_in_sec/60)),$scope.min=("00"+Math.floor(response.respond_time_in_sec/60)).slice(-2),$scope.sec=("00"+response.respond_time_in_sec%60).slice(-2),$scope.$apply()})},result}]);